<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>The Book – The Little Book of C</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../index.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-1fe81d0376b2c50856e68e651e390326.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-27c261d06b905028a18691de25d09dde.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../books/en-US/book.html"><span class="chapter-title">The Book</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../../index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">The Little Book of C</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Content</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../books/en-US/book.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">The Book</span></a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#chapter-1.-getting-started" id="toc-chapter-1.-getting-started" class="nav-link active" data-scroll-target="#chapter-1.-getting-started">Chapter 1. Getting Started</a>
  <ul class="collapse">
  <li><a href="#what-c-is-and-why-it-still-matters" id="toc-what-c-is-and-why-it-still-matters" class="nav-link" data-scroll-target="#what-c-is-and-why-it-still-matters">1. What C Is and Why It Still Matters</a></li>
  <li><a href="#installing-a-c-compiler-gcc-clang-tinycc" id="toc-installing-a-c-compiler-gcc-clang-tinycc" class="nav-link" data-scroll-target="#installing-a-c-compiler-gcc-clang-tinycc">2. Installing a C Compiler (gcc, clang, tinycc)</a></li>
  <li><a href="#writing-and-running-your-first-program" id="toc-writing-and-running-your-first-program" class="nav-link" data-scroll-target="#writing-and-running-your-first-program">3. Writing and Running Your First Program</a></li>
  <li><a href="#anatomy-of-a-c-program" id="toc-anatomy-of-a-c-program" class="nav-link" data-scroll-target="#anatomy-of-a-c-program">4. Anatomy of a C Program</a></li>
  <li><a href="#using-headers-and-the-preprocessor" id="toc-using-headers-and-the-preprocessor" class="nav-link" data-scroll-target="#using-headers-and-the-preprocessor">5. Using Headers and the Preprocessor</a></li>
  <li><a href="#compiling-linking-and-executing" id="toc-compiling-linking-and-executing" class="nav-link" data-scroll-target="#compiling-linking-and-executing">6. Compiling, Linking, and Executing</a></li>
  <li><a href="#common-errors-and-warnings" id="toc-common-errors-and-warnings" class="nav-link" data-scroll-target="#common-errors-and-warnings">7. Common Errors and Warnings</a></li>
  <li><a href="#command-line-basics-for-c-developers" id="toc-command-line-basics-for-c-developers" class="nav-link" data-scroll-target="#command-line-basics-for-c-developers">8. Command Line Basics for C Developers</a></li>
  <li><a href="#setting-up-a-minimal-project-structure" id="toc-setting-up-a-minimal-project-structure" class="nav-link" data-scroll-target="#setting-up-a-minimal-project-structure">9. Setting Up a Minimal Project Structure</a></li>
  </ul></li>
  <li><a href="#chapter-2.-language-basics" id="toc-chapter-2.-language-basics" class="nav-link" data-scroll-target="#chapter-2.-language-basics">Chapter 2. Language Basics</a>
  <ul class="collapse">
  <li><a href="#data-types-and-variables" id="toc-data-types-and-variables" class="nav-link" data-scroll-target="#data-types-and-variables">11. Data Types and Variables</a></li>
  <li><a href="#constants-literals-and-enumerations" id="toc-constants-literals-and-enumerations" class="nav-link" data-scroll-target="#constants-literals-and-enumerations">12. Constants, Literals, and Enumerations</a></li>
  <li><a href="#operators-and-expressions" id="toc-operators-and-expressions" class="nav-link" data-scroll-target="#operators-and-expressions">13. Operators and Expressions</a></li>
  <li><a href="#control-flow-if-else-switch" id="toc-control-flow-if-else-switch" class="nav-link" data-scroll-target="#control-flow-if-else-switch">14. Control Flow: if, else, switch</a></li>
  <li><a href="#loops-for-while-do-while" id="toc-loops-for-while-do-while" class="nav-link" data-scroll-target="#loops-for-while-do-while">15. Loops: for, while, do-while</a></li>
  <li><a href="#functions-and-parameters" id="toc-functions-and-parameters" class="nav-link" data-scroll-target="#functions-and-parameters">16. Functions and Parameters</a></li>
  <li><a href="#scope-and-lifetime-of-variables" id="toc-scope-and-lifetime-of-variables" class="nav-link" data-scroll-target="#scope-and-lifetime-of-variables">17. Scope and Lifetime of Variables</a></li>
  <li><a href="#return-values-and-function-signatures" id="toc-return-values-and-function-signatures" class="nav-link" data-scroll-target="#return-values-and-function-signatures">18. Return Values and Function Signatures</a></li>
  <li><a href="#static-vs-dynamic-linking-of-code-units" id="toc-static-vs-dynamic-linking-of-code-units" class="nav-link" data-scroll-target="#static-vs-dynamic-linking-of-code-units">19. Static vs Dynamic Linking of Code Units</a></li>
  <li><a href="#practice-build-a-simple-calculator" id="toc-practice-build-a-simple-calculator" class="nav-link" data-scroll-target="#practice-build-a-simple-calculator">20. Practice: Build a Simple Calculator</a></li>
  </ul></li>
  <li><a href="#chapter-3.-working-with-memory" id="toc-chapter-3.-working-with-memory" class="nav-link" data-scroll-target="#chapter-3.-working-with-memory">Chapter 3. Working with Memory</a>
  <ul class="collapse">
  <li><a href="#understanding-memory-layout-stack-heap-data-code" id="toc-understanding-memory-layout-stack-heap-data-code" class="nav-link" data-scroll-target="#understanding-memory-layout-stack-heap-data-code">21. Understanding Memory Layout (Stack, Heap, Data, Code)</a></li>
  <li><a href="#pointers-and-addresses" id="toc-pointers-and-addresses" class="nav-link" data-scroll-target="#pointers-and-addresses">22. Pointers and Addresses</a></li>
  <li><a href="#arrays-and-pointer-arithmetic" id="toc-arrays-and-pointer-arithmetic" class="nav-link" data-scroll-target="#arrays-and-pointer-arithmetic">23. Arrays and Pointer Arithmetic</a></li>
  <li><a href="#strings-as-character-arrays" id="toc-strings-as-character-arrays" class="nav-link" data-scroll-target="#strings-as-character-arrays">24. Strings as Character Arrays</a></li>
  <li><a href="#dynamic-memory-allocation-malloc-calloc-realloc-free" id="toc-dynamic-memory-allocation-malloc-calloc-realloc-free" class="nav-link" data-scroll-target="#dynamic-memory-allocation-malloc-calloc-realloc-free">25. Dynamic Memory Allocation (malloc, calloc, realloc, free)</a></li>
  <li><a href="#memory-leaks-and-undefined-behavior" id="toc-memory-leaks-and-undefined-behavior" class="nav-link" data-scroll-target="#memory-leaks-and-undefined-behavior">26. Memory Leaks and Undefined Behavior</a></li>
  <li><a href="#const-and-volatile-qualifiers" id="toc-const-and-volatile-qualifiers" class="nav-link" data-scroll-target="#const-and-volatile-qualifiers">27. const and volatile Qualifiers</a></li>
  <li><a href="#function-pointers-and-callbacks" id="toc-function-pointers-and-callbacks" class="nav-link" data-scroll-target="#function-pointers-and-callbacks">28. Function Pointers and Callbacks</a></li>
  <li><a href="#deep-vs-shallow-copies" id="toc-deep-vs-shallow-copies" class="nav-link" data-scroll-target="#deep-vs-shallow-copies">29. Deep vs Shallow Copies</a></li>
  <li><a href="#practice-manual-memory-management" id="toc-practice-manual-memory-management" class="nav-link" data-scroll-target="#practice-manual-memory-management">30. Practice: Manual Memory Management</a></li>
  </ul></li>
  <li><a href="#chapter-4.-structuring-data" id="toc-chapter-4.-structuring-data" class="nav-link" data-scroll-target="#chapter-4.-structuring-data">Chapter 4. Structuring Data</a>
  <ul class="collapse">
  <li><a href="#structures-and-nested-structures" id="toc-structures-and-nested-structures" class="nav-link" data-scroll-target="#structures-and-nested-structures">31. Structures and Nested Structures</a></li>
  <li><a href="#unions-and-type-reuse" id="toc-unions-and-type-reuse" class="nav-link" data-scroll-target="#unions-and-type-reuse">32. Unions and Type Reuse</a></li>
  <li><a href="#typedef-and-code-clarity" id="toc-typedef-and-code-clarity" class="nav-link" data-scroll-target="#typedef-and-code-clarity">33. Typedef and Code Clarity</a></li>
  <li><a href="#bitfields-and-memory-packing" id="toc-bitfields-and-memory-packing" class="nav-link" data-scroll-target="#bitfields-and-memory-packing">34. Bitfields and Memory Packing</a></li>
  <li><a href="#enumerations-revisited" id="toc-enumerations-revisited" class="nav-link" data-scroll-target="#enumerations-revisited">35. Enumerations Revisited</a></li>
  <li><a href="#linked-lists-from-scratch" id="toc-linked-lists-from-scratch" class="nav-link" data-scroll-target="#linked-lists-from-scratch">36. Linked Lists from Scratch</a></li>
  <li><a href="#stacks-and-queues-with-structs" id="toc-stacks-and-queues-with-structs" class="nav-link" data-scroll-target="#stacks-and-queues-with-structs">37. Stacks and Queues with Structs</a></li>
  <li><a href="#hash-tables-and-function-pointers" id="toc-hash-tables-and-function-pointers" class="nav-link" data-scroll-target="#hash-tables-and-function-pointers">38. Hash Tables and Function Pointers</a></li>
  <li><a href="#minimal-object-oriented-design-in-c" id="toc-minimal-object-oriented-design-in-c" class="nav-link" data-scroll-target="#minimal-object-oriented-design-in-c">39. Minimal Object-Oriented Design in C</a></li>
  <li><a href="#practice-build-a-tiny-library-system" id="toc-practice-build-a-tiny-library-system" class="nav-link" data-scroll-target="#practice-build-a-tiny-library-system">40. Practice: Build a Tiny Library System</a></li>
  </ul></li>
  <li><a href="#chapter-5.-input-output-and-files" id="toc-chapter-5.-input-output-and-files" class="nav-link" data-scroll-target="#chapter-5.-input-output-and-files">Chapter 5. Input, Output and Files</a>
  <ul class="collapse">
  <li><a href="#standard-io-and-printfscanf" id="toc-standard-io-and-printfscanf" class="nav-link" data-scroll-target="#standard-io-and-printfscanf">41. Standard I/O and printf/scanf</a></li>
  <li><a href="#file-pointers-and-fopen-fclose" id="toc-file-pointers-and-fopen-fclose" class="nav-link" data-scroll-target="#file-pointers-and-fopen-fclose">42. File Pointers and <code>fopen</code> / <code>fclose</code></a></li>
  <li><a href="#reading-and-writing-binary-files" id="toc-reading-and-writing-binary-files" class="nav-link" data-scroll-target="#reading-and-writing-binary-files">43. Reading and Writing Binary Files</a></li>
  <li><a href="#working-with-stdin-stdout-and-stderr" id="toc-working-with-stdin-stdout-and-stderr" class="nav-link" data-scroll-target="#working-with-stdin-stdout-and-stderr">44. Working with <code>stdin</code>, <code>stdout</code>, and <code>stderr</code></a></li>
  <li><a href="#buffered-io-with-fgets-and-fputs" id="toc-buffered-io-with-fgets-and-fputs" class="nav-link" data-scroll-target="#buffered-io-with-fgets-and-fputs">45. Buffered I/O with <code>fgets</code> and <code>fputs</code></a></li>
  <li><a href="#error-checking-with-errno-and-perror" id="toc-error-checking-with-errno-and-perror" class="nav-link" data-scroll-target="#error-checking-with-errno-and-perror">46. Error Checking with <code>errno</code> and <code>perror</code></a></li>
  <li><a href="#command-line-arguments-argc-argv" id="toc-command-line-arguments-argc-argv" class="nav-link" data-scroll-target="#command-line-arguments-argc-argv">47. Command-Line Arguments (<code>argc</code>, <code>argv</code>)</a></li>
  <li><a href="#reading-configuration-files" id="toc-reading-configuration-files" class="nav-link" data-scroll-target="#reading-configuration-files">48. Reading Configuration Files</a></li>
  <li><a href="#serializing-structs-to-disk" id="toc-serializing-structs-to-disk" class="nav-link" data-scroll-target="#serializing-structs-to-disk">49. Serializing Structs to Disk</a></li>
  <li><a href="#practice-build-a-log-reader-and-writer" id="toc-practice-build-a-log-reader-and-writer" class="nav-link" data-scroll-target="#practice-build-a-log-reader-and-writer">50. Practice: Build a Log Reader and Writer</a></li>
  </ul></li>
  <li><a href="#chapter-6.-compilation-and-the-build-process" id="toc-chapter-6.-compilation-and-the-build-process" class="nav-link" data-scroll-target="#chapter-6.-compilation-and-the-build-process">Chapter 6. Compilation and the build process</a>
  <ul class="collapse">
  <li><a href="#from-source-to-executable-the-compilation-pipeline" id="toc-from-source-to-executable-the-compilation-pipeline" class="nav-link" data-scroll-target="#from-source-to-executable-the-compilation-pipeline">51. From Source to Executable: The Compilation Pipeline</a></li>
  <li><a href="#the-preprocessor-and-macros" id="toc-the-preprocessor-and-macros" class="nav-link" data-scroll-target="#the-preprocessor-and-macros">52. The Preprocessor and Macros</a></li>
  <li><a href="#conditional-compilation-if-ifdef-ifndef" id="toc-conditional-compilation-if-ifdef-ifndef" class="nav-link" data-scroll-target="#conditional-compilation-if-ifdef-ifndef">53. Conditional Compilation (<code>#if</code>, <code>#ifdef</code>, <code>#ifndef</code>)</a></li>
  <li><a href="#inline-functions-and-header-hygiene" id="toc-inline-functions-and-header-hygiene" class="nav-link" data-scroll-target="#inline-functions-and-header-hygiene">54. Inline Functions and Header Hygiene</a></li>
  <li><a href="#makefiles-and-build-automation" id="toc-makefiles-and-build-automation" class="nav-link" data-scroll-target="#makefiles-and-build-automation">55. Makefiles and Build Automation</a></li>
  <li><a href="#linking-multiple-files" id="toc-linking-multiple-files" class="nav-link" data-scroll-target="#linking-multiple-files">56. Linking Multiple Files</a></li>
  <li><a href="#static-and-shared-libraries" id="toc-static-and-shared-libraries" class="nav-link" data-scroll-target="#static-and-shared-libraries">57. Static and Shared Libraries</a></li>
  <li><a href="#compiler-flags-and-optimization-levels" id="toc-compiler-flags-and-optimization-levels" class="nav-link" data-scroll-target="#compiler-flags-and-optimization-levels">58. Compiler Flags and Optimization Levels</a></li>
  <li><a href="#understanding-the-object-file" id="toc-understanding-the-object-file" class="nav-link" data-scroll-target="#understanding-the-object-file">59. Understanding the Object File</a></li>
  <li><a href="#practice-write-your-own-makefile" id="toc-practice-write-your-own-makefile" class="nav-link" data-scroll-target="#practice-write-your-own-makefile">60. Practice: Write Your Own Makefile</a></li>
  </ul></li>
  <li><a href="#chapter-7.-working-close-to-the-system" id="toc-chapter-7.-working-close-to-the-system" class="nav-link" data-scroll-target="#chapter-7.-working-close-to-the-system">Chapter 7. Working Close to the System</a>
  <ul class="collapse">
  <li><a href="#system-calls-and-the-standard-library" id="toc-system-calls-and-the-standard-library" class="nav-link" data-scroll-target="#system-calls-and-the-standard-library">61. System Calls and the Standard Library</a></li>
  <li><a href="#process-creation-fork-exec-wait" id="toc-process-creation-fork-exec-wait" class="nav-link" data-scroll-target="#process-creation-fork-exec-wait">62. Process Creation (fork, exec, wait)</a></li>
  <li><a href="#file-descriptors-and-openreadwrite" id="toc-file-descriptors-and-openreadwrite" class="nav-link" data-scroll-target="#file-descriptors-and-openreadwrite">63. File Descriptors and open/read/write</a></li>
  <li><a href="#pipes-and-redirection" id="toc-pipes-and-redirection" class="nav-link" data-scroll-target="#pipes-and-redirection">64. Pipes and Redirection</a></li>
  <li><a href="#signals-and-signal-handlers" id="toc-signals-and-signal-handlers" class="nav-link" data-scroll-target="#signals-and-signal-handlers">65. Signals and Signal Handlers</a></li>
  <li><a href="#memory-mapping-mmap" id="toc-memory-mapping-mmap" class="nav-link" data-scroll-target="#memory-mapping-mmap">66. Memory Mapping (mmap)</a></li>
  <li><a href="#time-and-clock-apis" id="toc-time-and-clock-apis" class="nav-link" data-scroll-target="#time-and-clock-apis">67. Time and Clock APIs</a></li>
  <li><a href="#environment-variables" id="toc-environment-variables" class="nav-link" data-scroll-target="#environment-variables">68. Environment Variables</a></li>
  <li><a href="#error-handling-and-return-codes" id="toc-error-handling-and-return-codes" class="nav-link" data-scroll-target="#error-handling-and-return-codes">69. Error Handling and Return Codes</a></li>
  <li><a href="#practice-mini-shell-in-c" id="toc-practice-mini-shell-in-c" class="nav-link" data-scroll-target="#practice-mini-shell-in-c">70. Practice: Mini Shell in C</a></li>
  </ul></li>
  <li><a href="#chapter-8.-debugging-testing-and-profiling" id="toc-chapter-8.-debugging-testing-and-profiling" class="nav-link" data-scroll-target="#chapter-8.-debugging-testing-and-profiling">Chapter 8. Debugging, Testing and Profiling</a>
  <ul class="collapse">
  <li><a href="#debugging-with-gdb" id="toc-debugging-with-gdb" class="nav-link" data-scroll-target="#debugging-with-gdb">71. Debugging with gdb</a></li>
  <li><a href="#using-valgrind-for-memory-checking" id="toc-using-valgrind-for-memory-checking" class="nav-link" data-scroll-target="#using-valgrind-for-memory-checking">72. Using Valgrind for Memory Checking</a></li>
  <li><a href="#assertions-and-defensive-programming" id="toc-assertions-and-defensive-programming" class="nav-link" data-scroll-target="#assertions-and-defensive-programming">73. Assertions and Defensive Programming</a></li>
  <li><a href="#unit-testing-in-c" id="toc-unit-testing-in-c" class="nav-link" data-scroll-target="#unit-testing-in-c">74. Unit Testing in C</a></li>
  <li><a href="#logging-systems" id="toc-logging-systems" class="nav-link" data-scroll-target="#logging-systems">75. Logging Systems</a></li>
  <li><a href="#profiling-with-gprof" id="toc-profiling-with-gprof" class="nav-link" data-scroll-target="#profiling-with-gprof">76. Profiling with gprof</a></li>
  <li><a href="#common-undefined-behaviors" id="toc-common-undefined-behaviors" class="nav-link" data-scroll-target="#common-undefined-behaviors">77. Common Undefined Behaviors</a></li>
  <li><a href="#crash-analysis-and-core-dumps" id="toc-crash-analysis-and-core-dumps" class="nav-link" data-scroll-target="#crash-analysis-and-core-dumps">78. Crash Analysis and Core Dumps</a></li>
  <li><a href="#code-review-checklist-for-c-projects" id="toc-code-review-checklist-for-c-projects" class="nav-link" data-scroll-target="#code-review-checklist-for-c-projects">79. Code Review Checklist for C Projects</a></li>
  <li><a href="#practice-fix-memory-and-logic-bugs" id="toc-practice-fix-memory-and-logic-bugs" class="nav-link" data-scroll-target="#practice-fix-memory-and-logic-bugs">80. Practice: Fix Memory and Logic Bugs</a></li>
  </ul></li>
  <li><a href="#chapter-9.-portable-and-modern-c" id="toc-chapter-9.-portable-and-modern-c" class="nav-link" data-scroll-target="#chapter-9.-portable-and-modern-c">Chapter 9. Portable and Modern C</a>
  <ul class="collapse">
  <li><a href="#the-c-standard-timeline-c89-to-c23" id="toc-the-c-standard-timeline-c89-to-c23" class="nav-link" data-scroll-target="#the-c-standard-timeline-c89-to-c23">81. The C Standard Timeline (C89 to C23)</a></li>
  <li><a href="#portability-and-endianness" id="toc-portability-and-endianness" class="nav-link" data-scroll-target="#portability-and-endianness">82. Portability and Endianness</a></li>
  <li><a href="#inline-assembly-and-hardware-access" id="toc-inline-assembly-and-hardware-access" class="nav-link" data-scroll-target="#inline-assembly-and-hardware-access">83. Inline Assembly and Hardware Access</a></li>
  <li><a href="#cross-compilation" id="toc-cross-compilation" class="nav-link" data-scroll-target="#cross-compilation">84. Cross-Compilation</a></li>
  <li><a href="#threading-with-pthreads" id="toc-threading-with-pthreads" class="nav-link" data-scroll-target="#threading-with-pthreads">85. Threading with pthreads</a></li>
  <li><a href="#atomic-operations-and-memory-models" id="toc-atomic-operations-and-memory-models" class="nav-link" data-scroll-target="#atomic-operations-and-memory-models">86. Atomic Operations and Memory Models</a></li>
  <li><a href="#using-c-with-other-languages-ffi" id="toc-using-c-with-other-languages-ffi" class="nav-link" data-scroll-target="#using-c-with-other-languages-ffi">87. Using C with Other Languages (FFI)</a></li>
  <li><a href="#safer-alternatives-bounds-checking-_static_assert-and-modern-c-safety-tools" id="toc-safer-alternatives-bounds-checking-_static_assert-and-modern-c-safety-tools" class="nav-link" data-scroll-target="#safer-alternatives-bounds-checking-_static_assert-and-modern-c-safety-tools">88. Safer Alternatives (Bounds Checking, <code>_Static_assert</code>, and Modern C Safety Tools)</a></li>
  <li><a href="#modern-style-clean-and-readable-c" id="toc-modern-style-clean-and-readable-c" class="nav-link" data-scroll-target="#modern-style-clean-and-readable-c">89. Modern Style: Clean and Readable C</a></li>
  <li><a href="#practice-portable-multithreaded-program" id="toc-practice-portable-multithreaded-program" class="nav-link" data-scroll-target="#practice-portable-multithreaded-program">90. Practice: Portable Multithreaded Program</a></li>
  </ul></li>
  <li><a href="#chapter-10.-building-real-projects" id="toc-chapter-10.-building-real-projects" class="nav-link" data-scroll-target="#chapter-10.-building-real-projects">Chapter 10. Building Real Projects</a>
  <ul class="collapse">
  <li><a href="#designing-small-c-libraries" id="toc-designing-small-c-libraries" class="nav-link" data-scroll-target="#designing-small-c-libraries">91. Designing Small C Libraries</a></li>
  <li><a href="#building-a-command-line-tool" id="toc-building-a-command-line-tool" class="nav-link" data-scroll-target="#building-a-command-line-tool">92. Building a Command-Line Tool</a></li>
  <li><a href="#tiny-http-server-sockets-and-threads" id="toc-tiny-http-server-sockets-and-threads" class="nav-link" data-scroll-target="#tiny-http-server-sockets-and-threads">93. Tiny HTTP Server (Sockets and Threads)</a></li>
  <li><a href="#simple-key-value-store" id="toc-simple-key-value-store" class="nav-link" data-scroll-target="#simple-key-value-store">94. Simple Key-Value Store</a></li>
  <li><a href="#implementing-a-custom-allocator" id="toc-implementing-a-custom-allocator" class="nav-link" data-scroll-target="#implementing-a-custom-allocator">95. Implementing a Custom Allocator</a></li>
  <li><a href="#writing-a-text-parser" id="toc-writing-a-text-parser" class="nav-link" data-scroll-target="#writing-a-text-parser">96. Writing a Text Parser</a></li>
  <li><a href="#tiny-interpreter-for-an-expression-language" id="toc-tiny-interpreter-for-an-expression-language" class="nav-link" data-scroll-target="#tiny-interpreter-for-an-expression-language">97. Tiny Interpreter for an Expression Language</a></li>
  <li><a href="#interfacing-with-sqlite-or-leveldb" id="toc-interfacing-with-sqlite-or-leveldb" class="nav-link" data-scroll-target="#interfacing-with-sqlite-or-leveldb">98. Interfacing with SQLite or LevelDB</a></li>
  <li><a href="#packaging-versioning-and-documentation" id="toc-packaging-versioning-and-documentation" class="nav-link" data-scroll-target="#packaging-versioning-and-documentation">99. Packaging, Versioning, and Documentation</a></li>
  <li><a href="#practice-build-your-own-mini-project" id="toc-practice-build-your-own-mini-project" class="nav-link" data-scroll-target="#practice-build-your-own-mini-project">100. Practice: Build Your Own Mini Project</a></li>
  <li><a href="#epilogue.-the-spirit-of-c" id="toc-epilogue.-the-spirit-of-c" class="nav-link" data-scroll-target="#epilogue.-the-spirit-of-c">Epilogue. The Spirit of C</a></li>
  <li><a href="#the-path-beyond" id="toc-the-path-beyond" class="nav-link" data-scroll-target="#the-path-beyond">The Path Beyond</a></li>
  <li><a href="#a-note-from-the-author" id="toc-a-note-from-the-author" class="nav-link" data-scroll-target="#a-note-from-the-author">A Note from the Author</a></li>
  <li><a href="#final-exercise" id="toc-final-exercise" class="nav-link" data-scroll-target="#final-exercise">Final Exercise</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">The Book</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="chapter-1.-getting-started" class="level1">
<h1>Chapter 1. Getting Started</h1>
<section id="what-c-is-and-why-it-still-matters" class="level3">
<h3 class="anchored" data-anchor-id="what-c-is-and-why-it-still-matters">1. What C Is and Why It Still Matters</h3>
<p>C is the language that sits closest to the machine while still feeling human to write. It’s not the newest or the easiest, but it’s one of the most powerful. Every modern operating system, compiler, and database has a core written in C, from Linux and Git to Python’s interpreter and even parts of your browser.</p>
<p>Learning C gives you something no other language can: an understanding of <em>how computers actually work</em>. You’ll see how memory is managed, how data moves, how the CPU runs your code, and how everything you write turns into tiny instructions that the machine understands.</p>
<p>C teaches discipline. There’s no garbage collector or safety net. You decide when to allocate memory, when to free it, and what happens when you forget. You learn precision and control, the same skills that make great programmers in any language.</p>
<section id="tiny-code" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code">Tiny Code</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hello, C World!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run this and you’ve done what every C programmer starts with, printing your first line of text to the screen. It’s small, but it carries the spirit of C: direct, explicit, and clear.</p>
</section>
<section id="why-it-matters" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters">Why It Matters</h4>
<p>C is the foundation of all systems programming. When you understand it, higher-level languages make more sense. You’ll see why compilers work the way they do, why memory errors happen, and how performance decisions ripple through an entire program.</p>
<p>Even if you never write production C code, the mindset it builds, careful reasoning, attention to detail, respect for the machine, will shape how you write code in any language.</p>
</section>
<section id="try-it-yourself" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself">Try It Yourself</h4>
<ol type="1">
<li><p>Install a C compiler like <code>gcc</code> or <code>clang</code>.</p></li>
<li><p>Save the code above into a file named <code>hello.c</code>.</p></li>
<li><p>Compile it:</p>
<pre><code>gcc hello.c -o hello</code></pre></li>
<li><p>Run it:</p>
<pre><code>./hello</code></pre></li>
<li><p>Modify the message and try printing more lines. You’ve just built your first C program.</p></li>
</ol>
</section>
</section>
<section id="installing-a-c-compiler-gcc-clang-tinycc" class="level3">
<h3 class="anchored" data-anchor-id="installing-a-c-compiler-gcc-clang-tinycc">2. Installing a C Compiler (gcc, clang, tinycc)</h3>
<p>Before you can write and run C programs, you need a compiler. A compiler is a tool that <em>translates your human-readable code</em> into the machine instructions that your CPU understands. In C, this process is explicit, you see it, control it, and learn from it.</p>
<p>There are many compilers available, but three are most common:</p>
<ul>
<li>GCC (GNU Compiler Collection)**, The standard compiler on Linux and macOS, known for reliability and wide support.</li>
<li><strong>Clang</strong>, A modern compiler built for speed, cleaner diagnostics, and integration with tools like LLVM.</li>
<li><strong>TinyCC (tcc)</strong>, A super-lightweight compiler that’s perfect for learning and quick testing.</li>
</ul>
<section id="tiny-code-1" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-1">Tiny Code</h4>
<p>You can check if you already have a compiler installed by running one of these commands in your terminal:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">--version</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">clang</span> <span class="at">--version</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ex">tcc</span> <span class="at">--version</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If you see a version number, you’re ready. If not, you’ll need to install one.</p>
</section>
<section id="installing-on-different-systems" class="level4">
<h4 class="anchored" data-anchor-id="installing-on-different-systems">Installing on Different Systems</h4>
<p><strong>Linux (Debian/Ubuntu):</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt update</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install build-essential</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This installs GCC along with other useful tools like <code>make</code>.</p>
<p><strong>macOS (with Xcode Command Line Tools):</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">xcode-select</span> <span class="at">--install</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This installs Clang and the developer toolchain.</p>
<p><strong>Windows (via Mingw-w64):</strong></p>
<ol type="1">
<li>Go to <a href="https://www.mingw-w64.org/">Mingw-w64</a>.</li>
<li>Download and install it.</li>
<li>Add the compiler’s <code>bin</code> folder to your system PATH.</li>
<li>Open <code>cmd</code> or PowerShell and run <code>gcc --version</code> to confirm.</li>
</ol>
<p>Or, if you prefer an all-in-one environment, install <strong>WSL (Windows Subsystem for Linux)</strong> and use the Linux commands above.</p>
</section>
<section id="why-it-matters-1" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-1">Why It Matters</h4>
<p>Installing a compiler is your first step toward understanding <em>how programs become executables</em>. In C, there’s no hidden build system or automatic runtime, everything that happens between writing code and running it is visible. That clarity is part of what makes C such a powerful learning tool.</p>
<p>When you install your compiler, you’re also installing the ability to explore how software really works.</p>
</section>
<section id="try-it-yourself-1" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-1">Try It Yourself</h4>
<ol type="1">
<li><p>Open your terminal or command prompt.</p></li>
<li><p>Type <code>gcc --version</code> or <code>clang --version</code> to confirm installation.</p></li>
<li><p>Create a simple file named <code>test.c</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Compile it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> test.c <span class="at">-o</span> test</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Run it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./test</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ol>
<p>If it runs with no output, that’s perfect, your compiler is ready. You’ve just built your very first executable program from source code.</p>
</section>
</section>
<section id="writing-and-running-your-first-program" class="level3">
<h3 class="anchored" data-anchor-id="writing-and-running-your-first-program">3. Writing and Running Your First Program</h3>
<p>Now that your compiler is ready, it’s time to write your first real C program. This is where the magic happens, you’ll write plain text, compile it into machine instructions, and watch your computer follow your commands exactly.</p>
<p>C doesn’t hide what’s happening under the hood. Every step, writing, compiling, linking, running, is visible and under your control.</p>
<section id="tiny-code-2" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-2">Tiny Code</h4>
<p>Create a new file named <code>hello.c</code> and type this code:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hello, world!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then, compile and run it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> hello.c <span class="at">-o</span> hello</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./hello</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You should see:</p>
<pre><code>Hello, world!</code></pre>
</section>
<section id="breaking-it-down" class="level4">
<h4 class="anchored" data-anchor-id="breaking-it-down">Breaking It Down</h4>
<ul>
<li><p><code>#include &lt;stdio.h&gt;</code> This tells the compiler to use the <em>Standard Input/Output</em> library, which provides the <code>printf</code> function.</p></li>
<li><p><code>int main(void)</code> Every C program starts with a <code>main</code> function. It’s the entry point, where execution begins.</p></li>
<li><p><code>printf("Hello, world!\n");</code> This prints text to the screen. The <code>\n</code> means “newline,” so the next output starts on a new line.</p></li>
<li><p><code>return 0;</code> When <code>main</code> returns 0, it tells the operating system that your program finished successfully.</p></li>
</ul>
</section>
<section id="why-it-matters-2" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-2">Why It Matters</h4>
<p>Your “Hello, world” may look simple, but it represents an entire process:</p>
<ol type="1">
<li><strong>The compiler</strong> translates your text (<code>hello.c</code>) into object code (<code>hello.o</code>).</li>
<li><strong>The linker</strong> combines that code with standard libraries.</li>
<li><strong>The executable</strong> (<code>hello</code>) is pure machine instructions.</li>
<li><strong>The operating system</strong> loads and runs it.</li>
</ol>
<p>Understanding this flow is what makes C special, it’s not just about writing code, but about knowing <em>how</em> code becomes software.</p>
</section>
<section id="try-it-yourself-2" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-2">Try It Yourself</h4>
<ol type="1">
<li><p>Change the message to <code>"Hello, C learner!"</code> and recompile.</p></li>
<li><p>Add another line:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"This is my first C program.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Try leaving out the semicolon, what error does the compiler show?</p></li>
<li><p>Try removing <code>#include &lt;stdio.h&gt;</code>, what happens then?</p></li>
<li><p>Experiment and break things. Every error teaches you how C thinks.</p></li>
</ol>
<p>You’ve just written and run your first C program, a direct conversation between you and the machine. From here, every new piece of code builds on this simple moment of control and understanding.</p>
</section>
</section>
<section id="anatomy-of-a-c-program" class="level3">
<h3 class="anchored" data-anchor-id="anatomy-of-a-c-program">4. Anatomy of a C Program</h3>
<p>Now that your first program runs, let’s open it up and look inside. Every C program follows a clear structure, a set of rules that tells both <em>you</em> and the <em>compiler</em> what each part means. Understanding this structure early will help you read, write, and debug code with confidence.</p>
<section id="tiny-code-3" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-3">Tiny Code</h4>
<p>Here’s the same program, with comments explaining each piece:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span><span class="pp">      </span><span class="co">// 1. Preprocessor directive</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Function definition</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span>        <span class="co">// main: entry point of every C program</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hello, C!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span>  <span class="co">// 3. Statement: prints a message</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span>           <span class="co">// 4. Return statement: signals success</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="the-four-main-parts" class="level4">
<h4 class="anchored" data-anchor-id="the-four-main-parts">The Four Main Parts</h4>
<ol type="1">
<li><p><strong>Preprocessor Directives</strong> Lines that begin with <code>#</code> are handled before the code is even compiled. They include or define things that your program depends on. Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PI </span><span class="fl">3.14159</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong>Functions</strong> Every C program is made of functions. The function <code>main()</code> is special, it’s where your program starts. You can define more functions to organize your code.</p></li>
<li><p><strong>Statements</strong> Each instruction inside a function ends with a semicolon. These are the steps your program takes, one by one.</p></li>
<li><p><strong>Comments</strong> Comments are ignored by the compiler but read by humans. Use them to explain <em>why</em> your code does something, not just <em>what</em> it does.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">// This is a single-line comment</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* This is a multi-line comment */</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ol>
</section>
<section id="why-it-matters-3" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-3">Why It Matters</h4>
<p>C is a <em>structured</em> language. Every function, statement, and declaration lives inside a clear boundary. Unlike scripting languages, there’s no automatic setup or hidden runtime, everything you see is everything that runs.</p>
<p>Learning the anatomy of a C program gives you a mental map:</p>
<ul>
<li>You know where execution begins (<code>main</code>).</li>
<li>You know where code lives (inside functions).</li>
<li>You know where libraries come from (via includes).</li>
</ul>
<p>Once this map becomes natural, reading even large C programs starts to feel easy and logical.</p>
</section>
<section id="try-it-yourself-3" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-3">Try It Yourself</h4>
<ol type="1">
<li><p>Create a file <code>structure.c</code> with this content:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> greet<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Welcome to C programming!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    greet<span class="op">();</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Compile and run it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> structure.c <span class="at">-o</span> structure</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./structure</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Add another function, maybe <code>void bye(void)</code> that prints a goodbye message, and call it after <code>greet()</code>.</p></li>
<li><p>Try removing <code>return 0;</code>, notice how the program still runs, but adding it makes your intent clear.</p></li>
</ol>
<p>Every C program you’ll ever write follows this basic shape. Once you can recognize these parts, you can start building programs that are longer, smarter, and closer to the system.</p>
</section>
</section>
<section id="using-headers-and-the-preprocessor" class="level3">
<h3 class="anchored" data-anchor-id="using-headers-and-the-preprocessor">5. Using Headers and the Preprocessor</h3>
<p>Every C program begins before it even starts running, with something called the <em>preprocessor</em>. Before the compiler turns your code into machine instructions, the preprocessor prepares it: it pulls in files, replaces macros, and sets up everything your program needs. This step is what makes <code>#include &lt;stdio.h&gt;</code> work, and it’s key to understanding how larger C projects are organized.</p>
<section id="tiny-code-4" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-4">Tiny Code</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span><span class="pp">   </span><span class="co">// include the standard input/output header</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PI </span><span class="fl">3.14159</span><span class="pp">    </span><span class="co">// define a constant macro</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"PI is approximately </span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> PI<span class="op">);</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>When you compile this program, the preprocessor replaces <code>PI</code> with <code>3.14159</code> and includes the contents of the file <code>stdio.h</code> before the compiler even starts.</p>
<p>You can see the preprocessed result by running:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-E</span> program.c</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>It will output a much longer version of your code, showing all the lines that <code>stdio.h</code> added behind the scenes.</p>
</section>
<section id="how-headers-work" class="level4">
<h4 class="anchored" data-anchor-id="how-headers-work">How Headers Work</h4>
<p>Headers are <strong>declaration files</strong>. They tell the compiler <em>what exists</em>, like functions, constants, and types, without actually providing the code (the <em>definitions</em>). For example, <code>stdio.h</code> declares the function <code>printf()</code> so the compiler knows how to call it.</p>
<p>There are two main ways to include headers:</p>
<ul>
<li><p><strong>System headers:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The compiler looks for these in standard library directories.</p></li>
<li><p><strong>User-defined headers:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"myutils.h"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The compiler looks for these in your project folder first.</p></li>
</ul>
<p>This separation keeps large programs modular and readable.</p>
</section>
<section id="why-it-matters-4" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-4">Why It Matters</h4>
<p>The preprocessor is like the “setup crew” for your program. It doesn’t run your code, it <em>prepares</em> it. By understanding headers and macros, you can:</p>
<ul>
<li>Split big programs into smaller, reusable parts.</li>
<li>Define constants in one place instead of repeating values.</li>
<li>Write portable code that compiles on different systems.</li>
<li>Avoid subtle bugs caused by missing declarations.</li>
</ul>
<p>When you write <code>#include &lt;stdio.h&gt;</code>, you’re tapping into decades of reliable, shared code, one of the greatest strengths of the C ecosystem.</p>
</section>
<section id="try-it-yourself-4" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-4">Try It Yourself</h4>
<ol type="1">
<li><p>Create two files:</p>
<p><strong>mathutils.h</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef MATHUTILS_H</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MATHUTILS_H</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SQUARE</span><span class="op">(</span><span class="pp">x</span><span class="op">)</span><span class="pp"> </span><span class="op">((</span><span class="pp">x</span><span class="op">)</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">x</span><span class="op">))</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>main.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"mathutils.h"</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"The square of </span><span class="sc">%d</span><span class="st"> is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> n<span class="op">,</span> SQUARE<span class="op">(</span>n<span class="op">));</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.c <span class="at">-o</span> main</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./main</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Try editing the macro in <code>mathutils.h</code> to add a <code>CUBE(x)</code> function, and use it in <code>main.c</code>.</p></li>
<li><p>Then run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-E</span> main.c <span class="kw">|</span> <span class="fu">less</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>to explore the preprocessed code and see how includes and macros expand.</p></li>
</ol>
<p>Once you grasp headers and preprocessing, you’ll understand how large C codebases stay organized, and how a simple <code>#include</code> line can unlock an entire library of functionality.</p>
</section>
</section>
<section id="compiling-linking-and-executing" class="level3">
<h3 class="anchored" data-anchor-id="compiling-linking-and-executing">6. Compiling, Linking, and Executing</h3>
<p>When you press <em>Enter</em> to compile your C program, a lot happens behind the scenes. Your source code goes through several stages before it becomes a runnable executable. Understanding these steps is essential, it turns compilation errors from mysteries into simple, fixable clues.</p>
<section id="tiny-code-5" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-5">Tiny Code</h4>
<p>Let’s start with a familiar program:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Learning the C build process!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now compile and run it step by step:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Compile to object file</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> hello.c <span class="at">-o</span> hello.o</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Link object file into executable</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> hello.o <span class="at">-o</span> hello</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Run the program</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="ex">./hello</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Learning the C build process!</code></pre>
</section>
<section id="the-four-stages-of-building-a-c-program" class="level4">
<h4 class="anchored" data-anchor-id="the-four-stages-of-building-a-c-program">The Four Stages of Building a C Program</h4>
<ol type="1">
<li><p><strong>Preprocessing</strong> The preprocessor handles all lines starting with <code>#</code>. It expands macros, includes headers, and prepares code for compilation. Command to inspect:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-E</span> hello.c <span class="kw">|</span> <span class="fu">less</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong>Compilation</strong> The compiler translates the preprocessed code into <em>assembly language</em>, and then into <em>object code</em>. Each source file (like <code>hello.c</code>) becomes an object file (<code>hello.o</code>). Command:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> hello.c</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong>Linking</strong> The linker combines all object files and libraries into one final executable. For example, <code>printf</code> comes from the C standard library (<code>libc</code>), so the linker connects your code to it. Command:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> hello.o <span class="at">-o</span> hello</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong>Execution</strong> Once linked, your binary (<code>hello</code>) is loaded by the operating system and executed by the CPU. Command:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./hello</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ol>
</section>
<section id="why-it-matters-5" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-5">Why It Matters</h4>
<p>C gives you control over every stage of this process. Most modern languages hide compilation or linking, but in C, these steps are transparent and configurable. When something goes wrong, a missing function, an undefined symbol, or a broken include, you’ll know exactly <em>which stage</em> to look at.</p>
<p>Mastering the build process also opens the door to deeper skills:</p>
<ul>
<li>Creating reusable libraries (<code>.a</code> or <code>.so</code> files)</li>
<li>Understanding Makefiles and build automation</li>
<li>Debugging with symbols and optimized builds</li>
<li>Writing portable programs that compile cleanly anywhere</li>
</ul>
<p>Every system programmer eventually learns to <em>think like a compiler</em>, and this is where that thinking begins.</p>
</section>
<section id="try-it-yourself-5" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-5">Try It Yourself</h4>
<ol type="1">
<li><p><strong>Experiment with separate compilation:</strong></p>
<p>Create two files:</p>
<p><strong>main.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> greet<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    greet<span class="op">();</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>greet.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> greet<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hello from another file!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then compile and link:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> main.c</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> greet.c</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.o greet.o <span class="at">-o</span> greetprog</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="ex">./greetprog</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong>Try breaking it:</strong> Delete the <code>void greet(void);</code> line in <code>main.c</code> and recompile, see how the compiler warns you about an implicit declaration.</p></li>
<li><p><strong>Observe the stages:</strong> Add flags like <code>-Wall -O2 -v</code> to see detailed messages from the compiler and linker.</p></li>
</ol>
<p>Once you understand compilation and linking, you’ve unlocked one of the most powerful parts of C, the ability to control exactly <em>how</em> your software is built, combined, and executed.</p>
</section>
</section>
<section id="common-errors-and-warnings" class="level3">
<h3 class="anchored" data-anchor-id="common-errors-and-warnings">7. Common Errors and Warnings</h3>
<p>No C programmer avoids errors. In fact, the compiler’s messages are your best teachers. Each warning or error is the compiler’s way of saying, “Something here doesn’t make sense yet.” Learning to read and fix them early will save you hours later and make debugging a natural part of your process.</p>
<section id="tiny-code-6" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-6">Tiny Code</h4>
<p>Let’s look at a few examples:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"The value of a is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">);</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Try compiling it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> error_demo.c <span class="at">-o</span> error_demo</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>error_demo.c: In function ‘main':
error_demo.c:4:13: error: expected ‘;' before ‘printf'</code></pre>
<p>This means the compiler found a missing semicolon. The message even tells you where (<code>line 4</code>) and why (<code>expected ';' before 'printf'</code>).</p>
<p>Fix it by adding the missing semicolon:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then compile again, clean output means success.</p>
</section>
<section id="common-types-of-errors" class="level4">
<h4 class="anchored" data-anchor-id="common-types-of-errors">Common Types of Errors</h4>
<ol type="1">
<li><p><strong>Syntax Errors</strong> These are the easiest to fix. You’ve broken a grammar rule. Example: missing <code>;</code>, mismatched braces <code>{}</code>, or incorrect parentheses.</p></li>
<li><p><strong>Type Errors</strong> You’re using variables or functions in a way that doesn’t match their type. Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb41"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="st">"hello"</span><span class="op">;</span> <span class="co">// error: assigning string to int</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong>Undeclared Identifiers</strong> You’re using a variable or function that the compiler hasn’t seen yet. Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb42"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Value: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> number<span class="op">);</span> <span class="co">// error: ‘number' undeclared</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong>Linker Errors</strong> Compilation succeeds, but linking fails because something is missing. Example:</p>
<pre><code>undefined reference to `greet'</code></pre>
<p>This means the compiler saw a declaration but couldn’t find the actual function definition.</p></li>
<li><p><strong>Warnings</strong> Warnings don’t stop compilation, but they often point to potential bugs. Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb44"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="ex">warning:</span> variable ‘x<span class="st">' set but not used</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Always pay attention to warnings, clean builds (<code>no warnings</code>) are a mark of quality code.</p></li>
</ol>
</section>
<section id="why-it-matters-6" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-6">Why It Matters</h4>
<p>Every programmer makes mistakes. What matters is how fast you can understand what the compiler is saying. In C, error messages are usually precise and honest, they tell you exactly what broke. By learning to interpret them, you’re training yourself to debug with logic, not luck.</p>
<p>Good habits:</p>
<ul>
<li>Compile often, don’t wait to write 100 lines before testing.</li>
<li>Use <code>-Wall -Wextra</code> to enable all useful warnings.</li>
<li>Read errors <em>top to bottom</em>, the first one often causes the rest.</li>
<li>Fix warnings even if the code still runs.</li>
</ul>
</section>
<section id="try-it-yourself-6" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-6">Try It Yourself</h4>
<ol type="1">
<li><p><strong>Forgetting a return type:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb45"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"No return type!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile with:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb46"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-Wall</span> test.c</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You’ll get:</p>
<pre><code>warning: return type defaults to ‘int'</code></pre></li>
<li><p><strong>Using an undeclared variable:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb48"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This will produce:</p>
<pre><code>error: ‘x' undeclared</code></pre></li>
<li><p><strong>Fix each one</strong> until your program compiles cleanly with no warnings.</p></li>
</ol>
<p>Errors are not failures, they’re the compiler’s way of guiding you toward understanding. The more errors you fix, the better you become at speaking the language of the machine.</p>
</section>
</section>
<section id="command-line-basics-for-c-developers" class="level3">
<h3 class="anchored" data-anchor-id="command-line-basics-for-c-developers">8. Command Line Basics for C Developers</h3>
<p>C was born in the Unix world, and the command line is its natural home. If you can move comfortably in the terminal, you’ll understand what your tools are doing, compiling, linking, and running programs directly. This section gives you the essential commands you’ll need to build and explore C projects like a real systems programmer.</p>
<section id="tiny-code-7" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-7">Tiny Code</h4>
<p>Let’s start with a quick refresher using a simple file <code>hello.c</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb50"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hello from the terminal!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>To build and run it from the command line:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb51"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> hello.c <span class="at">-o</span> hello</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./hello</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Hello from the terminal!</code></pre>
<p>That’s the full cycle: write → compile → run. Now let’s look at the basic tools that make that process smoother.</p>
</section>
<section id="essential-command-line-tools" class="level4">
<h4 class="anchored" data-anchor-id="essential-command-line-tools">Essential Command Line Tools</h4>
<ol type="1">
<li><p><strong><code>ls</code></strong> – List files in the current directory</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb53"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You’ll see files like <code>hello.c</code>, <code>hello.o</code>, or <code>hello</code>.</p></li>
<li><p><strong><code>pwd</code></strong> – Print the current working directory</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb54"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="bu">pwd</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong><code>cd</code></strong> – Change directories</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb55"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> projects/c_programs</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong><code>cat</code></strong> – Display file contents quickly</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb56"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> hello.c</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong><code>rm</code></strong> – Remove files</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb57"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> hello</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong><code>clear</code></strong> – Clear your terminal screen</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb58"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">clear</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong><code>man</code></strong> – Read the manual for a command</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb59"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">man</span> gcc</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Press <code>q</code> to exit.</p></li>
<li><p><strong><code>echo</code></strong> – Print a message or variable</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb60"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Compiling C!"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong><code>touch</code></strong> – Create a new empty file</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb61"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> main.c</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong><code>gcc</code></strong> – Compile your C source code</p></li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb62"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.c <span class="at">-o</span> main</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-7" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-7">Why It Matters</h4>
<p>The command line isn’t just for building code, it teaches you how your tools actually work. In C, there’s no hidden environment running behind a button click. Each command you type does exactly one job, and understanding those jobs gives you full control.</p>
<ul>
<li>You see the <strong>build process</strong> directly.</li>
<li>You control <strong>where outputs go</strong>.</li>
<li>You can <strong>chain commands</strong> for automation.</li>
</ul>
<p>This mindset, knowing what happens under the hood, is what makes C programmers comfortable working close to the machine.</p>
</section>
<section id="try-it-yourself-7" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-7">Try It Yourself</h4>
<ol type="1">
<li><p><strong>Navigate and build manually:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb63"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> myfirstc</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> myfirstc</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> hello.c</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Add code with your favorite text editor (like <code>nano hello.c</code>), then compile and run.</p></li>
<li><p><strong>Use compiler flags:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb64"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-Wall</span> <span class="at">-O2</span> hello.c <span class="at">-o</span> hello</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./hello</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><code>-Wall</code> enables warnings.</li>
<li><code>-O2</code> applies optimization.</li>
</ul></li>
<li><p><strong>Use output redirection:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb65"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./hello</span> <span class="op">&gt;</span> output.txt</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> output.txt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong>Explore commands interactively:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb66"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">man</span> ls</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">man</span> gcc</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Read a few lines, knowing how to find help is as important as coding itself.</p></li>
</ol>
<p>C and the command line grew up together. Once you get comfortable typing and compiling by hand, you’ll start to feel how programs, files, and processes fit together. That’s the real start of systems programming, not just writing code, but <em>commanding the computer directly</em>.</p>
</section>
</section>
<section id="setting-up-a-minimal-project-structure" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-a-minimal-project-structure">9. Setting Up a Minimal Project Structure</h3>
<p>As your C programs grow, you’ll quickly outgrow the single-file “hello.c” style. Real projects are made of multiple source files, headers, and sometimes libraries. A clear folder structure keeps your work clean, easy to build, and easy to maintain. In this section, you’ll create a small, organized layout, the same structure used by professionals.</p>
<section id="tiny-code-8" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-8">Tiny Code</h4>
<p>Here’s a minimal project layout:</p>
<pre><code>my_project/
├── include/
│   └── greet.h
├── src/
│   └── greet.c
├── main.c
└── Makefile</code></pre>
<p><strong>include/greet.h</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb68"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef GREET_H</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define GREET_H</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> greet<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">);</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>src/greet.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb69"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"greet.h"</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> greet<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hello, </span><span class="sc">%s</span><span class="st">!</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> name<span class="op">);</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>main.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb70"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"greet.h"</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    greet<span class="op">(</span><span class="st">"C Learner"</span><span class="op">);</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Makefile</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb71"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span> <span class="ch">=</span><span class="st"> gcc</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span> <span class="ch">=</span><span class="st"> -Wall -Iinclude</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="dt">SRC</span> <span class="ch">=</span><span class="st"> main.c src/greet.c</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="dt">OUT</span> <span class="ch">=</span><span class="st"> my_program</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="dv">$(OUT):</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">SRC</span><span class="ch">)</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">SRC</span><span class="ch">)</span> -o <span class="ch">$(</span><span class="dt">OUT</span><span class="ch">)</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f <span class="ch">$(</span><span class="dt">OUT</span><span class="ch">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now build and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb72"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./my_program</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Hello, C Learner!</code></pre>
</section>
<section id="understanding-the-structure" class="level4">
<h4 class="anchored" data-anchor-id="understanding-the-structure">Understanding the Structure</h4>
<ol type="1">
<li><p><strong><code>include/</code></strong> Holds header files (<code>.h</code>), declarations of functions, constants, and types. You include these in <code>.c</code> files using quotes:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb74"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"greet.h"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong><code>src/</code></strong> Contains source files (<code>.c</code>) that implement functions declared in headers.</p></li>
<li><p><strong><code>main.c</code></strong> The entry point of your program, this file usually just calls functions from <code>src/</code>.</p></li>
<li><p><strong><code>Makefile</code></strong> Defines how to build the program. You can run <code>make</code> instead of typing long <code>gcc</code> commands.</p></li>
<li><p><strong>Output binary</strong> The compiled executable (here <code>my_program</code>) stays in the project’s root for convenience.</p></li>
</ol>
</section>
<section id="why-it-matters-8" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-8">Why It Matters</h4>
<p>A clear structure helps you:</p>
<ul>
<li>Keep code modular and reusable</li>
<li>Separate interface (<code>.h</code>) from implementation (<code>.c</code>)</li>
<li>Make compilation faster and easier to manage</li>
<li>Avoid name clashes in large projects</li>
<li>Scale from one file to dozens without confusion</li>
</ul>
<p>Even small C utilities benefit from structure, you’ll thank yourself later when you revisit your code.</p>
</section>
<section id="try-it-yourself-8" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-8">Try It Yourself</h4>
<ol type="1">
<li><p>Create the directories and files shown above.</p></li>
<li><p>Type each file carefully and run <code>make</code>.</p></li>
<li><p>Modify <code>greet.c</code> to print a personalized message, e.g.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb75"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Welcome back, </span><span class="sc">%s</span><span class="st">!</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> name<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>then rebuild.</p></li>
<li><p>Add another pair of files, <code>src/farewell.c</code> and <code>include/farewell.h</code>, with a goodbye function, and call it from <code>main.c</code>.</p></li>
<li><p>Run <code>make clean</code> to delete the binary and rebuild fresh.</p></li>
</ol>
<p>This small structure is the seed of every serious C project. Once you can organize your files this way, you’re ready to grow into larger systems, libraries, tools, and applications that others can use and build upon.</p>
</section>
</section>
</section>
<section id="chapter-2.-language-basics" class="level1">
<h1>Chapter 2. Language Basics</h1>
<section id="data-types-and-variables" class="level3">
<h3 class="anchored" data-anchor-id="data-types-and-variables">11. Data Types and Variables</h3>
<p>In C, everything begins with types. A <strong>type</strong> tells the compiler how much memory to reserve, how to interpret the bits stored there, and what operations are allowed. Understanding types is the foundation of writing safe and efficient C programs, it’s how you speak the computer’s native language precisely.</p>
<section id="tiny-code-9" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-9">Tiny Code</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb76"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age <span class="op">=</span> <span class="dv">25</span><span class="op">;</span>              <span class="co">// integer</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> height <span class="op">=</span> <span class="fl">1.75</span><span class="op">;</span>       <span class="co">// floating-point number</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> initial <span class="op">=</span> <span class="ch">'A'</span><span class="op">;</span>        <span class="co">// single character</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> weight <span class="op">=</span> <span class="fl">68.4</span><span class="op">;</span>      <span class="co">// double-precision number</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Age: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> age<span class="op">);</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Height: </span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> height<span class="op">);</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Initial: </span><span class="sc">%c\n</span><span class="st">"</span><span class="op">,</span> initial<span class="op">);</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Weight: </span><span class="sc">%.1lf\n</span><span class="st">"</span><span class="op">,</span> weight<span class="op">);</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Age: 25
Height: 1.75
Initial: A
Weight: 68.4</code></pre>
</section>
<section id="core-built-in-types" class="level4">
<h4 class="anchored" data-anchor-id="core-built-in-types">Core Built-in Types</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 11%">
<col style="width: 19%">
<col style="width: 46%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Size (Typical)</th>
<th>Description</th>
<th>Format Specifier</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>char</code></td>
<td>1 byte</td>
<td>Single character</td>
<td><code>%c</code></td>
</tr>
<tr class="even">
<td><code>int</code></td>
<td>4 bytes</td>
<td>Whole number</td>
<td><code>%d</code></td>
</tr>
<tr class="odd">
<td><code>float</code></td>
<td>4 bytes</td>
<td>Decimal number (single precision)</td>
<td><code>%f</code></td>
</tr>
<tr class="even">
<td><code>double</code></td>
<td>8 bytes</td>
<td>Decimal number (double precision)</td>
<td><code>%lf</code></td>
</tr>
<tr class="odd">
<td><code>void</code></td>
<td>–</td>
<td>No value or type</td>
<td>–</td>
</tr>
</tbody>
</table>
<blockquote class="blockquote">
<p>Sizes may vary depending on system and compiler, but the relationships remain consistent.</p>
</blockquote>
<p>You can also control how numbers behave using <strong>modifiers</strong>:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Modifier</th>
<th>Example</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>short</code></td>
<td><code>short int x;</code></td>
<td>Smaller integer (often 2 bytes)</td>
</tr>
<tr class="even">
<td><code>long</code></td>
<td><code>long int y;</code></td>
<td>Larger integer (often 8 bytes)</td>
</tr>
<tr class="odd">
<td><code>unsigned</code></td>
<td><code>unsigned int z;</code></td>
<td>Only non-negative values</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb78"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> score <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> big_number <span class="op">=</span> <span class="dv">1234567890123</span><span class="bu">LL</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="declaring-and-initializing-variables" class="level4">
<h4 class="anchored" data-anchor-id="declaring-and-initializing-variables">Declaring and Initializing Variables</h4>
<p>A variable is simply a <em>named piece of memory</em>. You declare it by specifying its type and name:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb79"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> count<span class="op">;</span>       <span class="co">// declaration</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> <span class="dv">5</span><span class="op">;</span>       <span class="co">// assignment</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Or both together:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb80"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> count <span class="op">=</span> <span class="dv">5</span><span class="op">;</span>   <span class="co">// initialization</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Multiple declarations:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb81"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> y <span class="op">=</span> <span class="dv">2</span><span class="op">,</span> z <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Variables must be declared <em>before</em> you use them, and their type cannot change.</p>
</section>
<section id="why-it-matters-9" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-9">Why It Matters</h4>
<p>C is a <strong>statically typed language</strong>, meaning every variable’s type is known at compile time. This makes programs faster and safer, because the compiler can:</p>
<ul>
<li>Catch type mismatches early</li>
<li>Optimize memory layout</li>
<li>Predict storage and alignment</li>
</ul>
<p>When you understand data types, you understand how your code maps directly to the machine’s memory.</p>
<p>C forces you to think carefully about <em>what kind of data</em> you’re working with, a skill that improves every program you write, in any language.</p>
</section>
<section id="try-it-yourself-9" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-9">Try It Yourself</h4>
<ol type="1">
<li><p>Create a program that stores and prints:</p>
<ul>
<li>Your age as an <code>int</code></li>
<li>Your height as a <code>float</code></li>
<li>Your name’s first letter as a <code>char</code></li>
</ul></li>
<li><p>Add two integers and print the result:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb82"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> b <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Sum: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a <span class="op">+</span> b<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Try using an <code>unsigned int</code> and print what happens if you assign a negative value.</p></li>
<li><p>Use <code>sizeof()</code> to inspect how big each type is on your system:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb83"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Size of int: </span><span class="sc">%zu</span><span class="st"> bytes</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ol>
<p>Every number, character, and pointer in C starts here, in the precise world of types and variables. Once you’re fluent in these, memory layout, structs, and pointers will make perfect sense.</p>
</section>
</section>
<section id="constants-literals-and-enumerations" class="level3">
<h3 class="anchored" data-anchor-id="constants-literals-and-enumerations">12. Constants, Literals, and Enumerations</h3>
<p>C programs often rely on values that never change, numbers, characters, or named constants used throughout your code. Instead of sprinkling magic numbers everywhere, you can give them meaningful names and keep your program readable, safe, and easy to maintain.</p>
<section id="tiny-code-10" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-10">Tiny Code</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb84"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PI </span><span class="fl">3.14159</span><span class="pp">           </span><span class="co">// preprocessor constant</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> DAYS_IN_WEEK <span class="op">=</span> <span class="dv">7</span><span class="op">;</span>  <span class="co">// read-only variable</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> Direction <span class="op">{</span> NORTH<span class="op">,</span> EAST<span class="op">,</span> SOUTH<span class="op">,</span> WEST <span class="op">};</span> <span class="co">// enumerated constants</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Pi: </span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> PI<span class="op">);</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Days in a week: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> DAYS_IN_WEEK<span class="op">);</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Direction EAST has value: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> EAST<span class="op">);</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Pi: 3.14
Days in a week: 7
Direction EAST has value: 1</code></pre>
</section>
<section id="constants-in-c" class="level4">
<h4 class="anchored" data-anchor-id="constants-in-c">Constants in C</h4>
<ol type="1">
<li><p><strong>Preprocessor constants (<code>#define</code>)</strong> These are replaced <em>before</em> compilation. Think of them as text substitutions, not variables.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb86"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAX_USERS </span><span class="dv">100</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Max users: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> MAX_USERS<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>No memory is used.</li>
<li>No type checking, the compiler just replaces the text.</li>
</ul></li>
<li><p><strong>Constant variables (<code>const</code>)</strong> These are real variables stored in memory but cannot be modified after initialization.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb87"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">double</span> SPEED_OF_LIGHT <span class="op">=</span> <span class="fl">299792458.0</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>Type safe.</li>
<li>Preferred for constants in modern C code.</li>
</ul></li>
<li><p><strong>Literals</strong> These are fixed values written directly in your code:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb88"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="dv">42</span>          <span class="co">// integer literal</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fl">3.14</span>        <span class="co">// floating-point literal</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="ch">'A'</span>         <span class="co">// character literal</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="st">"Hello"</span>     <span class="co">// string literal</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="bn">0xFF</span>        <span class="co">// hexadecimal literal (255)</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="bn">075</span>         <span class="co">// octal literal (61)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ol>
</section>
<section id="enumerations" class="level4">
<h4 class="anchored" data-anchor-id="enumerations">Enumerations</h4>
<p>An <strong>enum</strong> (short for <em>enumeration</em>) defines a set of named integer constants. They make your code self-documenting and prevent mistakes with raw numbers.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb89"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> TrafficLight <span class="op">{</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>    RED<span class="op">,</span>     <span class="co">// 0</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    YELLOW<span class="op">,</span>  <span class="co">// 1</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    GREEN    <span class="co">// 2</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> TrafficLight signal <span class="op">=</span> GREEN<span class="op">;</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>signal <span class="op">==</span> GREEN<span class="op">)</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Go!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You can also assign custom values:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb90"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> Month <span class="op">{</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>    JAN <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> FEB<span class="op">,</span> MAR<span class="op">,</span> APR<span class="op">,</span> MAY<span class="op">,</span> JUN<span class="op">,</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    JUL<span class="op">,</span> AUG<span class="op">,</span> SEP<span class="op">,</span> OCT<span class="op">,</span> NOV<span class="op">,</span> DEC</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now <code>JAN</code> starts at 1, and each value increments automatically.</p>
</section>
<section id="why-it-matters-10" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-10">Why It Matters</h4>
<p>Constants and enums make your code <strong>clearer and safer</strong>:</p>
<ul>
<li>You can change one definition instead of many numbers.</li>
<li>The compiler can enforce that constants are not modified.</li>
<li>Enumerations group related values into a meaningful set.</li>
</ul>
<p>Without them, large programs become fragile and full of unexplained numbers, a maintenance nightmare.</p>
<p>Good C programmers use constants to express <strong>intent</strong>, not just values.</p>
</section>
<section id="try-it-yourself-10" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-10">Try It Yourself</h4>
<ol type="1">
<li><p>Replace every numeric literal in your old programs with a <code>#define</code> or <code>const</code>. Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb91"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAX_SCORE </span><span class="dv">100</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">float</span> TAX_RATE <span class="op">=</span> <span class="fl">0.08</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Create an <code>enum</code> for days of the week, and print <code>MONDAY</code> and <code>FRIDAY</code>.</p></li>
<li><p>Assign custom values in your enum (e.g.&nbsp;start with <code>SUNDAY = 1</code>).</p></li>
<li><p>Experiment: try changing <code>const int x = 5; x = 10;</code> , notice the compiler stops you from modifying it.</p></li>
<li><p>Use <code>printf</code> to print literal values in different formats:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb92"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%x</span><span class="st"> </span><span class="sc">%o\n</span><span class="st">"</span><span class="op">,</span> <span class="dv">255</span><span class="op">,</span> <span class="dv">255</span><span class="op">,</span> <span class="dv">255</span><span class="op">);</span> <span class="co">// decimal, hex, octal</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ol>
<p>Constants are how you make your C programs <em>speak clearly</em>. They turn numbers into ideas, and that’s what transforms code from working to understandable.</p>
</section>
</section>
<section id="operators-and-expressions" class="level3">
<h3 class="anchored" data-anchor-id="operators-and-expressions">13. Operators and Expressions</h3>
<p>Operators are the building blocks of computation in C. They let you perform arithmetic, compare values, manipulate bits, and combine logic, all in concise expressions. Once you understand how operators work and how they interact through <em>precedence</em> and <em>associativity</em>, you can write clear, efficient code that behaves exactly as you expect.</p>
<section id="tiny-code-11" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-11">Tiny Code</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb93"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> b <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"a + b = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a <span class="op">+</span> b<span class="op">);</span>   <span class="co">// addition</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"a - b = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a <span class="op">-</span> b<span class="op">);</span>   <span class="co">// subtraction</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"a * b = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a <span class="op">*</span> b<span class="op">);</span>   <span class="co">// multiplication</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"a / b = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a <span class="op">/</span> b<span class="op">);</span>   <span class="co">// integer division</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"a </span><span class="sc">%%</span><span class="st"> b = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a <span class="op">%</span> b<span class="op">);</span>  <span class="co">// remainder (modulo)</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>    a <span class="op">+=</span> <span class="dv">5</span><span class="op">;</span> <span class="co">// same as a = a + 5</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"a after += 5: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">);</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>a + b = 13
a - b = 7
a * b = 30
a / b = 3
a % b = 1
a after += 5: 15</code></pre>
</section>
<section id="arithmetic-operators" class="level4">
<h4 class="anchored" data-anchor-id="arithmetic-operators">Arithmetic Operators</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operator</th>
<th>Meaning</th>
<th>Example</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>+</code></td>
<td>Addition</td>
<td><code>4 + 3</code></td>
<td>7</td>
</tr>
<tr class="even">
<td><code>-</code></td>
<td>Subtraction</td>
<td><code>10 - 6</code></td>
<td>4</td>
</tr>
<tr class="odd">
<td><code>*</code></td>
<td>Multiplication</td>
<td><code>2 * 5</code></td>
<td>10</td>
</tr>
<tr class="even">
<td><code>/</code></td>
<td>Division</td>
<td><code>7 / 2</code></td>
<td>3 (integer division)</td>
</tr>
<tr class="odd">
<td><code>%</code></td>
<td>Modulo (remainder)</td>
<td><code>7 % 2</code></td>
<td>1</td>
</tr>
</tbody>
</table>
<blockquote class="blockquote">
<p>Tip: If you use floating-point numbers (<code>float</code>, <code>double</code>), division produces decimals.</p>
</blockquote>
</section>
<section id="relational-and-logical-operators" class="level4">
<h4 class="anchored" data-anchor-id="relational-and-logical-operators">Relational and Logical Operators</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 31%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 3%">
<col style="width: 1%">
<col style="width: 3%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Operator</th>
<th>Example</th>
<th>Meaning</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Relational</td>
<td><code>==</code></td>
<td><code>a == b</code></td>
<td>Equal</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td><code>!=</code></td>
<td><code>a != b</code></td>
<td>Not equal</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td><code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code></td>
<td><code>a &lt; b</code></td>
<td>Comparison</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Logical</td>
<td><code>&amp;&amp;</code></td>
<td><code>a &amp;&amp; b</code></td>
<td>Logical AND</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td><code>|          |</code></td>
<td><code>a |   | b</code></td>
<td>Logical OR</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td><code>!</code></td>
<td><code>!a</code></td>
<td>Logical NOT</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb95"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> age <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>age <span class="op">&gt;=</span> <span class="dv">18</span> <span class="op">&amp;&amp;</span> age <span class="op">&lt;=</span> <span class="dv">60</span><span class="op">)</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Adult</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="increment-and-decrement" class="level4">
<h4 class="anchored" data-anchor-id="increment-and-decrement">Increment and Decrement</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb96"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">++</span>x<span class="op">);</span> <span class="co">// prefix: increments, then uses value (6)</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">++);</span> <span class="co">// postfix: uses value, then increments (6)</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span>   <span class="co">// final value is 7</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="assignment-and-compound-operators" class="level4">
<h4 class="anchored" data-anchor-id="assignment-and-compound-operators">Assignment and Compound Operators</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operator</th>
<th>Meaning</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>=</code></td>
<td>Assignment</td>
<td><code>x = 10</code></td>
</tr>
<tr class="even">
<td><code>+=</code></td>
<td>Add and assign</td>
<td><code>x += 2</code></td>
</tr>
<tr class="odd">
<td><code>-=</code></td>
<td>Subtract and assign</td>
<td><code>x -= 3</code></td>
</tr>
<tr class="even">
<td><code>*=</code></td>
<td>Multiply and assign</td>
<td><code>x *= 4</code></td>
</tr>
<tr class="odd">
<td><code>/=</code></td>
<td>Divide and assign</td>
<td><code>x /= 5</code></td>
</tr>
<tr class="even">
<td><code>%=</code></td>
<td>Modulo and assign</td>
<td><code>x %= 6</code></td>
</tr>
</tbody>
</table>
<p>These save typing and make intent clearer.</p>
</section>
<section id="bitwise-operators" class="level4">
<h4 class="anchored" data-anchor-id="bitwise-operators">Bitwise Operators</h4>
<p>C gives you direct access to bits, useful for systems, embedded, or optimization tasks.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operator</th>
<th>Meaning</th>
<th>Example</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>&amp;</code></td>
<td>AND</td>
<td><code>a &amp; b</code></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>|</code></td>
<td>OR</td>
<td><code>a | b</code></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>^</code></td>
<td>XOR</td>
<td><code>a ^ b</code></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>~</code></td>
<td>NOT</td>
<td><code>~a</code></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>&lt;&lt;</code></td>
<td>Left shift</td>
<td><code>a &lt;&lt; 1</code></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>&gt;&gt;</code></td>
<td>Right shift</td>
<td><code>a &gt;&gt; 2</code></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb97"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> mask <span class="op">=</span> <span class="bn">0b0010</span><span class="op">;</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> num <span class="op">=</span> <span class="bn">0b1011</span><span class="op">;</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> result <span class="op">=</span> num <span class="op">&amp;</span> mask<span class="op">;</span>  <span class="co">// checks if the 2nd bit is set</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="precedence-and-associativity" class="level4">
<h4 class="anchored" data-anchor-id="precedence-and-associativity">Precedence and Associativity</h4>
<p>When you write complex expressions, C follows operator precedence rules. For example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb98"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> result <span class="op">=</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> <span class="dv">4</span><span class="op">;</span> <span class="co">// result is 14, not 20</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><code>*</code> has higher precedence than <code>+</code>, so it runs first.</p>
<p>Use parentheses to make intentions clear:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb99"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> result <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">3</span><span class="op">)</span> <span class="op">*</span> <span class="dv">4</span><span class="op">;</span> <span class="co">// result is 20</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-11" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-11">Why It Matters</h4>
<p>Operators are where <strong>logic meets the machine</strong>. They translate mathematical ideas and control decisions into instructions the CPU executes directly. Understanding how expressions are built and evaluated helps you:</p>
<ul>
<li>Write compact, efficient code</li>
<li>Avoid precedence mistakes</li>
<li>Control exactly what your program computes</li>
</ul>
<p>In low-level work (like bitwise operations or embedded systems), operator mastery is essential.</p>
</section>
<section id="try-it-yourself-11" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-11">Try It Yourself</h4>
<ol type="1">
<li><p>Write a small program that takes two integers and prints their:</p>
<ul>
<li>Sum</li>
<li>Difference</li>
<li>Product</li>
<li>Quotient</li>
<li>Remainder</li>
</ul></li>
<li><p>Modify it to print results as floating-point values.</p></li>
<li><p>Use logical operators to test if both numbers are positive.</p></li>
<li><p>Try combining bitwise operations:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb100"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="dv">5</span> <span class="op">&amp;</span> <span class="dv">3</span><span class="op">);</span>  <span class="co">// AND</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="dv">5</span> <span class="op">|</span> <span class="dv">3</span><span class="op">);</span>  <span class="co">// OR</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="dv">5</span> <span class="op">^</span> <span class="dv">3</span><span class="op">);</span>  <span class="co">// XOR</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Experiment with parentheses and operator order until you can predict every result.</p></li>
</ol>
<p>Operators are where C’s simplicity meets its power, a small set of symbols that give you total control over computation, logic, and even raw bits.</p>
</section>
</section>
<section id="control-flow-if-else-switch" class="level3">
<h3 class="anchored" data-anchor-id="control-flow-if-else-switch">14. Control Flow: if, else, switch</h3>
<p>Programs become powerful when they can <em>decide</em>, when they can choose one path or another depending on data or conditions. In C, <strong>control flow</strong> statements give you that power. They determine how your program moves through different parts of your code.</p>
<section id="tiny-code-12" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-12">Tiny Code</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb101"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> temperature <span class="op">=</span> <span class="dv">30</span><span class="op">;</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>temperature <span class="op">&gt;</span> <span class="dv">35</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"It's too hot!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>temperature <span class="op">&gt;</span> <span class="dv">25</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"It's warm.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"It's cool.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>It's warm.</code></pre>
<p>This is how you express logic in C: by checking conditions and executing only the code that matches.</p>
</section>
<section id="the-if-and-else-structure" class="level4">
<h4 class="anchored" data-anchor-id="the-if-and-else-structure">The if and else Structure</h4>
<p>The basic pattern looks like this:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb103"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>condition<span class="op">)</span> <span class="op">{</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// do something if true</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>another_condition<span class="op">)</span> <span class="op">{</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// do something else</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// default action</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Each <code>if</code> or <code>else if</code> checks a <strong>condition</strong> that must evaluate to <code>true</code> (non-zero) or <code>false</code> (zero).</p>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb104"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> score <span class="op">=</span> <span class="dv">85</span><span class="op">;</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>score <span class="op">&gt;=</span> <span class="dv">90</span><span class="op">)</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Grade: A</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>score <span class="op">&gt;=</span> <span class="dv">80</span><span class="op">)</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Grade: B</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Grade: C or below</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="comparison-and-boolean-logic" class="level4">
<h4 class="anchored" data-anchor-id="comparison-and-boolean-logic">Comparison and Boolean Logic</h4>
<p>C doesn’t have a built-in <code>bool</code> type in older standards, but since C99, you can include it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb105"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdbool.h&gt;</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> is_ready <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>is_ready<span class="op">)</span> printf<span class="op">(</span><span class="st">"Let's go!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Behind the scenes, <code>true</code> is just <code>1</code> and <code>false</code> is <code>0</code>.</p>
</section>
<section id="nested-if-statements" class="level4">
<h4 class="anchored" data-anchor-id="nested-if-statements">Nested if Statements</h4>
<p>You can nest decisions for more complex logic:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb106"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>x <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>x <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Positive even number</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Positive odd number</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Just be careful, too much nesting makes code harder to read. When logic gets complex, consider reorganizing or using a <code>switch</code> statement.</p>
</section>
<section id="the-switch-statement" class="level4">
<h4 class="anchored" data-anchor-id="the-switch-statement">The switch Statement</h4>
<p><code>switch</code> is a clean way to test one variable against several fixed values.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb107"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> day <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>day<span class="op">)</span> <span class="op">{</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="dv">1</span><span class="op">:</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"Monday</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="dv">2</span><span class="op">:</span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"Tuesday</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="dv">3</span><span class="op">:</span></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"Wednesday</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">default</span><span class="op">:</span></span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"Another day</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Wednesday</code></pre>
<p>Each <code>case</code> label marks a potential branch. <code>break</code> stops the switch from “falling through” into the next case.</p>
<p>You can group multiple cases:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb109"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="cf">switch</span> <span class="op">(</span>ch<span class="op">)</span> <span class="op">{</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">'a'</span><span class="op">:</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">'A'</span><span class="op">:</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Letter A detected</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="the-ternary-operator" class="level4">
<h4 class="anchored" data-anchor-id="the-ternary-operator">The Ternary Operator</h4>
<p>For quick decisions, you can use the <strong>conditional operator</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb110"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> age <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> <span class="op">(</span>age <span class="op">&gt;=</span> <span class="dv">18</span><span class="op">)</span> <span class="op">?</span> <span class="st">"Adult"</span> <span class="op">:</span> <span class="st">"Minor"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This is equivalent to:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb111"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>age <span class="op">&gt;=</span> <span class="dv">18</span><span class="op">)</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Adult</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Minor</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-12" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-12">Why It Matters</h4>
<p>Control flow gives your programs <strong>intelligence</strong>. Instead of running straight through, your code reacts to input, conditions, and data. C’s branching statements are simple but flexible, they’re the building blocks of everything from sorting algorithms to operating system schedulers.</p>
<p>When you understand how to control execution, you can shape your program’s logic precisely.</p>
</section>
<section id="try-it-yourself-12" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-12">Try It Yourself</h4>
<ol type="1">
<li><p>Write a program that:</p>
<ul>
<li>Reads an integer from the user.</li>
<li>Prints whether it’s positive, negative, or zero.</li>
</ul></li>
<li><p>Extend it:</p>
<ul>
<li>If it’s positive, print whether it’s even or odd.</li>
</ul></li>
<li><p>Use a <code>switch</code> statement:</p>
<ul>
<li>Ask for a number 1–7.</li>
<li>Print the day of the week that matches.</li>
</ul></li>
<li><p>Try replacing your <code>if</code> statements with a ternary operator where it makes sense.</p></li>
</ol>
<p>Control flow is how you <em>think</em> in code, it’s how you teach your program to make decisions just like you do.</p>
</section>
</section>
<section id="loops-for-while-do-while" class="level3">
<h3 class="anchored" data-anchor-id="loops-for-while-do-while">15. Loops: for, while, do-while</h3>
<p>Sometimes you need your program to repeat something, a calculation, a print statement, or a check, again and again. Instead of copying the same line of code many times, you use <strong>loops</strong>. Loops make your program efficient, compact, and able to handle dynamic data of any size.</p>
<section id="the-for-loop" class="level4">
<h4 class="anchored" data-anchor-id="the-for-loop">The <code>for</code> Loop</h4>
<p>A <code>for</code> loop repeats a block of code a fixed number of times.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb112"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span>initialization<span class="op">;</span> condition<span class="op">;</span> update<span class="op">)</span> <span class="op">{</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// repeated statements</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb113"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Explanation:</p>
<ul>
<li><strong>Initialization</strong> runs once at the start (<code>int i = 0</code>)</li>
<li><strong>Condition</strong> is checked before every loop (<code>i &lt; 10</code>)</li>
<li><strong>Update</strong> runs after each iteration (<code>i++</code>)</li>
<li>The loop stops when the condition becomes false</li>
</ul>
</section>
<section id="the-while-loop" class="level4">
<h4 class="anchored" data-anchor-id="the-while-loop">The <code>while</code> Loop</h4>
<p>The <code>while</code> loop repeats <strong>while</strong> a condition remains true.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb114"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>n <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"n = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> n<span class="op">);</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>    n<span class="op">--;</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This loop executes as long as <code>n</code> is greater than zero.</p>
</section>
<section id="the-do-while-loop" class="level4">
<h4 class="anchored" data-anchor-id="the-do-while-loop">The <code>do-while</code> Loop</h4>
<p>The <code>do-while</code> loop guarantees at least one execution, because the condition is checked <em>after</em> the body.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb115"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span> <span class="op">{</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Running once! i = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>    i<span class="op">++;</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">while</span> <span class="op">(</span>i <span class="op">&lt;</span> <span class="dv">1</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>It’s useful for input validation or repeating tasks until the user chooses to stop.</p>
</section>
<section id="breaking-and-continuing" class="level4">
<h4 class="anchored" data-anchor-id="breaking-and-continuing">Breaking and Continuing</h4>
<p>Sometimes you want to <strong>skip</strong> or <strong>stop</strong> partway through a loop.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb116"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">5</span><span class="op">)</span> <span class="cf">continue</span><span class="op">;</span>   <span class="co">// skip this iteration</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">8</span><span class="op">)</span> <span class="cf">break</span><span class="op">;</span>      <span class="co">// stop the loop</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>1 2 3 4 6 7</code></pre>
</section>
<section id="nested-loops" class="level4">
<h4 class="anchored" data-anchor-id="nested-loops">Nested Loops</h4>
<p>You can place one loop inside another to handle grids, tables, or multiple dimensions.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb118"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">3</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;=</span> <span class="dv">2</span><span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"i=</span><span class="sc">%d</span><span class="st">, j=</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> j<span class="op">);</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>i=1, j=1
i=1, j=2
i=2, j=1
i=2, j=2
i=3, j=1
i=3, j=2</code></pre>
</section>
<section id="tiny-code-13" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-13">Tiny Code</h4>
<p>Here’s a complete program that demonstrates all three types of loops and control flow features:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb120"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// for loop</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"for loop:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// while loop</span></span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"while loop:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>n <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"n = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> n<span class="op">);</span></span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a>        n<span class="op">--;</span></span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb120-19"><a href="#cb120-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-20"><a href="#cb120-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// do-while loop</span></span>
<span id="cb120-21"><a href="#cb120-21" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"do-while loop:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb120-22"><a href="#cb120-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb120-23"><a href="#cb120-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">do</span> <span class="op">{</span></span>
<span id="cb120-24"><a href="#cb120-24" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"x = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb120-25"><a href="#cb120-25" aria-hidden="true" tabindex="-1"></a>        x<span class="op">++;</span></span>
<span id="cb120-26"><a href="#cb120-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">while</span> <span class="op">(</span>x <span class="op">&lt;</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb120-27"><a href="#cb120-27" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb120-28"><a href="#cb120-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-29"><a href="#cb120-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// break and continue</span></span>
<span id="cb120-30"><a href="#cb120-30" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"break and continue demo:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb120-31"><a href="#cb120-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb120-32"><a href="#cb120-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">5</span><span class="op">)</span> <span class="cf">continue</span><span class="op">;</span> <span class="co">// skip 5</span></span>
<span id="cb120-33"><a href="#cb120-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">8</span><span class="op">)</span> <span class="cf">break</span><span class="op">;</span>    <span class="co">// stop at 8</span></span>
<span id="cb120-34"><a href="#cb120-34" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb120-35"><a href="#cb120-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb120-36"><a href="#cb120-36" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb120-37"><a href="#cb120-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-38"><a href="#cb120-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">// nested loop</span></span>
<span id="cb120-39"><a href="#cb120-39" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">nested loops:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb120-40"><a href="#cb120-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">2</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb120-41"><a href="#cb120-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;=</span> <span class="dv">3</span><span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb120-42"><a href="#cb120-42" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"(</span><span class="sc">%d</span><span class="st">,</span><span class="sc">%d</span><span class="st">) "</span><span class="op">,</span> i<span class="op">,</span> j<span class="op">);</span></span>
<span id="cb120-43"><a href="#cb120-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb120-44"><a href="#cb120-44" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb120-45"><a href="#cb120-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb120-46"><a href="#cb120-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-47"><a href="#cb120-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb120-48"><a href="#cb120-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb121"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> loops_demo.c <span class="at">-o</span> loops_demo</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./loops_demo</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You’ll see all types of loops in action.</p>
</section>
<section id="why-it-matters-13" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-13">Why It Matters</h4>
<p>Loops are the <strong>engine of repetition</strong> in every C program. They make it possible to:</p>
<ul>
<li>Process arrays, files, and lists of data</li>
<li>Run algorithms that iterate until a condition is met</li>
<li>Automate repetitive tasks efficiently</li>
</ul>
<p>In C, loops are close to how the CPU itself operates, each iteration is a direct cycle of logic and computation. By mastering them, you control how your program moves, stops, and repeats, the heartbeat of every algorithm.</p>
</section>
<section id="try-it-yourself-13" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-13">Try It Yourself</h4>
<ol type="1">
<li><p>Write a <code>for</code> loop that prints numbers 1 through 100.</p></li>
<li><p>Add an <code>if</code> inside it to print only even numbers.</p></li>
<li><p>Write a <code>while</code> loop that counts down from 10 to 1.</p></li>
<li><p>Create a nested loop that prints a 3×3 multiplication table.</p></li>
<li><p>Try an infinite loop safely:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb122"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Press Ctrl+C to stop</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span><span class="op">;</span> <span class="co">// or add a condition to exit</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ol>
<p>Once you’re comfortable with loops, you can build patterns, algorithms, and data processors, all by controlling how many times code repeats and under what conditions.</p>
</section>
</section>
<section id="functions-and-parameters" class="level3">
<h3 class="anchored" data-anchor-id="functions-and-parameters">16. Functions and Parameters</h3>
<p>Functions are how you break a program into smaller, reusable pieces. Each function performs one specific task, you call it when needed, pass in data (parameters), and get something back (a return value). Functions make your code organized, testable, and easier to understand.</p>
<section id="the-structure-of-a-function" class="level4">
<h4 class="anchored" data-anchor-id="the-structure-of-a-function">The Structure of a Function</h4>
<p>A function in C has four main parts:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb123"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>return_type function_name<span class="op">(</span>parameter_list<span class="op">)</span> <span class="op">{</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// body of the function</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> value<span class="op">;</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb124"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Here:</p>
<ul>
<li><code>int</code> is the return type</li>
<li><code>add</code> is the name</li>
<li><code>(int a, int b)</code> are parameters</li>
<li><code>return a + b;</code> sends a result back to the caller</li>
</ul>
</section>
<section id="declaring-and-defining-functions" class="level4">
<h4 class="anchored" data-anchor-id="declaring-and-defining-functions">Declaring and Defining Functions</h4>
<p>In C, you must <em>declare</em> a function before using it. The declaration tells the compiler what to expect.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb125"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">);</span> <span class="co">// declaration (prototype)</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> result <span class="op">=</span> add<span class="op">(</span><span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Result: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> result<span class="op">);</span></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="co">// definition</span></span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Result: 7</code></pre>
</section>
<section id="passing-parameters" class="level4">
<h4 class="anchored" data-anchor-id="passing-parameters">Passing Parameters</h4>
<p>When you call a function, the arguments are passed <em>by value</em>, a copy of each value is made. Changing parameters inside the function does <strong>not</strong> affect the original variables.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb127"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> change<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>    change<span class="op">(</span>a<span class="op">);</span></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">);</span> <span class="co">// still 5</span></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If you want to modify the original variable, use <strong>pointers</strong> (you’ll explore this in Chapter 3):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb128"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> change<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="return-values" class="level4">
<h4 class="anchored" data-anchor-id="return-values">Return Values</h4>
<p>A function can return a value using <code>return</code>. The type of the returned value must match the function’s declared return type.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb129"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> average<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>a <span class="op">+</span> b<span class="op">)</span> <span class="op">/</span> <span class="fl">2.0</span><span class="op">;</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>To return nothing, use <code>void</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb130"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> greet<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hello!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="tiny-code-14" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-14">Tiny Code</h4>
<p>Here’s a complete program that combines multiple functions and parameters:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb131"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="co">// function declarations</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">);</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> subtract<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">);</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> divide<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">);</span></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> greet<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">);</span></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a><span class="co">// main function</span></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>    greet<span class="op">(</span><span class="st">"C Learner"</span><span class="op">);</span></span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> sum <span class="op">=</span> add<span class="op">(</span><span class="dv">10</span><span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> diff <span class="op">=</span> subtract<span class="op">(</span><span class="dv">10</span><span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> quotient <span class="op">=</span> divide<span class="op">(</span><span class="fl">10.0</span><span class="op">,</span> <span class="fl">5.0</span><span class="op">);</span></span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Sum: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> sum<span class="op">);</span></span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Difference: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> diff<span class="op">);</span></span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Quotient: </span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> quotient<span class="op">);</span></span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-21"><a href="#cb131-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb131-22"><a href="#cb131-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb131-23"><a href="#cb131-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-24"><a href="#cb131-24" aria-hidden="true" tabindex="-1"></a><span class="co">// function definitions</span></span>
<span id="cb131-25"><a href="#cb131-25" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb131-26"><a href="#cb131-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb131-27"><a href="#cb131-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb131-28"><a href="#cb131-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-29"><a href="#cb131-29" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> subtract<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb131-30"><a href="#cb131-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">-</span> b<span class="op">;</span></span>
<span id="cb131-31"><a href="#cb131-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb131-32"><a href="#cb131-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-33"><a href="#cb131-33" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> divide<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb131-34"><a href="#cb131-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>b <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb131-35"><a href="#cb131-35" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Error: division by zero!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb131-36"><a href="#cb131-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb131-37"><a href="#cb131-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb131-38"><a href="#cb131-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">/</span> b<span class="op">;</span></span>
<span id="cb131-39"><a href="#cb131-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb131-40"><a href="#cb131-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-41"><a href="#cb131-41" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> greet<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb131-42"><a href="#cb131-42" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hello, </span><span class="sc">%s</span><span class="st">!</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> name<span class="op">);</span></span>
<span id="cb131-43"><a href="#cb131-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb132"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> functions_demo.c <span class="at">-o</span> functions_demo</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./functions_demo</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Hello, C Learner!
Sum: 15
Difference: 5
Quotient: 2.00</code></pre>
</section>
<section id="why-it-matters-14" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-14">Why It Matters</h4>
<p>Functions are the <strong>building blocks</strong> of every program. They let you:</p>
<ul>
<li>Break large problems into smaller steps</li>
<li>Reuse code instead of rewriting it</li>
<li>Test each part independently</li>
<li>Make programs easier to read and maintain</li>
</ul>
<p>In C, you’ll use functions for everything, from arithmetic helpers to memory allocators, system calls, and modular libraries.</p>
</section>
<section id="try-it-yourself-14" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-14">Try It Yourself</h4>
<ol type="1">
<li>Write a function that returns the larger of two numbers.</li>
<li>Create a <code>void</code> function that prints a welcome message.</li>
<li>Add a <code>multiply()</code> function and call it from <code>main()</code>.</li>
<li>Modify the program to read numbers from user input and pass them as parameters.</li>
<li>Experiment by removing the declaration at the top, see what compiler error appears, then fix it.</li>
</ol>
<p>Functions are how C programs <em>grow</em>. Each one is a small tool, and together, they become complete systems.</p>
</section>
</section>
<section id="scope-and-lifetime-of-variables" class="level3">
<h3 class="anchored" data-anchor-id="scope-and-lifetime-of-variables">17. Scope and Lifetime of Variables</h3>
<p>Every variable in C exists within a specific <em>scope</em> (where it can be accessed) and has a <em>lifetime</em> (how long it exists in memory). Understanding both is essential to avoid common bugs, from name conflicts to mysterious “garbage values.” Once you know where and how variables live, you’ll start thinking like the compiler.</p>
<section id="variable-scope" class="level4">
<h4 class="anchored" data-anchor-id="variable-scope">Variable Scope</h4>
<p><strong>Scope</strong> defines <em>where</em> a variable can be seen or used in your code.</p>
<ol type="1">
<li><p><strong>Block scope (local variables)</strong> Declared inside a function or block <code>{ ... }</code>. Accessible only within that block.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb134"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> example<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span>  <span class="co">// local to this function</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You can’t access <code>x</code> outside of <code>example()</code>.</p></li>
<li><p><strong>File scope (global variables)</strong> Declared outside of all functions. Accessible anywhere in the file after declaration.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb135"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> counter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// global variable</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> increment<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>    counter<span class="op">++;</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong>Function parameter scope</strong> Parameters behave like local variables, visible only within the function.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb136"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> greet<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hello, </span><span class="sc">%s</span><span class="st">!</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> name<span class="op">);</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong>Block shadowing</strong> Inner variables can temporarily “hide” outer ones:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb137"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span>  <span class="co">// shadows the outer x</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span> <span class="co">// prints 10</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span> <span class="co">// prints 5</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ol>
</section>
<section id="variable-lifetime" class="level4">
<h4 class="anchored" data-anchor-id="variable-lifetime">Variable Lifetime</h4>
<p><strong>Lifetime</strong> determines <em>how long</em> a variable stays in memory.</p>
<ol type="1">
<li><p><strong>Automatic (default)</strong> Local variables are created when a function starts and destroyed when it ends.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb138"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> demo<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> temp <span class="op">=</span> <span class="dv">42</span><span class="op">;</span>  <span class="co">// exists only while demo() runs</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong>Static</strong> Declared with the <code>static</code> keyword, they keep their value between function calls.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb139"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> counter<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> <span class="dt">int</span> count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>  <span class="co">// initialized only once</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>    count<span class="op">++;</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Count: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> count<span class="op">);</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Every call to <code>counter()</code> increases the same variable.</p></li>
<li><p><strong>Dynamic</strong> Created manually using <code>malloc()</code> or <code>calloc()</code>, they live until you <code>free()</code> them. (You’ll learn this in Chapter 3.)</p></li>
<li><p><strong>Global</strong> Exist for the entire duration of the program.</p></li>
</ol>
</section>
<section id="storage-classes-in-c" class="level4">
<h4 class="anchored" data-anchor-id="storage-classes-in-c">Storage Classes in C</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 19%">
<col style="width: 14%">
<col style="width: 19%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Storage</th>
<th>Scope</th>
<th>Lifetime</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>auto</code></td>
<td>Stack</td>
<td>Block</td>
<td>Function call</td>
<td>Default for locals</td>
</tr>
<tr class="even">
<td><code>register</code></td>
<td>CPU Register</td>
<td>Block</td>
<td>Function call</td>
<td>Hint to optimize speed</td>
</tr>
<tr class="odd">
<td><code>static</code></td>
<td>Static Memory</td>
<td>Block/File</td>
<td>Program</td>
<td>Retains value</td>
</tr>
<tr class="even">
<td><code>extern</code></td>
<td>Static Memory</td>
<td>Global</td>
<td>Program</td>
<td>Declared elsewhere</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-15" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-15">Tiny Code</h4>
<p>Here’s a full program showing scope and lifetime in action:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb140"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> global_var <span class="op">=</span> <span class="dv">10</span><span class="op">;</span> <span class="co">// global scope</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> demo_scope<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> local_var <span class="op">=</span> <span class="dv">5</span><span class="op">;</span> <span class="co">// block scope</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> <span class="dt">int</span> persistent <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// retains value between calls</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Global: </span><span class="sc">%d</span><span class="st">, Local: </span><span class="sc">%d</span><span class="st">, Static: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> global_var<span class="op">,</span> local_var<span class="op">,</span> persistent<span class="op">);</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>    persistent<span class="op">++;</span></span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"First call:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>    demo_scope<span class="op">();</span></span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Second call:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a>    demo_scope<span class="op">();</span></span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Accessing global variable in main: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> global_var<span class="op">);</span></span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb141"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> scope_demo.c <span class="at">-o</span> scope_demo</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./scope_demo</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>First call:
Global: 10, Local: 5, Static: 0

Second call:
Global: 10, Local: 5, Static: 1

Accessing global variable in main: 10</code></pre>
</section>
<section id="why-it-matters-15" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-15">Why It Matters</h4>
<p>Scope and lifetime are the <strong>invisible structure</strong> beneath your code. They define what data is available where, and for how long. Without understanding them, you’ll face bugs like:</p>
<ul>
<li>Uninitialized values after a function returns</li>
<li>Variables mysteriously resetting</li>
<li>Conflicts between local and global names</li>
</ul>
<p>Once you know how the compiler manages variables, you can reason about memory, performance, and correctness with confidence.</p>
</section>
<section id="try-it-yourself-15" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-15">Try It Yourself</h4>
<ol type="1">
<li>Write a function with a static counter and call it three times. Observe how the count persists.</li>
<li>Add a global variable, modify it from two different functions, and print the result.</li>
<li>Create nested blocks with variables of the same name, see how shadowing behaves.</li>
<li>Move a variable outside a function and mark it <code>static</code>. Try accessing it from another function, what happens?</li>
<li>Rewrite your earlier “calculator” example using global and local variables to see the difference.</li>
</ol>
<p>When you understand scope and lifetime, you gain control over how your program’s data moves, lives, and dies, a skill every true C programmer needs.</p>
</section>
</section>
<section id="return-values-and-function-signatures" class="level3">
<h3 class="anchored" data-anchor-id="return-values-and-function-signatures">18. Return Values and Function Signatures</h3>
<p>Functions not only perform tasks but often <em>communicate results</em> back to the caller. They do this through <strong>return values</strong>. Every C function has a <strong>signature</strong>, a declaration that defines its return type, name, and parameters. Getting comfortable with signatures and return values helps you write clean, predictable, and modular programs.</p>
<section id="function-signatures-explained" class="level4">
<h4 class="anchored" data-anchor-id="function-signatures-explained">Function Signatures Explained</h4>
<p>A function signature looks like this:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb143"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>return_type function_name<span class="op">(</span>parameter_list<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>It tells the compiler:</p>
<ol type="1">
<li><strong>What kind of value</strong> the function returns (<code>int</code>, <code>double</code>, <code>void</code>, etc.)</li>
<li><strong>What the function is called</strong></li>
<li><strong>What arguments</strong> it expects and their types</li>
</ol>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb144"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> max<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This says: “<code>max</code> is a function that takes two integers and returns an integer.”</p>
</section>
<section id="returning-values" class="level4">
<h4 class="anchored" data-anchor-id="returning-values">Returning Values</h4>
<p>You use the <code>return</code> keyword to send a value back from a function.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb145"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">+</span> y<span class="op">;</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The type of the value you return must match the function’s declared return type.</p>
<p>If a function doesn’t need to return anything, declare it as <code>void</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb146"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> greet<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hello!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>A <code>void</code> function can still perform actions, it just doesn’t produce a result.</p>
</section>
<section id="multiple-return-points" class="level4">
<h4 class="anchored" data-anchor-id="multiple-return-points">Multiple Return Points</h4>
<p>You can return early if certain conditions are met.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb147"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> divide<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>b <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Error: division by zero!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">/</span> b<span class="op">;</span></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This is common for error handling or input validation.</p>
</section>
<section id="returning-different-data-types" class="level4">
<h4 class="anchored" data-anchor-id="returning-different-data-types">Returning Different Data Types</h4>
<p>You can return any type, not just integers.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb148"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> average<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>a <span class="op">+</span> b<span class="op">)</span> <span class="op">/</span> <span class="fl">2.0</span><span class="op">;</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> first_letter<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>word<span class="op">)</span> <span class="op">{</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> word<span class="op">[</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a><span class="dt">_Bool</span> is_even<span class="op">(</span><span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>For more complex data, you’ll later learn how to return pointers or structs.</p>
</section>
<section id="tiny-code-16" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-16">Tiny Code</h4>
<p>Here’s a complete example showing several return types and signatures:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb149"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdbool.h&gt;</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="co">// function declarations</span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">);</span></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> divide<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">);</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> is_even<span class="op">(</span><span class="dt">int</span> n<span class="op">);</span></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> greet<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">);</span></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>    greet<span class="op">(</span><span class="st">"C Programmer"</span><span class="op">);</span></span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> sum <span class="op">=</span> add<span class="op">(</span><span class="dv">7</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> quotient <span class="op">=</span> divide<span class="op">(</span><span class="fl">10.0</span><span class="op">,</span> <span class="fl">4.0</span><span class="op">);</span></span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> check <span class="op">=</span> is_even<span class="op">(</span>sum<span class="op">);</span></span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Sum: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> sum<span class="op">);</span></span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Quotient: </span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> quotient<span class="op">);</span></span>
<span id="cb149-19"><a href="#cb149-19" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Is sum even? </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> check <span class="op">?</span> <span class="st">"Yes"</span> <span class="op">:</span> <span class="st">"No"</span><span class="op">);</span></span>
<span id="cb149-20"><a href="#cb149-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-21"><a href="#cb149-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb149-22"><a href="#cb149-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb149-23"><a href="#cb149-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-24"><a href="#cb149-24" aria-hidden="true" tabindex="-1"></a><span class="co">// function definitions</span></span>
<span id="cb149-25"><a href="#cb149-25" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb149-26"><a href="#cb149-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">+</span> y<span class="op">;</span></span>
<span id="cb149-27"><a href="#cb149-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb149-28"><a href="#cb149-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-29"><a href="#cb149-29" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> divide<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb149-30"><a href="#cb149-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>b <span class="op">==</span> <span class="fl">0.0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb149-31"><a href="#cb149-31" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Cannot divide by zero.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb149-32"><a href="#cb149-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb149-33"><a href="#cb149-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb149-34"><a href="#cb149-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">/</span> b<span class="op">;</span></span>
<span id="cb149-35"><a href="#cb149-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb149-36"><a href="#cb149-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-37"><a href="#cb149-37" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> is_even<span class="op">(</span><span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb149-38"><a href="#cb149-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb149-39"><a href="#cb149-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb149-40"><a href="#cb149-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-41"><a href="#cb149-41" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> greet<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb149-42"><a href="#cb149-42" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hello, </span><span class="sc">%s</span><span class="st">!</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> name<span class="op">);</span></span>
<span id="cb149-43"><a href="#cb149-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb150"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> return_demo.c <span class="at">-o</span> return_demo</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./return_demo</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Hello, C Programmer!
Sum: 10
Quotient: 2.50
Is sum even? Yes</code></pre>
</section>
<section id="why-it-matters-16" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-16">Why It Matters</h4>
<p>Return values are how functions <em>communicate</em>. By designing clear and meaningful signatures:</p>
<ul>
<li>You make your code <strong>predictable</strong>, every function has a defined purpose and output.</li>
<li>The compiler can <strong>check correctness</strong>, mismatched types raise warnings.</li>
<li>You can <strong>compose</strong> functions, one function’s return becomes another’s input.</li>
</ul>
<p>In large systems, consistent signatures and meaningful return types form the backbone of good API design.</p>
</section>
<section id="try-it-yourself-16" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-16">Try It Yourself</h4>
<ol type="1">
<li>Write a function <code>max(a, b)</code> that returns the larger of two integers.</li>
<li>Write a function <code>to_upper(char c)</code> that returns an uppercase version of a character.</li>
<li>Modify a <code>divide()</code> function to return <code>-1</code> if division by zero occurs.</li>
<li>Create a <code>sum_to_n(int n)</code> that returns the sum of all numbers from 1 to <code>n</code>.</li>
<li>Try using a <code>void</code> function that prints the result of another function call.</li>
</ol>
<p>Return values give your functions purpose, they turn simple actions into reusable building blocks that make your programs expressive, modular, and alive.</p>
</section>
</section>
<section id="static-vs-dynamic-linking-of-code-units" class="level3">
<h3 class="anchored" data-anchor-id="static-vs-dynamic-linking-of-code-units">19. Static vs Dynamic Linking of Code Units</h3>
<p>When your program grows beyond a single file, you begin linking multiple <em>code units</em> together, functions and data that live in different files. This linking step decides how your program combines and shares code. There are two main ways to do it in C: <strong>static linking</strong> and <strong>dynamic linking</strong>. Understanding both is essential for building real-world software.</p>
<section id="the-big-picture" class="level4">
<h4 class="anchored" data-anchor-id="the-big-picture">The Big Picture</h4>
<p>When you compile a C program:</p>
<ol type="1">
<li><p>Each <code>.c</code> file becomes an <strong>object file</strong> (<code>.o</code>).</p></li>
<li><p>The <strong>linker</strong> combines all object files and libraries into one executable.</p></li>
<li><p>Depending on how you link, that executable may contain:</p>
<ul>
<li>All required code inside (static linking), or</li>
<li>References to shared libraries on the system (dynamic linking).</li>
</ul></li>
</ol>
</section>
<section id="static-linking" class="level4">
<h4 class="anchored" data-anchor-id="static-linking">Static Linking</h4>
<p><strong>Static linking</strong> copies all the necessary library code directly into your program at build time.</p>
<p>Example command:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb152"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.c mathutils.c <span class="at">-o</span> app_static</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Everything from <code>mathutils.c</code> gets <em>embedded</em> inside <code>app_static</code>.</p>
<p><strong>Pros:</strong></p>
<ul>
<li>No external dependencies at runtime</li>
<li>Faster startup (everything is self-contained)</li>
<li>Easier deployment</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>Larger executable file</li>
<li>Updating a library means recompiling the program</li>
</ul>
</section>
<section id="dynamic-linking" class="level4">
<h4 class="anchored" data-anchor-id="dynamic-linking">Dynamic Linking</h4>
<p><strong>Dynamic linking</strong> (or <em>shared linking</em>) links your program to shared libraries (<code>.so</code> on Linux, <code>.dll</code> on Windows) at runtime instead of embedding them.</p>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb153"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.c <span class="at">-o</span> app_dynamic <span class="at">-lm</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Here, <code>-lm</code> tells the linker to use the shared <strong>math library</strong> (<code>libm.so</code>).</p>
<p>Your program keeps the library <em>separate</em>, loading it when executed.</p>
<p><strong>Pros:</strong></p>
<ul>
<li>Smaller executables</li>
<li>Libraries can be updated independently</li>
<li>Multiple programs share the same library in memory</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>Requires the correct library to be available at runtime</li>
<li>Slightly slower startup</li>
</ul>
</section>
<section id="tiny-code-17" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-17">Tiny Code</h4>
<p>Let’s demonstrate static vs dynamic linking using a simple math utility.</p>
<p><strong>mathutils.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb154"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> multiply<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">*</span> b<span class="op">;</span></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>mathutils.h</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb155"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef MATHUTILS_H</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MATHUTILS_H</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">);</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> multiply<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">);</span></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>main.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb156"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"mathutils.h"</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">4</span><span class="op">,</span> y <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Add: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> add<span class="op">(</span>x<span class="op">,</span> y<span class="op">));</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Multiply: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> multiply<span class="op">(</span>x<span class="op">,</span> y<span class="op">));</span></span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Static Linking Build:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb157"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.c mathutils.c <span class="at">-o</span> static_app</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./static_app</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Add: 9
Multiply: 20</code></pre>
<p><strong>Dynamic Linking Build (using shared library):</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb159"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> <span class="at">-fPIC</span> mathutils.c <span class="at">-o</span> mathutils.o</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-shared</span> <span class="at">-o</span> libmathutils.so mathutils.o</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.c <span class="at">-L.</span> <span class="at">-lmathutils</span> <span class="at">-o</span> dynamic_app</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">LD_LIBRARY_PATH</span><span class="op">=</span>.</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a><span class="ex">./dynamic_app</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Add: 9
Multiply: 20</code></pre>
<p>Now your executable depends on the shared <code>libmathutils.so</code>, the same library could be used by many other programs.</p>
</section>
<section id="why-it-matters-17" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-17">Why It Matters</h4>
<p>Linking determines <strong>how your software connects and shares code</strong>. It affects:</p>
<ul>
<li>Performance and memory usage</li>
<li>Deployment and portability</li>
<li>How easily your program updates when libraries change</li>
</ul>
<p>Static linking is great for small, standalone tools. Dynamic linking is better for large systems, shared components, or when you rely on system libraries (like <code>libc</code>, <code>libm</code>, <code>pthread</code>).</p>
<p>Understanding linking makes you a systems thinker, you’ll know how the pieces of your program fit together at the binary level.</p>
</section>
<section id="try-it-yourself-17" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-17">Try It Yourself</h4>
<ol type="1">
<li>Create <code>mathutils.c</code> and <code>mathutils.h</code> as above.</li>
<li>Compile statically and dynamically; compare file sizes using <code>ls -lh</code>.</li>
<li>Move <code>libmathutils.so</code> out of the directory and run <code>./dynamic_app</code>, notice the missing library error.</li>
<li>Add <code>export LD_LIBRARY_PATH=.</code> and run again.</li>
<li>Modify <code>multiply()</code> to print a message, recompile <em>only</em> the shared library and see the change take effect instantly.</li>
</ol>
<p>Static vs dynamic linking is where your C programs move from “source code” to real-world software, how your logic becomes part of an executable that lives, loads, and runs on any machine.</p>
</section>
</section>
<section id="practice-build-a-simple-calculator" class="level3">
<h3 class="anchored" data-anchor-id="practice-build-a-simple-calculator">20. Practice: Build a Simple Calculator</h3>
<p>Now that you’ve learned about functions, variables, loops, control flow, and linking, it’s time to bring everything together. You’ll build a simple calculator that performs basic arithmetic using clean modular code. This small project will reinforce everything from Chapters 11–19, data types, operators, control flow, and reusable functions.</p>
<section id="project-overview" class="level4">
<h4 class="anchored" data-anchor-id="project-overview">Project Overview</h4>
<p>You’ll write a calculator that:</p>
<ul>
<li>Prompts the user for two numbers and an operator</li>
<li>Performs the corresponding operation (+, -, *, /)</li>
<li>Handles division by zero safely</li>
<li>Repeats until the user chooses to quit</li>
</ul>
<p>You’ll structure it using multiple functions and a clean main loop.</p>
</section>
<section id="tiny-code-18" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-18">Tiny Code</h4>
<p><strong>calculator.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb161"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdbool.h&gt;</span></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Function declarations</span></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> add<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">);</span></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> subtract<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">);</span></span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> multiply<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">);</span></span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> divide<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">);</span></span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_menu<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-11"><a href="#cb161-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb161-12"><a href="#cb161-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> num1<span class="op">,</span> num2<span class="op">,</span> result<span class="op">;</span></span>
<span id="cb161-13"><a href="#cb161-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> op<span class="op">;</span></span>
<span id="cb161-14"><a href="#cb161-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> running <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb161-15"><a href="#cb161-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-16"><a href="#cb161-16" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"=== Simple C Calculator ===</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb161-17"><a href="#cb161-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-18"><a href="#cb161-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>running<span class="op">)</span> <span class="op">{</span></span>
<span id="cb161-19"><a href="#cb161-19" aria-hidden="true" tabindex="-1"></a>        print_menu<span class="op">();</span></span>
<span id="cb161-20"><a href="#cb161-20" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Enter an operator (+, -, *, /) or q to quit: "</span><span class="op">);</span></span>
<span id="cb161-21"><a href="#cb161-21" aria-hidden="true" tabindex="-1"></a>        scanf<span class="op">(</span><span class="st">" </span><span class="sc">%c</span><span class="st">"</span><span class="op">,</span> <span class="op">&amp;</span>op<span class="op">);</span></span>
<span id="cb161-22"><a href="#cb161-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-23"><a href="#cb161-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>op <span class="op">==</span> <span class="ch">'q'</span> <span class="op">||</span> op <span class="op">==</span> <span class="ch">'Q'</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb161-24"><a href="#cb161-24" aria-hidden="true" tabindex="-1"></a>            running <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb161-25"><a href="#cb161-25" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"Goodbye!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb161-26"><a href="#cb161-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb161-27"><a href="#cb161-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb161-28"><a href="#cb161-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-29"><a href="#cb161-29" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Enter first number: "</span><span class="op">);</span></span>
<span id="cb161-30"><a href="#cb161-30" aria-hidden="true" tabindex="-1"></a>        scanf<span class="op">(</span><span class="st">"</span><span class="sc">%lf</span><span class="st">"</span><span class="op">,</span> <span class="op">&amp;</span>num1<span class="op">);</span></span>
<span id="cb161-31"><a href="#cb161-31" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Enter second number: "</span><span class="op">);</span></span>
<span id="cb161-32"><a href="#cb161-32" aria-hidden="true" tabindex="-1"></a>        scanf<span class="op">(</span><span class="st">"</span><span class="sc">%lf</span><span class="st">"</span><span class="op">,</span> <span class="op">&amp;</span>num2<span class="op">);</span></span>
<span id="cb161-33"><a href="#cb161-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-34"><a href="#cb161-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> <span class="op">(</span>op<span class="op">)</span> <span class="op">{</span></span>
<span id="cb161-35"><a href="#cb161-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="ch">'+'</span><span class="op">:</span></span>
<span id="cb161-36"><a href="#cb161-36" aria-hidden="true" tabindex="-1"></a>                result <span class="op">=</span> add<span class="op">(</span>num1<span class="op">,</span> num2<span class="op">);</span></span>
<span id="cb161-37"><a href="#cb161-37" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">"Result: </span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> result<span class="op">);</span></span>
<span id="cb161-38"><a href="#cb161-38" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb161-39"><a href="#cb161-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="ch">'-'</span><span class="op">:</span></span>
<span id="cb161-40"><a href="#cb161-40" aria-hidden="true" tabindex="-1"></a>                result <span class="op">=</span> subtract<span class="op">(</span>num1<span class="op">,</span> num2<span class="op">);</span></span>
<span id="cb161-41"><a href="#cb161-41" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">"Result: </span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> result<span class="op">);</span></span>
<span id="cb161-42"><a href="#cb161-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb161-43"><a href="#cb161-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="ch">'*'</span><span class="op">:</span></span>
<span id="cb161-44"><a href="#cb161-44" aria-hidden="true" tabindex="-1"></a>                result <span class="op">=</span> multiply<span class="op">(</span>num1<span class="op">,</span> num2<span class="op">);</span></span>
<span id="cb161-45"><a href="#cb161-45" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">"Result: </span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> result<span class="op">);</span></span>
<span id="cb161-46"><a href="#cb161-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb161-47"><a href="#cb161-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="ch">'/'</span><span class="op">:</span></span>
<span id="cb161-48"><a href="#cb161-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>num2 <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb161-49"><a href="#cb161-49" aria-hidden="true" tabindex="-1"></a>                    printf<span class="op">(</span><span class="st">"Error: Division by zero!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb161-50"><a href="#cb161-50" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb161-51"><a href="#cb161-51" aria-hidden="true" tabindex="-1"></a>                    result <span class="op">=</span> divide<span class="op">(</span>num1<span class="op">,</span> num2<span class="op">);</span></span>
<span id="cb161-52"><a href="#cb161-52" aria-hidden="true" tabindex="-1"></a>                    printf<span class="op">(</span><span class="st">"Result: </span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> result<span class="op">);</span></span>
<span id="cb161-53"><a href="#cb161-53" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb161-54"><a href="#cb161-54" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb161-55"><a href="#cb161-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">default</span><span class="op">:</span></span>
<span id="cb161-56"><a href="#cb161-56" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">"Unknown operator: </span><span class="sc">%c\n</span><span class="st">"</span><span class="op">,</span> op<span class="op">);</span></span>
<span id="cb161-57"><a href="#cb161-57" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb161-58"><a href="#cb161-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-59"><a href="#cb161-59" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb161-60"><a href="#cb161-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb161-61"><a href="#cb161-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-62"><a href="#cb161-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb161-63"><a href="#cb161-63" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb161-64"><a href="#cb161-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-65"><a href="#cb161-65" aria-hidden="true" tabindex="-1"></a><span class="co">// Function definitions</span></span>
<span id="cb161-66"><a href="#cb161-66" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> add<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb161-67"><a href="#cb161-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb161-68"><a href="#cb161-68" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb161-69"><a href="#cb161-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-70"><a href="#cb161-70" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> subtract<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb161-71"><a href="#cb161-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">-</span> b<span class="op">;</span></span>
<span id="cb161-72"><a href="#cb161-72" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb161-73"><a href="#cb161-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-74"><a href="#cb161-74" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> multiply<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb161-75"><a href="#cb161-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">*</span> b<span class="op">;</span></span>
<span id="cb161-76"><a href="#cb161-76" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb161-77"><a href="#cb161-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-78"><a href="#cb161-78" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> divide<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb161-79"><a href="#cb161-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">/</span> b<span class="op">;</span></span>
<span id="cb161-80"><a href="#cb161-80" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb161-81"><a href="#cb161-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-82"><a href="#cb161-82" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_menu<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb161-83"><a href="#cb161-83" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Choose an operation:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb161-84"><a href="#cb161-84" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"  +  Addition</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb161-85"><a href="#cb161-85" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"  -  Subtraction</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb161-86"><a href="#cb161-86" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"  *  Multiplication</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb161-87"><a href="#cb161-87" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"  /  Division</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb161-88"><a href="#cb161-88" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"  q  Quit</span><span class="sc">\n\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb161-89"><a href="#cb161-89" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb162"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> calculator.c <span class="at">-o</span> calculator</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./calculator</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example session:</p>
<pre><code>=== Simple C Calculator ===
Choose an operation:
  +  Addition
  -  Subtraction
  *  Multiplication
  /  Division
  q  Quit

Enter an operator (+, -, *, /) or q to quit: +
Enter first number: 5
Enter second number: 3
Result: 8.00

Enter an operator (+, -, *, /) or q to quit: /
Enter first number: 10
Enter second number: 0
Error: Division by zero!

Enter an operator (+, -, *, /) or q to quit: q
Goodbye!</code></pre>
</section>
<section id="why-it-matters-18" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-18">Why It Matters</h4>
<p>This simple project combines nearly everything you’ve learned in Chapter 2:</p>
<ul>
<li><strong>Data types</strong> for representing numbers</li>
<li><strong>Operators</strong> for performing calculations</li>
<li><strong>Control flow</strong> for making decisions</li>
<li><strong>Loops</strong> for repeated interaction</li>
<li><strong>Functions</strong> for modular design</li>
</ul>
<p>You’ve now moved beyond syntax, you’ve built a working, reusable C program that interacts with real users.</p>
</section>
<section id="try-it-yourself-18" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-18">Try It Yourself</h4>
<ol type="1">
<li><p>Add a new operator <code>%</code> for modulo (integer remainder).</p></li>
<li><p>Create separate files:</p>
<ul>
<li><code>calculator.c</code> for <code>main()</code></li>
<li><code>mathutils.c</code> and <code>mathutils.h</code> for the arithmetic functions Then compile using:</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb164"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> calculator.c mathutils.c <span class="at">-o</span> calculator</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Extend the calculator to remember the last result and reuse it if the user enters a single operand.</p></li>
<li><p>Add input validation (e.g., check if <code>scanf</code> actually reads a number).</p></li>
<li><p>For a challenge, implement power (<code>^</code>) or square root (<code>sqrt</code>) using <code>&lt;math.h&gt;</code>.</p></li>
</ol>
<p>This calculator marks the end of your <strong>Language Basics</strong> journey, from variables and control flow to full, interactive programs. In the next chapter, you’ll dive into memory: how C stores your data, manages it, and lets you control it directly.</p>
</section>
</section>
</section>
<section id="chapter-3.-working-with-memory" class="level1">
<h1>Chapter 3. Working with Memory</h1>
<section id="understanding-memory-layout-stack-heap-data-code" class="level3">
<h3 class="anchored" data-anchor-id="understanding-memory-layout-stack-heap-data-code">21. Understanding Memory Layout (Stack, Heap, Data, Code)</h3>
<p>Before you can master pointers or dynamic memory, you need to understand <strong>how memory is organized</strong> in a running C program. C gives you a level of control that few languages allow, but to use it safely, you must know where your data lives and how long it stays there.</p>
<section id="the-memory-segments" class="level4">
<h4 class="anchored" data-anchor-id="the-memory-segments">The Memory Segments</h4>
<p>When a program runs, its memory is divided into several key sections:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 55%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th>Segment</th>
<th>Purpose</th>
<th>Example Data</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Code (Text)</strong></td>
<td>Stores compiled machine instructions</td>
<td>Functions, program logic</td>
</tr>
<tr class="even">
<td><strong>Data (Static)</strong></td>
<td>Stores global and static variables with initialized values</td>
<td><code>int count = 5;</code></td>
</tr>
<tr class="odd">
<td><strong>BSS (Uninitialized Data)</strong></td>
<td>Holds global/static variables that start as zero or are uninitialized</td>
<td><code>int buffer[256];</code></td>
</tr>
<tr class="even">
<td><strong>Heap</strong></td>
<td>Used for dynamic memory allocation (<code>malloc</code>, <code>calloc</code>)</td>
<td>Large, runtime-created data</td>
</tr>
<tr class="odd">
<td><strong>Stack</strong></td>
<td>Stores local variables, function parameters, return addresses</td>
<td>Function calls, recursion</td>
</tr>
</tbody>
</table>
<p>These segments are managed differently by the operating system, and each has a different <strong>lifetime</strong> and <strong>scope</strong>.</p>
</section>
<section id="tiny-code-19" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-19">Tiny Code</h4>
<p>Here’s a small program that prints the memory addresses of different variables to show where they live:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb165"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Global variable (Data segment)</span></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> global_var <span class="op">=</span> <span class="dv">42</span><span class="op">;</span></span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Uninitialized global variable (BSS segment)</span></span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> global_bss<span class="op">;</span></span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> show_addresses<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Local variable (Stack)</span></span>
<span id="cb165-12"><a href="#cb165-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> local_var <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb165-13"><a href="#cb165-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-14"><a href="#cb165-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Static variable (Data segment)</span></span>
<span id="cb165-15"><a href="#cb165-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> <span class="dt">int</span> static_var <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb165-16"><a href="#cb165-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-17"><a href="#cb165-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Dynamic variable (Heap)</span></span>
<span id="cb165-18"><a href="#cb165-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>heap_var <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb165-19"><a href="#cb165-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>heap_var <span class="op">=</span> <span class="dv">30</span><span class="op">;</span></span>
<span id="cb165-20"><a href="#cb165-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-21"><a href="#cb165-21" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Code (function) address:     </span><span class="sc">%p\n</span><span class="st">"</span><span class="op">,</span> <span class="op">(</span><span class="dt">void</span> <span class="op">*)</span>show_addresses<span class="op">);</span></span>
<span id="cb165-22"><a href="#cb165-22" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Global variable address:     </span><span class="sc">%p\n</span><span class="st">"</span><span class="op">,</span> <span class="op">(</span><span class="dt">void</span> <span class="op">*)&amp;</span>global_var<span class="op">);</span></span>
<span id="cb165-23"><a href="#cb165-23" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Uninitialized global address:</span><span class="sc">%p\n</span><span class="st">"</span><span class="op">,</span> <span class="op">(</span><span class="dt">void</span> <span class="op">*)&amp;</span>global_bss<span class="op">);</span></span>
<span id="cb165-24"><a href="#cb165-24" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Static variable address:     </span><span class="sc">%p\n</span><span class="st">"</span><span class="op">,</span> <span class="op">(</span><span class="dt">void</span> <span class="op">*)&amp;</span>static_var<span class="op">);</span></span>
<span id="cb165-25"><a href="#cb165-25" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Stack variable address:      </span><span class="sc">%p\n</span><span class="st">"</span><span class="op">,</span> <span class="op">(</span><span class="dt">void</span> <span class="op">*)&amp;</span>local_var<span class="op">);</span></span>
<span id="cb165-26"><a href="#cb165-26" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Heap variable address:       </span><span class="sc">%p\n</span><span class="st">"</span><span class="op">,</span> <span class="op">(</span><span class="dt">void</span> <span class="op">*)</span>heap_var<span class="op">);</span></span>
<span id="cb165-27"><a href="#cb165-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-28"><a href="#cb165-28" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>heap_var<span class="op">);</span></span>
<span id="cb165-29"><a href="#cb165-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb165-30"><a href="#cb165-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-31"><a href="#cb165-31" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb165-32"><a href="#cb165-32" aria-hidden="true" tabindex="-1"></a>    show_addresses<span class="op">();</span></span>
<span id="cb165-33"><a href="#cb165-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb165-34"><a href="#cb165-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb166"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> memory_layout.c <span class="at">-o</span> memory_layout</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./memory_layout</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example output (addresses vary by system):</p>
<pre><code>Code (function) address:     0x561ce7348169
Global variable address:     0x561ce7546014
Uninitialized global address:0x561ce7546018
Static variable address:     0x561ce7546020
Stack variable address:      0x7ffc94b65a5c
Heap variable address:       0x561ce774b2a0</code></pre>
<p>Notice how the stack address is much higher than the heap, the stack usually grows <em>downward</em>, and the heap grows <em>upward</em> in memory.</p>
</section>
<section id="how-it-all-works" class="level4">
<h4 class="anchored" data-anchor-id="how-it-all-works">How It All Works</h4>
<ol type="1">
<li><p><strong>Code segment</strong></p>
<ul>
<li>Contains compiled instructions.</li>
<li>Usually marked as read-only to prevent accidental modification.</li>
</ul></li>
<li><p><strong>Data segment</strong></p>
<ul>
<li>Holds global and static variables initialized with values.</li>
<li>Exists for the entire program duration.</li>
</ul></li>
<li><p><strong>BSS (Block Started by Symbol)</strong></p>
<ul>
<li>Holds uninitialized global/static variables.</li>
<li>Automatically zero-initialized at runtime.</li>
</ul></li>
<li><p><strong>Stack</strong></p>
<ul>
<li>Used for local variables and function calls.</li>
<li>Automatically managed, grows and shrinks as functions are called and return.</li>
</ul></li>
<li><p><strong>Heap</strong></p>
<ul>
<li>Allocated manually at runtime.</li>
<li>Requires explicit management (<code>malloc</code> and <code>free</code>).</li>
</ul></li>
</ol>
</section>
<section id="why-it-matters-19" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-19">Why It Matters</h4>
<p>Every time you write a variable, you’re deciding, whether consciously or not, <em>where</em> in memory it lives. Understanding this layout helps you:</p>
<ul>
<li>Debug memory errors (segmentation faults, leaks, corruption).</li>
<li>Reason about performance and function calls.</li>
<li>Write correct code when using <code>malloc</code>, <code>free</code>, and pointers.</li>
<li>Build real systems software like allocators or kernels.</li>
</ul>
<p>Without this mental model, C memory bugs feel mysterious; with it, they become logical and fixable.</p>
</section>
<section id="try-it-yourself-19" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-19">Try It Yourself</h4>
<ol type="1">
<li>Add more global, local, and static variables to the example and print their addresses.</li>
<li>Allocate two blocks with <code>malloc()</code> and compare their addresses, the heap grows upward.</li>
<li>Call <code>show_addresses()</code> multiple times and notice how the stack variable’s address changes each call.</li>
<li>Move a variable from global to local and observe how its memory segment changes.</li>
<li>Draw a diagram showing stack, heap, data, and code regions for your system.</li>
</ol>
<p>Understanding memory layout is your first real step into <strong>systems-level C</strong>, it’s how you begin to see your code not just as text, but as <strong>structured bytes living inside memory</strong>.</p>
</section>
</section>
<section id="pointers-and-addresses" class="level3">
<h3 class="anchored" data-anchor-id="pointers-and-addresses">22. Pointers and Addresses</h3>
<p>Pointers are at the heart of C programming. They give you direct access to memory, the power to read, write, and manipulate data stored anywhere in your program. Understanding pointers transforms how you think about variables, functions, and data structures.</p>
<p>You can’t truly master C without mastering pointers.</p>
<section id="what-is-a-pointer" class="level4">
<h4 class="anchored" data-anchor-id="what-is-a-pointer">What Is a Pointer?</h4>
<p>A <strong>pointer</strong> is a variable that stores the <em>address</em> of another variable. Think of it as a reference to a specific spot in memory.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb168"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> value <span class="op">=</span> <span class="dv">42</span><span class="op">;</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>ptr <span class="op">=</span> <span class="op">&amp;</span>value<span class="op">;</span> <span class="co">// pointer to int, stores the address of value</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><code>&amp;value</code> gives the memory address of <code>value</code>.</li>
<li><code>ptr</code> <em>holds</em> that address.</li>
<li><code>*ptr</code> lets you <em>access</em> the value stored there (this is called <em>dereferencing</em>).</li>
</ul>
</section>
<section id="tiny-code-20" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-20">Tiny Code</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb169"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> number <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>number<span class="op">;</span>  <span class="co">// pointer stores address of number</span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Value of number: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> number<span class="op">);</span></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Address of number: </span><span class="sc">%p\n</span><span class="st">"</span><span class="op">,</span> <span class="op">(</span><span class="dt">void</span> <span class="op">*)&amp;</span>number<span class="op">);</span></span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Pointer p holds address: </span><span class="sc">%p\n</span><span class="st">"</span><span class="op">,</span> <span class="op">(</span><span class="dt">void</span> <span class="op">*)</span>p<span class="op">);</span></span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Value through pointer: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span></span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>p <span class="op">=</span> <span class="dv">20</span><span class="op">;</span>  <span class="co">// modify the value via the pointer</span></span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"New value of number: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> number<span class="op">);</span></span>
<span id="cb169-14"><a href="#cb169-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-15"><a href="#cb169-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb169-16"><a href="#cb169-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb170"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> pointer_basics.c <span class="at">-o</span> pointer_basics</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./pointer_basics</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output (addresses vary):</p>
<pre><code>Value of number: 10
Address of number: 0x7ffc8f4c9c4c
Pointer p holds address: 0x7ffc8f4c9c4c
Value through pointer: 10
New value of number: 20</code></pre>
</section>
<section id="pointer-declaration-and-dereferencing" class="level4">
<h4 class="anchored" data-anchor-id="pointer-declaration-and-dereferencing">Pointer Declaration and Dereferencing</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 85%">
</colgroup>
<thead>
<tr class="header">
<th>Syntax</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>int *p;</code></td>
<td>Pointer to an integer</td>
</tr>
<tr class="even">
<td><code>char *c;</code></td>
<td>Pointer to a character</td>
</tr>
<tr class="odd">
<td><code>float *f;</code></td>
<td>Pointer to a float</td>
</tr>
<tr class="even">
<td><code>p = &amp;x;</code></td>
<td>Assigns address of variable <code>x</code> to pointer <code>p</code></td>
</tr>
<tr class="odd">
<td><code>*p</code></td>
<td>Accesses (dereferences) the value stored at the address held by <code>p</code></td>
</tr>
</tbody>
</table>
<p>Dereferencing works both ways:</p>
<ul>
<li>Reading the value: <code>x = *p;</code></li>
<li>Writing to the address: <code>*p = 99;</code></li>
</ul>
</section>
<section id="null-pointers" class="level4">
<h4 class="anchored" data-anchor-id="null-pointers">Null Pointers</h4>
<p>A pointer that points to nothing should be set to <code>NULL</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb172"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>ptr <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>ptr <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Pointer is not initialized.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Dereferencing a null pointer (<code>*ptr</code> when <code>ptr == NULL</code>) causes a <strong>segmentation fault</strong>, one of the most common C errors.</p>
</section>
<section id="pointer-to-pointer" class="level4">
<h4 class="anchored" data-anchor-id="pointer-to-pointer">Pointer to Pointer</h4>
<p>You can have pointers that store addresses of other pointers.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb173"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">**</span>pp <span class="op">=</span> <span class="op">&amp;</span>p<span class="op">;</span></span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"x = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">**</span>pp<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This concept appears in multi-dimensional arrays and function pointers.</p>
</section>
<section id="why-it-matters-20" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-20">Why It Matters</h4>
<p>Pointers are what make C powerful:</p>
<ul>
<li>They enable <strong>dynamic memory allocation</strong> (<code>malloc</code>, <code>calloc</code>, <code>free</code>).</li>
<li>They allow <strong>arrays, strings, and structures</strong> to be passed efficiently.</li>
<li>They are the foundation for <strong>linked lists, trees, and system calls</strong>.</li>
</ul>
<p>But they also demand precision. A single misused pointer can cause crashes or memory corruption.</p>
<p>Mastering pointers means mastering both control and responsibility over memory.</p>
</section>
<section id="try-it-yourself-20" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-20">Try It Yourself</h4>
<ol type="1">
<li>Write a program that declares an integer and prints both its value and address.</li>
<li>Create a pointer to that integer and modify the variable’s value through the pointer.</li>
<li>Try declaring <code>int *p = NULL;</code> and check it before dereferencing.</li>
<li>Print a pointer to a pointer (<code>int **</code>) and see how the addresses relate.</li>
<li>For fun, declare two variables and make one pointer swap their values using dereferencing.</li>
</ol>
<p>Once you truly understand pointers, the rest of C, arrays, structs, dynamic memory, even function calls, begins to make sense. They are the bridge between your code and the machine’s actual memory.</p>
</section>
</section>
<section id="arrays-and-pointer-arithmetic" class="level3">
<h3 class="anchored" data-anchor-id="arrays-and-pointer-arithmetic">23. Arrays and Pointer Arithmetic</h3>
<p>An <strong>array</strong> is a block of consecutive memory cells that hold elements of the same type. Arrays and pointers are deeply connected in C, in fact, an array’s name often behaves like a pointer to its first element. Understanding how arrays and pointer arithmetic work together is key to writing fast, memory-efficient programs.</p>
<section id="declaring-and-using-arrays" class="level4">
<h4 class="anchored" data-anchor-id="declaring-and-using-arrays">Declaring and Using Arrays</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb174"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> numbers<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">40</span><span class="op">,</span> <span class="dv">50</span><span class="op">};</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"numbers[</span><span class="sc">%d</span><span class="st">] = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> numbers<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>numbers[0] = 10
numbers[1] = 20
numbers[2] = 30
numbers[3] = 40
numbers[4] = 50</code></pre>
<p>Here:</p>
<ul>
<li><code>numbers</code> is an array of five integers.</li>
<li>Each element is stored <strong>next to each other in memory</strong>.</li>
<li>The compiler knows each <code>int</code> takes the same number of bytes, so it can find <code>numbers[i]</code> quickly using pointer arithmetic.</li>
</ul>
</section>
<section id="array-name-as-a-pointer" class="level4">
<h4 class="anchored" data-anchor-id="array-name-as-a-pointer">Array Name as a Pointer</h4>
<p>When you use an array’s name (without an index), it acts as a pointer to its first element.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb176"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> numbers<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">};</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> numbers<span class="op">;</span>  <span class="co">// same as &amp;numbers[0]</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">,</span> <span class="op">*(</span>p <span class="op">+</span> <span class="dv">1</span><span class="op">),</span> <span class="op">*(</span>p <span class="op">+</span> <span class="dv">2</span><span class="op">));</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>1 2 3</code></pre>
<p>Each time you add 1 to the pointer, it moves forward by one element, <strong>not one byte</strong>, but one <em>object</em> of that type.</p>
</section>
<section id="tiny-code-21" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-21">Tiny Code</h4>
<p>Here’s a complete example showing array access and pointer arithmetic:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb178"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> arr<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">2</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">10</span><span class="op">};</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>ptr <span class="op">=</span> arr<span class="op">;</span> <span class="co">// arr decays to pointer to arr[0]</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Accessing with array index:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"arr[</span><span class="sc">%d</span><span class="st">] = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> arr<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Accessing with pointer arithmetic:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb178-13"><a href="#cb178-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb178-14"><a href="#cb178-14" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"*(ptr + </span><span class="sc">%d</span><span class="st">) = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> <span class="op">*(</span>ptr <span class="op">+</span> i<span class="op">));</span></span>
<span id="cb178-15"><a href="#cb178-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb178-16"><a href="#cb178-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-17"><a href="#cb178-17" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Addresses in memory:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb178-18"><a href="#cb178-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb178-19"><a href="#cb178-19" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"&amp;arr[</span><span class="sc">%d</span><span class="st">] = </span><span class="sc">%p\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> <span class="op">(</span><span class="dt">void</span> <span class="op">*)&amp;</span>arr<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb178-20"><a href="#cb178-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb178-21"><a href="#cb178-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-22"><a href="#cb178-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb178-23"><a href="#cb178-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb179"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> array_pointer.c <span class="at">-o</span> array_pointer</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./array_pointer</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output (addresses will differ):</p>
<pre><code>Accessing with array index:
arr[0] = 2
arr[1] = 4
arr[2] = 6
arr[3] = 8
arr[4] = 10

Accessing with pointer arithmetic:
*(ptr + 0) = 2
*(ptr + 1) = 4
*(ptr + 2) = 6
*(ptr + 3) = 8
*(ptr + 4) = 10

Addresses in memory:
&amp;arr[0] = 0x7ffcc73f9a60
&amp;arr[1] = 0x7ffcc73f9a64
&amp;arr[2] = 0x7ffcc73f9a68
&amp;arr[3] = 0x7ffcc73f9a6c
&amp;arr[4] = 0x7ffcc73f9a70</code></pre>
<p>You can see that each element sits <strong>4 bytes apart</strong> (typical size of <code>int</code>).</p>
</section>
<section id="pointer-arithmetic-rules" class="level4">
<h4 class="anchored" data-anchor-id="pointer-arithmetic-rules">Pointer Arithmetic Rules</h4>
<p>When you move pointers, C automatically scales by the size of the type they point to:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Expression</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>p + 1</code></td>
<td>Move to the next element</td>
</tr>
<tr class="even">
<td><code>p - 1</code></td>
<td>Move to the previous element</td>
</tr>
<tr class="odd">
<td><code>*(p + i)</code></td>
<td>Access the i-th element after the current one</td>
</tr>
<tr class="even">
<td><code>p2 - p1</code></td>
<td>Returns the number of elements between two pointers</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb181"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>start <span class="op">=</span> arr<span class="op">;</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>end <span class="op">=</span> arr <span class="op">+</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Array length: </span><span class="sc">%ld\n</span><span class="st">"</span><span class="op">,</span> end <span class="op">-</span> start<span class="op">);</span> <span class="co">// prints 5</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="common-pitfalls" class="level4">
<h4 class="anchored" data-anchor-id="common-pitfalls">Common Pitfalls</h4>
<ol type="1">
<li><p><strong>Out-of-bounds access</strong> Accessing memory beyond an array’s valid range leads to <em>undefined behavior</em>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb182"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>arr<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="dv">99</span><span class="op">;</span> <span class="co">// invalid! array has only indices 0-4</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong>Array decay</strong> Arrays “decay” to pointers when passed to functions, they lose size information. You must pass the length manually.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb183"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_array<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>arr<span class="op">,</span> <span class="dt">int</span> len<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong>Pointer confusion</strong> Remember that <code>arr[i]</code> and <code>*(arr + i)</code> mean the same thing. Mixing them is fine, but be consistent for readability.</p></li>
</ol>
</section>
<section id="why-it-matters-21" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-21">Why It Matters</h4>
<p>Arrays and pointers form the <strong>foundation of C data structures</strong>. You’ll use them to build:</p>
<ul>
<li>Strings (arrays of <code>char</code>)</li>
<li>Matrices (arrays of arrays)</li>
<li>Linked lists and trees (via pointer arithmetic)</li>
</ul>
<p>Once you’re comfortable thinking of arrays as <em>contiguous memory blocks</em> accessed through pointers, you can start designing your own data structures like a real systems programmer.</p>
</section>
<section id="try-it-yourself-21" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-21">Try It Yourself</h4>
<ol type="1">
<li>Write a function that prints an array using only pointers (no <code>[]</code> syntax).</li>
<li>Create an array of <code>char</code> and print it as a string and as separate characters.</li>
<li>Declare an array of 10 numbers, then use pointers to sum them.</li>
<li>Print the address difference between two elements.</li>
<li>Create a two-dimensional array and print it with nested loops.</li>
</ol>
<p>Arrays and pointers are two sides of the same coin in C. Once you understand their connection, you’ll see how powerful, and elegant, direct memory access can be.</p>
</section>
</section>
<section id="strings-as-character-arrays" class="level3">
<h3 class="anchored" data-anchor-id="strings-as-character-arrays">24. Strings as Character Arrays</h3>
<p>In C, a <strong>string</strong> is simply an array of characters ending with a special null character <code>'\0'</code>. Unlike higher-level languages, C doesn’t have a built-in string type, just arrays and pointers. This simplicity gives you full control over text data but also demands care: every string operation must respect memory limits and null terminators.</p>
<section id="how-strings-work" class="level4">
<h4 class="anchored" data-anchor-id="how-strings-work">How Strings Work</h4>
<p>A string like <code>"Hello"</code> in C is represented internally as:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Character</th>
<th>H</th>
<th>e</th>
<th>l</th>
<th>l</th>
<th>o</th>
<th><code>\0</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Index</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
</tr>
</tbody>
</table>
<p>The <code>'\0'</code> (ASCII 0) marks the end of the string, it’s how functions like <code>printf</code> or <code>strlen</code> know where to stop.</p>
</section>
<section id="declaring-strings" class="level4">
<h4 class="anchored" data-anchor-id="declaring-strings">Declaring Strings</h4>
<p>There are two common ways to declare strings:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb184"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> greeting1<span class="op">[]</span> <span class="op">=</span> <span class="st">"Hello"</span><span class="op">;</span>        <span class="co">// automatic null terminator</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> greeting2<span class="op">[</span><span class="dv">6</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="ch">'H'</span><span class="op">,</span><span class="ch">'e'</span><span class="op">,</span><span class="ch">'l'</span><span class="op">,</span><span class="ch">'l'</span><span class="op">,</span><span class="ch">'o'</span><span class="op">,</span><span class="ch">'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">};</span> <span class="co">// explicit</span></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>greeting3 <span class="op">=</span> <span class="st">"Hello"</span><span class="op">;</span>         <span class="co">// pointer to string literal</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><code>greeting1</code> is a mutable array you can modify. <code>greeting3</code> points to a <strong>read-only</strong> string literal stored in memory, modifying it causes undefined behavior.</p>
</section>
<section id="tiny-code-22" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-22">Tiny Code</h4>
<p>Here’s a complete example that explores string declarations, iteration, and basic operations:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb185"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> msg<span class="op">[]</span> <span class="op">=</span> <span class="st">"C language"</span><span class="op">;</span></span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>ptr <span class="op">=</span> msg<span class="op">;</span> <span class="co">// pointer to the first character</span></span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"String: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> msg<span class="op">);</span></span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Length: </span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> strlen<span class="op">(</span>msg<span class="op">));</span></span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-11"><a href="#cb185-11" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Characters one by one:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb185-12"><a href="#cb185-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> msg<span class="op">[</span>i<span class="op">]</span> <span class="op">!=</span> <span class="ch">'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb185-13"><a href="#cb185-13" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"msg[</span><span class="sc">%d</span><span class="st">] = </span><span class="sc">%c</span><span class="st"> (address: </span><span class="sc">%p</span><span class="st">)</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> msg<span class="op">[</span>i<span class="op">],</span> <span class="op">(</span><span class="dt">void</span> <span class="op">*)&amp;</span>msg<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb185-14"><a href="#cb185-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb185-15"><a href="#cb185-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-16"><a href="#cb185-16" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Access via pointer arithmetic:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb185-17"><a href="#cb185-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="op">*(</span>ptr <span class="op">+</span> i<span class="op">)</span> <span class="op">!=</span> <span class="ch">'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb185-18"><a href="#cb185-18" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"*(ptr + </span><span class="sc">%d</span><span class="st">) = </span><span class="sc">%c\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> <span class="op">*(</span>ptr <span class="op">+</span> i<span class="op">));</span></span>
<span id="cb185-19"><a href="#cb185-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb185-20"><a href="#cb185-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-21"><a href="#cb185-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Modify string safely</span></span>
<span id="cb185-22"><a href="#cb185-22" aria-hidden="true" tabindex="-1"></a>    msg<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">'C'</span><span class="op">;</span></span>
<span id="cb185-23"><a href="#cb185-23" aria-hidden="true" tabindex="-1"></a>    msg<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="ch">'+'</span><span class="op">;</span></span>
<span id="cb185-24"><a href="#cb185-24" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Modified string: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> msg<span class="op">);</span></span>
<span id="cb185-25"><a href="#cb185-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-26"><a href="#cb185-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb185-27"><a href="#cb185-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb186"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> strings_demo.c <span class="at">-o</span> strings_demo</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./strings_demo</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>String: C language
Length: 10

Characters one by one:
msg[0] = C (address: 0x7ffd29c4a0a0)
msg[1] =   (address: 0x7ffd29c4a0a1)
msg[2] = l (address: 0x7ffd29c4a0a2)
...

Access via pointer arithmetic:
*(ptr + 0) = C
*(ptr + 1) =  
*(ptr + 2) = l
...

Modified string: C+anguage</code></pre>
</section>
<section id="common-string-operations" class="level4">
<h4 class="anchored" data-anchor-id="common-string-operations">Common String Operations</h4>
<p>C provides several standard functions in <code>&lt;string.h&gt;</code>:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 45%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>strlen(s)</code></td>
<td>Get string length (excluding <code>\0</code>)</td>
<td><code>strlen("Hi") == 2</code></td>
</tr>
<tr class="even">
<td><code>strcpy(dest, src)</code></td>
<td>Copy string</td>
<td><code>strcpy(name, "Bob");</code></td>
</tr>
<tr class="odd">
<td><code>strcat(dest, src)</code></td>
<td>Concatenate strings</td>
<td><code>strcat(full, last);</code></td>
</tr>
<tr class="even">
<td><code>strcmp(a, b)</code></td>
<td>Compare strings (<code>0</code> if equal)</td>
<td><code>strcmp("a","b")</code></td>
</tr>
<tr class="odd">
<td><code>strchr(s, c)</code></td>
<td>Find first occurrence of character</td>
<td><code>strchr(word, 'a')</code></td>
</tr>
<tr class="even">
<td><code>strstr(s, sub)</code></td>
<td>Find substring</td>
<td><code>strstr(text, "find")</code></td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb188"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> a<span class="op">[</span><span class="dv">20</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Hello, "</span><span class="op">;</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> b<span class="op">[]</span> <span class="op">=</span> <span class="st">"World!"</span><span class="op">;</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>strcat<span class="op">(</span>a<span class="op">,</span> b<span class="op">);</span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">);</span> <span class="co">// "Hello, World!"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="pointers-and-strings" class="level4">
<h4 class="anchored" data-anchor-id="pointers-and-strings">Pointers and Strings</h4>
<p>Because a string’s name decays into a pointer, you can pass strings directly to functions:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb189"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> greet<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hello, </span><span class="sc">%s</span><span class="st">!</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> name<span class="op">);</span></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>    greet<span class="op">(</span><span class="st">"C Learner"</span><span class="op">);</span></span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<blockquote class="blockquote">
<p><code>const char *</code> prevents accidental modification of the string literal.</p>
</blockquote>
</section>
<section id="common-pitfalls-1" class="level4">
<h4 class="anchored" data-anchor-id="common-pitfalls-1">Common Pitfalls</h4>
<ol type="1">
<li><p><strong>Forgetting <code>'\0'</code>:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb190"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> word<span class="op">[</span><span class="dv">4</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="ch">'T'</span><span class="op">,</span><span class="ch">'e'</span><span class="op">,</span><span class="ch">'s'</span><span class="op">,</span><span class="ch">'t'</span><span class="op">};</span> <span class="co">// missing terminator, unsafe</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong>Buffer overflows:</strong> Copying more characters than fit in the destination buffer leads to undefined behavior.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb191"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> dest<span class="op">[</span><span class="dv">5</span><span class="op">];</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>strcpy<span class="op">(</span>dest<span class="op">,</span> <span class="st">"Too long!"</span><span class="op">);</span> <span class="co">// dangerous</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong>Modifying string literals:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb192"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"Hello"</span><span class="op">;</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>s<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">'Y'</span><span class="op">;</span> <span class="co">// crash or undefined behavior</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ol>
</section>
<section id="why-it-matters-22" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-22">Why It Matters</h4>
<p>Strings are the foundation of <strong>text processing, file handling, and user interfaces</strong> in C. Because they’re just arrays of characters, understanding strings forces you to think about:</p>
<ul>
<li><strong>Memory layout</strong></li>
<li><strong>Null termination</strong></li>
<li><strong>Buffer size and safety</strong></li>
</ul>
<p>Once you internalize how C handles text at the byte level, you’ll be ready to build real parsers, file readers, and command-line tools.</p>
</section>
<section id="try-it-yourself-22" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-22">Try It Yourself</h4>
<ol type="1">
<li>Write a function <code>void reverse(char *s)</code> that reverses a string in place.</li>
<li>Implement your own version of <code>strlen</code>.</li>
<li>Create a program that counts vowels in a string.</li>
<li>Concatenate two user-input strings using <code>strcat</code>.</li>
<li>Experiment by printing a string without <code>'\0'</code>, observe what happens.</li>
</ol>
<p>Strings in C are both elegant and dangerous, a true test of precision. Once you master them, you’ll understand how text truly exists in memory, one byte at a time.</p>
</section>
</section>
<section id="dynamic-memory-allocation-malloc-calloc-realloc-free" class="level3">
<h3 class="anchored" data-anchor-id="dynamic-memory-allocation-malloc-calloc-realloc-free">25. Dynamic Memory Allocation (malloc, calloc, realloc, free)</h3>
<p>Static arrays have fixed size, but real programs often need flexible data that grows or shrinks at runtime. Dynamic memory allocation lets you <strong>request</strong>, <strong>use</strong>, and <strong>release</strong> memory manually while your program is running. It’s one of the most powerful and error-prone parts of C.</p>
<section id="the-idea" class="level4">
<h4 class="anchored" data-anchor-id="the-idea">The Idea</h4>
<p>C provides four key functions from <code>&lt;stdlib.h&gt;</code> for dynamic memory management:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 29%">
<col style="width: 70%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>malloc(size)</code></td>
<td>Allocates a block of memory</td>
</tr>
<tr class="even">
<td><code>calloc(n, size)</code></td>
<td>Allocates and clears memory for <code>n</code> elements</td>
</tr>
<tr class="odd">
<td><code>realloc(ptr, size)</code></td>
<td>Changes the size of a previously allocated block</td>
</tr>
<tr class="even">
<td><code>free(ptr)</code></td>
<td>Releases memory back to the system</td>
</tr>
</tbody>
</table>
<p>These return a <strong>pointer</strong> to the allocated memory, or <code>NULL</code> if allocation fails.</p>
</section>
<section id="basic-example" class="level4">
<h4 class="anchored" data-anchor-id="basic-example">Basic Example</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb193"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span>  <span class="co">// allocate space for one int</span></span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>p <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Memory allocation failed.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>p <span class="op">=</span> <span class="dv">42</span><span class="op">;</span>  <span class="co">// store a value in allocated memory</span></span>
<span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Value: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span></span>
<span id="cb193-13"><a href="#cb193-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-14"><a href="#cb193-14" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>p<span class="op">);</span>  <span class="co">// release the memory</span></span>
<span id="cb193-15"><a href="#cb193-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb193-16"><a href="#cb193-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb194"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> malloc_demo.c <span class="at">-o</span> malloc_demo</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./malloc_demo</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Value: 42</code></pre>
</section>
<section id="allocating-arrays-dynamically" class="level4">
<h4 class="anchored" data-anchor-id="allocating-arrays-dynamically">Allocating Arrays Dynamically</h4>
<p>You can allocate arrays at runtime using <code>malloc()</code> or <code>calloc()</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb196"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n<span class="op">;</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Enter number of elements: "</span><span class="op">);</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>scanf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">"</span><span class="op">,</span> <span class="op">&amp;</span>n<span class="op">);</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>arr <span class="op">=</span> malloc<span class="op">(</span>n <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>arr <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Out of memory.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Initialize and print</span></span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb196-13"><a href="#cb196-13" aria-hidden="true" tabindex="-1"></a>    arr<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i <span class="op">*</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb196-14"><a href="#cb196-14" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> arr<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb196-15"><a href="#cb196-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb196-16"><a href="#cb196-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-17"><a href="#cb196-17" aria-hidden="true" tabindex="-1"></a>free<span class="op">(</span>arr<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output example:</p>
<pre><code>Enter number of elements: 5
0 10 20 30 40</code></pre>
<p><code>malloc()</code> leaves memory uninitialized, while <code>calloc()</code> clears it to zero:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb198"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>arr <span class="op">=</span> calloc<span class="op">(</span>n<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span> <span class="co">// all elements start at 0</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="changing-memory-size-with-realloc" class="level4">
<h4 class="anchored" data-anchor-id="changing-memory-size-with-realloc">Changing Memory Size with realloc()</h4>
<p>When you need to resize an allocated block, say, double an array’s capacity, use <code>realloc()</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb199"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>arr <span class="op">=</span> malloc<span class="op">(</span><span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>arr<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> arr<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="dv">2</span><span class="op">;</span> arr<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a><span class="co">// grow array to 5 elements</span></span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>temp <span class="op">=</span> realloc<span class="op">(</span>arr<span class="op">,</span> <span class="dv">5</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>temp <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Reallocation failed!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>arr<span class="op">);</span></span>
<span id="cb199-9"><a href="#cb199-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb199-10"><a href="#cb199-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb199-11"><a href="#cb199-11" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> temp<span class="op">;</span></span>
<span id="cb199-12"><a href="#cb199-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-13"><a href="#cb199-13" aria-hidden="true" tabindex="-1"></a>arr<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb199-14"><a href="#cb199-14" aria-hidden="true" tabindex="-1"></a>arr<span class="op">[</span><span class="dv">4</span><span class="op">]</span> <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb199-15"><a href="#cb199-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-16"><a href="#cb199-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb199-17"><a href="#cb199-17" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> arr<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb199-18"><a href="#cb199-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-19"><a href="#cb199-19" aria-hidden="true" tabindex="-1"></a>free<span class="op">(</span>arr<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>1 2 3 4 5</code></pre>
<p><code>realloc()</code> tries to expand the existing block if possible; if not, it allocates a new block, copies the data, and frees the old one automatically.</p>
</section>
<section id="tiny-code-23" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-23">Tiny Code</h4>
<p>Here’s a complete program combining <code>malloc</code>, <code>calloc</code>, <code>realloc</code>, and <code>free</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb201"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>nums <span class="op">=</span> calloc<span class="op">(</span>n<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>nums <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Initial allocation failed.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb201-10"><a href="#cb201-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb201-11"><a href="#cb201-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb201-12"><a href="#cb201-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-13"><a href="#cb201-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Fill array</span></span>
<span id="cb201-14"><a href="#cb201-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> nums<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="op">(</span>i <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">*</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb201-15"><a href="#cb201-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-16"><a href="#cb201-16" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Initial values: "</span><span class="op">);</span></span>
<span id="cb201-17"><a href="#cb201-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> nums<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb201-18"><a href="#cb201-18" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb201-19"><a href="#cb201-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-20"><a href="#cb201-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Resize</span></span>
<span id="cb201-21"><a href="#cb201-21" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb201-22"><a href="#cb201-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>new_nums <span class="op">=</span> realloc<span class="op">(</span>nums<span class="op">,</span> n <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb201-23"><a href="#cb201-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>new_nums <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb201-24"><a href="#cb201-24" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Reallocation failed.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb201-25"><a href="#cb201-25" aria-hidden="true" tabindex="-1"></a>        free<span class="op">(</span>nums<span class="op">);</span></span>
<span id="cb201-26"><a href="#cb201-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb201-27"><a href="#cb201-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb201-28"><a href="#cb201-28" aria-hidden="true" tabindex="-1"></a>    nums <span class="op">=</span> new_nums<span class="op">;</span></span>
<span id="cb201-29"><a href="#cb201-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-30"><a href="#cb201-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Fill new slots</span></span>
<span id="cb201-31"><a href="#cb201-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">3</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> nums<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="op">(</span>i <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">*</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb201-32"><a href="#cb201-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-33"><a href="#cb201-33" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"After realloc: "</span><span class="op">);</span></span>
<span id="cb201-34"><a href="#cb201-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> nums<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb201-35"><a href="#cb201-35" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb201-36"><a href="#cb201-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-37"><a href="#cb201-37" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>nums<span class="op">);</span></span>
<span id="cb201-38"><a href="#cb201-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb201-39"><a href="#cb201-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Initial values: 5 10 15
After realloc: 5 10 15 20 25</code></pre>
</section>
<section id="memory-allocation-diagram" class="level4">
<h4 class="anchored" data-anchor-id="memory-allocation-diagram">Memory Allocation Diagram</h4>
<pre><code>Stack   →   grows downward
Heap    →   grows upward
Data    →   global/static variables
Code    →   program instructions</code></pre>
<p>Each call to <code>malloc</code> reserves space on the <strong>heap</strong>, which stays allocated until explicitly freed.</p>
</section>
<section id="why-it-matters-23" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-23">Why It Matters</h4>
<p>Dynamic memory is the <strong>backbone of all real systems programming</strong>. Without it, you can’t build:</p>
<ul>
<li>Variable-sized arrays</li>
<li>Linked lists, trees, graphs</li>
<li>Caches and databases</li>
<li>File readers and parsers</li>
</ul>
<p>It’s also where most C bugs happen, dangling pointers, leaks, double frees, and buffer overruns, so disciplined management is crucial.</p>
</section>
<section id="try-it-yourself-23" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-23">Try It Yourself</h4>
<ol type="1">
<li>Allocate an array of 10 integers, fill it, print it, and free it.</li>
<li>Use <code>calloc</code> instead of <code>malloc</code> and observe the zero initialization.</li>
<li>Resize the array from 10 to 20 elements using <code>realloc</code>.</li>
<li>Forget to call <code>free()</code> and then run your program with <strong>Valgrind</strong>, see the memory leak report.</li>
<li>Write a function <code>int *make_array(int n)</code> that allocates and returns a pointer to a new array.</li>
</ol>
<p>Dynamic allocation is where you start managing memory <em>by hand</em>. Done right, it gives you incredible control and efficiency, done wrong, it’s chaos. Master it carefully: it’s the essence of being a C programmer.</p>
</section>
</section>
<section id="memory-leaks-and-undefined-behavior" class="level3">
<h3 class="anchored" data-anchor-id="memory-leaks-and-undefined-behavior">26. Memory Leaks and Undefined Behavior</h3>
<p>C gives you total control over memory, which means you can do anything you want, including things that <em>should never be done</em>. Two of the biggest dangers are <strong>memory leaks</strong> (when memory is never released) and <strong>undefined behavior</strong> (when the program does something unpredictable). Learning to avoid these is the key to writing stable, safe, and correct C programs.</p>
<section id="what-is-a-memory-leak" class="level4">
<h4 class="anchored" data-anchor-id="what-is-a-memory-leak">What Is a Memory Leak?</h4>
<p>A <strong>memory leak</strong> happens when you allocate memory on the heap and never free it. The memory stays reserved even though you can’t access it anymore.</p>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb204"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> leak<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>data <span class="op">=</span> malloc<span class="op">(</span><span class="dv">100</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span> <span class="co">// allocated</span></span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>    data<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">42</span><span class="op">;</span></span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// forgot to free(data); memory is now lost</span></span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If <code>leak()</code> runs many times, your program consumes more and more memory until it crashes or slows down. In long-running programs (like servers), this is deadly.</p>
<p><strong>Rule:</strong> Every <code>malloc</code>, <code>calloc</code>, or <code>realloc</code> must eventually be paired with a matching <code>free()</code>.</p>
</section>
<section id="tiny-code-24" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-24">Tiny Code</h4>
<p>Let’s see leaks and fixes in action.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb205"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> with_leak<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>arr <span class="op">=</span> malloc<span class="op">(</span><span class="dv">5</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> arr<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"with_leak: allocated 5 ints, but not freed.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb205-9"><a href="#cb205-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-10"><a href="#cb205-10" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> without_leak<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb205-11"><a href="#cb205-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>arr <span class="op">=</span> malloc<span class="op">(</span><span class="dv">5</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb205-12"><a href="#cb205-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> arr<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb205-13"><a href="#cb205-13" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"without_leak: freeing memory.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb205-14"><a href="#cb205-14" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>arr<span class="op">);</span></span>
<span id="cb205-15"><a href="#cb205-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb205-16"><a href="#cb205-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-17"><a href="#cb205-17" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb205-18"><a href="#cb205-18" aria-hidden="true" tabindex="-1"></a>    with_leak<span class="op">();</span></span>
<span id="cb205-19"><a href="#cb205-19" aria-hidden="true" tabindex="-1"></a>    without_leak<span class="op">();</span></span>
<span id="cb205-20"><a href="#cb205-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb205-21"><a href="#cb205-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run with <strong>Valgrind</strong> (a memory checker):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb206"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> leaks_demo.c <span class="at">-o</span> leaks_demo</span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="fu">valgrind</span> ./leaks_demo</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Valgrind output (simplified):</p>
<pre><code>==1234== HEAP SUMMARY:
==1234==    definitely lost: 20 bytes in 1 blocks
==1234==    indirectly lost: 0 bytes in 0 blocks
==1234== LEAK SUMMARY:
==1234==    1 blocks definitely lost</code></pre>
<p>You can see the first function leaked memory, while the second freed it properly.</p>
</section>
<section id="dangling-pointers" class="level4">
<h4 class="anchored" data-anchor-id="dangling-pointers">Dangling Pointers</h4>
<p>A <strong>dangling pointer</strong> points to memory that has been freed or is otherwise invalid.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb208"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>p <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>free<span class="op">(</span>p<span class="op">);</span></span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span> <span class="co">// ❌ undefined behavior</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>After <code>free(p)</code>, the pointer <code>p</code> still holds the old address, but that memory no longer belongs to you. Accessing it may crash, or appear to work, or corrupt data, you can’t rely on it.</p>
<p>Always nullify freed pointers:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb209"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>free<span class="op">(</span>p<span class="op">);</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> NULL<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="double-free" class="level4">
<h4 class="anchored" data-anchor-id="double-free">Double Free</h4>
<p>Freeing the same memory twice also leads to undefined behavior:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb210"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>free<span class="op">(</span>p<span class="op">);</span></span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>free<span class="op">(</span>p<span class="op">);</span> <span class="co">// ❌ double free error</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Most modern OSes detect this and abort, but it’s still a critical bug.</p>
</section>
<section id="use-after-free" class="level4">
<h4 class="anchored" data-anchor-id="use-after-free">Use-After-Free</h4>
<p>This is one of the worst kinds of memory errors. It happens when you access memory after it’s been freed.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb211"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>arr <span class="op">=</span> malloc<span class="op">(</span><span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>arr<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>free<span class="op">(</span>arr<span class="op">);</span></span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>arr<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">7</span><span class="op">;</span> <span class="co">// ❌ use-after-free</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The compiler won’t catch this, but Valgrind will warn you.</p>
</section>
<section id="uninitialized-memory" class="level4">
<h4 class="anchored" data-anchor-id="uninitialized-memory">Uninitialized Memory</h4>
<p>Reading memory you never wrote to is also undefined:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb212"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>arr <span class="op">=</span> malloc<span class="op">(</span><span class="dv">5</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> arr<span class="op">[</span><span class="dv">2</span><span class="op">]);</span> <span class="co">// ❌ uninitialized read</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><code>malloc()</code> does <strong>not</strong> zero out memory, use <code>calloc()</code> if you need cleared data.</p>
</section>
<section id="common-causes-of-undefined-behavior" class="level4">
<h4 class="anchored" data-anchor-id="common-causes-of-undefined-behavior">Common Causes of Undefined Behavior</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 31%">
<col style="width: 36%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Example</th>
<th>Consequence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Out-of-bounds access</td>
<td><code>arr[10]</code> in a 5-element array</td>
<td>Corrupts memory</td>
</tr>
<tr class="even">
<td>Use-after-free</td>
<td>Dereferencing freed pointer</td>
<td>Crash or silent corruption</td>
</tr>
<tr class="odd">
<td>Null pointer dereference</td>
<td><code>*NULL</code></td>
<td>Crash</td>
</tr>
<tr class="even">
<td>Division by zero</td>
<td><code>x / 0</code></td>
<td>Crash</td>
</tr>
<tr class="odd">
<td>Invalid pointer arithmetic</td>
<td><code>(int *)0 + 1</code></td>
<td>Undefined</td>
</tr>
<tr class="even">
<td>Modifying string literal</td>
<td><code>char *s = "hi"; s[0]='H';</code></td>
<td>Crash</td>
</tr>
</tbody>
</table>
</section>
<section id="why-it-matters-24" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-24">Why It Matters</h4>
<p>Undefined behavior is not “just a bug.” It means <strong>anything</strong> can happen:</p>
<ul>
<li>Your program may seem fine but fail later.</li>
<li>Compiler optimizations may remove or reorder code unexpectedly.</li>
<li>The same code might work on one system and crash on another.</li>
</ul>
<p>In C, correctness is your responsibility. You must know when memory is valid, who owns it, and when to free it.</p>
</section>
<section id="defensive-techniques" class="level4">
<h4 class="anchored" data-anchor-id="defensive-techniques">Defensive Techniques</h4>
<ol type="1">
<li><strong>Always check <code>malloc()</code> return values.</strong></li>
<li><strong>Initialize pointers to <code>NULL</code>.</strong></li>
<li><strong>Set pointers to <code>NULL</code> after freeing.</strong></li>
<li><strong>Use Valgrind</strong> (Linux) or <strong>AddressSanitizer</strong> (Clang/GCC) to detect leaks and invalid access.</li>
<li><strong>Prefer small, testable functions</strong>, easier to verify memory ownership.</li>
<li><strong>Avoid mixing stack and heap memory</strong> unless you’re certain of lifetimes.</li>
</ol>
</section>
<section id="try-it-yourself-24" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-24">Try It Yourself</h4>
<ol type="1">
<li>Write a small program that intentionally leaks memory. Run it under Valgrind.</li>
<li>Fix the leak by calling <code>free()</code> properly.</li>
<li>Create a dangling pointer and observe what happens (on some systems it crashes, on others not).</li>
<li>Experiment with <code>calloc()</code> to see how zero-initialized memory behaves.</li>
<li>Write a function that allocates memory and returns it, then ensure the caller frees it.</li>
</ol>
</section>
<section id="final-thought" class="level4">
<h4 class="anchored" data-anchor-id="final-thought">Final Thought</h4>
<p>Memory errors are the hardest bugs to track because they may not appear right away. But once you understand <strong>ownership</strong>, who allocates and who frees, memory in C becomes predictable, even elegant. This discipline is what separates casual C users from real systems programmers.</p>
</section>
</section>
<section id="const-and-volatile-qualifiers" class="level3">
<h3 class="anchored" data-anchor-id="const-and-volatile-qualifiers">27. const and volatile Qualifiers</h3>
<p>C gives you fine-grained control over how variables are used through <strong>type qualifiers</strong>. Two of the most important are <code>const</code> and <code>volatile</code>. They look simple but play a crucial role in writing safe, predictable, and efficient code, especially in systems programming, embedded systems, and multithreaded environments.</p>
<section id="the-const-qualifier" class="level4">
<h4 class="anchored" data-anchor-id="the-const-qualifier">The <code>const</code> Qualifier</h4>
<p><code>const</code> means <em>read-only</em>: once a variable is initialized, you cannot modify it.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb213"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">20</span><span class="op">;</span> <span class="co">// ❌ error: assignment of read-only variable</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>It’s a promise to the compiler, and to other programmers, that the value won’t change.</p>
<p><code>const</code> can be applied to many things:</p>
<ul>
<li>Variables</li>
<li>Function parameters</li>
<li>Pointers</li>
<li>Return types</li>
</ul>
</section>
<section id="const-with-pointers" class="level4">
<h4 class="anchored" data-anchor-id="const-with-pointers">const with Pointers</h4>
<p><code>const</code> with pointers can be tricky but follows consistent rules. The position of <code>const</code> determines what cannot change.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 28%">
<col style="width: 71%">
</colgroup>
<thead>
<tr class="header">
<th>Declaration</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>const int *p;</code></td>
<td>Pointer to <strong>constant data</strong>, data can’t change</td>
</tr>
<tr class="even">
<td><code>int *const p;</code></td>
<td><strong>Constant pointer</strong>, pointer can’t change, data can</td>
</tr>
<tr class="odd">
<td><code>const int *const p;</code></td>
<td>Both pointer and data are constant</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb214"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> value <span class="op">=</span> <span class="dv">42</span><span class="op">;</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> <span class="op">*</span>p1 <span class="op">=</span> <span class="op">&amp;</span>value<span class="op">;</span>   <span class="co">// cannot modify *p1</span></span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span><span class="dt">const</span> p2 <span class="op">=</span> <span class="op">&amp;</span>value<span class="op">;</span>   <span class="co">// cannot reassign p2</span></span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> <span class="op">*</span><span class="dt">const</span> p3 <span class="op">=</span> <span class="op">&amp;</span>value<span class="op">;</span> <span class="co">// cannot change *p3 or p3</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="const-in-function-parameters" class="level4">
<h4 class="anchored" data-anchor-id="const-in-function-parameters">const in Function Parameters</h4>
<p>Marking parameters as <code>const</code> helps prevent accidental modification and enables compiler optimizations.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb215"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_message<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>msg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> msg<span class="op">);</span></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Here, <code>msg</code> is read-only; the function can’t modify the string it points to.</p>
</section>
<section id="tiny-code-25" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-25">Tiny Code</h4>
<p>Here’s a program demonstrating <code>const</code> in action:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb216"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> show<span class="op">(</span><span class="dt">const</span> <span class="dt">int</span> <span class="op">*</span>ptr<span class="op">)</span> <span class="op">{</span></span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// *ptr = 10; // ❌ not allowed</span></span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Value: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>ptr<span class="op">);</span></span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-8"><a href="#cb216-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb216-9"><a href="#cb216-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> num <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb216-10"><a href="#cb216-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>num<span class="op">;</span></span>
<span id="cb216-11"><a href="#cb216-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span><span class="dt">const</span> q <span class="op">=</span> <span class="op">&amp;</span>num<span class="op">;</span></span>
<span id="cb216-12"><a href="#cb216-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-13"><a href="#cb216-13" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"num = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> num<span class="op">);</span></span>
<span id="cb216-14"><a href="#cb216-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-15"><a href="#cb216-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// *p = 10; // ❌ cannot modify value through const pointer</span></span>
<span id="cb216-16"><a href="#cb216-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>q <span class="op">=</span> <span class="dv">15</span><span class="op">;</span>   <span class="co">// ✅ data modifiable through q</span></span>
<span id="cb216-17"><a href="#cb216-17" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"num after q change = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> num<span class="op">);</span></span>
<span id="cb216-18"><a href="#cb216-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-19"><a href="#cb216-19" aria-hidden="true" tabindex="-1"></a>    show<span class="op">(&amp;</span>num<span class="op">);</span> <span class="co">// function accepts const pointer</span></span>
<span id="cb216-20"><a href="#cb216-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb216-21"><a href="#cb216-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb217"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> const_demo.c <span class="at">-o</span> const_demo</span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./const_demo</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>num = 5
num after q change = 15
Value: 15</code></pre>
</section>
<section id="the-volatile-qualifier" class="level4">
<h4 class="anchored" data-anchor-id="the-volatile-qualifier">The <code>volatile</code> Qualifier</h4>
<p><code>volatile</code> tells the compiler that a variable <strong>can change at any time</strong>, even if your code doesn’t modify it. It prevents the compiler from optimizing out reads or writes.</p>
<p>Use <code>volatile</code> when:</p>
<ul>
<li>A variable can be changed by <strong>hardware</strong> (e.g., memory-mapped I/O registers).</li>
<li>A variable can be modified by <strong>another thread</strong> or <strong>signal handler</strong>.</li>
<li>You need to force an <strong>actual memory read</strong> each time, not a cached value.</li>
</ul>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb219"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="dt">volatile</span> <span class="dt">int</span> sensor_value<span class="op">;</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>sensor_value <span class="op">&lt;</span> <span class="dv">100</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// without volatile, compiler might optimize this loop away</span></span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Here, <code>sensor_value</code> might be updated by hardware; <code>volatile</code> ensures each check re-reads memory instead of reusing a cached register value.</p>
</section>
<section id="combining-const-and-volatile" class="level4">
<h4 class="anchored" data-anchor-id="combining-const-and-volatile">Combining const and volatile</h4>
<p>Yes, you can use both together, a value that can change unexpectedly, but your code cannot modify it.</p>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb220"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">volatile</span> <span class="dt">int</span> status_register <span class="op">=</span> <span class="bn">0x1234</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This is common in embedded systems, where a hardware register’s bits may change due to external events.</p>
</section>
<section id="why-it-matters-25" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-25">Why It Matters</h4>
<ul>
<li><strong><code>const</code></strong> improves safety and clarity: makes interfaces self-documenting and helps the compiler catch mistakes.</li>
<li><strong><code>volatile</code></strong> preserves correctness in concurrent or hardware-driven systems.</li>
<li>Together, they let you balance optimization with precision, critical in low-level C programming.</li>
</ul>
<p>If you misuse or forget them:</p>
<ul>
<li>You risk accidental modification of data (<code>const</code>).</li>
<li>You risk the compiler removing critical reads/writes (<code>volatile</code>).</li>
</ul>
</section>
<section id="try-it-yourself-25" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-25">Try It Yourself</h4>
<ol type="1">
<li><p>Write a program that tries to modify a <code>const int</code> through a pointer, observe the compiler error.</p></li>
<li><p>Declare a variable as <code>volatile int counter</code> and increment it in a loop.</p>
<ul>
<li>Then remove <code>volatile</code> and inspect the generated assembly with <code>gcc -S</code>.</li>
</ul></li>
<li><p>Create a function with <code>const char *msg</code> and try to modify it, see why it’s prohibited.</p></li>
<li><p>Experiment with <code>const int *p</code> vs <code>int *const p</code> to understand their difference.</p></li>
<li><p>Combine both: <code>const volatile int flag;</code> and print it in a loop.</p></li>
</ol>
<p>In C, <code>const</code> and <code>volatile</code> are more than just keywords, they’re contracts. They tell the compiler exactly how memory can be used, which helps both humans and machines reason safely about your code.</p>
</section>
</section>
<section id="function-pointers-and-callbacks" class="level3">
<h3 class="anchored" data-anchor-id="function-pointers-and-callbacks">28. Function Pointers and Callbacks</h3>
<p>Functions in C are values too, they live in memory and have addresses just like variables. A <strong>function pointer</strong> is a pointer that stores the address of a function, allowing you to call that function indirectly. This idea powers callbacks, event systems, custom sorters, and plug-in architectures in C.</p>
<section id="what-is-a-function-pointer" class="level4">
<h4 class="anchored" data-anchor-id="what-is-a-function-pointer">What Is a Function Pointer?</h4>
<p>Just like <code>int *</code> points to an integer, a <strong>function pointer</strong> points to a function.</p>
<p>Syntax:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb221"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>return_type <span class="op">(*</span>pointer_name<span class="op">)(</span>parameter_types<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb222"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">(*</span>func_ptr<span class="op">)(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span><span class="op">)</span> <span class="op">=</span> add<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now you can call the function through the pointer:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb223"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> result <span class="op">=</span> func_ptr<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span> <span class="co">// same as add(2, 3)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="tiny-code-26" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-26">Tiny Code</h4>
<p>Here’s a complete example showing how to declare, assign, and call function pointers:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb224"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sub<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">-</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> mul<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">*</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> operate<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">,</span> <span class="dt">int</span> <span class="op">(*</span>op<span class="op">)(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Result: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> op<span class="op">(</span>x<span class="op">,</span> y<span class="op">));</span> <span class="co">// call through pointer</span></span>
<span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb224-10"><a href="#cb224-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-11"><a href="#cb224-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb224-12"><a href="#cb224-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">(*</span>f<span class="op">)(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span><span class="op">);</span> <span class="co">// declaration</span></span>
<span id="cb224-13"><a href="#cb224-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-14"><a href="#cb224-14" aria-hidden="true" tabindex="-1"></a>    f <span class="op">=</span> add<span class="op">;</span></span>
<span id="cb224-15"><a href="#cb224-15" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Add via pointer: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> f<span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="dv">3</span><span class="op">));</span></span>
<span id="cb224-16"><a href="#cb224-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-17"><a href="#cb224-17" aria-hidden="true" tabindex="-1"></a>    f <span class="op">=</span> sub<span class="op">;</span></span>
<span id="cb224-18"><a href="#cb224-18" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Subtract via pointer: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> f<span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="dv">3</span><span class="op">));</span></span>
<span id="cb224-19"><a href="#cb224-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-20"><a href="#cb224-20" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Using callback function:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb224-21"><a href="#cb224-21" aria-hidden="true" tabindex="-1"></a>    operate<span class="op">(</span><span class="dv">4</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> mul<span class="op">);</span> <span class="co">// pass function pointer as argument</span></span>
<span id="cb224-22"><a href="#cb224-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-23"><a href="#cb224-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb224-24"><a href="#cb224-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb225"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> func_pointer_demo.c <span class="at">-o</span> func_pointer_demo</span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./func_pointer_demo</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Add via pointer: 8
Subtract via pointer: 2

Using callback function:
Result: 24</code></pre>
</section>
<section id="function-pointers-in-arrays" class="level4">
<h4 class="anchored" data-anchor-id="function-pointers-in-arrays">Function Pointers in Arrays</h4>
<p>You can also store multiple function pointers in an array, useful for building tables of operations.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb227"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">(*</span>ops<span class="op">[</span><span class="dv">3</span><span class="op">])(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span><span class="op">)</span> <span class="op">=</span> <span class="op">{</span>add<span class="op">,</span> sub<span class="op">,</span> mul<span class="op">};</span></span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"ops[</span><span class="sc">%d</span><span class="st">](4, 2) = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> ops<span class="op">[</span>i<span class="op">](</span><span class="dv">4</span><span class="op">,</span> <span class="dv">2</span><span class="op">));</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>ops[0](4, 2) = 6
ops[1](4, 2) = 2
ops[2](4, 2) = 8</code></pre>
<p>This pattern underlies dispatch tables, interpreters, and virtual function systems in C.</p>
</section>
<section id="callbacks" class="level4">
<h4 class="anchored" data-anchor-id="callbacks">Callbacks</h4>
<p>A <strong>callback</strong> is a function you pass as an argument to another function, letting the callee “call back” into user code. This pattern is essential in event-driven and modular designs.</p>
<p>Example: a simple iterator that accepts a callback</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb229"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> for_each<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>arr<span class="op">,</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">void</span> <span class="op">(*</span>callback<span class="op">)(</span><span class="dt">int</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a>        callback<span class="op">(</span>arr<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb229-7"><a href="#cb229-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-8"><a href="#cb229-8" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_square<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb229-9"><a href="#cb229-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">^2 = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">,</span> x <span class="op">*</span> x<span class="op">);</span></span>
<span id="cb229-10"><a href="#cb229-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb229-11"><a href="#cb229-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-12"><a href="#cb229-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb229-13"><a href="#cb229-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> nums<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">};</span></span>
<span id="cb229-14"><a href="#cb229-14" aria-hidden="true" tabindex="-1"></a>    for_each<span class="op">(</span>nums<span class="op">,</span> <span class="dv">5</span><span class="op">,</span> print_square<span class="op">);</span> <span class="co">// pass callback</span></span>
<span id="cb229-15"><a href="#cb229-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb229-16"><a href="#cb229-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>1^2 = 1
2^2 = 4
3^2 = 9
4^2 = 16
5^2 = 25</code></pre>
</section>
<section id="why-it-matters-26" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-26">Why It Matters</h4>
<p>Function pointers let you:</p>
<ul>
<li>Select behavior at runtime (dynamic dispatch).</li>
<li>Pass logic into libraries without recompiling them.</li>
<li>Build frameworks, event handlers, interpreters, and plug-ins.</li>
<li>Replace huge switch-case structures with elegant dispatch tables.</li>
</ul>
<p>They are also how C implements:</p>
<ul>
<li><code>qsort()</code> and <code>bsearch()</code> comparison functions,</li>
<li>signal handlers (<code>signal(SIGINT, handler)</code>), and</li>
<li>system callbacks in GUIs or kernels.</li>
</ul>
</section>
<section id="try-it-yourself-26" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-26">Try It Yourself</h4>
<ol type="1">
<li>Write three arithmetic functions and store them in an array of function pointers.</li>
<li>Build a <code>calculate(a, b, char op)</code> function that picks the right function pointer based on <code>op</code>.</li>
<li>Implement a callback-style loop that calls a user-defined function for each array element.</li>
<li>Pass a function pointer to <code>qsort()</code> from <code>&lt;stdlib.h&gt;</code> to sort integers in descending order.</li>
<li>Write a small menu system that calls the right function based on user choice.</li>
</ol>
<p>Function pointers and callbacks give your programs flexibility and abstraction without sacrificing speed. They’re how C achieves dynamic behavior, the bridge between data and executable logic.</p>
</section>
</section>
<section id="deep-vs-shallow-copies" class="level3">
<h3 class="anchored" data-anchor-id="deep-vs-shallow-copies">29. Deep vs Shallow Copies</h3>
<p>When you assign one variable to another in C, you’re often copying <em>addresses</em>, not <em>actual data</em>. This distinction between <strong>shallow copies</strong> and <strong>deep copies</strong> becomes critical when working with pointers, arrays, and dynamically allocated structures. Understanding it helps you prevent memory corruption, double frees, and mysterious bugs.</p>
<section id="the-core-idea" class="level4">
<h4 class="anchored" data-anchor-id="the-core-idea">The Core Idea</h4>
<ul>
<li>A <strong>shallow copy</strong> duplicates only the pointer, both variables refer to the <em>same memory</em>.</li>
<li>A <strong>deep copy</strong> duplicates the <em>data itself</em>, each variable owns its own independent memory.</li>
</ul>
</section>
<section id="simple-analogy" class="level4">
<h4 class="anchored" data-anchor-id="simple-analogy">Simple Analogy</h4>
<p>Think of shallow vs deep copy like two houses:</p>
<ul>
<li><strong>Shallow copy:</strong> You hand someone your house key. You both open the same door.</li>
<li><strong>Deep copy:</strong> You build a new house that looks identical, but is separate.</li>
</ul>
</section>
<section id="shallow-copy-example" class="level4">
<h4 class="anchored" data-anchor-id="shallow-copy-example">Shallow Copy Example</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb231"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>original <span class="op">=</span> malloc<span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a>    strcpy<span class="op">(</span>original<span class="op">,</span> <span class="st">"Hello"</span><span class="op">);</span></span>
<span id="cb231-8"><a href="#cb231-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-9"><a href="#cb231-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Shallow copy</span></span>
<span id="cb231-10"><a href="#cb231-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>copy <span class="op">=</span> original<span class="op">;</span></span>
<span id="cb231-11"><a href="#cb231-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-12"><a href="#cb231-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Before change: </span><span class="sc">%s</span><span class="st"> | </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> original<span class="op">,</span> copy<span class="op">);</span></span>
<span id="cb231-13"><a href="#cb231-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-14"><a href="#cb231-14" aria-hidden="true" tabindex="-1"></a>    copy<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">'J'</span><span class="op">;</span> <span class="co">// modify one</span></span>
<span id="cb231-15"><a href="#cb231-15" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"After change: </span><span class="sc">%s</span><span class="st"> | </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> original<span class="op">,</span> copy<span class="op">);</span></span>
<span id="cb231-16"><a href="#cb231-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-17"><a href="#cb231-17" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>original<span class="op">);</span></span>
<span id="cb231-18"><a href="#cb231-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// free(copy); // ❌ would cause double free error!</span></span>
<span id="cb231-19"><a href="#cb231-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-20"><a href="#cb231-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb231-21"><a href="#cb231-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Before change: Hello | Hello
After change: Jello | Jello</code></pre>
<p>Explanation:</p>
<ul>
<li><code>copy</code> points to the <em>same memory</em> as <code>original</code>.</li>
<li>Changing one changes both.</li>
<li>You must only <code>free()</code> it once, freeing both is a bug.</li>
</ul>
</section>
<section id="deep-copy-example" class="level4">
<h4 class="anchored" data-anchor-id="deep-copy-example">Deep Copy Example</h4>
<p>A deep copy allocates new memory and copies the data over.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb233"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>original <span class="op">=</span> malloc<span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a>    strcpy<span class="op">(</span>original<span class="op">,</span> <span class="st">"Hello"</span><span class="op">);</span></span>
<span id="cb233-8"><a href="#cb233-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-9"><a href="#cb233-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Deep copy</span></span>
<span id="cb233-10"><a href="#cb233-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>copy <span class="op">=</span> malloc<span class="op">(</span>strlen<span class="op">(</span>original<span class="op">)</span> <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb233-11"><a href="#cb233-11" aria-hidden="true" tabindex="-1"></a>    strcpy<span class="op">(</span>copy<span class="op">,</span> original<span class="op">);</span></span>
<span id="cb233-12"><a href="#cb233-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-13"><a href="#cb233-13" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Before change: </span><span class="sc">%s</span><span class="st"> | </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> original<span class="op">,</span> copy<span class="op">);</span></span>
<span id="cb233-14"><a href="#cb233-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-15"><a href="#cb233-15" aria-hidden="true" tabindex="-1"></a>    copy<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">'J'</span><span class="op">;</span></span>
<span id="cb233-16"><a href="#cb233-16" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"After change: </span><span class="sc">%s</span><span class="st"> | </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> original<span class="op">,</span> copy<span class="op">);</span></span>
<span id="cb233-17"><a href="#cb233-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-18"><a href="#cb233-18" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>original<span class="op">);</span></span>
<span id="cb233-19"><a href="#cb233-19" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>copy<span class="op">);</span> <span class="co">// ✅ both safely freed</span></span>
<span id="cb233-20"><a href="#cb233-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-21"><a href="#cb233-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb233-22"><a href="#cb233-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Before change: Hello | Hello
After change: Hello | Jello</code></pre>
<p>Now the two strings are completely independent, a true deep copy.</p>
</section>
<section id="shallow-vs-deep-in-structs" class="level4">
<h4 class="anchored" data-anchor-id="shallow-vs-deep-in-structs">Shallow vs Deep in Structs</h4>
<p>Consider this structure:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb235"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span></span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Person<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If you assign one <code>Person</code> to another:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb236"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>Person a<span class="op">,</span> b<span class="op">;</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>a<span class="op">.</span>name <span class="op">=</span> malloc<span class="op">(</span><span class="dv">20</span><span class="op">);</span></span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a>strcpy<span class="op">(</span>a<span class="op">.</span>name<span class="op">,</span> <span class="st">"Alice"</span><span class="op">);</span></span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> a<span class="op">;</span> <span class="co">// shallow copy</span></span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a>b<span class="op">.</span>name<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">'M'</span><span class="op">;</span> <span class="co">// modifies a.name too!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Both <code>a</code> and <code>b</code> point to the same memory. To make a deep copy:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb237"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>b<span class="op">.</span>name <span class="op">=</span> malloc<span class="op">(</span>strlen<span class="op">(</span>a<span class="op">.</span>name<span class="op">)</span> <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>strcpy<span class="op">(</span>b<span class="op">.</span>name<span class="op">,</span> a<span class="op">.</span>name<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now they’re independent.</p>
</section>
<section id="tiny-code-27" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-27">Tiny Code</h4>
<p>Here’s a full program demonstrating both copies with structs:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb238"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span></span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb238-8"><a href="#cb238-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Person<span class="op">;</span></span>
<span id="cb238-9"><a href="#cb238-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-10"><a href="#cb238-10" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_person<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>label<span class="op">,</span> Person p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb238-11"><a href="#cb238-11" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st">: name=</span><span class="sc">%s</span><span class="st"> age=</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> label<span class="op">,</span> p<span class="op">.</span>name<span class="op">,</span> p<span class="op">.</span>age<span class="op">);</span></span>
<span id="cb238-12"><a href="#cb238-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb238-13"><a href="#cb238-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-14"><a href="#cb238-14" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb238-15"><a href="#cb238-15" aria-hidden="true" tabindex="-1"></a>    Person p1<span class="op">;</span></span>
<span id="cb238-16"><a href="#cb238-16" aria-hidden="true" tabindex="-1"></a>    p1<span class="op">.</span>name <span class="op">=</span> malloc<span class="op">(</span><span class="dv">20</span><span class="op">);</span></span>
<span id="cb238-17"><a href="#cb238-17" aria-hidden="true" tabindex="-1"></a>    strcpy<span class="op">(</span>p1<span class="op">.</span>name<span class="op">,</span> <span class="st">"Alice"</span><span class="op">);</span></span>
<span id="cb238-18"><a href="#cb238-18" aria-hidden="true" tabindex="-1"></a>    p1<span class="op">.</span>age <span class="op">=</span> <span class="dv">25</span><span class="op">;</span></span>
<span id="cb238-19"><a href="#cb238-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-20"><a href="#cb238-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Shallow copy</span></span>
<span id="cb238-21"><a href="#cb238-21" aria-hidden="true" tabindex="-1"></a>    Person p2 <span class="op">=</span> p1<span class="op">;</span></span>
<span id="cb238-22"><a href="#cb238-22" aria-hidden="true" tabindex="-1"></a>    print_person<span class="op">(</span><span class="st">"Before"</span><span class="op">,</span> p1<span class="op">);</span></span>
<span id="cb238-23"><a href="#cb238-23" aria-hidden="true" tabindex="-1"></a>    p2<span class="op">.</span>name<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">'M'</span><span class="op">;</span> <span class="co">// modifies same memory</span></span>
<span id="cb238-24"><a href="#cb238-24" aria-hidden="true" tabindex="-1"></a>    print_person<span class="op">(</span><span class="st">"After shallow copy"</span><span class="op">,</span> p1<span class="op">);</span></span>
<span id="cb238-25"><a href="#cb238-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-26"><a href="#cb238-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Deep copy</span></span>
<span id="cb238-27"><a href="#cb238-27" aria-hidden="true" tabindex="-1"></a>    Person p3<span class="op">;</span></span>
<span id="cb238-28"><a href="#cb238-28" aria-hidden="true" tabindex="-1"></a>    p3<span class="op">.</span>name <span class="op">=</span> malloc<span class="op">(</span>strlen<span class="op">(</span>p1<span class="op">.</span>name<span class="op">)</span> <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb238-29"><a href="#cb238-29" aria-hidden="true" tabindex="-1"></a>    strcpy<span class="op">(</span>p3<span class="op">.</span>name<span class="op">,</span> p1<span class="op">.</span>name<span class="op">);</span></span>
<span id="cb238-30"><a href="#cb238-30" aria-hidden="true" tabindex="-1"></a>    p3<span class="op">.</span>age <span class="op">=</span> p1<span class="op">.</span>age<span class="op">;</span></span>
<span id="cb238-31"><a href="#cb238-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-32"><a href="#cb238-32" aria-hidden="true" tabindex="-1"></a>    p3<span class="op">.</span>name<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">'C'</span><span class="op">;</span> <span class="co">// independent copy</span></span>
<span id="cb238-33"><a href="#cb238-33" aria-hidden="true" tabindex="-1"></a>    print_person<span class="op">(</span><span class="st">"After deep copy"</span><span class="op">,</span> p1<span class="op">);</span></span>
<span id="cb238-34"><a href="#cb238-34" aria-hidden="true" tabindex="-1"></a>    print_person<span class="op">(</span><span class="st">"Deep copy result"</span><span class="op">,</span> p3<span class="op">);</span></span>
<span id="cb238-35"><a href="#cb238-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-36"><a href="#cb238-36" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>p1<span class="op">.</span>name<span class="op">);</span></span>
<span id="cb238-37"><a href="#cb238-37" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>p3<span class="op">.</span>name<span class="op">);</span> <span class="co">// ✅ safe</span></span>
<span id="cb238-38"><a href="#cb238-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb238-39"><a href="#cb238-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Before: name=Alice age=25
After shallow copy: name=Mlice age=25
After deep copy: name=Mlice age=25
Deep copy result: name=Clice age=25</code></pre>
</section>
<section id="why-it-matters-27" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-27">Why It Matters</h4>
<p>Shallow and deep copies determine <strong>ownership</strong> of memory:</p>
<ul>
<li>If two variables share the same pointer (shallow), freeing one invalidates the other.</li>
<li>Deep copies isolate data, preventing interference but using more memory.</li>
</ul>
<p>Getting this wrong leads to:</p>
<ul>
<li>Double free or dangling pointer errors</li>
<li>Memory leaks</li>
<li>Corrupted data in complex structures</li>
</ul>
<p>Understanding these concepts is crucial for:</p>
<ul>
<li>Managing dynamic arrays and linked lists</li>
<li>Designing APIs that safely return or duplicate data</li>
<li>Writing custom copy constructors for structs</li>
</ul>
</section>
<section id="try-it-yourself-27" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-27">Try It Yourself</h4>
<ol type="1">
<li>Create a struct with dynamically allocated fields (e.g., <code>name</code>, <code>address</code>) and write two copy functions: <code>copy_shallow()</code> and <code>copy_deep()</code>.</li>
<li>Modify one copy and observe the difference.</li>
<li>Call <code>free()</code> in the wrong order and note what happens.</li>
<li>Use Valgrind to verify that deep copies are properly freed.</li>
<li>Extend the concept to an array of structs, implement deep copy for each element.</li>
</ol>
<p>When you understand deep vs shallow copies, you control <strong>how memory ownership moves</strong> in your program, a foundation for safe, modular, and leak-free C design.</p>
</section>
</section>
<section id="practice-manual-memory-management" class="level3">
<h3 class="anchored" data-anchor-id="practice-manual-memory-management">30. Practice: Manual Memory Management</h3>
<p>Now that you’ve learned how memory works, stack vs heap, allocation, freeing, leaks, deep vs shallow copies, it’s time to practice <strong>controlling memory manually</strong>. This exercise ties together <code>malloc</code>, <code>free</code>, pointers, and struct management in a real, runnable program.</p>
<p>You’ll build a small system that stores and manipulates dynamically allocated records, a tiny simulation of how databases or object systems manage memory in C.</p>
<section id="goal" class="level4">
<h4 class="anchored" data-anchor-id="goal">Goal</h4>
<p>Create a simple “student record manager” that can:</p>
<ul>
<li>Dynamically allocate memory for each student’s name.</li>
<li>Store and print student data.</li>
<li>Free all allocated memory cleanly at the end.</li>
</ul>
</section>
<section id="tiny-code-28" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-28">Tiny Code</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb240"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span></span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb240-8"><a href="#cb240-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> gpa<span class="op">;</span></span>
<span id="cb240-9"><a href="#cb240-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Student<span class="op">;</span></span>
<span id="cb240-10"><a href="#cb240-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-11"><a href="#cb240-11" aria-hidden="true" tabindex="-1"></a>Student <span class="op">*</span>create_student<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">,</span> <span class="dt">int</span> age<span class="op">,</span> <span class="dt">float</span> gpa<span class="op">)</span> <span class="op">{</span></span>
<span id="cb240-12"><a href="#cb240-12" aria-hidden="true" tabindex="-1"></a>    Student <span class="op">*</span>s <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Student<span class="op">));</span></span>
<span id="cb240-13"><a href="#cb240-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb240-14"><a href="#cb240-14" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Memory allocation failed for Student.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb240-15"><a href="#cb240-15" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb240-16"><a href="#cb240-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb240-17"><a href="#cb240-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-18"><a href="#cb240-18" aria-hidden="true" tabindex="-1"></a>    s<span class="op">-&gt;</span>name <span class="op">=</span> malloc<span class="op">(</span>strlen<span class="op">(</span>name<span class="op">)</span> <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb240-19"><a href="#cb240-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>s<span class="op">-&gt;</span>name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb240-20"><a href="#cb240-20" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Memory allocation failed for name.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb240-21"><a href="#cb240-21" aria-hidden="true" tabindex="-1"></a>        free<span class="op">(</span>s<span class="op">);</span></span>
<span id="cb240-22"><a href="#cb240-22" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb240-23"><a href="#cb240-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb240-24"><a href="#cb240-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-25"><a href="#cb240-25" aria-hidden="true" tabindex="-1"></a>    strcpy<span class="op">(</span>s<span class="op">-&gt;</span>name<span class="op">,</span> name<span class="op">);</span></span>
<span id="cb240-26"><a href="#cb240-26" aria-hidden="true" tabindex="-1"></a>    s<span class="op">-&gt;</span>age <span class="op">=</span> age<span class="op">;</span></span>
<span id="cb240-27"><a href="#cb240-27" aria-hidden="true" tabindex="-1"></a>    s<span class="op">-&gt;</span>gpa <span class="op">=</span> gpa<span class="op">;</span></span>
<span id="cb240-28"><a href="#cb240-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-29"><a href="#cb240-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s<span class="op">;</span></span>
<span id="cb240-30"><a href="#cb240-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb240-31"><a href="#cb240-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-32"><a href="#cb240-32" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_student<span class="op">(</span><span class="dt">const</span> Student <span class="op">*</span>s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb240-33"><a href="#cb240-33" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Name: </span><span class="sc">%-10s</span><span class="st"> | Age: </span><span class="sc">%d</span><span class="st"> | GPA: </span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">-&gt;</span>name<span class="op">,</span> s<span class="op">-&gt;</span>age<span class="op">,</span> s<span class="op">-&gt;</span>gpa<span class="op">);</span></span>
<span id="cb240-34"><a href="#cb240-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb240-35"><a href="#cb240-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-36"><a href="#cb240-36" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> free_student<span class="op">(</span>Student <span class="op">*</span>s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb240-37"><a href="#cb240-37" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>s<span class="op">-&gt;</span>name<span class="op">);</span></span>
<span id="cb240-38"><a href="#cb240-38" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>s<span class="op">);</span></span>
<span id="cb240-39"><a href="#cb240-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb240-40"><a href="#cb240-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-41"><a href="#cb240-41" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb240-42"><a href="#cb240-42" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"=== Manual Memory Management Demo ===</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb240-43"><a href="#cb240-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-44"><a href="#cb240-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create three students dynamically</span></span>
<span id="cb240-45"><a href="#cb240-45" aria-hidden="true" tabindex="-1"></a>    Student <span class="op">*</span>a <span class="op">=</span> create_student<span class="op">(</span><span class="st">"Alice"</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="fl">3.8</span><span class="bu">f</span><span class="op">);</span></span>
<span id="cb240-46"><a href="#cb240-46" aria-hidden="true" tabindex="-1"></a>    Student <span class="op">*</span>b <span class="op">=</span> create_student<span class="op">(</span><span class="st">"Bob"</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="fl">3.4</span><span class="bu">f</span><span class="op">);</span></span>
<span id="cb240-47"><a href="#cb240-47" aria-hidden="true" tabindex="-1"></a>    Student <span class="op">*</span>c <span class="op">=</span> create_student<span class="op">(</span><span class="st">"Carol"</span><span class="op">,</span> <span class="dv">19</span><span class="op">,</span> <span class="fl">3.9</span><span class="bu">f</span><span class="op">);</span></span>
<span id="cb240-48"><a href="#cb240-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-49"><a href="#cb240-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Print their details</span></span>
<span id="cb240-50"><a href="#cb240-50" aria-hidden="true" tabindex="-1"></a>    print_student<span class="op">(</span>a<span class="op">);</span></span>
<span id="cb240-51"><a href="#cb240-51" aria-hidden="true" tabindex="-1"></a>    print_student<span class="op">(</span>b<span class="op">);</span></span>
<span id="cb240-52"><a href="#cb240-52" aria-hidden="true" tabindex="-1"></a>    print_student<span class="op">(</span>c<span class="op">);</span></span>
<span id="cb240-53"><a href="#cb240-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-54"><a href="#cb240-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Modify dynamically allocated memory</span></span>
<span id="cb240-55"><a href="#cb240-55" aria-hidden="true" tabindex="-1"></a>    strcpy<span class="op">(</span>b<span class="op">-&gt;</span>name<span class="op">,</span> <span class="st">"Bobby"</span><span class="op">);</span></span>
<span id="cb240-56"><a href="#cb240-56" aria-hidden="true" tabindex="-1"></a>    b<span class="op">-&gt;</span>gpa <span class="op">=</span> <span class="fl">3.6</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb240-57"><a href="#cb240-57" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">After update:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb240-58"><a href="#cb240-58" aria-hidden="true" tabindex="-1"></a>    print_student<span class="op">(</span>b<span class="op">);</span></span>
<span id="cb240-59"><a href="#cb240-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-60"><a href="#cb240-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Free memory</span></span>
<span id="cb240-61"><a href="#cb240-61" aria-hidden="true" tabindex="-1"></a>    free_student<span class="op">(</span>a<span class="op">);</span></span>
<span id="cb240-62"><a href="#cb240-62" aria-hidden="true" tabindex="-1"></a>    free_student<span class="op">(</span>b<span class="op">);</span></span>
<span id="cb240-63"><a href="#cb240-63" aria-hidden="true" tabindex="-1"></a>    free_student<span class="op">(</span>c<span class="op">);</span></span>
<span id="cb240-64"><a href="#cb240-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-65"><a href="#cb240-65" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">All memory released.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb240-66"><a href="#cb240-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb240-67"><a href="#cb240-67" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb241"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> manual_memory.c <span class="at">-o</span> manual_memory</span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./manual_memory</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>=== Manual Memory Management Demo ===
Name: Alice      | Age: 20 | GPA: 3.80
Name: Bob        | Age: 22 | GPA: 3.40
Name: Carol      | Age: 19 | GPA: 3.90

After update:
Name: Bobby      | Age: 22 | GPA: 3.60

All memory released.</code></pre>
</section>
<section id="how-it-works" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works">How It Works</h4>
<ol type="1">
<li><p><strong>Dynamic Allocation:</strong> Each <code>Student</code> and its <code>name</code> field are created on the heap with <code>malloc()</code>. You control exactly when they exist and when to destroy them.</p></li>
<li><p><strong>Ownership:</strong></p>
<ul>
<li>The program owns each student’s memory.</li>
<li>Each <code>create_student()</code> call must later be matched by <code>free_student()</code>.</li>
</ul></li>
<li><p><strong>Memory Safety:</strong></p>
<ul>
<li>Every <code>malloc</code> result is checked.</li>
<li>Freed memory is properly released before exit.</li>
</ul></li>
</ol>
</section>
<section id="expanding-the-example" class="level4">
<h4 class="anchored" data-anchor-id="expanding-the-example">Expanding the Example</h4>
<p>Try these modifications:</p>
<ol type="1">
<li><p><strong>Dynamic Array of Students</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb243"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>Student <span class="op">**</span>students <span class="op">=</span> malloc<span class="op">(</span><span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span>Student <span class="op">*));</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>students<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> create_student<span class="op">(</span><span class="st">"Ava"</span><span class="op">,</span> <span class="dv">21</span><span class="op">,</span> <span class="fl">3.7</span><span class="bu">f</span><span class="op">);</span></span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>students<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> create_student<span class="op">(</span><span class="st">"Ben"</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="fl">3.5</span><span class="bu">f</span><span class="op">);</span></span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>students<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> create_student<span class="op">(</span><span class="st">"Cleo"</span><span class="op">,</span> <span class="dv">23</span><span class="op">,</span> <span class="fl">3.9</span><span class="bu">f</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Iterate through them and print all details, then free each one.</p></li>
<li><p><strong>Reallocation (grow list)</strong> Use <code>realloc()</code> to increase your array’s capacity when adding more students dynamically.</p></li>
<li><p><strong>Deep Copy Function</strong> Implement:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb244"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>Student <span class="op">*</span>copy_student<span class="op">(</span><span class="dt">const</span> Student <span class="op">*</span>src<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>which performs a deep copy by allocating new memory for both the struct and its name.</p></li>
<li><p><strong>Leak Detection</strong> Run your program with <code>valgrind ./manual_memory</code>, confirm that all memory is freed cleanly.</p></li>
</ol>
</section>
<section id="why-it-matters-28" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-28">Why It Matters</h4>
<p>This small example mirrors what real C systems do:</p>
<ul>
<li>Allocate complex data on demand.</li>
<li>Manage lifetime explicitly.</li>
<li>Clean up correctly.</li>
</ul>
<p>Everything from operating systems to databases and compilers depends on this discipline. Once you can manage small dynamic structures like this confidently, you’re ready to build larger systems safely, from allocators to object pools to file caches.</p>
</section>
<section id="try-it-yourself-28" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-28">Try It Yourself</h4>
<ol type="1">
<li>Add a new field (<code>major</code>) and handle it dynamically.</li>
<li>Add an array of grades and compute averages.</li>
<li>Convert your static list into a dynamically resizable array using <code>realloc</code>.</li>
<li>Intentionally omit a <code>free()</code> call, then detect the leak with Valgrind.</li>
<li>Write a <code>destroy_all()</code> function that frees an array of students safely.</li>
</ol>
<p>You’ve now completed <strong>Chapter 3: Working with Memory</strong>. You understand how data lives, moves, and disappears in C, and you’ve practiced taking full control over it. From here, you’ll learn how to <strong>structure</strong> that data elegantly using <code>struct</code>, <code>union</code>, and real-world data abstractions in Chapter 4.</p>
</section>
</section>
</section>
<section id="chapter-4.-structuring-data" class="level1">
<h1>Chapter 4. Structuring Data</h1>
<section id="structures-and-nested-structures" class="level3">
<h3 class="anchored" data-anchor-id="structures-and-nested-structures">31. Structures and Nested Structures</h3>
<p>Real-world programs often deal with groups of related data, not just single variables. For example, a person has a name, an age, and an address. Instead of juggling separate variables, you can <strong>combine them into a single structure</strong> using <code>struct</code>.</p>
<p><code>struct</code> is one of the most powerful features in C, it lets you define your own data types that group information logically and efficiently.</p>
<section id="what-is-a-structure" class="level4">
<h4 class="anchored" data-anchor-id="what-is-a-structure">What Is a Structure?</h4>
<p>A <strong>structure</strong> is a user-defined type that holds variables of different kinds under one name.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb245"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Person <span class="op">{</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">50</span><span class="op">];</span></span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> height<span class="op">;</span></span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This declares a <em>template</em> for a <code>Person</code> object. It doesn’t create actual data yet, just the blueprint.</p>
</section>
<section id="declaring-and-using-structures" class="level4">
<h4 class="anchored" data-anchor-id="declaring-and-using-structures">Declaring and Using Structures</h4>
<p>You can now create variables of this new type:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb246"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Person <span class="op">{</span></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">50</span><span class="op">];</span></span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> height<span class="op">;</span></span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb246-10"><a href="#cb246-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Person p1 <span class="op">=</span> <span class="op">{</span><span class="st">"Alice"</span><span class="op">,</span> <span class="dv">25</span><span class="op">,</span> <span class="fl">1.65</span><span class="bu">f</span><span class="op">};</span></span>
<span id="cb246-11"><a href="#cb246-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-12"><a href="#cb246-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Name: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> p1<span class="op">.</span>name<span class="op">);</span></span>
<span id="cb246-13"><a href="#cb246-13" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Age: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> p1<span class="op">.</span>age<span class="op">);</span></span>
<span id="cb246-14"><a href="#cb246-14" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Height: </span><span class="sc">%.2f</span><span class="st"> m</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> p1<span class="op">.</span>height<span class="op">);</span></span>
<span id="cb246-15"><a href="#cb246-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-16"><a href="#cb246-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb246-17"><a href="#cb246-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Name: Alice
Age: 25
Height: 1.65 m</code></pre>
</section>
<section id="accessing-members" class="level4">
<h4 class="anchored" data-anchor-id="accessing-members">Accessing Members</h4>
<p>Use the dot operator <code>.</code> to access fields of a structure variable:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb248"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>p1<span class="op">.</span>age <span class="op">=</span> <span class="dv">26</span><span class="op">;</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Updated age: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> p1<span class="op">.</span>age<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If you have a pointer to a structure, use the arrow operator <code>-&gt;</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb249"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Person <span class="op">*</span>ptr <span class="op">=</span> <span class="op">&amp;</span>p1<span class="op">;</span></span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Pointer access: </span><span class="sc">%s</span><span class="st"> is </span><span class="sc">%d</span><span class="st"> years old.</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> ptr<span class="op">-&gt;</span>name<span class="op">,</span> ptr<span class="op">-&gt;</span>age<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Pointer access: Alice is 26 years old.</code></pre>
</section>
<section id="initializing-and-copying-structures" class="level4">
<h4 class="anchored" data-anchor-id="initializing-and-copying-structures">Initializing and Copying Structures</h4>
<p>You can initialize a struct directly:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb251"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Person p2 <span class="op">=</span> <span class="op">{.</span>name <span class="op">=</span> <span class="st">"Bob"</span><span class="op">,</span> <span class="op">.</span>age <span class="op">=</span> <span class="dv">30</span><span class="op">,</span> <span class="op">.</span>height <span class="op">=</span> <span class="fl">1.75</span><span class="bu">f</span><span class="op">};</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Structures can be assigned and copied by value:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb252"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Person copy <span class="op">=</span> p2<span class="op">;</span></span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Copy: </span><span class="sc">%s</span><span class="st"> (</span><span class="sc">%d</span><span class="st">)</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> copy<span class="op">.</span>name<span class="op">,</span> copy<span class="op">.</span>age<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This performs a <strong>shallow copy</strong>, all fields are copied, but if any contain pointers, they’ll still refer to the same memory (you’ll learn how to make deep copies later).</p>
</section>
<section id="nested-structures" class="level4">
<h4 class="anchored" data-anchor-id="nested-structures">Nested Structures</h4>
<p>Structures can contain other structures. This helps you organize complex data clearly.</p>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb253"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Date <span class="op">{</span></span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> day<span class="op">;</span></span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> month<span class="op">;</span></span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> year<span class="op">;</span></span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb253-8"><a href="#cb253-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-9"><a href="#cb253-9" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Student <span class="op">{</span></span>
<span id="cb253-10"><a href="#cb253-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">50</span><span class="op">];</span></span>
<span id="cb253-11"><a href="#cb253-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb253-12"><a href="#cb253-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Date birthdate<span class="op">;</span> <span class="co">// nested structure</span></span>
<span id="cb253-13"><a href="#cb253-13" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb253-14"><a href="#cb253-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-15"><a href="#cb253-15" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb253-16"><a href="#cb253-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Student s <span class="op">=</span> <span class="op">{</span></span>
<span id="cb253-17"><a href="#cb253-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>name <span class="op">=</span> <span class="st">"Carol"</span><span class="op">,</span></span>
<span id="cb253-18"><a href="#cb253-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>id <span class="op">=</span> <span class="dv">1234</span><span class="op">,</span></span>
<span id="cb253-19"><a href="#cb253-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>birthdate <span class="op">=</span> <span class="op">{</span><span class="dv">15</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">2003</span><span class="op">}</span></span>
<span id="cb253-20"><a href="#cb253-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb253-21"><a href="#cb253-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-22"><a href="#cb253-22" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st"> (ID </span><span class="sc">%d</span><span class="st">) was born on </span><span class="sc">%02d</span><span class="st">/</span><span class="sc">%02d</span><span class="st">/</span><span class="sc">%04d\n</span><span class="st">"</span><span class="op">,</span></span>
<span id="cb253-23"><a href="#cb253-23" aria-hidden="true" tabindex="-1"></a>           s<span class="op">.</span>name<span class="op">,</span> s<span class="op">.</span>id<span class="op">,</span></span>
<span id="cb253-24"><a href="#cb253-24" aria-hidden="true" tabindex="-1"></a>           s<span class="op">.</span>birthdate<span class="op">.</span>day<span class="op">,</span> s<span class="op">.</span>birthdate<span class="op">.</span>month<span class="op">,</span> s<span class="op">.</span>birthdate<span class="op">.</span>year<span class="op">);</span></span>
<span id="cb253-25"><a href="#cb253-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb253-26"><a href="#cb253-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Carol (ID 1234) was born on 15/08/2003</code></pre>
<p>You access nested fields with the dot operator:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb255"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>s<span class="op">.</span>birthdate<span class="op">.</span>year <span class="op">=</span> <span class="dv">2004</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="structures-and-functions" class="level4">
<h4 class="anchored" data-anchor-id="structures-and-functions">Structures and Functions</h4>
<p>You can pass structs to functions by value or by pointer:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb256"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_person<span class="op">(</span><span class="kw">struct</span> Person p<span class="op">);</span></span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> update_age<span class="op">(</span><span class="kw">struct</span> Person <span class="op">*</span>p<span class="op">,</span> <span class="dt">int</span> new_age<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb257"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> update_age<span class="op">(</span><span class="kw">struct</span> Person <span class="op">*</span>p<span class="op">,</span> <span class="dt">int</span> new_age<span class="op">)</span> <span class="op">{</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>    p<span class="op">-&gt;</span>age <span class="op">=</span> new_age<span class="op">;</span></span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Passing a pointer is more efficient, especially for large structures.</p>
</section>
<section id="tiny-code-29" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-29">Tiny Code</h4>
<p>Here’s a full example combining everything above:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb258"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Date <span class="op">{</span></span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> day<span class="op">;</span></span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> month<span class="op">;</span></span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> year<span class="op">;</span></span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb258-8"><a href="#cb258-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-9"><a href="#cb258-9" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Person <span class="op">{</span></span>
<span id="cb258-10"><a href="#cb258-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">50</span><span class="op">];</span></span>
<span id="cb258-11"><a href="#cb258-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb258-12"><a href="#cb258-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> height<span class="op">;</span></span>
<span id="cb258-13"><a href="#cb258-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Date birthdate<span class="op">;</span></span>
<span id="cb258-14"><a href="#cb258-14" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb258-15"><a href="#cb258-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-16"><a href="#cb258-16" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_person<span class="op">(</span><span class="dt">const</span> <span class="kw">struct</span> Person <span class="op">*</span>p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb258-17"><a href="#cb258-17" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st">, </span><span class="sc">%d</span><span class="st"> years old, born on </span><span class="sc">%02d</span><span class="st">/</span><span class="sc">%02d</span><span class="st">/</span><span class="sc">%04d</span><span class="st">, height </span><span class="sc">%.2f</span><span class="st">m</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span></span>
<span id="cb258-18"><a href="#cb258-18" aria-hidden="true" tabindex="-1"></a>           p<span class="op">-&gt;</span>name<span class="op">,</span> p<span class="op">-&gt;</span>age<span class="op">,</span></span>
<span id="cb258-19"><a href="#cb258-19" aria-hidden="true" tabindex="-1"></a>           p<span class="op">-&gt;</span>birthdate<span class="op">.</span>day<span class="op">,</span> p<span class="op">-&gt;</span>birthdate<span class="op">.</span>month<span class="op">,</span> p<span class="op">-&gt;</span>birthdate<span class="op">.</span>year<span class="op">,</span></span>
<span id="cb258-20"><a href="#cb258-20" aria-hidden="true" tabindex="-1"></a>           p<span class="op">-&gt;</span>height<span class="op">);</span></span>
<span id="cb258-21"><a href="#cb258-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb258-22"><a href="#cb258-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-23"><a href="#cb258-23" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb258-24"><a href="#cb258-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Person person <span class="op">=</span> <span class="op">{</span><span class="st">"Alice"</span><span class="op">,</span> <span class="dv">25</span><span class="op">,</span> <span class="fl">1.68</span><span class="bu">f</span><span class="op">,</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">1999</span><span class="op">}};</span></span>
<span id="cb258-25"><a href="#cb258-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-26"><a href="#cb258-26" aria-hidden="true" tabindex="-1"></a>    print_person<span class="op">(&amp;</span>person<span class="op">);</span></span>
<span id="cb258-27"><a href="#cb258-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-28"><a href="#cb258-28" aria-hidden="true" tabindex="-1"></a>    person<span class="op">.</span>age<span class="op">++;</span></span>
<span id="cb258-29"><a href="#cb258-29" aria-hidden="true" tabindex="-1"></a>    person<span class="op">.</span>birthdate<span class="op">.</span>year<span class="op">++;</span></span>
<span id="cb258-30"><a href="#cb258-30" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"After update:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb258-31"><a href="#cb258-31" aria-hidden="true" tabindex="-1"></a>    print_person<span class="op">(&amp;</span>person<span class="op">);</span></span>
<span id="cb258-32"><a href="#cb258-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-33"><a href="#cb258-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb258-34"><a href="#cb258-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Alice, 25 years old, born on 01/02/1999, height 1.68m
After update:
Alice, 26 years old, born on 01/02/2000, height 1.68m</code></pre>
</section>
<section id="why-it-matters-29" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-29">Why It Matters</h4>
<p>Structures let you:</p>
<ul>
<li>Combine related data into logical units.</li>
<li>Model real-world entities directly in code.</li>
<li>Pass data efficiently between functions.</li>
<li>Build higher-level data abstractions like lists, trees, or objects.</li>
</ul>
<p>They’re the foundation of all complex C systems, files, network packets, kernel data, even database rows are built on top of <code>struct</code>.</p>
</section>
<section id="try-it-yourself-29" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-29">Try It Yourself</h4>
<ol type="1">
<li>Create a <code>Book</code> structure with <code>title</code>, <code>author</code>, and <code>year</code>.</li>
<li>Write a function to print all details of a <code>Book</code>.</li>
<li>Create a nested structure <code>Library</code> that contains multiple books.</li>
<li>Access a nested field (e.g., the title of the first book).</li>
<li>Modify the <code>Library</code> through a pointer using the <code>-&gt;</code> operator.</li>
</ol>
<p>Structures are how C lets you <strong>model the world</strong>, compact, explicit, and fast. Next, you’ll learn about <strong>unions</strong> and how C lets different data types share the same memory space efficiently.</p>
</section>
</section>
<section id="unions-and-type-reuse" class="level3">
<h3 class="anchored" data-anchor-id="unions-and-type-reuse">32. Unions and Type Reuse</h3>
<p>Sometimes you need a variable that can hold <em>different types of data</em> at different times, but you don’t want to waste memory keeping all of them active at once. That’s where <strong>unions</strong> come in.</p>
<p>A <code>union</code> lets multiple fields share the <em>same memory location</em>. It’s a space-saving feature and a powerful tool for implementing type flexibility, variant data, and even low-level binary manipulation.</p>
<section id="what-is-a-union" class="level4">
<h4 class="anchored" data-anchor-id="what-is-a-union">What Is a Union?</h4>
<p>A <strong>union</strong> is like a structure, but instead of giving each member its own memory, <em>all members share the same memory block</em>. Only one field is valid at any moment.</p>
<p>Syntax:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb260"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="kw">union</span> Data <span class="op">{</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> f<span class="op">;</span></span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> c<span class="op">;</span></span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Here, <code>i</code>, <code>f</code>, and <code>c</code> share the same storage. The size of the union is equal to the size of its <em>largest</em> member.</p>
</section>
<section id="using-a-union" class="level4">
<h4 class="anchored" data-anchor-id="using-a-union">Using a Union</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb261"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a><span class="kw">union</span> Data <span class="op">{</span></span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> f<span class="op">;</span></span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> c<span class="op">;</span></span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb261-8"><a href="#cb261-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-9"><a href="#cb261-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb261-10"><a href="#cb261-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">union</span> Data d<span class="op">;</span></span>
<span id="cb261-11"><a href="#cb261-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-12"><a href="#cb261-12" aria-hidden="true" tabindex="-1"></a>    d<span class="op">.</span>i <span class="op">=</span> <span class="dv">42</span><span class="op">;</span></span>
<span id="cb261-13"><a href="#cb261-13" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"d.i = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> d<span class="op">.</span>i<span class="op">);</span></span>
<span id="cb261-14"><a href="#cb261-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-15"><a href="#cb261-15" aria-hidden="true" tabindex="-1"></a>    d<span class="op">.</span>f <span class="op">=</span> <span class="fl">3.14</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb261-16"><a href="#cb261-16" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"d.f = </span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> d<span class="op">.</span>f<span class="op">);</span></span>
<span id="cb261-17"><a href="#cb261-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-18"><a href="#cb261-18" aria-hidden="true" tabindex="-1"></a>    d<span class="op">.</span>c <span class="op">=</span> <span class="ch">'A'</span><span class="op">;</span></span>
<span id="cb261-19"><a href="#cb261-19" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"d.c = </span><span class="sc">%c\n</span><span class="st">"</span><span class="op">,</span> d<span class="op">.</span>c<span class="op">);</span></span>
<span id="cb261-20"><a href="#cb261-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-21"><a href="#cb261-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The last assignment overwrites the previous ones</span></span>
<span id="cb261-22"><a href="#cb261-22" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"After d.c = 'A', d.i = </span><span class="sc">%d</span><span class="st"> (corrupted)</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> d<span class="op">.</span>i<span class="op">);</span></span>
<span id="cb261-23"><a href="#cb261-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-24"><a href="#cb261-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb261-25"><a href="#cb261-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>d.i = 42
d.f = 3.14
d.c = A
After d.c = 'A', d.i = 1094795585</code></pre>
<p>Notice how writing to one member affects the others, because they occupy the same memory.</p>
</section>
<section id="memory-layout-illustration" class="level4">
<h4 class="anchored" data-anchor-id="memory-layout-illustration">Memory Layout Illustration</h4>
<pre><code>+------------------+
| Shared Memory    |  &lt;- same location for all fields
| (size = largest) |
+------------------+
| i: 4 bytes       |
| f: 4 bytes       |
| c: 1 byte        |
+------------------+</code></pre>
<p>All fields overlap in the same storage area.</p>
</section>
<section id="tiny-code-30" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-30">Tiny Code</h4>
<p>Let’s see a practical example where a union saves memory.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb264"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a><span class="kw">union</span> Value <span class="op">{</span></span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb264-6"><a href="#cb264-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> f<span class="op">;</span></span>
<span id="cb264-7"><a href="#cb264-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> str<span class="op">[</span><span class="dv">20</span><span class="op">];</span></span>
<span id="cb264-8"><a href="#cb264-8" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb264-9"><a href="#cb264-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-10"><a href="#cb264-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb264-11"><a href="#cb264-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">union</span> Value v<span class="op">;</span></span>
<span id="cb264-12"><a href="#cb264-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-13"><a href="#cb264-13" aria-hidden="true" tabindex="-1"></a>    v<span class="op">.</span>i <span class="op">=</span> <span class="dv">42</span><span class="op">;</span></span>
<span id="cb264-14"><a href="#cb264-14" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"As int: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> v<span class="op">.</span>i<span class="op">);</span></span>
<span id="cb264-15"><a href="#cb264-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-16"><a href="#cb264-16" aria-hidden="true" tabindex="-1"></a>    v<span class="op">.</span>f <span class="op">=</span> <span class="fl">3.14</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb264-17"><a href="#cb264-17" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"As float: </span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> v<span class="op">.</span>f<span class="op">);</span></span>
<span id="cb264-18"><a href="#cb264-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-19"><a href="#cb264-19" aria-hidden="true" tabindex="-1"></a>    strcpy<span class="op">(</span>v<span class="op">.</span>str<span class="op">,</span> <span class="st">"Hello"</span><span class="op">);</span></span>
<span id="cb264-20"><a href="#cb264-20" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"As string: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> v<span class="op">.</span>str<span class="op">);</span></span>
<span id="cb264-21"><a href="#cb264-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-22"><a href="#cb264-22" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Union size: </span><span class="sc">%zu</span><span class="st"> bytes</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>v<span class="op">));</span></span>
<span id="cb264-23"><a href="#cb264-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb264-24"><a href="#cb264-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>As int: 42
As float: 3.14
As string: Hello
Union size: 20 bytes</code></pre>
<p>Even though it contains an <code>int</code>, a <code>float</code>, and a <code>char[20]</code>, the total size is only 20 bytes, the size of the largest member.</p>
</section>
<section id="tagged-unions-type-safe-pattern" class="level4">
<h4 class="anchored" data-anchor-id="tagged-unions-type-safe-pattern">Tagged Unions (Type-Safe Pattern)</h4>
<p>In practice, you often use a <strong>tag</strong> (an enum or integer) to remember which member is active, this is known as a <em>tagged union</em> or <em>discriminated union</em>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb266"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> Type <span class="op">{</span> INT<span class="op">,</span> FLOAT<span class="op">,</span> STRING <span class="op">};</span></span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Variant <span class="op">{</span></span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> Type type<span class="op">;</span></span>
<span id="cb266-8"><a href="#cb266-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">union</span> <span class="op">{</span></span>
<span id="cb266-9"><a href="#cb266-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb266-10"><a href="#cb266-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> f<span class="op">;</span></span>
<span id="cb266-11"><a href="#cb266-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> str<span class="op">[</span><span class="dv">20</span><span class="op">];</span></span>
<span id="cb266-12"><a href="#cb266-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> data<span class="op">;</span></span>
<span id="cb266-13"><a href="#cb266-13" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb266-14"><a href="#cb266-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-15"><a href="#cb266-15" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_variant<span class="op">(</span><span class="dt">const</span> <span class="kw">struct</span> Variant <span class="op">*</span>v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb266-16"><a href="#cb266-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>v<span class="op">-&gt;</span>type<span class="op">)</span> <span class="op">{</span></span>
<span id="cb266-17"><a href="#cb266-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> INT<span class="op">:</span>   printf<span class="op">(</span><span class="st">"INT: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> v<span class="op">-&gt;</span>data<span class="op">.</span>i<span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb266-18"><a href="#cb266-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> FLOAT<span class="op">:</span> printf<span class="op">(</span><span class="st">"FLOAT: </span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> v<span class="op">-&gt;</span>data<span class="op">.</span>f<span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb266-19"><a href="#cb266-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> STRING<span class="op">:</span>printf<span class="op">(</span><span class="st">"STRING: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> v<span class="op">-&gt;</span>data<span class="op">.</span>str<span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb266-20"><a href="#cb266-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb266-21"><a href="#cb266-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb266-22"><a href="#cb266-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-23"><a href="#cb266-23" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb266-24"><a href="#cb266-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Variant v<span class="op">;</span></span>
<span id="cb266-25"><a href="#cb266-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-26"><a href="#cb266-26" aria-hidden="true" tabindex="-1"></a>    v<span class="op">.</span>type <span class="op">=</span> STRING<span class="op">;</span></span>
<span id="cb266-27"><a href="#cb266-27" aria-hidden="true" tabindex="-1"></a>    strcpy<span class="op">(</span>v<span class="op">.</span>data<span class="op">.</span>str<span class="op">,</span> <span class="st">"C Language"</span><span class="op">);</span></span>
<span id="cb266-28"><a href="#cb266-28" aria-hidden="true" tabindex="-1"></a>    print_variant<span class="op">(&amp;</span>v<span class="op">);</span></span>
<span id="cb266-29"><a href="#cb266-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-30"><a href="#cb266-30" aria-hidden="true" tabindex="-1"></a>    v<span class="op">.</span>type <span class="op">=</span> INT<span class="op">;</span></span>
<span id="cb266-31"><a href="#cb266-31" aria-hidden="true" tabindex="-1"></a>    v<span class="op">.</span>data<span class="op">.</span>i <span class="op">=</span> <span class="dv">123</span><span class="op">;</span></span>
<span id="cb266-32"><a href="#cb266-32" aria-hidden="true" tabindex="-1"></a>    print_variant<span class="op">(&amp;</span>v<span class="op">);</span></span>
<span id="cb266-33"><a href="#cb266-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-34"><a href="#cb266-34" aria-hidden="true" tabindex="-1"></a>    v<span class="op">.</span>type <span class="op">=</span> FLOAT<span class="op">;</span></span>
<span id="cb266-35"><a href="#cb266-35" aria-hidden="true" tabindex="-1"></a>    v<span class="op">.</span>data<span class="op">.</span>f <span class="op">=</span> <span class="fl">9.81</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb266-36"><a href="#cb266-36" aria-hidden="true" tabindex="-1"></a>    print_variant<span class="op">(&amp;</span>v<span class="op">);</span></span>
<span id="cb266-37"><a href="#cb266-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-38"><a href="#cb266-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb266-39"><a href="#cb266-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>STRING: C Language
INT: 123
FLOAT: 9.81</code></pre>
<p>This is how you combine the flexibility of unions with the safety of knowing which field is currently valid.</p>
</section>
<section id="why-it-matters-30" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-30">Why It Matters</h4>
<p>Unions are crucial for:</p>
<ul>
<li><strong>Saving memory</strong>, only one field exists at a time.</li>
<li><strong>Implementing variant data types</strong>, e.g., JSON values, expression trees, network packets.</li>
<li><strong>Working with hardware registers</strong>, map one register into multiple view types.</li>
<li><strong>Binary serialization</strong>, reinterpret raw bytes as various data forms.</li>
</ul>
<p>In low-level systems, they enable compact and flexible representations that C is famous for.</p>
</section>
<section id="try-it-yourself-30" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-30">Try It Yourself</h4>
<ol type="1">
<li><p>Write a union <code>Number</code> with <code>int</code>, <code>float</code>, and <code>double</code>.</p>
<ul>
<li>Print its size and observe which member determines it.</li>
</ul></li>
<li><p>Implement a tagged union <code>Message</code> with types TEXT, BINARY, and COMMAND.</p></li>
<li><p>Create a struct with an enum tag and a union, simulate how file formats (like PNG chunks) are parsed.</p></li>
<li><p>Write a function that prints the active union field using the tag.</p></li>
<li><p>Modify the previous example to store an array of tagged unions.</p></li>
</ol>
<p>In C, <strong>unions give you memory control and flexibility</strong> that few languages allow. They’re the foundation for advanced constructs like variant types, polymorphic structs, and even message protocols, used everywhere from the Linux kernel to embedded firmware.</p>
</section>
</section>
<section id="typedef-and-code-clarity" class="level3">
<h3 class="anchored" data-anchor-id="typedef-and-code-clarity">33. Typedef and Code Clarity</h3>
<p>C gives you the power to create your own type names using the <code>typedef</code> keyword. It doesn’t create new types at runtime, instead, it creates <strong>aliases</strong> that make your code cleaner, more expressive, and easier to maintain.</p>
<p>If <code>struct</code>, <code>enum</code>, or pointer syntax ever feels cluttered, <code>typedef</code> is your best friend.</p>
<section id="what-is-typedef" class="level4">
<h4 class="anchored" data-anchor-id="what-is-typedef">What Is <code>typedef</code>?</h4>
<p><code>typedef</code> gives an existing type a new name. It’s like a <em>nickname</em> for a complex or frequently used declaration.</p>
<p>Syntax:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb268"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> existing_type new_name<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb269"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">unsigned</span> <span class="dt">long</span> ulong<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now <code>ulong</code> can be used wherever you’d normally write <code>unsigned long</code>.</p>
</section>
<section id="basic-examples" class="level4">
<h4 class="anchored" data-anchor-id="basic-examples">Basic Examples</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb270"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">int</span> Score<span class="op">;</span></span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">char</span> Letter<span class="op">;</span></span>
<span id="cb270-5"><a href="#cb270-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-6"><a href="#cb270-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb270-7"><a href="#cb270-7" aria-hidden="true" tabindex="-1"></a>    Score math <span class="op">=</span> <span class="dv">95</span><span class="op">;</span></span>
<span id="cb270-8"><a href="#cb270-8" aria-hidden="true" tabindex="-1"></a>    Letter grade <span class="op">=</span> <span class="ch">'A'</span><span class="op">;</span></span>
<span id="cb270-9"><a href="#cb270-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Math: </span><span class="sc">%d</span><span class="st">, Grade: </span><span class="sc">%c\n</span><span class="st">"</span><span class="op">,</span> math<span class="op">,</span> grade<span class="op">);</span></span>
<span id="cb270-10"><a href="#cb270-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb270-11"><a href="#cb270-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Math: 95, Grade: A</code></pre>
<p>It doesn’t change how the compiler treats the variable, just makes the code more readable.</p>
</section>
<section id="typedef-with-pointers" class="level4">
<h4 class="anchored" data-anchor-id="typedef-with-pointers">Typedef with Pointers</h4>
<p>Pointer declarations can get messy. With <code>typedef</code>, you can simplify them.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb272"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">int</span><span class="op">*</span> IntPtr<span class="op">;</span></span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a>    IntPtr p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span> <span class="co">// same as int *p = &amp;x;</span></span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Value: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span></span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb272-8"><a href="#cb272-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Value: 10</code></pre>
<blockquote class="blockquote">
<p><strong>Tip:</strong> Be careful, <code>IntPtr a, b;</code> means <em>both</em> <code>a</code> and <code>b</code> are pointers, unlike plain <code>int *a, b;</code>.</p>
</blockquote>
</section>
<section id="typedef-with-structures" class="level4">
<h4 class="anchored" data-anchor-id="typedef-with-structures">Typedef with Structures</h4>
<p><code>typedef</code> shines with <code>struct</code>, <code>union</code>, and <code>enum</code> declarations. Without typedef:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb274"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Point <span class="op">{</span></span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">;</span></span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> y<span class="op">;</span></span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-6"><a href="#cb274-6" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Point p1 <span class="op">=</span> <span class="op">{</span><span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">};</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>With typedef:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb275"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">;</span></span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> y<span class="op">;</span></span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Point<span class="op">;</span></span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-6"><a href="#cb275-6" aria-hidden="true" tabindex="-1"></a>Point p1 <span class="op">=</span> <span class="op">{</span><span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">};</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>No more need to repeat the word <code>struct</code> everywhere.</p>
</section>
<section id="combining-struct-and-typedef" class="level4">
<h4 class="anchored" data-anchor-id="combining-struct-and-typedef">Combining Struct and Typedef</h4>
<p>You can define and alias a struct in one line:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb276"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Person <span class="op">{</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">50</span><span class="op">];</span></span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Person<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now you can write:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb277"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>Person p <span class="op">=</span> <span class="op">{</span><span class="st">"Alice"</span><span class="op">,</span> <span class="dv">25</span><span class="op">};</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>instead of:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb278"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Person p <span class="op">=</span> <span class="op">{</span><span class="st">"Alice"</span><span class="op">,</span> <span class="dv">25</span><span class="op">};</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="typedef-with-function-pointers" class="level4">
<h4 class="anchored" data-anchor-id="typedef-with-function-pointers">Typedef with Function Pointers</h4>
<p>Function pointer syntax can be hard to read, typedef simplifies it dramatically.</p>
<p>Without typedef:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb279"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">(*</span>operation<span class="op">)(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>With typedef:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb280"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">int</span> <span class="op">(*</span>Operation<span class="op">)(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span><span class="op">);</span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb280-6"><a href="#cb280-6" aria-hidden="true" tabindex="-1"></a>    Operation op <span class="op">=</span> add<span class="op">;</span></span>
<span id="cb280-7"><a href="#cb280-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> op<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">));</span></span>
<span id="cb280-8"><a href="#cb280-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now <code>Operation</code> is a clean alias for a pointer to a function that takes two ints and returns an int.</p>
</section>
<section id="tiny-code-31" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-31">Tiny Code</h4>
<p>Here’s a full example showing typedefs for structs, pointers, and function types:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb281"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">50</span><span class="op">];</span></span>
<span id="cb281-6"><a href="#cb281-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb281-7"><a href="#cb281-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Person<span class="op">;</span></span>
<span id="cb281-8"><a href="#cb281-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-9"><a href="#cb281-9" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> Person<span class="op">*</span> PersonPtr<span class="op">;</span></span>
<span id="cb281-10"><a href="#cb281-10" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">void</span> <span class="op">(*</span>Printer<span class="op">)(</span><span class="dt">const</span> Person<span class="op">*);</span></span>
<span id="cb281-11"><a href="#cb281-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-12"><a href="#cb281-12" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_person<span class="op">(</span><span class="dt">const</span> Person <span class="op">*</span>p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb281-13"><a href="#cb281-13" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st"> (</span><span class="sc">%d</span><span class="st"> years old)</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> p<span class="op">-&gt;</span>name<span class="op">,</span> p<span class="op">-&gt;</span>age<span class="op">);</span></span>
<span id="cb281-14"><a href="#cb281-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb281-15"><a href="#cb281-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-16"><a href="#cb281-16" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb281-17"><a href="#cb281-17" aria-hidden="true" tabindex="-1"></a>    Person p <span class="op">=</span> <span class="op">{</span><span class="st">"Alice"</span><span class="op">,</span> <span class="dv">25</span><span class="op">};</span></span>
<span id="cb281-18"><a href="#cb281-18" aria-hidden="true" tabindex="-1"></a>    PersonPtr ptr <span class="op">=</span> <span class="op">&amp;</span>p<span class="op">;</span></span>
<span id="cb281-19"><a href="#cb281-19" aria-hidden="true" tabindex="-1"></a>    Printer print <span class="op">=</span> print_person<span class="op">;</span></span>
<span id="cb281-20"><a href="#cb281-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-21"><a href="#cb281-21" aria-hidden="true" tabindex="-1"></a>    print<span class="op">(</span>ptr<span class="op">);</span></span>
<span id="cb281-22"><a href="#cb281-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb281-23"><a href="#cb281-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Alice (25 years old)</code></pre>
</section>
<section id="why-it-matters-31" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-31">Why It Matters</h4>
<p><code>typedef</code> improves:</p>
<ul>
<li><strong>Clarity:</strong> Long or complex declarations become readable.</li>
<li><strong>Consistency:</strong> Standardize naming (e.g., <code>size_t</code>, <code>uint32_t</code>).</li>
<li><strong>Maintainability:</strong> Changing underlying types is easier, one typedef change updates all uses.</li>
<li><strong>Abstraction:</strong> Hides implementation details, especially in headers.</li>
</ul>
<p>It’s especially useful in large projects and system APIs, where naming conventions define clean boundaries.</p>
</section>
<section id="common-typedef-patterns" class="level4">
<h4 class="anchored" data-anchor-id="common-typedef-patterns">Common Typedef Patterns</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 72%">
</colgroup>
<thead>
<tr class="header">
<th>Purpose</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Standard aliases</td>
<td><code>typedef unsigned int uint;</code></td>
</tr>
<tr class="even">
<td>Struct abstraction</td>
<td><code>typedef struct Node Node;</code></td>
</tr>
<tr class="odd">
<td>Function pointer type</td>
<td><code>typedef void (*Handler)(int signal);</code></td>
</tr>
<tr class="even">
<td>Handle-like pattern</td>
<td><code>typedef struct File* FileHandle;</code></td>
</tr>
<tr class="odd">
<td>Platform types</td>
<td><code>typedef long long int64; typedef unsigned int uint32;</code></td>
</tr>
</tbody>
</table>
</section>
<section id="try-it-yourself-31" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-31">Try It Yourself</h4>
<ol type="1">
<li>Define a <code>typedef</code> for <code>unsigned long long</code> called <code>u64</code>.</li>
<li>Create a <code>typedef struct</code> called <code>Book</code> with fields for title and pages.</li>
<li>Define a <code>typedef</code> for a function pointer <code>Comparator(int, int)</code>.</li>
<li>Write a program that passes a <code>Comparator</code> to a sorting function.</li>
<li>Modify one typedef and observe how the code compiles cleanly without further edits.</li>
</ol>
<p><code>typedef</code> may look simple, but it’s one of the most powerful readability tools in C. It lets you design your own vocabulary for your system, a small step toward writing clean, self-documenting code that scales.</p>
</section>
</section>
<section id="bitfields-and-memory-packing" class="level3">
<h3 class="anchored" data-anchor-id="bitfields-and-memory-packing">34. Bitfields and Memory Packing</h3>
<p>C lets you control data layout down to the <em>bit level</em> using <strong>bitfields</strong>. They allow you to store small values compactly inside a struct, perfect for flags, configuration registers, or communication protocols. Combined with <em>packing</em>, you can squeeze data into minimal space while still keeping it easy to manipulate symbolically.</p>
<section id="what-is-a-bitfield" class="level4">
<h4 class="anchored" data-anchor-id="what-is-a-bitfield">What Is a Bitfield?</h4>
<p>A <strong>bitfield</strong> lets you define the exact number of bits to allocate for a field inside a <code>struct</code>.</p>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb283"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Flags <span class="op">{</span></span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> is_visible <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> is_enabled <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> has_error  <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Here, each field uses just <strong>1 bit</strong> instead of a full 4-byte <code>int</code>. That means 8 such flags fit comfortably in one byte.</p>
</section>
<section id="declaring-and-using-bitfields" class="level4">
<h4 class="anchored" data-anchor-id="declaring-and-using-bitfields">Declaring and Using Bitfields</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb284"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Status <span class="op">{</span></span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> connected <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> error     <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb284-6"><a href="#cb284-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> active    <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb284-7"><a href="#cb284-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> reserved  <span class="op">:</span> <span class="dv">5</span><span class="op">;</span> <span class="co">// padding bits</span></span>
<span id="cb284-8"><a href="#cb284-8" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb284-9"><a href="#cb284-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-10"><a href="#cb284-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb284-11"><a href="#cb284-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Status s <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">};</span></span>
<span id="cb284-12"><a href="#cb284-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Connected: </span><span class="sc">%u</span><span class="st">, Active: </span><span class="sc">%u\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">.</span>connected<span class="op">,</span> s<span class="op">.</span>active<span class="op">);</span></span>
<span id="cb284-13"><a href="#cb284-13" aria-hidden="true" tabindex="-1"></a>    s<span class="op">.</span>error <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb284-14"><a href="#cb284-14" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Error now: </span><span class="sc">%u\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">.</span>error<span class="op">);</span></span>
<span id="cb284-15"><a href="#cb284-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb284-16"><a href="#cb284-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Connected: 1, Active: 1
Error now: 1</code></pre>
<p>Even though there are 4 fields, the entire struct typically occupies only 1 byte.</p>
</section>
<section id="tiny-code-32" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-32">Tiny Code</h4>
<p>Here’s a complete example demonstrating packed flags and printing bit values:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb286"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> DeviceStatus <span class="op">{</span></span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> powered_on <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb286-5"><a href="#cb286-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> connected  <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb286-6"><a href="#cb286-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> has_error  <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb286-7"><a href="#cb286-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> battery_low<span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb286-8"><a href="#cb286-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> reserved   <span class="op">:</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb286-9"><a href="#cb286-9" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb286-10"><a href="#cb286-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-11"><a href="#cb286-11" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_bits<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> byte<span class="op">)</span> <span class="op">{</span></span>
<span id="cb286-12"><a href="#cb286-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">7</span><span class="op">;</span> i <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">;</span> i<span class="op">--)</span></span>
<span id="cb286-13"><a href="#cb286-13" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">"</span><span class="op">,</span> <span class="op">(</span>byte <span class="op">&gt;&gt;</span> i<span class="op">)</span> <span class="op">&amp;</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb286-14"><a href="#cb286-14" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb286-15"><a href="#cb286-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb286-16"><a href="#cb286-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-17"><a href="#cb286-17" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb286-18"><a href="#cb286-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> DeviceStatus d <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">};</span></span>
<span id="cb286-19"><a href="#cb286-19" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Size of DeviceStatus: </span><span class="sc">%zu</span><span class="st"> bytes</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>d<span class="op">));</span></span>
<span id="cb286-20"><a href="#cb286-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-21"><a href="#cb286-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>raw <span class="op">=</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">*)&amp;</span>d<span class="op">;</span></span>
<span id="cb286-22"><a href="#cb286-22" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Binary layout: "</span><span class="op">);</span></span>
<span id="cb286-23"><a href="#cb286-23" aria-hidden="true" tabindex="-1"></a>    print_bits<span class="op">(*</span>raw<span class="op">);</span></span>
<span id="cb286-24"><a href="#cb286-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-25"><a href="#cb286-25" aria-hidden="true" tabindex="-1"></a>    d<span class="op">.</span>has_error <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb286-26"><a href="#cb286-26" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Updated binary: "</span><span class="op">);</span></span>
<span id="cb286-27"><a href="#cb286-27" aria-hidden="true" tabindex="-1"></a>    print_bits<span class="op">(*</span>raw<span class="op">);</span></span>
<span id="cb286-28"><a href="#cb286-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-29"><a href="#cb286-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb286-30"><a href="#cb286-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output (may vary by platform):</p>
<pre><code>Size of DeviceStatus: 1 bytes
Binary layout: 00000011
Updated binary: 00000111</code></pre>
</section>
<section id="nested-bitfields-example" class="level4">
<h4 class="anchored" data-anchor-id="nested-bitfields-example">Nested Bitfields Example</h4>
<p>You can even use bitfields inside nested structs to create compact yet expressive data models:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb288"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Sensor <span class="op">{</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> id       <span class="op">:</span> <span class="dv">4</span><span class="op">;</span>  <span class="co">// 0–15</span></span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> type     <span class="op">:</span> <span class="dv">3</span><span class="op">;</span>  <span class="co">// 0–7</span></span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> active   <span class="op">:</span> <span class="dv">1</span><span class="op">;</span>  <span class="co">// boolean</span></span>
<span id="cb288-5"><a href="#cb288-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb288-6"><a href="#cb288-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-7"><a href="#cb288-7" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Device <span class="op">{</span></span>
<span id="cb288-8"><a href="#cb288-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Sensor sensors<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb288-9"><a href="#cb288-9" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Each sensor entry now fits neatly into a single byte.</p>
</section>
<section id="memory-packing" class="level4">
<h4 class="anchored" data-anchor-id="memory-packing">Memory Packing</h4>
<p>By default, compilers may insert <strong>padding bytes</strong> to align fields for faster access. If you want tighter packing, for example, when saving binary data to a file or sending over a network, you can request packed structs.</p>
<p>Compiler directives differ by system:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb289"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#pragma pack(push, 1)</span></span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Packet <span class="op">{</span></span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> type<span class="op">;</span></span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> length<span class="op">;</span></span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">short</span> checksum<span class="op">;</span></span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb289-7"><a href="#cb289-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#pragma pack(pop)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now the struct is tightly packed without alignment padding between fields.</p>
</section>
<section id="bitfields-in-real-systems" class="level4">
<h4 class="anchored" data-anchor-id="bitfields-in-real-systems">Bitfields in Real Systems</h4>
<p>Bitfields are used everywhere in systems programming:</p>
<ul>
<li><strong>Hardware control registers:</strong> Represent on/off bits for devices.</li>
<li><strong>Network protocols:</strong> Flags in TCP, UDP, or IP headers.</li>
<li><strong>Compression and serialization:</strong> Compact representation of status or metadata.</li>
<li><strong>Embedded systems:</strong> Save every byte of RAM in microcontrollers.</li>
</ul>
</section>
<section id="limitations" class="level4">
<h4 class="anchored" data-anchor-id="limitations">Limitations</h4>
<ul>
<li>Bitfield ordering (which bit is “first”) is <strong>implementation-dependent</strong>, varies by compiler and platform.</li>
<li>They cannot cross word boundaries reliably across architectures.</li>
<li>Bitfields cannot be directly addressed by pointers (<code>&amp;field</code> not allowed).</li>
<li>Endianness matters if transmitting across different systems.</li>
</ul>
<blockquote class="blockquote">
<p>For portable bit-level control (especially in networking), many engineers use explicit bitwise operators instead.</p>
</blockquote>
</section>
<section id="manual-bitwise-control" class="level4">
<h4 class="anchored" data-anchor-id="manual-bitwise-control">Manual Bitwise Control</h4>
<p>Sometimes you’ll prefer manual masks and shifts:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb290"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">char</span> flags <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>flags <span class="op">|=</span> <span class="op">(</span><span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">0</span><span class="op">);</span> <span class="co">// set bit 0</span></span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a>flags <span class="op">|=</span> <span class="op">(</span><span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">2</span><span class="op">);</span> <span class="co">// set bit 2</span></span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a>flags <span class="op">&amp;=</span> <span class="op">~(</span><span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">0</span><span class="op">);</span> <span class="co">// clear bit 0</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This approach is more portable and explicit, but less readable for large sets of flags.</p>
</section>
<section id="why-it-matters-32" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-32">Why It Matters</h4>
<p>Bitfields give you <strong>compact control</strong> over memory layout and binary representation. They’re critical in:</p>
<ul>
<li>Embedded firmware</li>
<li>Network stacks</li>
<li>Kernel drivers</li>
<li>Compression libraries</li>
</ul>
<p>They make your code expressive <em>and</em> efficient, as long as you understand alignment and portability issues.</p>
</section>
<section id="try-it-yourself-32" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-32">Try It Yourself</h4>
<ol type="1">
<li>Define a struct <code>Permissions</code> with 1-bit fields for <code>read</code>, <code>write</code>, and <code>execute</code>.</li>
<li>Print its size and check how compact it is.</li>
<li>Use a bitfield struct to represent a simplified TCP header (flags like SYN, ACK, FIN).</li>
<li>Use <code>#pragma pack(1)</code> and observe the size difference.</li>
<li>Write functions to set, clear, and toggle bits using bitwise operators.</li>
</ol>
<p>Bitfields are where C meets the hardware. They let you talk to the machine not just in bytes, but in <strong>bits</strong>, the true language of computers. Next, you’ll revisit enumerations and see how they complement these compact structures by giving symbolic meaning to values.</p>
</section>
</section>
<section id="enumerations-revisited" class="level3">
<h3 class="anchored" data-anchor-id="enumerations-revisited">35. Enumerations Revisited</h3>
<p>You’ve seen <code>enum</code> briefly when learning about constants, but now it’s time to use it as a <strong>first-class design tool</strong>. Enumerations give names to sets of integer values, making code easier to read, maintain, and debug. They also pair beautifully with <code>struct</code>, <code>union</code>, and <code>bitfield</code> patterns from the previous sections.</p>
<section id="what-is-an-enumeration" class="level4">
<h4 class="anchored" data-anchor-id="what-is-an-enumeration">What Is an Enumeration?</h4>
<p>An <strong>enumeration</strong> (<code>enum</code>) defines a type whose values are limited to a specific list of named constants.</p>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb291"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> Color <span class="op">{</span></span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a>    RED<span class="op">,</span></span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a>    GREEN<span class="op">,</span></span>
<span id="cb291-4"><a href="#cb291-4" aria-hidden="true" tabindex="-1"></a>    BLUE</span>
<span id="cb291-5"><a href="#cb291-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Under the hood, <code>enum Color</code> is an integer type — <code>RED</code> = 0, <code>GREEN</code> = 1, <code>BLUE</code> = 2 by default.</p>
</section>
<section id="basic-usage" class="level4">
<h4 class="anchored" data-anchor-id="basic-usage">Basic Usage</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb292"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> Direction <span class="op">{</span></span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>    NORTH<span class="op">,</span></span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a>    EAST<span class="op">,</span></span>
<span id="cb292-6"><a href="#cb292-6" aria-hidden="true" tabindex="-1"></a>    SOUTH<span class="op">,</span></span>
<span id="cb292-7"><a href="#cb292-7" aria-hidden="true" tabindex="-1"></a>    WEST</span>
<span id="cb292-8"><a href="#cb292-8" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb292-9"><a href="#cb292-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-10"><a href="#cb292-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb292-11"><a href="#cb292-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> Direction d <span class="op">=</span> EAST<span class="op">;</span></span>
<span id="cb292-12"><a href="#cb292-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Current direction: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> d<span class="op">);</span></span>
<span id="cb292-13"><a href="#cb292-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb292-14"><a href="#cb292-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Current direction: 1</code></pre>
<p>Even though <code>EAST</code> prints as <code>1</code>, using a named constant makes your code far more meaningful.</p>
</section>
<section id="assigning-custom-values" class="level4">
<h4 class="anchored" data-anchor-id="assigning-custom-values">Assigning Custom Values</h4>
<p>You can specify explicit integer values, useful for compatibility or mapping to real-world codes.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb294"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> ErrorCode <span class="op">{</span></span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a>    OK <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a>    FILE_NOT_FOUND <span class="op">=</span> <span class="dv">404</span><span class="op">,</span></span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a>    SERVER_ERROR <span class="op">=</span> <span class="dv">500</span></span>
<span id="cb294-5"><a href="#cb294-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If you skip a value, enumeration continues counting from the last number:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb295"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> Level <span class="op">{</span></span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>    LOW <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a>    MEDIUM<span class="op">,</span></span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a>    HIGH</span>
<span id="cb295-5"><a href="#cb295-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb295-6"><a href="#cb295-6" aria-hidden="true" tabindex="-1"></a><span class="co">// HIGH = 3</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="tiny-code-33" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-33">Tiny Code</h4>
<p>A small program that uses enums for clear program flow:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb296"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> Status <span class="op">{</span></span>
<span id="cb296-4"><a href="#cb296-4" aria-hidden="true" tabindex="-1"></a>    SUCCESS <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb296-5"><a href="#cb296-5" aria-hidden="true" tabindex="-1"></a>    WARNING <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb296-6"><a href="#cb296-6" aria-hidden="true" tabindex="-1"></a>    ERROR <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb296-7"><a href="#cb296-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb296-8"><a href="#cb296-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-9"><a href="#cb296-9" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">char</span><span class="op">*</span> status_to_string<span class="op">(</span><span class="kw">enum</span> Status s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb296-10"><a href="#cb296-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb296-11"><a href="#cb296-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> SUCCESS<span class="op">:</span> <span class="cf">return</span> <span class="st">"Success"</span><span class="op">;</span></span>
<span id="cb296-12"><a href="#cb296-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> WARNING<span class="op">:</span> <span class="cf">return</span> <span class="st">"Warning"</span><span class="op">;</span></span>
<span id="cb296-13"><a href="#cb296-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> ERROR<span class="op">:</span>   <span class="cf">return</span> <span class="st">"Error"</span><span class="op">;</span></span>
<span id="cb296-14"><a href="#cb296-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">default</span><span class="op">:</span>      <span class="cf">return</span> <span class="st">"Unknown"</span><span class="op">;</span></span>
<span id="cb296-15"><a href="#cb296-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb296-16"><a href="#cb296-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb296-17"><a href="#cb296-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-18"><a href="#cb296-18" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb296-19"><a href="#cb296-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> Status s <span class="op">=</span> WARNING<span class="op">;</span></span>
<span id="cb296-20"><a href="#cb296-20" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Status: </span><span class="sc">%s</span><span class="st"> (</span><span class="sc">%d</span><span class="st">)</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> status_to_string<span class="op">(</span>s<span class="op">),</span> s<span class="op">);</span></span>
<span id="cb296-21"><a href="#cb296-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb296-22"><a href="#cb296-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Status: Warning (1)</code></pre>
<p>This pattern, <code>enum</code> + <code>switch</code>, is everywhere in C projects: error handling, state machines, network protocols, and more.</p>
</section>
<section id="enumerations-with-structs" class="level4">
<h4 class="anchored" data-anchor-id="enumerations-with-structs">Enumerations with Structs</h4>
<p>Combine <code>enum</code> with <code>struct</code> for self-describing data:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb298"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> ShapeType <span class="op">{</span></span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a>    CIRCLE<span class="op">,</span></span>
<span id="cb298-5"><a href="#cb298-5" aria-hidden="true" tabindex="-1"></a>    RECTANGLE</span>
<span id="cb298-6"><a href="#cb298-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb298-7"><a href="#cb298-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-8"><a href="#cb298-8" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Shape <span class="op">{</span></span>
<span id="cb298-9"><a href="#cb298-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> ShapeType type<span class="op">;</span></span>
<span id="cb298-10"><a href="#cb298-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">union</span> <span class="op">{</span></span>
<span id="cb298-11"><a href="#cb298-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> <span class="op">{</span> <span class="dt">float</span> radius<span class="op">;</span> <span class="op">};</span></span>
<span id="cb298-12"><a href="#cb298-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> <span class="op">{</span> <span class="dt">float</span> width<span class="op">,</span> height<span class="op">;</span> <span class="op">};</span></span>
<span id="cb298-13"><a href="#cb298-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb298-14"><a href="#cb298-14" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb298-15"><a href="#cb298-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-16"><a href="#cb298-16" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_shape<span class="op">(</span><span class="kw">struct</span> Shape s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb298-17"><a href="#cb298-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>s<span class="op">.</span>type <span class="op">==</span> CIRCLE<span class="op">)</span></span>
<span id="cb298-18"><a href="#cb298-18" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Circle with radius </span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">.</span>radius<span class="op">);</span></span>
<span id="cb298-19"><a href="#cb298-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb298-20"><a href="#cb298-20" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Rectangle </span><span class="sc">%.2f</span><span class="st">x</span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">.</span>width<span class="op">,</span> s<span class="op">.</span>height<span class="op">);</span></span>
<span id="cb298-21"><a href="#cb298-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb298-22"><a href="#cb298-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-23"><a href="#cb298-23" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb298-24"><a href="#cb298-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Shape c <span class="op">=</span> <span class="op">{</span>CIRCLE<span class="op">,</span> <span class="op">.</span>radius <span class="op">=</span> <span class="fl">2.5</span><span class="bu">f</span><span class="op">};</span></span>
<span id="cb298-25"><a href="#cb298-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Shape r <span class="op">=</span> <span class="op">{</span>RECTANGLE<span class="op">,</span> <span class="op">.</span>width <span class="op">=</span> <span class="fl">3.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">.</span>height <span class="op">=</span> <span class="fl">4.0</span><span class="bu">f</span><span class="op">};</span></span>
<span id="cb298-26"><a href="#cb298-26" aria-hidden="true" tabindex="-1"></a>    print_shape<span class="op">(</span>c<span class="op">);</span></span>
<span id="cb298-27"><a href="#cb298-27" aria-hidden="true" tabindex="-1"></a>    print_shape<span class="op">(</span>r<span class="op">);</span></span>
<span id="cb298-28"><a href="#cb298-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb298-29"><a href="#cb298-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Circle with radius 2.50
Rectangle 3.00x4.00</code></pre>
<p>This pairing of <code>enum</code> + <code>union</code> is a common pattern in real-world systems, known as a <strong>tagged union</strong>.</p>
</section>
<section id="scoped-enums-in-modern-c-c23" class="level4">
<h4 class="anchored" data-anchor-id="scoped-enums-in-modern-c-c23">Scoped Enums in Modern C (C23)</h4>
<p>C23 introduces a cleaner way to scope enum names:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb300"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> class Mode <span class="op">{</span> READ<span class="op">,</span> WRITE<span class="op">,</span> APPEND <span class="op">};</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This avoids name collisions and allows better type checking — similar to <code>enum class</code> in C++. (Some compilers may not support this yet, but it’s worth knowing.)</p>
</section>
<section id="why-it-matters-33" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-33">Why It Matters</h4>
<p>Enumerations bring <strong>semantic clarity</strong> to your code:</p>
<ul>
<li>Replace “magic numbers” with meaningful names.</li>
<li>Simplify debugging and logging.</li>
<li>Enable compile-time checking, you can’t assign invalid constants easily.</li>
<li>Combine cleanly with structs, unions, and bitfields to express state machines or protocols.</li>
</ul>
<p>They also improve portability, your program logic is described by <strong>intent</strong>, not arbitrary numbers.</p>
</section>
<section id="try-it-yourself-33" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-33">Try It Yourself</h4>
<ol type="1">
<li>Define an enum <code>TrafficLight { RED, YELLOW, GREEN }</code> and print messages based on its value.</li>
<li>Create an enum <code>FileType { TEXT, BINARY, UNKNOWN }</code> and use it inside a <code>struct FileInfo</code>.</li>
<li>Extend your tagged-union pattern: add <code>TRIANGLE</code> to the <code>Shape</code> enum.</li>
<li>Write a <code>switch</code> statement that maps <code>enum ErrorCode</code> to error messages.</li>
<li>Experiment with explicitly setting values and skipping a few, observe the auto-increment behavior.</li>
</ol>
<p>Enumerations make your programs <em>speak in concepts, not numbers</em>. They are the key to clarity, readability, and robust design, the bridge between human meaning and machine representation.</p>
</section>
</section>
<section id="linked-lists-from-scratch" class="level3">
<h3 class="anchored" data-anchor-id="linked-lists-from-scratch">36. Linked Lists from Scratch</h3>
<p>Now that you understand how to group data with <code>struct</code>, it’s time to make it <strong>dynamic</strong>. A <strong>linked list</strong> is one of the most fundamental data structures in C, built entirely with pointers and structs. It teaches you how memory, pointers, and iteration really work.</p>
<section id="what-is-a-linked-list" class="level4">
<h4 class="anchored" data-anchor-id="what-is-a-linked-list">What Is a Linked List?</h4>
<p>A <strong>linked list</strong> is a collection of nodes, where each node stores:</p>
<ol type="1">
<li>Data (of any type you choose), and</li>
<li>A pointer to the next node.</li>
</ol>
<p>Unlike arrays, linked lists aren’t fixed in size, you can add or remove nodes anytime without reallocating large blocks of memory.</p>
</section>
<section id="basic-node-structure" class="level4">
<h4 class="anchored" data-anchor-id="basic-node-structure">Basic Node Structure</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb301"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> value<span class="op">;</span></span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>next<span class="op">;</span></span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This defines a “node” that holds an integer and a pointer to the next node in the list. If <code>next</code> is <code>NULL</code>, it’s the end of the list.</p>
</section>
<section id="creating-and-traversing-a-linked-list" class="level4">
<h4 class="anchored" data-anchor-id="creating-and-traversing-a-linked-list">Creating and Traversing a Linked List</h4>
<p>Let’s build a simple three-node list:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb302"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb302-5"><a href="#cb302-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> value<span class="op">;</span></span>
<span id="cb302-6"><a href="#cb302-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>next<span class="op">;</span></span>
<span id="cb302-7"><a href="#cb302-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb302-8"><a href="#cb302-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-9"><a href="#cb302-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb302-10"><a href="#cb302-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create three nodes dynamically</span></span>
<span id="cb302-11"><a href="#cb302-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>a <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="kw">struct</span> Node<span class="op">));</span></span>
<span id="cb302-12"><a href="#cb302-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>b <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="kw">struct</span> Node<span class="op">));</span></span>
<span id="cb302-13"><a href="#cb302-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>c <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="kw">struct</span> Node<span class="op">));</span></span>
<span id="cb302-14"><a href="#cb302-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-15"><a href="#cb302-15" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>value <span class="op">=</span> <span class="dv">10</span><span class="op">;</span> a<span class="op">-&gt;</span>next <span class="op">=</span> b<span class="op">;</span></span>
<span id="cb302-16"><a href="#cb302-16" aria-hidden="true" tabindex="-1"></a>    b<span class="op">-&gt;</span>value <span class="op">=</span> <span class="dv">20</span><span class="op">;</span> b<span class="op">-&gt;</span>next <span class="op">=</span> c<span class="op">;</span></span>
<span id="cb302-17"><a href="#cb302-17" aria-hidden="true" tabindex="-1"></a>    c<span class="op">-&gt;</span>value <span class="op">=</span> <span class="dv">30</span><span class="op">;</span> c<span class="op">-&gt;</span>next <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb302-18"><a href="#cb302-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-19"><a href="#cb302-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Traverse and print</span></span>
<span id="cb302-20"><a href="#cb302-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>current <span class="op">=</span> a<span class="op">;</span></span>
<span id="cb302-21"><a href="#cb302-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>current <span class="op">!=</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb302-22"><a href="#cb302-22" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> current<span class="op">-&gt;</span>value<span class="op">);</span></span>
<span id="cb302-23"><a href="#cb302-23" aria-hidden="true" tabindex="-1"></a>        current <span class="op">=</span> current<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb302-24"><a href="#cb302-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb302-25"><a href="#cb302-25" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb302-26"><a href="#cb302-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-27"><a href="#cb302-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Free memory</span></span>
<span id="cb302-28"><a href="#cb302-28" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>a<span class="op">);</span> free<span class="op">(</span>b<span class="op">);</span> free<span class="op">(</span>c<span class="op">);</span></span>
<span id="cb302-29"><a href="#cb302-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb302-30"><a href="#cb302-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>10 20 30</code></pre>
</section>
<section id="tiny-code-build-insert-delete" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-build-insert-delete">Tiny Code: Build, Insert, Delete</h4>
<p>Let’s make it reusable, define helper functions for common operations.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb304"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb304-3"><a href="#cb304-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-4"><a href="#cb304-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb304-5"><a href="#cb304-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> value<span class="op">;</span></span>
<span id="cb304-6"><a href="#cb304-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>next<span class="op">;</span></span>
<span id="cb304-7"><a href="#cb304-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb304-8"><a href="#cb304-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-9"><a href="#cb304-9" aria-hidden="true" tabindex="-1"></a>Node<span class="op">*</span> create_node<span class="op">(</span><span class="dt">int</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb304-10"><a href="#cb304-10" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>n <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb304-11"><a href="#cb304-11" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>value <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb304-12"><a href="#cb304-12" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>next <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb304-13"><a href="#cb304-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb304-14"><a href="#cb304-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb304-15"><a href="#cb304-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-16"><a href="#cb304-16" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> append<span class="op">(</span>Node <span class="op">**</span>head<span class="op">,</span> <span class="dt">int</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb304-17"><a href="#cb304-17" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>new_node <span class="op">=</span> create_node<span class="op">(</span>value<span class="op">);</span></span>
<span id="cb304-18"><a href="#cb304-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(*</span>head <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb304-19"><a href="#cb304-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>head <span class="op">=</span> new_node<span class="op">;</span></span>
<span id="cb304-20"><a href="#cb304-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb304-21"><a href="#cb304-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb304-22"><a href="#cb304-22" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>cur <span class="op">=</span> <span class="op">*</span>head<span class="op">;</span></span>
<span id="cb304-23"><a href="#cb304-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>cur<span class="op">-&gt;</span>next<span class="op">)</span> cur <span class="op">=</span> cur<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb304-24"><a href="#cb304-24" aria-hidden="true" tabindex="-1"></a>    cur<span class="op">-&gt;</span>next <span class="op">=</span> new_node<span class="op">;</span></span>
<span id="cb304-25"><a href="#cb304-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb304-26"><a href="#cb304-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-27"><a href="#cb304-27" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_list<span class="op">(</span><span class="dt">const</span> Node <span class="op">*</span>head<span class="op">)</span> <span class="op">{</span></span>
<span id="cb304-28"><a href="#cb304-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">const</span> Node <span class="op">*</span>p <span class="op">=</span> head<span class="op">;</span> p <span class="op">!=</span> NULL<span class="op">;</span> p <span class="op">=</span> p<span class="op">-&gt;</span>next<span class="op">)</span></span>
<span id="cb304-29"><a href="#cb304-29" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> -&gt; "</span><span class="op">,</span> p<span class="op">-&gt;</span>value<span class="op">);</span></span>
<span id="cb304-30"><a href="#cb304-30" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"NULL</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb304-31"><a href="#cb304-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb304-32"><a href="#cb304-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-33"><a href="#cb304-33" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> delete_list<span class="op">(</span>Node <span class="op">*</span>head<span class="op">)</span> <span class="op">{</span></span>
<span id="cb304-34"><a href="#cb304-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>head<span class="op">)</span> <span class="op">{</span></span>
<span id="cb304-35"><a href="#cb304-35" aria-hidden="true" tabindex="-1"></a>        Node <span class="op">*</span>next <span class="op">=</span> head<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb304-36"><a href="#cb304-36" aria-hidden="true" tabindex="-1"></a>        free<span class="op">(</span>head<span class="op">);</span></span>
<span id="cb304-37"><a href="#cb304-37" aria-hidden="true" tabindex="-1"></a>        head <span class="op">=</span> next<span class="op">;</span></span>
<span id="cb304-38"><a href="#cb304-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb304-39"><a href="#cb304-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb304-40"><a href="#cb304-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-41"><a href="#cb304-41" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb304-42"><a href="#cb304-42" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>head <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb304-43"><a href="#cb304-43" aria-hidden="true" tabindex="-1"></a>    append<span class="op">(&amp;</span>head<span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb304-44"><a href="#cb304-44" aria-hidden="true" tabindex="-1"></a>    append<span class="op">(&amp;</span>head<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb304-45"><a href="#cb304-45" aria-hidden="true" tabindex="-1"></a>    append<span class="op">(&amp;</span>head<span class="op">,</span> <span class="dv">15</span><span class="op">);</span></span>
<span id="cb304-46"><a href="#cb304-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-47"><a href="#cb304-47" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Linked list contents:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb304-48"><a href="#cb304-48" aria-hidden="true" tabindex="-1"></a>    print_list<span class="op">(</span>head<span class="op">);</span></span>
<span id="cb304-49"><a href="#cb304-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-50"><a href="#cb304-50" aria-hidden="true" tabindex="-1"></a>    delete_list<span class="op">(</span>head<span class="op">);</span></span>
<span id="cb304-51"><a href="#cb304-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb304-52"><a href="#cb304-52" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Linked list contents:
5 -&gt; 10 -&gt; 15 -&gt; NULL</code></pre>
</section>
<section id="why-use-linked-lists" class="level4">
<h4 class="anchored" data-anchor-id="why-use-linked-lists">Why Use Linked Lists?</h4>
<ul>
<li><strong>Dynamic size:</strong> Easily grow or shrink as needed.</li>
<li><strong>Efficient insertions and deletions:</strong> No need to shift elements as in arrays.</li>
<li><strong>Great for learning memory handling:</strong> You directly allocate and free each node.</li>
</ul>
<p>But they also have trade-offs:</p>
<ul>
<li>Slower random access (must traverse from the head).</li>
<li>Slightly higher memory usage due to pointer fields.</li>
</ul>
</section>
<section id="variants-youll-meet-later" class="level4">
<h4 class="anchored" data-anchor-id="variants-youll-meet-later">Variants You’ll Meet Later</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 34%">
<col style="width: 65%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Singly Linked List</strong></td>
<td>Each node points to the next one (like above).</td>
</tr>
<tr class="even">
<td><strong>Doubly Linked List</strong></td>
<td>Each node has <code>prev</code> and <code>next</code> pointers.</td>
</tr>
<tr class="odd">
<td><strong>Circular Linked List</strong></td>
<td>The last node links back to the first.</td>
</tr>
<tr class="even">
<td><strong>Sentinel List</strong></td>
<td>Uses dummy head/tail nodes to simplify logic.</td>
</tr>
</tbody>
</table>
</section>
<section id="why-it-matters-34" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-34">Why It Matters</h4>
<p>Linked lists are a window into <strong>manual memory management</strong>, you handle creation, traversal, and cleanup. They’re used in:</p>
<ul>
<li>Kernels (e.g., Linux <code>list_head</code>)</li>
<li>Compilers (symbol tables, token streams)</li>
<li>Dynamic containers (queues, allocators)</li>
</ul>
<p>You’re not just learning a data structure, you’re learning how to think in pointers.</p>
</section>
<section id="try-it-yourself-34" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-34">Try It Yourself</h4>
<ol type="1">
<li>Implement a function <code>int length(Node *head)</code> that counts the number of nodes.</li>
<li>Write <code>insert_front()</code> and <code>insert_after()</code> functions.</li>
<li>Implement a <code>find()</code> function that returns a pointer to a node with a given value.</li>
<li>Modify the <code>delete_list()</code> function to print which node is being freed.</li>
<li>Extend the struct to include a <code>char name[20]</code> and print both the name and value.</li>
</ol>
<p>You’ve now built one of the most essential dynamic structures in computer science, entirely from scratch. Next, you’ll build on this foundation to create <strong>stacks</strong> and <strong>queues</strong>, two of the most common and useful data abstractions in systems programming.</p>
</section>
</section>
<section id="stacks-and-queues-with-structs" class="level3">
<h3 class="anchored" data-anchor-id="stacks-and-queues-with-structs">37. Stacks and Queues with Structs</h3>
<p>You’ve learned how to build a <strong>linked list</strong>, now you’ll use that foundation to create two classic data structures: <strong>Stacks</strong> (LIFO, Last In, First Out) and <strong>Queues</strong> (FIFO, First In, First Out). Both are essential for real-world programs, from parsing expressions to managing tasks and kernel scheduling.</p>
<section id="the-stack" class="level4">
<h4 class="anchored" data-anchor-id="the-stack">1. The Stack</h4>
<p>A <strong>stack</strong> is like a pile of plates. You add to the top (<em>push</em>), and remove from the top (<em>pop</em>).</p>
<p>Operations:</p>
<ul>
<li><code>push(x)</code> → add an item to the top</li>
<li><code>pop()</code> → remove the top item</li>
<li><code>peek()</code> → look at the top item without removing it</li>
</ul>
</section>
<section id="stack-implementation-using-linked-list" class="level4">
<h4 class="anchored" data-anchor-id="stack-implementation-using-linked-list">Stack Implementation Using Linked List</h4>
<p>Each stack node holds data and a pointer to the next node.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb306"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb306-5"><a href="#cb306-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> value<span class="op">;</span></span>
<span id="cb306-6"><a href="#cb306-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>next<span class="op">;</span></span>
<span id="cb306-7"><a href="#cb306-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb306-8"><a href="#cb306-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-9"><a href="#cb306-9" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb306-10"><a href="#cb306-10" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>top<span class="op">;</span></span>
<span id="cb306-11"><a href="#cb306-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Stack<span class="op">;</span></span>
<span id="cb306-12"><a href="#cb306-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-13"><a href="#cb306-13" aria-hidden="true" tabindex="-1"></a>Stack<span class="op">*</span> create_stack<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb306-14"><a href="#cb306-14" aria-hidden="true" tabindex="-1"></a>    Stack <span class="op">*</span>s <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Stack<span class="op">));</span></span>
<span id="cb306-15"><a href="#cb306-15" aria-hidden="true" tabindex="-1"></a>    s<span class="op">-&gt;</span>top <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb306-16"><a href="#cb306-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s<span class="op">;</span></span>
<span id="cb306-17"><a href="#cb306-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb306-18"><a href="#cb306-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-19"><a href="#cb306-19" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> push<span class="op">(</span>Stack <span class="op">*</span>s<span class="op">,</span> <span class="dt">int</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb306-20"><a href="#cb306-20" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>n <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb306-21"><a href="#cb306-21" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>value <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb306-22"><a href="#cb306-22" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>next <span class="op">=</span> s<span class="op">-&gt;</span>top<span class="op">;</span></span>
<span id="cb306-23"><a href="#cb306-23" aria-hidden="true" tabindex="-1"></a>    s<span class="op">-&gt;</span>top <span class="op">=</span> n<span class="op">;</span></span>
<span id="cb306-24"><a href="#cb306-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb306-25"><a href="#cb306-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-26"><a href="#cb306-26" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> pop<span class="op">(</span>Stack <span class="op">*</span>s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb306-27"><a href="#cb306-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>s<span class="op">-&gt;</span>top<span class="op">)</span> <span class="op">{</span></span>
<span id="cb306-28"><a href="#cb306-28" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Stack underflow!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb306-29"><a href="#cb306-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb306-30"><a href="#cb306-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb306-31"><a href="#cb306-31" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>temp <span class="op">=</span> s<span class="op">-&gt;</span>top<span class="op">;</span></span>
<span id="cb306-32"><a href="#cb306-32" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> val <span class="op">=</span> temp<span class="op">-&gt;</span>value<span class="op">;</span></span>
<span id="cb306-33"><a href="#cb306-33" aria-hidden="true" tabindex="-1"></a>    s<span class="op">-&gt;</span>top <span class="op">=</span> temp<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb306-34"><a href="#cb306-34" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>temp<span class="op">);</span></span>
<span id="cb306-35"><a href="#cb306-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> val<span class="op">;</span></span>
<span id="cb306-36"><a href="#cb306-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb306-37"><a href="#cb306-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-38"><a href="#cb306-38" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> peek<span class="op">(</span><span class="dt">const</span> Stack <span class="op">*</span>s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb306-39"><a href="#cb306-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s<span class="op">-&gt;</span>top <span class="op">?</span> s<span class="op">-&gt;</span>top<span class="op">-&gt;</span>value <span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb306-40"><a href="#cb306-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb306-41"><a href="#cb306-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-42"><a href="#cb306-42" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> free_stack<span class="op">(</span>Stack <span class="op">*</span>s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb306-43"><a href="#cb306-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>s<span class="op">-&gt;</span>top<span class="op">)</span> pop<span class="op">(</span>s<span class="op">);</span></span>
<span id="cb306-44"><a href="#cb306-44" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>s<span class="op">);</span></span>
<span id="cb306-45"><a href="#cb306-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb306-46"><a href="#cb306-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-47"><a href="#cb306-47" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb306-48"><a href="#cb306-48" aria-hidden="true" tabindex="-1"></a>    Stack <span class="op">*</span>s <span class="op">=</span> create_stack<span class="op">();</span></span>
<span id="cb306-49"><a href="#cb306-49" aria-hidden="true" tabindex="-1"></a>    push<span class="op">(</span>s<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb306-50"><a href="#cb306-50" aria-hidden="true" tabindex="-1"></a>    push<span class="op">(</span>s<span class="op">,</span> <span class="dv">20</span><span class="op">);</span></span>
<span id="cb306-51"><a href="#cb306-51" aria-hidden="true" tabindex="-1"></a>    push<span class="op">(</span>s<span class="op">,</span> <span class="dv">30</span><span class="op">);</span></span>
<span id="cb306-52"><a href="#cb306-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-53"><a href="#cb306-53" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Top: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> peek<span class="op">(</span>s<span class="op">));</span></span>
<span id="cb306-54"><a href="#cb306-54" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Popped: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> pop<span class="op">(</span>s<span class="op">));</span></span>
<span id="cb306-55"><a href="#cb306-55" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Popped: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> pop<span class="op">(</span>s<span class="op">));</span></span>
<span id="cb306-56"><a href="#cb306-56" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Top now: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> peek<span class="op">(</span>s<span class="op">));</span></span>
<span id="cb306-57"><a href="#cb306-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-58"><a href="#cb306-58" aria-hidden="true" tabindex="-1"></a>    free_stack<span class="op">(</span>s<span class="op">);</span></span>
<span id="cb306-59"><a href="#cb306-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb306-60"><a href="#cb306-60" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Top: 30
Popped: 30
Popped: 20
Top now: 10</code></pre>
</section>
<section id="why-use-a-stack" class="level4">
<h4 class="anchored" data-anchor-id="why-use-a-stack">Why Use a Stack?</h4>
<p>Stacks are used in:</p>
<ul>
<li>Function calls (the <em>call stack</em>)</li>
<li>Undo/redo systems</li>
<li>Parsing expressions (e.g., evaluating <code>(2 + 3) * 4</code>)</li>
<li>Depth-first search (DFS) in graphs</li>
</ul>
</section>
<section id="the-queue" class="level4">
<h4 class="anchored" data-anchor-id="the-queue">2. The Queue</h4>
<p>A <strong>queue</strong> is like a line at a store. You add to the back (<em>enqueue</em>), and remove from the front (<em>dequeue</em>).</p>
<p>Operations:</p>
<ul>
<li><code>enqueue(x)</code> → add to the end</li>
<li><code>dequeue()</code> → remove from the front</li>
</ul>
</section>
<section id="queue-implementation-using-linked-list" class="level4">
<h4 class="anchored" data-anchor-id="queue-implementation-using-linked-list">Queue Implementation Using Linked List</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb308"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-4"><a href="#cb308-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb308-5"><a href="#cb308-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> value<span class="op">;</span></span>
<span id="cb308-6"><a href="#cb308-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>next<span class="op">;</span></span>
<span id="cb308-7"><a href="#cb308-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb308-8"><a href="#cb308-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-9"><a href="#cb308-9" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb308-10"><a href="#cb308-10" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>front<span class="op">;</span></span>
<span id="cb308-11"><a href="#cb308-11" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>rear<span class="op">;</span></span>
<span id="cb308-12"><a href="#cb308-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Queue<span class="op">;</span></span>
<span id="cb308-13"><a href="#cb308-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-14"><a href="#cb308-14" aria-hidden="true" tabindex="-1"></a>Queue<span class="op">*</span> create_queue<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb308-15"><a href="#cb308-15" aria-hidden="true" tabindex="-1"></a>    Queue <span class="op">*</span>q <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Queue<span class="op">));</span></span>
<span id="cb308-16"><a href="#cb308-16" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>front <span class="op">=</span> q<span class="op">-&gt;</span>rear <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb308-17"><a href="#cb308-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> q<span class="op">;</span></span>
<span id="cb308-18"><a href="#cb308-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb308-19"><a href="#cb308-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-20"><a href="#cb308-20" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> enqueue<span class="op">(</span>Queue <span class="op">*</span>q<span class="op">,</span> <span class="dt">int</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb308-21"><a href="#cb308-21" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>n <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb308-22"><a href="#cb308-22" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>value <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb308-23"><a href="#cb308-23" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>next <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb308-24"><a href="#cb308-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-25"><a href="#cb308-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>q<span class="op">-&gt;</span>rear <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb308-26"><a href="#cb308-26" aria-hidden="true" tabindex="-1"></a>        q<span class="op">-&gt;</span>front <span class="op">=</span> q<span class="op">-&gt;</span>rear <span class="op">=</span> n<span class="op">;</span></span>
<span id="cb308-27"><a href="#cb308-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb308-28"><a href="#cb308-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb308-29"><a href="#cb308-29" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>rear<span class="op">-&gt;</span>next <span class="op">=</span> n<span class="op">;</span></span>
<span id="cb308-30"><a href="#cb308-30" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>rear <span class="op">=</span> n<span class="op">;</span></span>
<span id="cb308-31"><a href="#cb308-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb308-32"><a href="#cb308-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-33"><a href="#cb308-33" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> dequeue<span class="op">(</span>Queue <span class="op">*</span>q<span class="op">)</span> <span class="op">{</span></span>
<span id="cb308-34"><a href="#cb308-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>q<span class="op">-&gt;</span>front <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb308-35"><a href="#cb308-35" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Queue underflow!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb308-36"><a href="#cb308-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb308-37"><a href="#cb308-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb308-38"><a href="#cb308-38" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>temp <span class="op">=</span> q<span class="op">-&gt;</span>front<span class="op">;</span></span>
<span id="cb308-39"><a href="#cb308-39" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> val <span class="op">=</span> temp<span class="op">-&gt;</span>value<span class="op">;</span></span>
<span id="cb308-40"><a href="#cb308-40" aria-hidden="true" tabindex="-1"></a>    q<span class="op">-&gt;</span>front <span class="op">=</span> temp<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb308-41"><a href="#cb308-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-42"><a href="#cb308-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>q<span class="op">-&gt;</span>front <span class="op">==</span> NULL<span class="op">)</span></span>
<span id="cb308-43"><a href="#cb308-43" aria-hidden="true" tabindex="-1"></a>        q<span class="op">-&gt;</span>rear <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb308-44"><a href="#cb308-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-45"><a href="#cb308-45" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>temp<span class="op">);</span></span>
<span id="cb308-46"><a href="#cb308-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> val<span class="op">;</span></span>
<span id="cb308-47"><a href="#cb308-47" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb308-48"><a href="#cb308-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-49"><a href="#cb308-49" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_queue<span class="op">(</span><span class="dt">const</span> Queue <span class="op">*</span>q<span class="op">)</span> <span class="op">{</span></span>
<span id="cb308-50"><a href="#cb308-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>Node <span class="op">*</span>p <span class="op">=</span> q<span class="op">-&gt;</span>front<span class="op">;</span> p <span class="op">!=</span> NULL<span class="op">;</span> p <span class="op">=</span> p<span class="op">-&gt;</span>next<span class="op">)</span></span>
<span id="cb308-51"><a href="#cb308-51" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> p<span class="op">-&gt;</span>value<span class="op">);</span></span>
<span id="cb308-52"><a href="#cb308-52" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb308-53"><a href="#cb308-53" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb308-54"><a href="#cb308-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-55"><a href="#cb308-55" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> free_queue<span class="op">(</span>Queue <span class="op">*</span>q<span class="op">)</span> <span class="op">{</span></span>
<span id="cb308-56"><a href="#cb308-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>q<span class="op">-&gt;</span>front<span class="op">)</span> dequeue<span class="op">(</span>q<span class="op">);</span></span>
<span id="cb308-57"><a href="#cb308-57" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>q<span class="op">);</span></span>
<span id="cb308-58"><a href="#cb308-58" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb308-59"><a href="#cb308-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-60"><a href="#cb308-60" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb308-61"><a href="#cb308-61" aria-hidden="true" tabindex="-1"></a>    Queue <span class="op">*</span>q <span class="op">=</span> create_queue<span class="op">();</span></span>
<span id="cb308-62"><a href="#cb308-62" aria-hidden="true" tabindex="-1"></a>    enqueue<span class="op">(</span>q<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb308-63"><a href="#cb308-63" aria-hidden="true" tabindex="-1"></a>    enqueue<span class="op">(</span>q<span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb308-64"><a href="#cb308-64" aria-hidden="true" tabindex="-1"></a>    enqueue<span class="op">(</span>q<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb308-65"><a href="#cb308-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-66"><a href="#cb308-66" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Queue: "</span><span class="op">);</span></span>
<span id="cb308-67"><a href="#cb308-67" aria-hidden="true" tabindex="-1"></a>    print_queue<span class="op">(</span>q<span class="op">);</span></span>
<span id="cb308-68"><a href="#cb308-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-69"><a href="#cb308-69" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Dequeued: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> dequeue<span class="op">(</span>q<span class="op">));</span></span>
<span id="cb308-70"><a href="#cb308-70" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Dequeued: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> dequeue<span class="op">(</span>q<span class="op">));</span></span>
<span id="cb308-71"><a href="#cb308-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-72"><a href="#cb308-72" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Remaining: "</span><span class="op">);</span></span>
<span id="cb308-73"><a href="#cb308-73" aria-hidden="true" tabindex="-1"></a>    print_queue<span class="op">(</span>q<span class="op">);</span></span>
<span id="cb308-74"><a href="#cb308-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-75"><a href="#cb308-75" aria-hidden="true" tabindex="-1"></a>    free_queue<span class="op">(</span>q<span class="op">);</span></span>
<span id="cb308-76"><a href="#cb308-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb308-77"><a href="#cb308-77" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Queue: 1 2 3 
Dequeued: 1
Dequeued: 2
Remaining: 3</code></pre>
</section>
<section id="stack-vs-queue-summary" class="level4">
<h4 class="anchored" data-anchor-id="stack-vs-queue-summary">Stack vs Queue Summary</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 43%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>Stack</th>
<th>Queue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Access Order</td>
<td>LIFO (Last In, First Out)</td>
<td>FIFO (First In, First Out)</td>
</tr>
<tr class="even">
<td>Main Operations</td>
<td>push / pop</td>
<td>enqueue / dequeue</td>
</tr>
<tr class="odd">
<td>Used For</td>
<td>Recursion, parsing, backtracking</td>
<td>Task scheduling, buffering</td>
</tr>
<tr class="even">
<td>Example</td>
<td>Undo system</td>
<td>Printer jobs</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-exercise-dual-queue-stack" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-exercise-dual-queue-stack">Tiny Code Exercise: Dual Queue-Stack</h4>
<p>Here’s a minimal snippet that lets you switch between stack and queue mode:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb310"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">enum</span> <span class="op">{</span> STACK_MODE<span class="op">,</span> QUEUE_MODE <span class="op">}</span> Mode<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You could use the same linked list logic but change whether new nodes are added at the head (stack) or tail (queue).</p>
</section>
<section id="why-it-matters-35" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-35">Why It Matters</h4>
<p>Stack and queue behavior underlie <strong>every major system abstraction</strong>:</p>
<ul>
<li>CPU scheduling</li>
<li>IO buffering</li>
<li>Event loops</li>
<li>Expression parsing</li>
<li>Recursive algorithms</li>
</ul>
<p>Building them in raw C solidifies your understanding of <strong>pointer-based data structures</strong> and <strong>memory ownership</strong>.</p>
</section>
<section id="try-it-yourself-35" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-35">Try It Yourself</h4>
<ol type="1">
<li>Implement <code>is_empty()</code> for both stack and queue.</li>
<li>Extend the queue to handle strings instead of ints.</li>
<li>Add a function <code>reverse_queue()</code> using a stack.</li>
<li>Implement a “bounded queue” that has a fixed maximum size.</li>
<li>Write a small program simulating customer arrivals using a queue.</li>
</ol>
<p>Stacks and queues are the <strong>control flow primitives of memory and time</strong>. Next, you’ll combine them with hashing and function pointers to build your own <strong>hash table</strong>, the basis for efficient lookups and symbol tables in C.</p>
</section>
</section>
<section id="hash-tables-and-function-pointers" class="level3">
<h3 class="anchored" data-anchor-id="hash-tables-and-function-pointers">38. Hash Tables and Function Pointers</h3>
<p>Hash tables are among the most important data structures in computing, fast, flexible, and foundational. They give you <strong>average O(1)</strong> lookup, insertion, and deletion by mapping <em>keys</em> to <em>values</em> through a hash function. In this section, you’ll build a simple hash table from scratch in C using <strong>structs</strong>, <strong>arrays</strong>, and <strong>function pointers</strong> for hash and comparison operations.</p>
<section id="what-is-a-hash-table" class="level4">
<h4 class="anchored" data-anchor-id="what-is-a-hash-table">What Is a Hash Table?</h4>
<p>A <strong>hash table</strong> stores data as key–value pairs. When you insert a key:</p>
<ol type="1">
<li>The <strong>hash function</strong> converts it into an integer index.</li>
<li>The data is stored in that slot of an array.</li>
<li>When you search later, the key is hashed again to find the same index.</li>
</ol>
<p>If multiple keys map to the same slot, that’s called a <strong>collision</strong>, handled by <em>chaining</em> (linked lists) or <em>open addressing</em>.</p>
</section>
<section id="simple-design" class="level4">
<h4 class="anchored" data-anchor-id="simple-design">Simple Design</h4>
<p>We’ll use <strong>chaining</strong>, each slot in the table is a linked list of key–value pairs that share the same hash.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb311"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Entry <span class="op">{</span></span>
<span id="cb311-2"><a href="#cb311-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>key<span class="op">;</span></span>
<span id="cb311-3"><a href="#cb311-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> value<span class="op">;</span></span>
<span id="cb311-4"><a href="#cb311-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Entry <span class="op">*</span>next<span class="op">;</span></span>
<span id="cb311-5"><a href="#cb311-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Entry<span class="op">;</span></span>
<span id="cb311-6"><a href="#cb311-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-7"><a href="#cb311-7" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb311-8"><a href="#cb311-8" aria-hidden="true" tabindex="-1"></a>    Entry <span class="op">**</span>buckets<span class="op">;</span> <span class="co">// array of linked lists</span></span>
<span id="cb311-9"><a href="#cb311-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> size<span class="op">;</span></span>
<span id="cb311-10"><a href="#cb311-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> HashTable<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="hash-function" class="level4">
<h4 class="anchored" data-anchor-id="hash-function">Hash Function</h4>
<p>A basic string hash function (the djb2 algorithm):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb312"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stddef.h&gt;</span></span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">long</span> hash_string<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>str<span class="op">)</span> <span class="op">{</span></span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> hash <span class="op">=</span> <span class="dv">5381</span><span class="op">;</span></span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> c<span class="op">;</span></span>
<span id="cb312-6"><a href="#cb312-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">((</span>c <span class="op">=</span> <span class="op">*</span>str<span class="op">++))</span></span>
<span id="cb312-7"><a href="#cb312-7" aria-hidden="true" tabindex="-1"></a>        hash <span class="op">=</span> <span class="op">((</span>hash <span class="op">&lt;&lt;</span> <span class="dv">5</span><span class="op">)</span> <span class="op">+</span> hash<span class="op">)</span> <span class="op">+</span> c<span class="op">;</span> <span class="co">// hash * 33 + c</span></span>
<span id="cb312-8"><a href="#cb312-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> hash<span class="op">;</span></span>
<span id="cb312-9"><a href="#cb312-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="tiny-code-hash-table-implementation" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-hash-table-implementation">Tiny Code: Hash Table Implementation</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb313"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb313-2"><a href="#cb313-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb313-3"><a href="#cb313-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb313-4"><a href="#cb313-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-5"><a href="#cb313-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Entry <span class="op">{</span></span>
<span id="cb313-6"><a href="#cb313-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>key<span class="op">;</span></span>
<span id="cb313-7"><a href="#cb313-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> value<span class="op">;</span></span>
<span id="cb313-8"><a href="#cb313-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Entry <span class="op">*</span>next<span class="op">;</span></span>
<span id="cb313-9"><a href="#cb313-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Entry<span class="op">;</span></span>
<span id="cb313-10"><a href="#cb313-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-11"><a href="#cb313-11" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb313-12"><a href="#cb313-12" aria-hidden="true" tabindex="-1"></a>    Entry <span class="op">**</span>buckets<span class="op">;</span></span>
<span id="cb313-13"><a href="#cb313-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> size<span class="op">;</span></span>
<span id="cb313-14"><a href="#cb313-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> HashTable<span class="op">;</span></span>
<span id="cb313-15"><a href="#cb313-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-16"><a href="#cb313-16" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">long</span> hash_string<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>str<span class="op">)</span> <span class="op">{</span></span>
<span id="cb313-17"><a href="#cb313-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> hash <span class="op">=</span> <span class="dv">5381</span><span class="op">;</span></span>
<span id="cb313-18"><a href="#cb313-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> c<span class="op">;</span></span>
<span id="cb313-19"><a href="#cb313-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">((</span>c <span class="op">=</span> <span class="op">*</span>str<span class="op">++))</span></span>
<span id="cb313-20"><a href="#cb313-20" aria-hidden="true" tabindex="-1"></a>        hash <span class="op">=</span> <span class="op">((</span>hash <span class="op">&lt;&lt;</span> <span class="dv">5</span><span class="op">)</span> <span class="op">+</span> hash<span class="op">)</span> <span class="op">+</span> c<span class="op">;</span></span>
<span id="cb313-21"><a href="#cb313-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> hash<span class="op">;</span></span>
<span id="cb313-22"><a href="#cb313-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb313-23"><a href="#cb313-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-24"><a href="#cb313-24" aria-hidden="true" tabindex="-1"></a>HashTable<span class="op">*</span> create_table<span class="op">(</span><span class="dt">size_t</span> size<span class="op">)</span> <span class="op">{</span></span>
<span id="cb313-25"><a href="#cb313-25" aria-hidden="true" tabindex="-1"></a>    HashTable <span class="op">*</span>t <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>HashTable<span class="op">));</span></span>
<span id="cb313-26"><a href="#cb313-26" aria-hidden="true" tabindex="-1"></a>    t<span class="op">-&gt;</span>size <span class="op">=</span> size<span class="op">;</span></span>
<span id="cb313-27"><a href="#cb313-27" aria-hidden="true" tabindex="-1"></a>    t<span class="op">-&gt;</span>buckets <span class="op">=</span> calloc<span class="op">(</span>size<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Entry<span class="op">*));</span></span>
<span id="cb313-28"><a href="#cb313-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> t<span class="op">;</span></span>
<span id="cb313-29"><a href="#cb313-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb313-30"><a href="#cb313-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-31"><a href="#cb313-31" aria-hidden="true" tabindex="-1"></a>Entry<span class="op">*</span> create_entry<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>key<span class="op">,</span> <span class="dt">int</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb313-32"><a href="#cb313-32" aria-hidden="true" tabindex="-1"></a>    Entry <span class="op">*</span>e <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Entry<span class="op">));</span></span>
<span id="cb313-33"><a href="#cb313-33" aria-hidden="true" tabindex="-1"></a>    e<span class="op">-&gt;</span>key <span class="op">=</span> strdup<span class="op">(</span>key<span class="op">);</span></span>
<span id="cb313-34"><a href="#cb313-34" aria-hidden="true" tabindex="-1"></a>    e<span class="op">-&gt;</span>value <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb313-35"><a href="#cb313-35" aria-hidden="true" tabindex="-1"></a>    e<span class="op">-&gt;</span>next <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb313-36"><a href="#cb313-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> e<span class="op">;</span></span>
<span id="cb313-37"><a href="#cb313-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb313-38"><a href="#cb313-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-39"><a href="#cb313-39" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> insert<span class="op">(</span>HashTable <span class="op">*</span>t<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>key<span class="op">,</span> <span class="dt">int</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb313-40"><a href="#cb313-40" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> index <span class="op">=</span> hash_string<span class="op">(</span>key<span class="op">)</span> <span class="op">%</span> t<span class="op">-&gt;</span>size<span class="op">;</span></span>
<span id="cb313-41"><a href="#cb313-41" aria-hidden="true" tabindex="-1"></a>    Entry <span class="op">*</span>new_entry <span class="op">=</span> create_entry<span class="op">(</span>key<span class="op">,</span> value<span class="op">);</span></span>
<span id="cb313-42"><a href="#cb313-42" aria-hidden="true" tabindex="-1"></a>    new_entry<span class="op">-&gt;</span>next <span class="op">=</span> t<span class="op">-&gt;</span>buckets<span class="op">[</span>index<span class="op">];</span></span>
<span id="cb313-43"><a href="#cb313-43" aria-hidden="true" tabindex="-1"></a>    t<span class="op">-&gt;</span>buckets<span class="op">[</span>index<span class="op">]</span> <span class="op">=</span> new_entry<span class="op">;</span></span>
<span id="cb313-44"><a href="#cb313-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb313-45"><a href="#cb313-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-46"><a href="#cb313-46" aria-hidden="true" tabindex="-1"></a>Entry<span class="op">*</span> search<span class="op">(</span>HashTable <span class="op">*</span>t<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>key<span class="op">)</span> <span class="op">{</span></span>
<span id="cb313-47"><a href="#cb313-47" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> index <span class="op">=</span> hash_string<span class="op">(</span>key<span class="op">)</span> <span class="op">%</span> t<span class="op">-&gt;</span>size<span class="op">;</span></span>
<span id="cb313-48"><a href="#cb313-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>Entry <span class="op">*</span>e <span class="op">=</span> t<span class="op">-&gt;</span>buckets<span class="op">[</span>index<span class="op">];</span> e<span class="op">;</span> e <span class="op">=</span> e<span class="op">-&gt;</span>next<span class="op">)</span></span>
<span id="cb313-49"><a href="#cb313-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>e<span class="op">-&gt;</span>key<span class="op">,</span> key<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb313-50"><a href="#cb313-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> e<span class="op">;</span></span>
<span id="cb313-51"><a href="#cb313-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb313-52"><a href="#cb313-52" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb313-53"><a href="#cb313-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-54"><a href="#cb313-54" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> free_table<span class="op">(</span>HashTable <span class="op">*</span>t<span class="op">)</span> <span class="op">{</span></span>
<span id="cb313-55"><a href="#cb313-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> t<span class="op">-&gt;</span>size<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb313-56"><a href="#cb313-56" aria-hidden="true" tabindex="-1"></a>        Entry <span class="op">*</span>e <span class="op">=</span> t<span class="op">-&gt;</span>buckets<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb313-57"><a href="#cb313-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span>e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb313-58"><a href="#cb313-58" aria-hidden="true" tabindex="-1"></a>            Entry <span class="op">*</span>next <span class="op">=</span> e<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb313-59"><a href="#cb313-59" aria-hidden="true" tabindex="-1"></a>            free<span class="op">(</span>e<span class="op">-&gt;</span>key<span class="op">);</span></span>
<span id="cb313-60"><a href="#cb313-60" aria-hidden="true" tabindex="-1"></a>            free<span class="op">(</span>e<span class="op">);</span></span>
<span id="cb313-61"><a href="#cb313-61" aria-hidden="true" tabindex="-1"></a>            e <span class="op">=</span> next<span class="op">;</span></span>
<span id="cb313-62"><a href="#cb313-62" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb313-63"><a href="#cb313-63" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb313-64"><a href="#cb313-64" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>t<span class="op">-&gt;</span>buckets<span class="op">);</span></span>
<span id="cb313-65"><a href="#cb313-65" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>t<span class="op">);</span></span>
<span id="cb313-66"><a href="#cb313-66" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb313-67"><a href="#cb313-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-68"><a href="#cb313-68" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb313-69"><a href="#cb313-69" aria-hidden="true" tabindex="-1"></a>    HashTable <span class="op">*</span>table <span class="op">=</span> create_table<span class="op">(</span><span class="dv">8</span><span class="op">);</span></span>
<span id="cb313-70"><a href="#cb313-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-71"><a href="#cb313-71" aria-hidden="true" tabindex="-1"></a>    insert<span class="op">(</span>table<span class="op">,</span> <span class="st">"apple"</span><span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb313-72"><a href="#cb313-72" aria-hidden="true" tabindex="-1"></a>    insert<span class="op">(</span>table<span class="op">,</span> <span class="st">"banana"</span><span class="op">,</span> <span class="dv">7</span><span class="op">);</span></span>
<span id="cb313-73"><a href="#cb313-73" aria-hidden="true" tabindex="-1"></a>    insert<span class="op">(</span>table<span class="op">,</span> <span class="st">"orange"</span><span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb313-74"><a href="#cb313-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-75"><a href="#cb313-75" aria-hidden="true" tabindex="-1"></a>    Entry <span class="op">*</span>result <span class="op">=</span> search<span class="op">(</span>table<span class="op">,</span> <span class="st">"banana"</span><span class="op">);</span></span>
<span id="cb313-76"><a href="#cb313-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>result<span class="op">)</span></span>
<span id="cb313-77"><a href="#cb313-77" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"banana = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> result<span class="op">-&gt;</span>value<span class="op">);</span></span>
<span id="cb313-78"><a href="#cb313-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb313-79"><a href="#cb313-79" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Key not found</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb313-80"><a href="#cb313-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-81"><a href="#cb313-81" aria-hidden="true" tabindex="-1"></a>    free_table<span class="op">(</span>table<span class="op">);</span></span>
<span id="cb313-82"><a href="#cb313-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb313-83"><a href="#cb313-83" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>banana = 7</code></pre>
</section>
<section id="using-function-pointers-for-genericity" class="level4">
<h4 class="anchored" data-anchor-id="using-function-pointers-for-genericity">Using Function Pointers for Genericity</h4>
<p>We can make the hash table generic by letting users provide custom hash and compare functions:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb315"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="op">(*</span>HashFunc<span class="op">)(</span><span class="dt">const</span> <span class="dt">void</span><span class="op">*);</span></span>
<span id="cb315-2"><a href="#cb315-2" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">int</span> <span class="op">(*</span>CompareFunc<span class="op">)(</span><span class="dt">const</span> <span class="dt">void</span><span class="op">*,</span> <span class="dt">const</span> <span class="dt">void</span><span class="op">*);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then we embed them in the struct:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb316"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a>    Entry <span class="op">**</span>buckets<span class="op">;</span></span>
<span id="cb316-3"><a href="#cb316-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> size<span class="op">;</span></span>
<span id="cb316-4"><a href="#cb316-4" aria-hidden="true" tabindex="-1"></a>    HashFunc hash<span class="op">;</span></span>
<span id="cb316-5"><a href="#cb316-5" aria-hidden="true" tabindex="-1"></a>    CompareFunc compare<span class="op">;</span></span>
<span id="cb316-6"><a href="#cb316-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> GenericTable<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This lets you reuse the same table for strings, integers, or structs, just provide the right hash and compare functions.</p>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb317"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">long</span> hash_int<span class="op">(</span><span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(*(</span><span class="dt">int</span><span class="op">*)</span>p<span class="op">)</span> <span class="op">*</span> <span class="dv">2654435761</span><span class="bu">u</span><span class="op">;</span></span>
<span id="cb317-3"><a href="#cb317-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-36" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-36">Why It Matters</h4>
<p>Hash tables power:</p>
<ul>
<li><strong>Compilers</strong> (symbol tables, variable scopes)</li>
<li><strong>Databases and caches</strong> (key-value stores)</li>
<li><strong>Operating systems</strong> (file descriptor maps, kernel objects)</li>
<li><strong>Network stacks</strong> (routing tables, ARP caches)</li>
</ul>
<p>They balance <strong>speed</strong>, <strong>simplicity</strong>, and <strong>control</strong>, the heart of efficient system design in C.</p>
</section>
<section id="common-pitfalls-2" class="level4">
<h4 class="anchored" data-anchor-id="common-pitfalls-2">Common Pitfalls</h4>
<ul>
<li>Forgetting to handle collisions (loses data).</li>
<li>Failing to free all nodes → memory leaks.</li>
<li>Using poor hash functions → clustering, performance drops.</li>
<li>Not resizing when full → reduced efficiency.</li>
</ul>
<p>A well-designed hash table grows dynamically (doubling capacity and rehashing when load exceeds a threshold).</p>
</section>
<section id="try-it-yourself-36" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-36">Try It Yourself</h4>
<ol type="1">
<li>Modify the table to <strong>update</strong> existing keys instead of always inserting new ones.</li>
<li>Implement a <strong>delete(key)</strong> function that removes an entry.</li>
<li>Write a version with <strong>integer keys</strong>.</li>
<li>Implement <strong>rehash()</strong> that doubles table size when 75% full.</li>
<li>Replace function pointers with macros for performance comparison.</li>
</ol>
<p>Hash tables are where C shows its full power: raw pointers, function indirection, and dynamic memory, all working together for blazing-fast lookups. Next, you’ll take these ideas further and explore how to simulate <strong>object-oriented design in C</strong> using structs, function pointers, and encapsulation.</p>
</section>
</section>
<section id="minimal-object-oriented-design-in-c" class="level3">
<h3 class="anchored" data-anchor-id="minimal-object-oriented-design-in-c">39. Minimal Object-Oriented Design in C</h3>
<p>C doesn’t have classes or inheritance, but it gives you <strong>structs</strong>, <strong>function pointers</strong>, and <strong>encapsulation through conventions</strong>. With these, you can build <em>object-oriented style</em> systems that are simple, fast, and explicit. You’ll learn how to design data structures that “own” both <strong>data and behavior</strong>, like lightweight objects.</p>
<section id="the-core-idea-1" class="level4">
<h4 class="anchored" data-anchor-id="the-core-idea-1">The Core Idea</h4>
<p>In object-oriented design, an object combines:</p>
<ul>
<li><strong>Data</strong> → the state</li>
<li><strong>Functions</strong> → the operations</li>
</ul>
<p>In C, you can achieve this by placing <strong>function pointers inside structs</strong>, and treating them as “methods.”</p>
</section>
<section id="a-simple-example-a-counter-object" class="level4">
<h4 class="anchored" data-anchor-id="a-simple-example-a-counter-object">A Simple Example: A Counter Object</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb318"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb318-3"><a href="#cb318-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-4"><a href="#cb318-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Counter Counter<span class="op">;</span> <span class="co">// forward declaration</span></span>
<span id="cb318-5"><a href="#cb318-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-6"><a href="#cb318-6" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Counter <span class="op">{</span></span>
<span id="cb318-7"><a href="#cb318-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> value<span class="op">;</span></span>
<span id="cb318-8"><a href="#cb318-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-9"><a href="#cb318-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// methods (function pointers)</span></span>
<span id="cb318-10"><a href="#cb318-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">(*</span>inc<span class="op">)(</span>Counter <span class="op">*</span>self<span class="op">);</span></span>
<span id="cb318-11"><a href="#cb318-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">(*</span>reset<span class="op">)(</span>Counter <span class="op">*</span>self<span class="op">);</span></span>
<span id="cb318-12"><a href="#cb318-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">(*</span>print<span class="op">)(</span><span class="dt">const</span> Counter <span class="op">*</span>self<span class="op">);</span></span>
<span id="cb318-13"><a href="#cb318-13" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb318-14"><a href="#cb318-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-15"><a href="#cb318-15" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> counter_inc<span class="op">(</span>Counter <span class="op">*</span>self<span class="op">)</span> <span class="op">{</span> self<span class="op">-&gt;</span>value<span class="op">++;</span> <span class="op">}</span></span>
<span id="cb318-16"><a href="#cb318-16" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> counter_reset<span class="op">(</span>Counter <span class="op">*</span>self<span class="op">)</span> <span class="op">{</span> self<span class="op">-&gt;</span>value <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb318-17"><a href="#cb318-17" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> counter_print<span class="op">(</span><span class="dt">const</span> Counter <span class="op">*</span>self<span class="op">)</span> <span class="op">{</span> printf<span class="op">(</span><span class="st">"Value: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> self<span class="op">-&gt;</span>value<span class="op">);</span> <span class="op">}</span></span>
<span id="cb318-18"><a href="#cb318-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-19"><a href="#cb318-19" aria-hidden="true" tabindex="-1"></a>Counter<span class="op">*</span> new_counter<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb318-20"><a href="#cb318-20" aria-hidden="true" tabindex="-1"></a>    Counter <span class="op">*</span>c <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Counter<span class="op">));</span></span>
<span id="cb318-21"><a href="#cb318-21" aria-hidden="true" tabindex="-1"></a>    c<span class="op">-&gt;</span>value <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb318-22"><a href="#cb318-22" aria-hidden="true" tabindex="-1"></a>    c<span class="op">-&gt;</span>inc <span class="op">=</span> counter_inc<span class="op">;</span></span>
<span id="cb318-23"><a href="#cb318-23" aria-hidden="true" tabindex="-1"></a>    c<span class="op">-&gt;</span>reset <span class="op">=</span> counter_reset<span class="op">;</span></span>
<span id="cb318-24"><a href="#cb318-24" aria-hidden="true" tabindex="-1"></a>    c<span class="op">-&gt;</span>print <span class="op">=</span> counter_print<span class="op">;</span></span>
<span id="cb318-25"><a href="#cb318-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> c<span class="op">;</span></span>
<span id="cb318-26"><a href="#cb318-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb318-27"><a href="#cb318-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-28"><a href="#cb318-28" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> free_counter<span class="op">(</span>Counter <span class="op">*</span>c<span class="op">)</span> <span class="op">{</span> free<span class="op">(</span>c<span class="op">);</span> <span class="op">}</span></span>
<span id="cb318-29"><a href="#cb318-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-30"><a href="#cb318-30" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb318-31"><a href="#cb318-31" aria-hidden="true" tabindex="-1"></a>    Counter <span class="op">*</span>c <span class="op">=</span> new_counter<span class="op">();</span></span>
<span id="cb318-32"><a href="#cb318-32" aria-hidden="true" tabindex="-1"></a>    c<span class="op">-&gt;</span>inc<span class="op">(</span>c<span class="op">);</span></span>
<span id="cb318-33"><a href="#cb318-33" aria-hidden="true" tabindex="-1"></a>    c<span class="op">-&gt;</span>inc<span class="op">(</span>c<span class="op">);</span></span>
<span id="cb318-34"><a href="#cb318-34" aria-hidden="true" tabindex="-1"></a>    c<span class="op">-&gt;</span>print<span class="op">(</span>c<span class="op">);</span></span>
<span id="cb318-35"><a href="#cb318-35" aria-hidden="true" tabindex="-1"></a>    c<span class="op">-&gt;</span>reset<span class="op">(</span>c<span class="op">);</span></span>
<span id="cb318-36"><a href="#cb318-36" aria-hidden="true" tabindex="-1"></a>    c<span class="op">-&gt;</span>print<span class="op">(</span>c<span class="op">);</span></span>
<span id="cb318-37"><a href="#cb318-37" aria-hidden="true" tabindex="-1"></a>    free_counter<span class="op">(</span>c<span class="op">);</span></span>
<span id="cb318-38"><a href="#cb318-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb318-39"><a href="#cb318-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Value: 2
Value: 0</code></pre>
<p>Here, <code>Counter</code> behaves like a small class: it stores both the <strong>state</strong> (<code>value</code>) and its <strong>methods</strong> (<code>inc</code>, <code>reset</code>, <code>print</code>).</p>
</section>
<section id="how-it-works-1" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-1">How It Works</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Concept (OOP)</th>
<th>Equivalent in C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Class</td>
<td><code>struct</code> definition</td>
</tr>
<tr class="even">
<td>Object</td>
<td>An instance (<code>malloc</code>ed struct)</td>
</tr>
<tr class="odd">
<td>Method</td>
<td>Function pointer</td>
</tr>
<tr class="even">
<td>Constructor</td>
<td><code>new_...()</code> function</td>
</tr>
<tr class="odd">
<td>Destructor</td>
<td><code>free_...()</code> function</td>
</tr>
<tr class="even">
<td>this</td>
<td>Pointer to the struct (<code>self</code>)</td>
</tr>
</tbody>
</table>
</section>
<section id="example-shape-interface-polymorphism" class="level4">
<h4 class="anchored" data-anchor-id="example-shape-interface-polymorphism">Example: Shape Interface (Polymorphism)</h4>
<p>You can simulate polymorphism, the ability to call the same function name on different types, using function pointers.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb320"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb320-3"><a href="#cb320-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;math.h&gt;</span></span>
<span id="cb320-4"><a href="#cb320-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-5"><a href="#cb320-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Shape Shape<span class="op">;</span></span>
<span id="cb320-6"><a href="#cb320-6" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Shape <span class="op">{</span></span>
<span id="cb320-7"><a href="#cb320-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> <span class="op">(*</span>area<span class="op">)(</span>Shape <span class="op">*</span>self<span class="op">);</span></span>
<span id="cb320-8"><a href="#cb320-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">(*</span>print<span class="op">)(</span>Shape <span class="op">*</span>self<span class="op">);</span></span>
<span id="cb320-9"><a href="#cb320-9" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb320-10"><a href="#cb320-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-11"><a href="#cb320-11" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb320-12"><a href="#cb320-12" aria-hidden="true" tabindex="-1"></a>    Shape base<span class="op">;</span></span>
<span id="cb320-13"><a href="#cb320-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> radius<span class="op">;</span></span>
<span id="cb320-14"><a href="#cb320-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Circle<span class="op">;</span></span>
<span id="cb320-15"><a href="#cb320-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-16"><a href="#cb320-16" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb320-17"><a href="#cb320-17" aria-hidden="true" tabindex="-1"></a>    Shape base<span class="op">;</span></span>
<span id="cb320-18"><a href="#cb320-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> width<span class="op">,</span> height<span class="op">;</span></span>
<span id="cb320-19"><a href="#cb320-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Rectangle<span class="op">;</span></span>
<span id="cb320-20"><a href="#cb320-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-21"><a href="#cb320-21" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> circle_area<span class="op">(</span>Shape <span class="op">*</span>s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb320-22"><a href="#cb320-22" aria-hidden="true" tabindex="-1"></a>    Circle <span class="op">*</span>c <span class="op">=</span> <span class="op">(</span>Circle<span class="op">*)</span>s<span class="op">;</span></span>
<span id="cb320-23"><a href="#cb320-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> M_PI <span class="op">*</span> c<span class="op">-&gt;</span>radius <span class="op">*</span> c<span class="op">-&gt;</span>radius<span class="op">;</span></span>
<span id="cb320-24"><a href="#cb320-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb320-25"><a href="#cb320-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-26"><a href="#cb320-26" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> circle_print<span class="op">(</span>Shape <span class="op">*</span>s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb320-27"><a href="#cb320-27" aria-hidden="true" tabindex="-1"></a>    Circle <span class="op">*</span>c <span class="op">=</span> <span class="op">(</span>Circle<span class="op">*)</span>s<span class="op">;</span></span>
<span id="cb320-28"><a href="#cb320-28" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Circle (r=</span><span class="sc">%.2f</span><span class="st">) area=</span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> c<span class="op">-&gt;</span>radius<span class="op">,</span> circle_area<span class="op">(</span>s<span class="op">));</span></span>
<span id="cb320-29"><a href="#cb320-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb320-30"><a href="#cb320-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-31"><a href="#cb320-31" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> rect_area<span class="op">(</span>Shape <span class="op">*</span>s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb320-32"><a href="#cb320-32" aria-hidden="true" tabindex="-1"></a>    Rectangle <span class="op">*</span>r <span class="op">=</span> <span class="op">(</span>Rectangle<span class="op">*)</span>s<span class="op">;</span></span>
<span id="cb320-33"><a href="#cb320-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r<span class="op">-&gt;</span>width <span class="op">*</span> r<span class="op">-&gt;</span>height<span class="op">;</span></span>
<span id="cb320-34"><a href="#cb320-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb320-35"><a href="#cb320-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-36"><a href="#cb320-36" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> rect_print<span class="op">(</span>Shape <span class="op">*</span>s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb320-37"><a href="#cb320-37" aria-hidden="true" tabindex="-1"></a>    Rectangle <span class="op">*</span>r <span class="op">=</span> <span class="op">(</span>Rectangle<span class="op">*)</span>s<span class="op">;</span></span>
<span id="cb320-38"><a href="#cb320-38" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Rectangle (</span><span class="sc">%.2f</span><span class="st">x</span><span class="sc">%.2f</span><span class="st">) area=</span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span></span>
<span id="cb320-39"><a href="#cb320-39" aria-hidden="true" tabindex="-1"></a>           r<span class="op">-&gt;</span>width<span class="op">,</span> r<span class="op">-&gt;</span>height<span class="op">,</span> rect_area<span class="op">(</span>s<span class="op">));</span></span>
<span id="cb320-40"><a href="#cb320-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb320-41"><a href="#cb320-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-42"><a href="#cb320-42" aria-hidden="true" tabindex="-1"></a>Shape<span class="op">*</span> new_circle<span class="op">(</span><span class="dt">double</span> r<span class="op">)</span> <span class="op">{</span></span>
<span id="cb320-43"><a href="#cb320-43" aria-hidden="true" tabindex="-1"></a>    Circle <span class="op">*</span>c <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Circle<span class="op">));</span></span>
<span id="cb320-44"><a href="#cb320-44" aria-hidden="true" tabindex="-1"></a>    c<span class="op">-&gt;</span>radius <span class="op">=</span> r<span class="op">;</span></span>
<span id="cb320-45"><a href="#cb320-45" aria-hidden="true" tabindex="-1"></a>    c<span class="op">-&gt;</span>base<span class="op">.</span>area <span class="op">=</span> circle_area<span class="op">;</span></span>
<span id="cb320-46"><a href="#cb320-46" aria-hidden="true" tabindex="-1"></a>    c<span class="op">-&gt;</span>base<span class="op">.</span>print <span class="op">=</span> circle_print<span class="op">;</span></span>
<span id="cb320-47"><a href="#cb320-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>Shape<span class="op">*)</span>c<span class="op">;</span></span>
<span id="cb320-48"><a href="#cb320-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb320-49"><a href="#cb320-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-50"><a href="#cb320-50" aria-hidden="true" tabindex="-1"></a>Shape<span class="op">*</span> new_rectangle<span class="op">(</span><span class="dt">double</span> w<span class="op">,</span> <span class="dt">double</span> h<span class="op">)</span> <span class="op">{</span></span>
<span id="cb320-51"><a href="#cb320-51" aria-hidden="true" tabindex="-1"></a>    Rectangle <span class="op">*</span>r <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Rectangle<span class="op">));</span></span>
<span id="cb320-52"><a href="#cb320-52" aria-hidden="true" tabindex="-1"></a>    r<span class="op">-&gt;</span>width <span class="op">=</span> w<span class="op">;</span></span>
<span id="cb320-53"><a href="#cb320-53" aria-hidden="true" tabindex="-1"></a>    r<span class="op">-&gt;</span>height <span class="op">=</span> h<span class="op">;</span></span>
<span id="cb320-54"><a href="#cb320-54" aria-hidden="true" tabindex="-1"></a>    r<span class="op">-&gt;</span>base<span class="op">.</span>area <span class="op">=</span> rect_area<span class="op">;</span></span>
<span id="cb320-55"><a href="#cb320-55" aria-hidden="true" tabindex="-1"></a>    r<span class="op">-&gt;</span>base<span class="op">.</span>print <span class="op">=</span> rect_print<span class="op">;</span></span>
<span id="cb320-56"><a href="#cb320-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>Shape<span class="op">*)</span>r<span class="op">;</span></span>
<span id="cb320-57"><a href="#cb320-57" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb320-58"><a href="#cb320-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-59"><a href="#cb320-59" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb320-60"><a href="#cb320-60" aria-hidden="true" tabindex="-1"></a>    Shape <span class="op">*</span>s1 <span class="op">=</span> new_circle<span class="op">(</span><span class="fl">2.5</span><span class="op">);</span></span>
<span id="cb320-61"><a href="#cb320-61" aria-hidden="true" tabindex="-1"></a>    Shape <span class="op">*</span>s2 <span class="op">=</span> new_rectangle<span class="op">(</span><span class="fl">3.0</span><span class="op">,</span> <span class="fl">4.0</span><span class="op">);</span></span>
<span id="cb320-62"><a href="#cb320-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-63"><a href="#cb320-63" aria-hidden="true" tabindex="-1"></a>    s1<span class="op">-&gt;</span>print<span class="op">(</span>s1<span class="op">);</span></span>
<span id="cb320-64"><a href="#cb320-64" aria-hidden="true" tabindex="-1"></a>    s2<span class="op">-&gt;</span>print<span class="op">(</span>s2<span class="op">);</span></span>
<span id="cb320-65"><a href="#cb320-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-66"><a href="#cb320-66" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>s1<span class="op">);</span></span>
<span id="cb320-67"><a href="#cb320-67" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>s2<span class="op">);</span></span>
<span id="cb320-68"><a href="#cb320-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb320-69"><a href="#cb320-69" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Circle (r=2.50) area=19.63
Rectangle (3.00x4.00) area=12.00</code></pre>
<p>Both shapes share the same “interface” (<code>area</code>, <code>print</code>) but behave differently, classic polymorphism.</p>
</section>
<section id="why-this-works" class="level4">
<h4 class="anchored" data-anchor-id="why-this-works">Why This Works</h4>
<p>Every “object” stores pointers to its <strong>methods</strong>, so you can call them without knowing the exact type. The first field (<code>base</code>) in derived structs allows casting between the parent (<code>Shape*</code>) and child (<code>Circle*</code>, <code>Rectangle*</code>). This mimics <em>inheritance by composition</em>.</p>
</section>
<section id="benefits" class="level4">
<h4 class="anchored" data-anchor-id="benefits">Benefits</h4>
<ul>
<li>Provides <strong>clear separation</strong> between interface and implementation.</li>
<li>Enables <strong>runtime dispatch</strong> (function behavior depends on type).</li>
<li>Keeps code modular, functions can operate on abstract “objects.”</li>
<li>Used in major C projects like the Linux kernel, GTK, and SQLite.</li>
</ul>
</section>
<section id="limitations-1" class="level4">
<h4 class="anchored" data-anchor-id="limitations-1">Limitations</h4>
<ul>
<li>No true type safety, casts can go wrong.</li>
<li>No automatic destructors or constructors (you must manage memory).</li>
<li>No inheritance syntax, everything is explicit.</li>
</ul>
<p>But these are also <em>strengths</em>: nothing is hidden, and everything is under your control.</p>
</section>
<section id="try-it-yourself-37" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-37">Try It Yourself</h4>
<ol type="1">
<li>Add a new shape: <code>Triangle</code> with base and height.</li>
<li>Write a function <code>print_all(Shape **arr, int n)</code> that prints all shapes in an array.</li>
<li>Add a <code>destroy(Shape *s)</code> method pointer and implement type-specific cleanup.</li>
<li>Extend the <code>Counter</code> struct with a <code>decrement</code> method.</li>
<li>Try designing a small “interface” for <code>Animal</code> → <code>Dog</code>, <code>Cat</code> with a <code>speak()</code> function.</li>
</ol>
<p>With structs and function pointers, C becomes a minimal but powerful <strong>object system</strong>. You now have everything needed to design reusable, modular code, without losing the clarity and efficiency that make C timeless.</p>
<p>Next, you’ll finish this chapter by putting all these ideas together: building a small, <strong>real-world system in C</strong>, your own <strong>Tiny Library System</strong>, with data structures, memory management, and modular design.</p>
</section>
</section>
<section id="practice-build-a-tiny-library-system" class="level3">
<h3 class="anchored" data-anchor-id="practice-build-a-tiny-library-system">40. Practice: Build a Tiny Library System</h3>
<p>You’ve now learned every building block, structs, pointers, dynamic memory, linked lists, enums, and even object-style design with function pointers. It’s time to combine them into a real mini-project: a <strong>Tiny Library System</strong>. This will be a full, runnable C program that manages books, authors, and borrowing records using everything you’ve learned so far.</p>
<section id="goal-1" class="level4">
<h4 class="anchored" data-anchor-id="goal-1">Goal</h4>
<p>Implement a minimal system that can:</p>
<ol type="1">
<li>Store book records dynamically</li>
<li>Add new books</li>
<li>Search books by title</li>
<li>Borrow and return books</li>
<li>Clean up all memory correctly</li>
</ol>
<p>We’ll use:</p>
<ul>
<li><code>struct</code> for data models</li>
<li><code>enum</code> for status tracking</li>
<li>linked lists for storage</li>
<li><code>typedef</code> and function pointers for clarity</li>
</ul>
</section>
<section id="data-structures" class="level4">
<h4 class="anchored" data-anchor-id="data-structures">Data Structures</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb322"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb322-3"><a href="#cb322-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb322-4"><a href="#cb322-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-5"><a href="#cb322-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">enum</span> <span class="op">{</span></span>
<span id="cb322-6"><a href="#cb322-6" aria-hidden="true" tabindex="-1"></a>    AVAILABLE<span class="op">,</span></span>
<span id="cb322-7"><a href="#cb322-7" aria-hidden="true" tabindex="-1"></a>    BORROWED</span>
<span id="cb322-8"><a href="#cb322-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> BookStatus<span class="op">;</span></span>
<span id="cb322-9"><a href="#cb322-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-10"><a href="#cb322-10" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Book <span class="op">{</span></span>
<span id="cb322-11"><a href="#cb322-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>title<span class="op">;</span></span>
<span id="cb322-12"><a href="#cb322-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>author<span class="op">;</span></span>
<span id="cb322-13"><a href="#cb322-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> year<span class="op">;</span></span>
<span id="cb322-14"><a href="#cb322-14" aria-hidden="true" tabindex="-1"></a>    BookStatus status<span class="op">;</span></span>
<span id="cb322-15"><a href="#cb322-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Book <span class="op">*</span>next<span class="op">;</span></span>
<span id="cb322-16"><a href="#cb322-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Book<span class="op">;</span></span>
<span id="cb322-17"><a href="#cb322-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-18"><a href="#cb322-18" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb322-19"><a href="#cb322-19" aria-hidden="true" tabindex="-1"></a>    Book <span class="op">*</span>head<span class="op">;</span></span>
<span id="cb322-20"><a href="#cb322-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Library<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Each book is one node in a linked list. The library owns the head pointer.</p>
</section>
<section id="core-functions" class="level4">
<h4 class="anchored" data-anchor-id="core-functions">Core Functions</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb323"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a>Book<span class="op">*</span> create_book<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>title<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>author<span class="op">,</span> <span class="dt">int</span> year<span class="op">)</span> <span class="op">{</span></span>
<span id="cb323-2"><a href="#cb323-2" aria-hidden="true" tabindex="-1"></a>    Book <span class="op">*</span>b <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Book<span class="op">));</span></span>
<span id="cb323-3"><a href="#cb323-3" aria-hidden="true" tabindex="-1"></a>    b<span class="op">-&gt;</span>title <span class="op">=</span> strdup<span class="op">(</span>title<span class="op">);</span></span>
<span id="cb323-4"><a href="#cb323-4" aria-hidden="true" tabindex="-1"></a>    b<span class="op">-&gt;</span>author <span class="op">=</span> strdup<span class="op">(</span>author<span class="op">);</span></span>
<span id="cb323-5"><a href="#cb323-5" aria-hidden="true" tabindex="-1"></a>    b<span class="op">-&gt;</span>year <span class="op">=</span> year<span class="op">;</span></span>
<span id="cb323-6"><a href="#cb323-6" aria-hidden="true" tabindex="-1"></a>    b<span class="op">-&gt;</span>status <span class="op">=</span> AVAILABLE<span class="op">;</span></span>
<span id="cb323-7"><a href="#cb323-7" aria-hidden="true" tabindex="-1"></a>    b<span class="op">-&gt;</span>next <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb323-8"><a href="#cb323-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> b<span class="op">;</span></span>
<span id="cb323-9"><a href="#cb323-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb323-10"><a href="#cb323-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-11"><a href="#cb323-11" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> add_book<span class="op">(</span>Library <span class="op">*</span>lib<span class="op">,</span> Book <span class="op">*</span>b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb323-12"><a href="#cb323-12" aria-hidden="true" tabindex="-1"></a>    b<span class="op">-&gt;</span>next <span class="op">=</span> lib<span class="op">-&gt;</span>head<span class="op">;</span></span>
<span id="cb323-13"><a href="#cb323-13" aria-hidden="true" tabindex="-1"></a>    lib<span class="op">-&gt;</span>head <span class="op">=</span> b<span class="op">;</span></span>
<span id="cb323-14"><a href="#cb323-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb323-15"><a href="#cb323-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-16"><a href="#cb323-16" aria-hidden="true" tabindex="-1"></a>Book<span class="op">*</span> find_book<span class="op">(</span>Library <span class="op">*</span>lib<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>title<span class="op">)</span> <span class="op">{</span></span>
<span id="cb323-17"><a href="#cb323-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>Book <span class="op">*</span>cur <span class="op">=</span> lib<span class="op">-&gt;</span>head<span class="op">;</span> cur <span class="op">!=</span> NULL<span class="op">;</span> cur <span class="op">=</span> cur<span class="op">-&gt;</span>next<span class="op">)</span></span>
<span id="cb323-18"><a href="#cb323-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>cur<span class="op">-&gt;</span>title<span class="op">,</span> title<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb323-19"><a href="#cb323-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> cur<span class="op">;</span></span>
<span id="cb323-20"><a href="#cb323-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb323-21"><a href="#cb323-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb323-22"><a href="#cb323-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-23"><a href="#cb323-23" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> borrow_book<span class="op">(</span>Library <span class="op">*</span>lib<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>title<span class="op">)</span> <span class="op">{</span></span>
<span id="cb323-24"><a href="#cb323-24" aria-hidden="true" tabindex="-1"></a>    Book <span class="op">*</span>b <span class="op">=</span> find_book<span class="op">(</span>lib<span class="op">,</span> title<span class="op">);</span></span>
<span id="cb323-25"><a href="#cb323-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb323-26"><a href="#cb323-26" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Book not found: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> title<span class="op">);</span></span>
<span id="cb323-27"><a href="#cb323-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb323-28"><a href="#cb323-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb323-29"><a href="#cb323-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>b<span class="op">-&gt;</span>status <span class="op">==</span> BORROWED<span class="op">)</span></span>
<span id="cb323-30"><a href="#cb323-30" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Book already borrowed: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> b<span class="op">-&gt;</span>title<span class="op">);</span></span>
<span id="cb323-31"><a href="#cb323-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb323-32"><a href="#cb323-32" aria-hidden="true" tabindex="-1"></a>        b<span class="op">-&gt;</span>status <span class="op">=</span> BORROWED<span class="op">;</span></span>
<span id="cb323-33"><a href="#cb323-33" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"You borrowed: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> b<span class="op">-&gt;</span>title<span class="op">);</span></span>
<span id="cb323-34"><a href="#cb323-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb323-35"><a href="#cb323-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb323-36"><a href="#cb323-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-37"><a href="#cb323-37" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> return_book<span class="op">(</span>Library <span class="op">*</span>lib<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>title<span class="op">)</span> <span class="op">{</span></span>
<span id="cb323-38"><a href="#cb323-38" aria-hidden="true" tabindex="-1"></a>    Book <span class="op">*</span>b <span class="op">=</span> find_book<span class="op">(</span>lib<span class="op">,</span> title<span class="op">);</span></span>
<span id="cb323-39"><a href="#cb323-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb323-40"><a href="#cb323-40" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Book not found: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> title<span class="op">);</span></span>
<span id="cb323-41"><a href="#cb323-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb323-42"><a href="#cb323-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb323-43"><a href="#cb323-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>b<span class="op">-&gt;</span>status <span class="op">==</span> AVAILABLE<span class="op">)</span></span>
<span id="cb323-44"><a href="#cb323-44" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Book already returned: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> b<span class="op">-&gt;</span>title<span class="op">);</span></span>
<span id="cb323-45"><a href="#cb323-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb323-46"><a href="#cb323-46" aria-hidden="true" tabindex="-1"></a>        b<span class="op">-&gt;</span>status <span class="op">=</span> AVAILABLE<span class="op">;</span></span>
<span id="cb323-47"><a href="#cb323-47" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"You returned: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> b<span class="op">-&gt;</span>title<span class="op">);</span></span>
<span id="cb323-48"><a href="#cb323-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb323-49"><a href="#cb323-49" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb323-50"><a href="#cb323-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-51"><a href="#cb323-51" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> list_books<span class="op">(</span><span class="dt">const</span> Library <span class="op">*</span>lib<span class="op">)</span> <span class="op">{</span></span>
<span id="cb323-52"><a href="#cb323-52" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">--- Library Catalog ---</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb323-53"><a href="#cb323-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">const</span> Book <span class="op">*</span>b <span class="op">=</span> lib<span class="op">-&gt;</span>head<span class="op">;</span> b <span class="op">!=</span> NULL<span class="op">;</span> b <span class="op">=</span> b<span class="op">-&gt;</span>next<span class="op">)</span></span>
<span id="cb323-54"><a href="#cb323-54" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%-20s</span><span class="st"> | </span><span class="sc">%-15s</span><span class="st"> | </span><span class="sc">%d</span><span class="st"> | </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span></span>
<span id="cb323-55"><a href="#cb323-55" aria-hidden="true" tabindex="-1"></a>               b<span class="op">-&gt;</span>title<span class="op">,</span> b<span class="op">-&gt;</span>author<span class="op">,</span> b<span class="op">-&gt;</span>year<span class="op">,</span></span>
<span id="cb323-56"><a href="#cb323-56" aria-hidden="true" tabindex="-1"></a>               b<span class="op">-&gt;</span>status <span class="op">==</span> AVAILABLE <span class="op">?</span> <span class="st">"Available"</span> <span class="op">:</span> <span class="st">"Borrowed"</span><span class="op">);</span></span>
<span id="cb323-57"><a href="#cb323-57" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"------------------------</span><span class="sc">\n\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb323-58"><a href="#cb323-58" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb323-59"><a href="#cb323-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-60"><a href="#cb323-60" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> free_library<span class="op">(</span>Library <span class="op">*</span>lib<span class="op">)</span> <span class="op">{</span></span>
<span id="cb323-61"><a href="#cb323-61" aria-hidden="true" tabindex="-1"></a>    Book <span class="op">*</span>cur <span class="op">=</span> lib<span class="op">-&gt;</span>head<span class="op">;</span></span>
<span id="cb323-62"><a href="#cb323-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>cur<span class="op">)</span> <span class="op">{</span></span>
<span id="cb323-63"><a href="#cb323-63" aria-hidden="true" tabindex="-1"></a>        Book <span class="op">*</span>next <span class="op">=</span> cur<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb323-64"><a href="#cb323-64" aria-hidden="true" tabindex="-1"></a>        free<span class="op">(</span>cur<span class="op">-&gt;</span>title<span class="op">);</span></span>
<span id="cb323-65"><a href="#cb323-65" aria-hidden="true" tabindex="-1"></a>        free<span class="op">(</span>cur<span class="op">-&gt;</span>author<span class="op">);</span></span>
<span id="cb323-66"><a href="#cb323-66" aria-hidden="true" tabindex="-1"></a>        free<span class="op">(</span>cur<span class="op">);</span></span>
<span id="cb323-67"><a href="#cb323-67" aria-hidden="true" tabindex="-1"></a>        cur <span class="op">=</span> next<span class="op">;</span></span>
<span id="cb323-68"><a href="#cb323-68" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb323-69"><a href="#cb323-69" aria-hidden="true" tabindex="-1"></a>    lib<span class="op">-&gt;</span>head <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb323-70"><a href="#cb323-70" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="tiny-code-full-program" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-full-program">Tiny Code, Full Program</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb324"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a>    Library lib <span class="op">=</span> <span class="op">{</span>NULL<span class="op">};</span></span>
<span id="cb324-3"><a href="#cb324-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-4"><a href="#cb324-4" aria-hidden="true" tabindex="-1"></a>    add_book<span class="op">(&amp;</span>lib<span class="op">,</span> create_book<span class="op">(</span><span class="st">"The C Programming Language"</span><span class="op">,</span> <span class="st">"Kernighan &amp; Ritchie"</span><span class="op">,</span> <span class="dv">1988</span><span class="op">));</span></span>
<span id="cb324-5"><a href="#cb324-5" aria-hidden="true" tabindex="-1"></a>    add_book<span class="op">(&amp;</span>lib<span class="op">,</span> create_book<span class="op">(</span><span class="st">"Clean Code"</span><span class="op">,</span> <span class="st">"Robert C. Martin"</span><span class="op">,</span> <span class="dv">2008</span><span class="op">));</span></span>
<span id="cb324-6"><a href="#cb324-6" aria-hidden="true" tabindex="-1"></a>    add_book<span class="op">(&amp;</span>lib<span class="op">,</span> create_book<span class="op">(</span><span class="st">"Algorithms in C"</span><span class="op">,</span> <span class="st">"Sedgewick"</span><span class="op">,</span> <span class="dv">1998</span><span class="op">));</span></span>
<span id="cb324-7"><a href="#cb324-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-8"><a href="#cb324-8" aria-hidden="true" tabindex="-1"></a>    list_books<span class="op">(&amp;</span>lib<span class="op">);</span></span>
<span id="cb324-9"><a href="#cb324-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-10"><a href="#cb324-10" aria-hidden="true" tabindex="-1"></a>    borrow_book<span class="op">(&amp;</span>lib<span class="op">,</span> <span class="st">"Clean Code"</span><span class="op">);</span></span>
<span id="cb324-11"><a href="#cb324-11" aria-hidden="true" tabindex="-1"></a>    borrow_book<span class="op">(&amp;</span>lib<span class="op">,</span> <span class="st">"Clean Code"</span><span class="op">);</span>  <span class="co">// test duplicate borrow</span></span>
<span id="cb324-12"><a href="#cb324-12" aria-hidden="true" tabindex="-1"></a>    return_book<span class="op">(&amp;</span>lib<span class="op">,</span> <span class="st">"Clean Code"</span><span class="op">);</span></span>
<span id="cb324-13"><a href="#cb324-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-14"><a href="#cb324-14" aria-hidden="true" tabindex="-1"></a>    borrow_book<span class="op">(&amp;</span>lib<span class="op">,</span> <span class="st">"Algorithms in C"</span><span class="op">);</span></span>
<span id="cb324-15"><a href="#cb324-15" aria-hidden="true" tabindex="-1"></a>    list_books<span class="op">(&amp;</span>lib<span class="op">);</span></span>
<span id="cb324-16"><a href="#cb324-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-17"><a href="#cb324-17" aria-hidden="true" tabindex="-1"></a>    free_library<span class="op">(&amp;</span>lib<span class="op">);</span></span>
<span id="cb324-18"><a href="#cb324-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb324-19"><a href="#cb324-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb325"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> library_system.c <span class="at">-o</span> library_system</span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./library_system</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>--- Library Catalog ---
Algorithms in C      | Sedgewick       | 1998 | Available
Clean Code           | Robert C. Martin | 2008 | Available
The C Programming Language | Kernighan &amp; Ritchie | 1988 | Available
------------------------

You borrowed: Clean Code
Book already borrowed: Clean Code
You returned: Clean Code
You borrowed: Algorithms in C

--- Library Catalog ---
Algorithms in C      | Sedgewick       | 1998 | Borrowed
Clean Code           | Robert C. Martin | 2008 | Available
The C Programming Language | Kernighan &amp; Ritchie | 1988 | Available
------------------------</code></pre>
</section>
<section id="what-you-just-practiced" class="level4">
<h4 class="anchored" data-anchor-id="what-you-just-practiced">What You Just Practiced</h4>
<p>You’ve combined everything from this chapter:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Concept</th>
<th>How You Used It</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Structs</strong></td>
<td>For <code>Book</code> and <code>Library</code> models</td>
</tr>
<tr class="even">
<td><strong>Enums</strong></td>
<td>For <code>BookStatus</code></td>
</tr>
<tr class="odd">
<td><strong>Dynamic memory</strong></td>
<td><code>malloc</code>, <code>free</code>, <code>strdup</code></td>
</tr>
<tr class="even">
<td><strong>Linked lists</strong></td>
<td>Dynamic collection of books</td>
</tr>
<tr class="odd">
<td><strong>Pointers</strong></td>
<td>Passing references between functions</td>
</tr>
<tr class="even">
<td><strong>Encapsulation</strong></td>
<td>Each function hides internal details</td>
</tr>
</tbody>
</table>
</section>
<section id="why-it-matters-37" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-37">Why It Matters</h4>
<p>This “tiny library” is a microcosm of systems programming: you’re managing memory, defining abstractions, and building a dynamic system with clear data ownership. From here, you can scale to databases, caches, or in-memory key-value stores, all built on the same principles.</p>
</section>
<section id="try-it-yourself-38" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-38">Try It Yourself</h4>
<ol type="1">
<li>Add <code>id</code> and <code>genre</code> fields to <code>Book</code>.</li>
<li>Implement <code>remove_book(title)</code> to delete a node safely.</li>
<li>Add a command interface (read from stdin) for interactive use.</li>
<li>Save and load the library to a file using <code>fwrite</code> and <code>fread</code>.</li>
<li>Write a function to count how many books are borrowed vs available.</li>
</ol>
<p>You’ve completed <strong>Chapter 4: Structuring Data</strong>, the heart of understanding how C organizes the world. Next, you’ll move from in-memory structures to <strong>input, output, and files</strong>, learning how to interact with the outside world through the standard I/O library in Chapter 5.</p>
</section>
</section>
</section>
<section id="chapter-5.-input-output-and-files" class="level1">
<h1>Chapter 5. Input, Output and Files</h1>
<section id="standard-io-and-printfscanf" class="level3">
<h3 class="anchored" data-anchor-id="standard-io-and-printfscanf">41. Standard I/O and printf/scanf</h3>
<p>Input and output are how your programs talk to the outside world. In C, almost everything goes through the <strong>Standard I/O library</strong>, defined in <code>&lt;stdio.h&gt;</code>. You’ve already met <code>printf()</code> in “Hello, C World”, now you’ll learn how all these functions fit together, how they work, and how to use them safely.</p>
<section id="the-standard-streams" class="level4">
<h4 class="anchored" data-anchor-id="the-standard-streams">The Standard Streams</h4>
<p>Every C program starts with <strong>three standard streams</strong> automatically open:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 60%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th>Stream</th>
<th>Purpose</th>
<th>Example Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>stdin</code></td>
<td>Standard input (keyboard, or redirected file)</td>
<td><code>scanf()</code>, <code>fgets()</code></td>
</tr>
<tr class="even">
<td><code>stdout</code></td>
<td>Standard output (screen)</td>
<td><code>printf()</code>, <code>puts()</code></td>
</tr>
<tr class="odd">
<td><code>stderr</code></td>
<td>Standard error (screen, for diagnostics)</td>
<td><code>fprintf(stderr, ...)</code></td>
</tr>
</tbody>
</table>
<p>You can redirect these streams in the terminal:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb327"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./program</span> <span class="op">&lt;</span> input.txt <span class="op">&gt;</span> output.txt <span class="dv">2</span><span class="op">&gt;</span> errors.log</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="printing-with-printf" class="level4">
<h4 class="anchored" data-anchor-id="printing-with-printf">Printing with printf()</h4>
<p><code>printf()</code> formats and prints data to <code>stdout</code>. Its power lies in <strong>format specifiers</strong>, which describe the type and layout of what to print.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Format</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>int</td>
<td><code>%d</code></td>
<td><code>printf("%d", 42);</code></td>
</tr>
<tr class="even">
<td>float</td>
<td><code>%f</code></td>
<td><code>printf("%.2f", 3.1415);</code></td>
</tr>
<tr class="odd">
<td>char</td>
<td><code>%c</code></td>
<td><code>printf("%c", 'A');</code></td>
</tr>
<tr class="even">
<td>string</td>
<td><code>%s</code></td>
<td><code>printf("%s", "Hello");</code></td>
</tr>
<tr class="odd">
<td>pointer</td>
<td><code>%p</code></td>
<td><code>printf("%p", ptr);</code></td>
</tr>
<tr class="even">
<td>hexadecimal</td>
<td><code>%x</code></td>
<td><code>printf("%x", 255);</code></td>
</tr>
</tbody>
</table>
<p>You can control width, precision, and alignment:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb328"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%-10s</span><span class="st"> | </span><span class="sc">%6.2f\n</span><span class="st">"</span><span class="op">,</span> <span class="st">"Price"</span><span class="op">,</span> <span class="fl">3.5</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Price      |   3.50</code></pre>
</section>
<section id="tiny-code-print-everything" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-print-everything">Tiny Code: Print Everything</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb330"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb330-3"><a href="#cb330-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb330-4"><a href="#cb330-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i <span class="op">=</span> <span class="dv">42</span><span class="op">;</span></span>
<span id="cb330-5"><a href="#cb330-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> f <span class="op">=</span> <span class="fl">3.1415</span><span class="op">;</span></span>
<span id="cb330-6"><a href="#cb330-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> c <span class="op">=</span> <span class="ch">'C'</span><span class="op">;</span></span>
<span id="cb330-7"><a href="#cb330-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"Hello, C!"</span><span class="op">;</span></span>
<span id="cb330-8"><a href="#cb330-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb330-9"><a href="#cb330-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Integer: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb330-10"><a href="#cb330-10" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Float: </span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> f<span class="op">);</span></span>
<span id="cb330-11"><a href="#cb330-11" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Char: </span><span class="sc">%c\n</span><span class="st">"</span><span class="op">,</span> c<span class="op">);</span></span>
<span id="cb330-12"><a href="#cb330-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"String: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">);</span></span>
<span id="cb330-13"><a href="#cb330-13" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Pointer: </span><span class="sc">%p\n</span><span class="st">"</span><span class="op">,</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span>s<span class="op">);</span></span>
<span id="cb330-14"><a href="#cb330-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb330-15"><a href="#cb330-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Integer: 42
Float: 3.14
Char: C
String: Hello, C!
Pointer: 0x7ffeed001234</code></pre>
</section>
<section id="reading-with-scanf" class="level4">
<h4 class="anchored" data-anchor-id="reading-with-scanf">Reading with scanf()</h4>
<p><code>scanf()</code> reads formatted input from <code>stdin</code>. It’s like <code>printf()</code> in reverse, you tell it the format, and it fills your variables.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb332"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> height<span class="op">;</span></span>
<span id="cb332-3"><a href="#cb332-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Enter age and height: "</span><span class="op">);</span></span>
<span id="cb332-4"><a href="#cb332-4" aria-hidden="true" tabindex="-1"></a>scanf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%f</span><span class="st">"</span><span class="op">,</span> <span class="op">&amp;</span>age<span class="op">,</span> <span class="op">&amp;</span>height<span class="op">);</span></span>
<span id="cb332-5"><a href="#cb332-5" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"You are </span><span class="sc">%d</span><span class="st"> years old and </span><span class="sc">%.1f</span><span class="st"> meters tall.</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> age<span class="op">,</span> height<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Input:</p>
<pre><code>25 1.75</code></pre>
<p>Output:</p>
<pre><code>You are 25 years old and 1.8 meters tall.</code></pre>
<blockquote class="blockquote">
<p><strong>Always use the <code>&amp;</code> operator</strong> for non-array variables — it passes the memory address where the value should be stored.</p>
</blockquote>
</section>
<section id="safer-input-fgets-and-sscanf" class="level4">
<h4 class="anchored" data-anchor-id="safer-input-fgets-and-sscanf">Safer Input: fgets() and sscanf()</h4>
<p><code>scanf()</code> is risky for strings, it doesn’t prevent buffer overflow. Safer pattern: use <code>fgets()</code> to read a full line, then parse it.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb335"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> buf<span class="op">[</span><span class="dv">100</span><span class="op">];</span></span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Enter your name: "</span><span class="op">);</span></span>
<span id="cb335-3"><a href="#cb335-3" aria-hidden="true" tabindex="-1"></a>fgets<span class="op">(</span>buf<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buf<span class="op">),</span> stdin<span class="op">);</span></span>
<span id="cb335-4"><a href="#cb335-4" aria-hidden="true" tabindex="-1"></a>buf<span class="op">[</span>strcspn<span class="op">(</span>buf<span class="op">,</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">)]</span> <span class="op">=</span> <span class="ch">'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">;</span> <span class="co">// remove newline</span></span>
<span id="cb335-5"><a href="#cb335-5" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Hello, </span><span class="sc">%s</span><span class="st">!</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> buf<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="combining-printf-and-scanf" class="level4">
<h4 class="anchored" data-anchor-id="combining-printf-and-scanf">Combining printf and scanf</h4>
<p>You can build interactive console tools easily:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb336"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-3"><a href="#cb336-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb336-4"><a href="#cb336-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">50</span><span class="op">];</span></span>
<span id="cb336-5"><a href="#cb336-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> year<span class="op">;</span></span>
<span id="cb336-6"><a href="#cb336-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-7"><a href="#cb336-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Enter your name: "</span><span class="op">);</span></span>
<span id="cb336-8"><a href="#cb336-8" aria-hidden="true" tabindex="-1"></a>    scanf<span class="op">(</span><span class="st">"</span><span class="sc">%49s</span><span class="st">"</span><span class="op">,</span> name<span class="op">);</span> <span class="co">// limit input to 49 chars + null</span></span>
<span id="cb336-9"><a href="#cb336-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Enter your birth year: "</span><span class="op">);</span></span>
<span id="cb336-10"><a href="#cb336-10" aria-hidden="true" tabindex="-1"></a>    scanf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">"</span><span class="op">,</span> <span class="op">&amp;</span>year<span class="op">);</span></span>
<span id="cb336-11"><a href="#cb336-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-12"><a href="#cb336-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hi </span><span class="sc">%s</span><span class="st">! You are about </span><span class="sc">%d</span><span class="st"> years old.</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> name<span class="op">,</span> <span class="dv">2025</span> <span class="op">-</span> year<span class="op">);</span></span>
<span id="cb336-13"><a href="#cb336-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb336-14"><a href="#cb336-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Enter your name: Alice
Enter your birth year: 2000
Hi Alice! You are about 25 years old.</code></pre>
</section>
<section id="formatted-output-to-files-and-strings" class="level4">
<h4 class="anchored" data-anchor-id="formatted-output-to-files-and-strings">Formatted Output to Files and Strings</h4>
<p>You can redirect formatted output anywhere, not just the screen.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb338"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a>fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Error: invalid input.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span> <span class="co">// print to stderr</span></span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> buffer<span class="op">[</span><span class="dv">50</span><span class="op">];</span></span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true" tabindex="-1"></a>sprintf<span class="op">(</span>buffer<span class="op">,</span> <span class="st">"Pi = </span><span class="sc">%.3f</span><span class="st">"</span><span class="op">,</span> <span class="fl">3.14159</span><span class="op">);</span> <span class="co">// print to string</span></span>
<span id="cb338-5"><a href="#cb338-5" aria-hidden="true" tabindex="-1"></a>puts<span class="op">(</span>buffer<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Pi = 3.142</code></pre>
</section>
<section id="why-it-matters-38" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-38">Why It Matters</h4>
<p><code>printf()</code> and <code>scanf()</code> are the <strong>workhorses of console I/O</strong>. They teach you:</p>
<ul>
<li>How data moves between memory and streams.</li>
<li>How to control numeric precision and layout.</li>
<li>How input and output interact with the terminal or files.</li>
</ul>
<p>Every C system, from tiny microcontrollers to full operating systems, uses these same foundations.</p>
</section>
<section id="try-it-yourself-39" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-39">Try It Yourself</h4>
<ol type="1">
<li>Print a table of numbers with two columns: number and its square.</li>
<li>Read three integers using <code>scanf</code> and print their average.</li>
<li>Use <code>fgets</code> and <code>sscanf</code> to safely parse <code>"42 3.14"</code> into int and float.</li>
<li>Write a small quiz app: ask a question, read input, print “Correct” or “Try again”.</li>
<li>Experiment with printing to <code>stderr</code>, redirect errors to a file.</li>
</ol>
<p>Mastering standard I/O is like mastering your program’s <strong>voice</strong>, it’s how your C code speaks and listens. Next, you’ll move deeper into file handling, learning how to open, read, and write files with file pointers in Section 42.</p>
</section>
</section>
<section id="file-pointers-and-fopen-fclose" class="level3">
<h3 class="anchored" data-anchor-id="file-pointers-and-fopen-fclose">42. File Pointers and <code>fopen</code> / <code>fclose</code></h3>
<p>Files let your C programs remember things beyond runtime. Unlike standard input and output, which disappear when the program ends, files provide <strong>persistent storage</strong>, you can read and write data between runs.</p>
<p>This section introduces the key file-handling API in C: <code>fopen()</code>, <code>fclose()</code>, <code>fprintf()</code>, <code>fscanf()</code>, and their relatives.</p>
<section id="the-big-picture-1" class="level4">
<h4 class="anchored" data-anchor-id="the-big-picture-1">The Big Picture</h4>
<p>File I/O in C uses a <code>FILE *</code> pointer to represent an open file. You don’t manipulate the disk directly, instead, you read and write through a buffered file stream managed by the runtime.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb340"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"data.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This returns a pointer to a <code>FILE</code> object if successful, or <code>NULL</code> if the file can’t be opened.</p>
</section>
<section id="file-modes" class="level4">
<h4 class="anchored" data-anchor-id="file-modes">File Modes</h4>
<p>When opening a file, you specify a <strong>mode</strong>, what you intend to do with it.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Mode</th>
<th>Meaning</th>
<th>Behavior</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>"r"</code></td>
<td>read</td>
<td>Fails if file doesn’t exist</td>
</tr>
<tr class="even">
<td><code>"w"</code></td>
<td>write</td>
<td>Creates new or truncates existing</td>
</tr>
<tr class="odd">
<td><code>"a"</code></td>
<td>append</td>
<td>Opens or creates; writes go to end</td>
</tr>
<tr class="even">
<td><code>"r+"</code></td>
<td>read/write</td>
<td>Must exist</td>
</tr>
<tr class="odd">
<td><code>"w+"</code></td>
<td>read/write</td>
<td>Truncates if exists</td>
</tr>
<tr class="even">
<td><code>"a+"</code></td>
<td>read/write</td>
<td>Appends; reading starts at beginning</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-write-and-read-a-file" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-write-and-read-a-file">Tiny Code: Write and Read a File</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb341"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb341-2"><a href="#cb341-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-3"><a href="#cb341-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb341-4"><a href="#cb341-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"example.txt"</span><span class="op">,</span> <span class="st">"w"</span><span class="op">);</span></span>
<span id="cb341-5"><a href="#cb341-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="op">{</span></span>
<span id="cb341-6"><a href="#cb341-6" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"Failed to open file"</span><span class="op">);</span></span>
<span id="cb341-7"><a href="#cb341-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb341-8"><a href="#cb341-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb341-9"><a href="#cb341-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-10"><a href="#cb341-10" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>fp<span class="op">,</span> <span class="st">"Hello, file world!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb341-11"><a href="#cb341-11" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>fp<span class="op">,</span> <span class="st">"C makes you closer to the machine.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb341-12"><a href="#cb341-12" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb341-13"><a href="#cb341-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-14"><a href="#cb341-14" aria-hidden="true" tabindex="-1"></a>    fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"example.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb341-15"><a href="#cb341-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="op">{</span></span>
<span id="cb341-16"><a href="#cb341-16" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"Failed to reopen file"</span><span class="op">);</span></span>
<span id="cb341-17"><a href="#cb341-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb341-18"><a href="#cb341-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb341-19"><a href="#cb341-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-20"><a href="#cb341-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> line<span class="op">[</span><span class="dv">100</span><span class="op">];</span></span>
<span id="cb341-21"><a href="#cb341-21" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"--- File Content ---</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb341-22"><a href="#cb341-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>fgets<span class="op">(</span>line<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>line<span class="op">),</span> fp<span class="op">))</span></span>
<span id="cb341-23"><a href="#cb341-23" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> line<span class="op">);</span></span>
<span id="cb341-24"><a href="#cb341-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-25"><a href="#cb341-25" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb341-26"><a href="#cb341-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb341-27"><a href="#cb341-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>--- File Content ---
Hello, file world!
C makes you closer to the machine.</code></pre>
</section>
<section id="how-it-works-2" class="level4">
<h4 class="anchored" data-anchor-id="how-it-works-2">How It Works</h4>
<ol type="1">
<li><code>fopen()</code> creates a connection to a file.</li>
<li><code>fprintf()</code> writes formatted text, just like <code>printf()</code> but to a file stream.</li>
<li><code>fclose()</code> flushes buffers and closes the file.</li>
<li>Reopen with <code>"r"</code> mode to read what you wrote.</li>
</ol>
<p>You can also mix with <code>fscanf()</code> to read formatted data.</p>
</section>
<section id="checking-for-errors" class="level4">
<h4 class="anchored" data-anchor-id="checking-for-errors">Checking for Errors</h4>
<p>Always check file operations for errors. Use <code>if (!fp)</code> after <code>fopen()</code>, and use <code>perror()</code> to print the reason.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb343"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> <span class="op">*</span>f <span class="op">=</span> fopen<span class="op">(</span><span class="st">"missing.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb343-2"><a href="#cb343-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span>f<span class="op">)</span> <span class="op">{</span></span>
<span id="cb343-3"><a href="#cb343-3" aria-hidden="true" tabindex="-1"></a>    perror<span class="op">(</span><span class="st">"Error opening file"</span><span class="op">);</span></span>
<span id="cb343-4"><a href="#cb343-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example output:</p>
<pre><code>Error opening file: No such file or directory</code></pre>
</section>
<section id="reading-formatted-data-with-fscanf" class="level4">
<h4 class="anchored" data-anchor-id="reading-formatted-data-with-fscanf">Reading Formatted Data with <code>fscanf</code></h4>
<p>You can parse text files using <code>fscanf()</code>, just like <code>scanf()</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb345"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb345-2"><a href="#cb345-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-3"><a href="#cb345-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb345-4"><a href="#cb345-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"numbers.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb345-5"><a href="#cb345-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb345-6"><a href="#cb345-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-7"><a href="#cb345-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a<span class="op">,</span> b<span class="op">;</span></span>
<span id="cb345-8"><a href="#cb345-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>fscanf<span class="op">(</span>fp<span class="op">,</span> <span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st">"</span><span class="op">,</span> <span class="op">&amp;</span>a<span class="op">,</span> <span class="op">&amp;</span>b<span class="op">)</span> <span class="op">==</span> <span class="dv">2</span><span class="op">)</span></span>
<span id="cb345-9"><a href="#cb345-9" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> + </span><span class="sc">%d</span><span class="st"> = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">,</span> b<span class="op">,</span> a <span class="op">+</span> b<span class="op">);</span></span>
<span id="cb345-10"><a href="#cb345-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-11"><a href="#cb345-11" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb345-12"><a href="#cb345-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb345-13"><a href="#cb345-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If <code>numbers.txt</code> contains:</p>
<pre><code>2 3
10 15
7 9</code></pre>
<p>Output:</p>
<pre><code>2 + 3 = 5
10 + 15 = 25
7 + 9 = 16</code></pre>
</section>
<section id="file-position-and-rewinding" class="level4">
<h4 class="anchored" data-anchor-id="file-position-and-rewinding">File Position and Rewinding</h4>
<p>You can move around a file using:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb348"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a>fseek<span class="op">(</span>fp<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> SEEK_SET<span class="op">);</span>  <span class="co">// go to beginning</span></span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true" tabindex="-1"></a>fseek<span class="op">(</span>fp<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> SEEK_END<span class="op">);</span>  <span class="co">// go to end</span></span>
<span id="cb348-3"><a href="#cb348-3" aria-hidden="true" tabindex="-1"></a>rewind<span class="op">(</span>fp<span class="op">);</span>              <span class="co">// reset to start</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>To know where you are:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb349"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> pos <span class="op">=</span> ftell<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb349-2"><a href="#cb349-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Current position: </span><span class="sc">%ld\n</span><span class="st">"</span><span class="op">,</span> pos<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="writing-binary-data" class="level4">
<h4 class="anchored" data-anchor-id="writing-binary-data">Writing Binary Data</h4>
<p>Text files are human-readable; binary files store raw bytes. You’ll use <code>fwrite()</code> and <code>fread()</code> for that (covered more in the next section).</p>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb350"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> numbers<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">};</span></span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a>fwrite<span class="op">(</span>numbers<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">),</span> <span class="dv">4</span><span class="op">,</span> fp<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-39" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-39">Why It Matters</h4>
<p>File I/O is the bridge between your C program and the real world:</p>
<ul>
<li>Configuration and log files</li>
<li>Database storage</li>
<li>Caches and serialization</li>
<li>Operating system utilities (copy, move, grep, etc.)</li>
</ul>
<p>It teaches <strong>resource management</strong>, always <code>fopen()</code> and <code>fclose()</code> in pairs, check errors, and handle failures gracefully.</p>
</section>
<section id="try-it-yourself-40" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-40">Try It Yourself</h4>
<ol type="1">
<li>Write a program that asks for your name and saves it to <code>user.txt</code>.</li>
<li>Append a timestamp each time the program runs.</li>
<li>Read all lines and count how many times your program has been executed.</li>
<li>Modify the example to reverse all lines read from a file.</li>
<li>Handle missing files gracefully using <code>perror()</code>.</li>
</ol>
<p>You now know how to open, read, and write text files safely. Next, you’ll go deeper into <strong>binary files</strong>, where data moves in raw bytes, perfect for storing structs and arrays efficiently.</p>
</section>
</section>
<section id="reading-and-writing-binary-files" class="level3">
<h3 class="anchored" data-anchor-id="reading-and-writing-binary-files">43. Reading and Writing Binary Files</h3>
<p>Text files are easy to read but not always efficient. Binary files, on the other hand, store raw bytes exactly as they exist in memory, no formatting, no conversions. They’re ideal for saving arrays, structs, or any data that must be written and read back quickly without loss or rounding.</p>
<section id="text-vs-binary" class="level4">
<h4 class="anchored" data-anchor-id="text-vs-binary">Text vs Binary</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 11%">
<col style="width: 38%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Aspect</th>
<th>Text File</th>
<th>Binary File</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Format</td>
<td>Human-readable (ASCII)</td>
<td>Raw bytes</td>
</tr>
<tr class="even">
<td>Size</td>
<td>Larger (extra characters, newlines)</td>
<td>Smaller (compact form)</td>
</tr>
<tr class="odd">
<td>Read/Write</td>
<td><code>fprintf</code>, <code>fscanf</code>, <code>fgets</code></td>
<td><code>fwrite</code>, <code>fread</code></td>
</tr>
<tr class="even">
<td>Use Case</td>
<td>Logs, config, reports</td>
<td>Structs, images, executables, serialized data</td>
</tr>
</tbody>
</table>
<p>When you open a file for binary I/O, add <strong><code>b</code></strong> to the mode:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb351"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"data.bin"</span><span class="op">,</span> <span class="st">"wb"</span><span class="op">);</span> <span class="co">// write binary</span></span>
<span id="cb351-2"><a href="#cb351-2" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"data.bin"</span><span class="op">,</span> <span class="st">"rb"</span><span class="op">);</span> <span class="co">// read binary</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="writing-binary-data-1" class="level4">
<h4 class="anchored" data-anchor-id="writing-binary-data-1">Writing Binary Data</h4>
<p>Let’s write an array of integers directly to disk.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb352"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb352-2"><a href="#cb352-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-3"><a href="#cb352-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb352-4"><a href="#cb352-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> numbers<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">40</span><span class="op">,</span> <span class="dv">50</span><span class="op">};</span></span>
<span id="cb352-5"><a href="#cb352-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> count <span class="op">=</span> <span class="kw">sizeof</span><span class="op">(</span>numbers<span class="op">)</span> <span class="op">/</span> <span class="kw">sizeof</span><span class="op">(</span>numbers<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb352-6"><a href="#cb352-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-7"><a href="#cb352-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"numbers.bin"</span><span class="op">,</span> <span class="st">"wb"</span><span class="op">);</span></span>
<span id="cb352-8"><a href="#cb352-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="op">{</span></span>
<span id="cb352-9"><a href="#cb352-9" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"Failed to open file"</span><span class="op">);</span></span>
<span id="cb352-10"><a href="#cb352-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb352-11"><a href="#cb352-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb352-12"><a href="#cb352-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-13"><a href="#cb352-13" aria-hidden="true" tabindex="-1"></a>    fwrite<span class="op">(</span>numbers<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">),</span> count<span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb352-14"><a href="#cb352-14" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb352-15"><a href="#cb352-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-16"><a href="#cb352-16" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Wrote </span><span class="sc">%zu</span><span class="st"> integers to numbers.bin</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> count<span class="op">);</span></span>
<span id="cb352-17"><a href="#cb352-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb352-18"><a href="#cb352-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This writes 5 integers (4 bytes each on most systems) directly to disk as raw bytes, no text conversion.</p>
</section>
<section id="reading-binary-data" class="level4">
<h4 class="anchored" data-anchor-id="reading-binary-data">Reading Binary Data</h4>
<p>Now let’s read them back:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb353"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb353-2"><a href="#cb353-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-3"><a href="#cb353-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb353-4"><a href="#cb353-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> numbers<span class="op">[</span><span class="dv">5</span><span class="op">];</span></span>
<span id="cb353-5"><a href="#cb353-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"numbers.bin"</span><span class="op">,</span> <span class="st">"rb"</span><span class="op">);</span></span>
<span id="cb353-6"><a href="#cb353-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="op">{</span></span>
<span id="cb353-7"><a href="#cb353-7" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"Failed to open file"</span><span class="op">);</span></span>
<span id="cb353-8"><a href="#cb353-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb353-9"><a href="#cb353-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb353-10"><a href="#cb353-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-11"><a href="#cb353-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> n <span class="op">=</span> fread<span class="op">(</span>numbers<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">),</span> <span class="dv">5</span><span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb353-12"><a href="#cb353-12" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb353-13"><a href="#cb353-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-14"><a href="#cb353-14" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Read </span><span class="sc">%zu</span><span class="st"> integers:</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> n<span class="op">);</span></span>
<span id="cb353-15"><a href="#cb353-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb353-16"><a href="#cb353-16" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> numbers<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb353-17"><a href="#cb353-17" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb353-18"><a href="#cb353-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-19"><a href="#cb353-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb353-20"><a href="#cb353-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Wrote 5 integers to numbers.bin
Read 5 integers:
10 20 30 40 50</code></pre>
</section>
<section id="writing-and-reading-structs" class="level4">
<h4 class="anchored" data-anchor-id="writing-and-reading-structs">Writing and Reading Structs</h4>
<p>You can store whole structures directly using the same pattern.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb355"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb355-2"><a href="#cb355-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb355-3"><a href="#cb355-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-4"><a href="#cb355-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb355-5"><a href="#cb355-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb355-6"><a href="#cb355-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> price<span class="op">;</span></span>
<span id="cb355-7"><a href="#cb355-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> title<span class="op">[</span><span class="dv">50</span><span class="op">];</span></span>
<span id="cb355-8"><a href="#cb355-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Book<span class="op">;</span></span>
<span id="cb355-9"><a href="#cb355-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-10"><a href="#cb355-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb355-11"><a href="#cb355-11" aria-hidden="true" tabindex="-1"></a>    Book b1 <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="fl">9.99</span><span class="op">,</span> <span class="st">"The C Book"</span><span class="op">};</span></span>
<span id="cb355-12"><a href="#cb355-12" aria-hidden="true" tabindex="-1"></a>    Book b2 <span class="op">=</span> <span class="op">{</span><span class="dv">2</span><span class="op">,</span> <span class="fl">15.49</span><span class="op">,</span> <span class="st">"Algorithms in C"</span><span class="op">};</span></span>
<span id="cb355-13"><a href="#cb355-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-14"><a href="#cb355-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"books.bin"</span><span class="op">,</span> <span class="st">"wb"</span><span class="op">);</span></span>
<span id="cb355-15"><a href="#cb355-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb355-16"><a href="#cb355-16" aria-hidden="true" tabindex="-1"></a>    fwrite<span class="op">(&amp;</span>b1<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Book<span class="op">),</span> <span class="dv">1</span><span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb355-17"><a href="#cb355-17" aria-hidden="true" tabindex="-1"></a>    fwrite<span class="op">(&amp;</span>b2<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Book<span class="op">),</span> <span class="dv">1</span><span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb355-18"><a href="#cb355-18" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb355-19"><a href="#cb355-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-20"><a href="#cb355-20" aria-hidden="true" tabindex="-1"></a>    fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"books.bin"</span><span class="op">,</span> <span class="st">"rb"</span><span class="op">);</span></span>
<span id="cb355-21"><a href="#cb355-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb355-22"><a href="#cb355-22" aria-hidden="true" tabindex="-1"></a>    Book b<span class="op">;</span></span>
<span id="cb355-23"><a href="#cb355-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>fread<span class="op">(&amp;</span>b<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Book<span class="op">),</span> <span class="dv">1</span><span class="op">,</span> fp<span class="op">)</span> <span class="op">==</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb355-24"><a href="#cb355-24" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> | </span><span class="sc">%s</span><span class="st"> | </span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> b<span class="op">.</span>id<span class="op">,</span> b<span class="op">.</span>title<span class="op">,</span> b<span class="op">.</span>price<span class="op">);</span></span>
<span id="cb355-25"><a href="#cb355-25" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb355-26"><a href="#cb355-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb355-27"><a href="#cb355-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>1 | The C Book | 9.99
2 | Algorithms in C | 15.49</code></pre>
</section>
<section id="handling-endianness" class="level4">
<h4 class="anchored" data-anchor-id="handling-endianness">Handling Endianness</h4>
<p>Binary files depend on the CPU’s byte order (endianness). If you write on a <strong>little-endian</strong> machine and read on a <strong>big-endian</strong> one, bytes may appear reversed.</p>
<p>For portable formats, you can:</p>
<ul>
<li>Use standardized serialization (like Protocol Buffers or MessagePack).</li>
<li>Convert manually using bit shifts or network-byte-order functions (<code>htonl</code>, <code>ntohl</code>).</li>
</ul>
<p>Example for manual conversion:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb357"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> to_big_endian<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb357-2"><a href="#cb357-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">((</span>x <span class="op">&amp;</span> <span class="bn">0xFF</span><span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="dv">24</span><span class="op">)</span> <span class="op">|</span></span>
<span id="cb357-3"><a href="#cb357-3" aria-hidden="true" tabindex="-1"></a>           <span class="op">((</span>x <span class="op">&amp;</span> <span class="bn">0xFF00</span><span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="dv">8</span><span class="op">)</span> <span class="op">|</span></span>
<span id="cb357-4"><a href="#cb357-4" aria-hidden="true" tabindex="-1"></a>           <span class="op">((</span>x <span class="op">&amp;</span> <span class="bn">0xFF0000</span><span class="op">)</span> <span class="op">&gt;&gt;</span> <span class="dv">8</span><span class="op">)</span> <span class="op">|</span></span>
<span id="cb357-5"><a href="#cb357-5" aria-hidden="true" tabindex="-1"></a>           <span class="op">((</span>x <span class="op">&gt;&gt;</span> <span class="dv">24</span><span class="op">)</span> <span class="op">&amp;</span> <span class="bn">0xFF</span><span class="op">);</span></span>
<span id="cb357-6"><a href="#cb357-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="appending-binary-data" class="level4">
<h4 class="anchored" data-anchor-id="appending-binary-data">Appending Binary Data</h4>
<p>You can append more records with mode <code>"ab"</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb358"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a>Book b3 <span class="op">=</span> <span class="op">{</span><span class="dv">3</span><span class="op">,</span> <span class="fl">21.75</span><span class="op">,</span> <span class="st">"Advanced C"</span><span class="op">};</span></span>
<span id="cb358-2"><a href="#cb358-2" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"books.bin"</span><span class="op">,</span> <span class="st">"ab"</span><span class="op">);</span></span>
<span id="cb358-3"><a href="#cb358-3" aria-hidden="true" tabindex="-1"></a>fwrite<span class="op">(&amp;</span>b3<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Book<span class="op">),</span> <span class="dv">1</span><span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb358-4"><a href="#cb358-4" aria-hidden="true" tabindex="-1"></a>fclose<span class="op">(</span>fp<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="binary-file-utilities" class="level4">
<h4 class="anchored" data-anchor-id="binary-file-utilities">Binary File Utilities</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Function</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>fwrite(ptr, size, count, file)</code></td>
<td>Write binary data</td>
</tr>
<tr class="even">
<td><code>fread(ptr, size, count, file)</code></td>
<td>Read binary data</td>
</tr>
<tr class="odd">
<td><code>fseek(file, offset, origin)</code></td>
<td>Move position</td>
</tr>
<tr class="even">
<td><code>ftell(file)</code></td>
<td>Get current position</td>
</tr>
<tr class="odd">
<td><code>rewind(file)</code></td>
<td>Go back to start</td>
</tr>
</tbody>
</table>
</section>
<section id="why-it-matters-40" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-40">Why It Matters</h4>
<p>Binary I/O is essential for:</p>
<ul>
<li>Saving large datasets efficiently</li>
<li>Game save files, multimedia formats, or scientific data</li>
<li>Databases and memory-mapped storage</li>
<li>Embedded and system-level tools</li>
</ul>
<p>It’s the foundation of <strong>serialization</strong>, transforming data in memory into bytes that can travel or persist.</p>
</section>
<section id="try-it-yourself-41" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-41">Try It Yourself</h4>
<ol type="1">
<li>Save an array of <code>double</code> values and read them back.</li>
<li>Modify the struct example to include an <code>enum</code> field and test the binary result.</li>
<li>Implement a function <code>count_records(filename)</code> that counts how many structs are stored.</li>
<li>Use <code>fseek()</code> to jump to the third record and print only that one.</li>
<li>Write both text and binary versions of the same file and compare sizes.</li>
</ol>
<p>Binary I/O connects C’s low-level power to real-world storage efficiency. Next, you’ll expand this further by understanding <strong>standard streams</strong>, how to use <code>stdin</code>, <code>stdout</code>, and <code>stderr</code> to build flexible, composable command-line tools.</p>
</section>
</section>
<section id="working-with-stdin-stdout-and-stderr" class="level3">
<h3 class="anchored" data-anchor-id="working-with-stdin-stdout-and-stderr">44. Working with <code>stdin</code>, <code>stdout</code>, and <code>stderr</code></h3>
<p>Every C program automatically starts with three open streams connected to your environment, the keyboard, the terminal screen, and the error console. They are the <strong>standard I/O streams</strong> that make your programs flexible and scriptable.</p>
<p>Understanding these three streams is crucial for writing tools that can interact with files, pipes, and other programs, the essence of Unix-style design.</p>
<section id="the-three-standard-streams" class="level4">
<h4 class="anchored" data-anchor-id="the-three-standard-streams">The Three Standard Streams</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 8%">
<col style="width: 16%">
<col style="width: 32%">
<col style="width: 42%">
</colgroup>
<thead>
<tr class="header">
<th>Stream</th>
<th>Purpose</th>
<th>Typical Device</th>
<th>Example Use</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>stdin</code></td>
<td>Standard Input</td>
<td>Keyboard (or file via <code>&lt;</code>)</td>
<td><code>scanf</code>, <code>fgets</code></td>
</tr>
<tr class="even">
<td><code>stdout</code></td>
<td>Standard Output</td>
<td>Screen (or file via <code>&gt;</code>)</td>
<td><code>printf</code>, <code>puts</code>, <code>fprintf(stdout, …)</code></td>
</tr>
<tr class="odd">
<td><code>stderr</code></td>
<td>Standard Error</td>
<td>Screen (separate from stdout)</td>
<td><code>fprintf(stderr, …)</code></td>
</tr>
</tbody>
</table>
<p>These are all of type <code>FILE *</code>. You can treat them like normal file pointers, reading, writing, or redirecting them.</p>
</section>
<section id="basic-example-1" class="level4">
<h4 class="anchored" data-anchor-id="basic-example-1">Basic Example</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb359"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb359-2"><a href="#cb359-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-3"><a href="#cb359-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb359-4"><a href="#cb359-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">50</span><span class="op">];</span></span>
<span id="cb359-5"><a href="#cb359-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Enter your name: "</span><span class="op">);</span></span>
<span id="cb359-6"><a href="#cb359-6" aria-hidden="true" tabindex="-1"></a>    fgets<span class="op">(</span>name<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>name<span class="op">),</span> stdin<span class="op">);</span></span>
<span id="cb359-7"><a href="#cb359-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-8"><a href="#cb359-8" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stdout<span class="op">,</span> <span class="st">"Hello, </span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> name<span class="op">);</span></span>
<span id="cb359-9"><a href="#cb359-9" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Note: This is an example error message.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb359-10"><a href="#cb359-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb359-11"><a href="#cb359-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Enter your name: Alice
Hello, Alice
Note: This is an example error message.</code></pre>
</section>
<section id="redirection-in-the-shell" class="level4">
<h4 class="anchored" data-anchor-id="redirection-in-the-shell">Redirection in the Shell</h4>
<p>You can redirect each stream separately:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb361"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./program</span> <span class="op">&lt;</span> input.txt <span class="op">&gt;</span> output.txt <span class="dv">2</span><span class="op">&gt;</span> errors.log</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><code>&lt;</code> replaces <code>stdin</code> (read input from file)</li>
<li><code>&gt;</code> replaces <code>stdout</code> (write normal output to file)</li>
<li><code>2&gt;</code> replaces <code>stderr</code> (write errors to file)</li>
</ul>
<p>You can also combine them:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb362"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./program</span> <span class="op">&gt;</span> all_output.txt <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This merges both output and error streams into one file.</p>
</section>
<section id="reading-from-stdin" class="level4">
<h4 class="anchored" data-anchor-id="reading-from-stdin">Reading from stdin</h4>
<p>You can build programs that process input dynamically, one line at a time:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb363"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb363-2"><a href="#cb363-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-3"><a href="#cb363-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb363-4"><a href="#cb363-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> line<span class="op">[</span><span class="dv">100</span><span class="op">];</span></span>
<span id="cb363-5"><a href="#cb363-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Enter text (Ctrl+D to stop):</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb363-6"><a href="#cb363-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>fgets<span class="op">(</span>line<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>line<span class="op">),</span> stdin<span class="op">))</span></span>
<span id="cb363-7"><a href="#cb363-7" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"You said: </span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> line<span class="op">);</span></span>
<span id="cb363-8"><a href="#cb363-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb363-9"><a href="#cb363-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now your program behaves like a Unix filter, it can read from a file, a pipe, or a keyboard input interchangeably.</p>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb364"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"hello"</span> <span class="kw">|</span> <span class="ex">./program</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>You said: hello</code></pre>
</section>
<section id="writing-to-stdout-and-stderr" class="level4">
<h4 class="anchored" data-anchor-id="writing-to-stdout-and-stderr">Writing to stdout and stderr</h4>
<p><code>stdout</code> is for normal program output, while <code>stderr</code> is for error messages or logs.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb366"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb366-2"><a href="#cb366-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb366-3"><a href="#cb366-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb366-4"><a href="#cb366-4" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stdout<span class="op">,</span> <span class="st">"Everything is fine.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb366-5"><a href="#cb366-5" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Warning: something might be wrong.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb366-6"><a href="#cb366-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb366-7"><a href="#cb366-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You can suppress normal output but keep errors:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb367"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./program</span> <span class="op">&gt;</span> /dev/null</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Warning: something might be wrong.</code></pre>
</section>
<section id="tiny-code-word-counter-using-stdinstdout" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-word-counter-using-stdinstdout">Tiny Code: Word Counter Using stdin/stdout</h4>
<p>This small program mimics a simplified version of the Unix <code>wc</code> command.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb369"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb369-2"><a href="#cb369-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;ctype.h&gt;</span></span>
<span id="cb369-3"><a href="#cb369-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-4"><a href="#cb369-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb369-5"><a href="#cb369-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> ch<span class="op">,</span> words <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> in_word <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb369-6"><a href="#cb369-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-7"><a href="#cb369-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">((</span>ch <span class="op">=</span> getchar<span class="op">())</span> <span class="op">!=</span> EOF<span class="op">)</span> <span class="op">{</span></span>
<span id="cb369-8"><a href="#cb369-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>isspace<span class="op">(</span>ch<span class="op">))</span></span>
<span id="cb369-9"><a href="#cb369-9" aria-hidden="true" tabindex="-1"></a>            in_word <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb369-10"><a href="#cb369-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(!</span>in_word<span class="op">)</span> <span class="op">{</span></span>
<span id="cb369-11"><a href="#cb369-11" aria-hidden="true" tabindex="-1"></a>            in_word <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb369-12"><a href="#cb369-12" aria-hidden="true" tabindex="-1"></a>            words<span class="op">++;</span></span>
<span id="cb369-13"><a href="#cb369-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb369-14"><a href="#cb369-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb369-15"><a href="#cb369-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-16"><a href="#cb369-16" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Word count: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> words<span class="op">);</span></span>
<span id="cb369-17"><a href="#cb369-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb369-18"><a href="#cb369-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Try:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb370"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"C is small but powerful"</span> <span class="kw">|</span> <span class="ex">./wordcount</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Word count: 4</code></pre>
</section>
<section id="mixing-stdout-and-stderr" class="level4">
<h4 class="anchored" data-anchor-id="mixing-stdout-and-stderr">Mixing stdout and stderr</h4>
<p>Sometimes you need to log progress to <code>stderr</code> while outputting results to <code>stdout</code>. That way, logs don’t pollute the actual data.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb372"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb372-2"><a href="#cb372-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-3"><a href="#cb372-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb372-4"><a href="#cb372-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb372-5"><a href="#cb372-5" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Processing item </span><span class="sc">%d</span><span class="st">...</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb372-6"><a href="#cb372-6" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stdout<span class="op">,</span> <span class="st">"Item </span><span class="sc">%d</span><span class="st"> processed</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb372-7"><a href="#cb372-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb372-8"><a href="#cb372-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb372-9"><a href="#cb372-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Redirect logs separately:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb373"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb373-1"><a href="#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./program</span> <span class="op">&gt;</span> result.txt <span class="dv">2</span><span class="op">&gt;</span> log.txt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="flushing-buffers" class="level4">
<h4 class="anchored" data-anchor-id="flushing-buffers">Flushing Buffers</h4>
<p>Output streams are <strong>buffered</strong>, data isn’t written until the buffer is full or flushed. To ensure output appears immediately:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb374"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a>fflush<span class="op">(</span>stdout<span class="op">);</span>  <span class="co">// flush output buffer</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This is useful for interactive programs.</p>
</section>
<section id="why-it-matters-41" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-41">Why It Matters</h4>
<p>These three streams give your program flexibility:</p>
<ul>
<li>Work interactively (keyboard/screen)</li>
<li>Work in batch (file input/output)</li>
<li>Chain with other tools using pipes</li>
</ul>
<p>They are the foundation of the <strong>Unix philosophy</strong>: small programs that do one thing well and can be composed together.</p>
</section>
<section id="try-it-yourself-42" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-42">Try It Yourself</h4>
<ol type="1">
<li>Write a program that reads from stdin and prints only lines containing a given keyword.</li>
<li>Print errors to stderr if no keyword is provided.</li>
<li>Redirect input and output from files using <code>&lt;</code> and <code>&gt;</code>.</li>
<li>Add progress messages to stderr and redirect them to a separate log.</li>
<li>Combine everything into a small “filter” tool that processes text from pipelines.</li>
</ol>
<p>With <code>stdin</code>, <code>stdout</code>, and <code>stderr</code>, your C programs become tools that fit seamlessly into real workflows, able to interact with files, other programs, and users alike. Next, you’ll explore <strong>buffered I/O</strong>, understanding how the C library optimizes performance through read and write buffers using <code>fgets</code>, <code>fputs</code>, and more.</p>
</section>
</section>
<section id="buffered-io-with-fgets-and-fputs" class="level3">
<h3 class="anchored" data-anchor-id="buffered-io-with-fgets-and-fputs">45. Buffered I/O with <code>fgets</code> and <code>fputs</code></h3>
<p>When your program reads and writes data, it doesn’t always go directly to disk or the terminal, instead, it uses <strong>buffers</strong>. Buffers are small chunks of memory that temporarily hold data, improving performance by reducing how often the system has to perform slow I/O operations.</p>
<p>C’s Standard I/O library (<code>&lt;stdio.h&gt;</code>) handles this automatically for you. In this section, you’ll learn how buffering works and how to use <code>fgets</code>, <code>fputs</code>, and related functions to manage it effectively.</p>
<section id="what-is-buffered-io" class="level4">
<h4 class="anchored" data-anchor-id="what-is-buffered-io">What Is Buffered I/O?</h4>
<p>Instead of reading or writing one character at a time, the C library:</p>
<ul>
<li>Fills a buffer (for input) or</li>
<li>Collects a batch of characters (for output)</li>
</ul>
<p>When the buffer is full or flushed, data moves between your program and the file or terminal.</p>
<p>This is why sometimes <code>printf()</code> output doesn’t appear immediately, it’s waiting in a buffer until a newline or flush occurs.</p>
</section>
<section id="input-fgets" class="level4">
<h4 class="anchored" data-anchor-id="input-fgets">Input: <code>fgets()</code></h4>
<p><code>fgets()</code> reads a full line from a stream (including spaces) and stores it in a string.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb375"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>fgets<span class="op">(</span><span class="dt">char</span> <span class="op">*</span>str<span class="op">,</span> <span class="dt">int</span> size<span class="op">,</span> <span class="dt">FILE</span> <span class="op">*</span>stream<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><code>str</code>: where to store the line</li>
<li><code>size</code>: maximum number of characters to read (including <code>\0</code>)</li>
<li><code>stream</code>: where to read from (e.g.&nbsp;<code>stdin</code> or a file pointer)</li>
</ul>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb376"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb376-2"><a href="#cb376-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-3"><a href="#cb376-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb376-4"><a href="#cb376-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> line<span class="op">[</span><span class="dv">100</span><span class="op">];</span></span>
<span id="cb376-5"><a href="#cb376-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Enter a sentence: "</span><span class="op">);</span></span>
<span id="cb376-6"><a href="#cb376-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fgets<span class="op">(</span>line<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>line<span class="op">),</span> stdin<span class="op">))</span></span>
<span id="cb376-7"><a href="#cb376-7" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"You said: </span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> line<span class="op">);</span></span>
<span id="cb376-8"><a href="#cb376-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb376-9"><a href="#cb376-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Input:</p>
<pre><code>C is beautiful.</code></pre>
<p>Output:</p>
<pre><code>You said: C is beautiful.</code></pre>
<p>If the input exceeds the buffer, <code>fgets</code> stops reading after <code>size - 1</code> characters to prevent overflow, and automatically null-terminates the string.</p>
</section>
<section id="output-fputs" class="level4">
<h4 class="anchored" data-anchor-id="output-fputs">Output: <code>fputs()</code></h4>
<p><code>fputs()</code> writes a string to a stream.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb379"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> fputs<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>str<span class="op">,</span> <span class="dt">FILE</span> <span class="op">*</span>stream<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb380"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb380-1"><a href="#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb380-2"><a href="#cb380-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-3"><a href="#cb380-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb380-4"><a href="#cb380-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"output.txt"</span><span class="op">,</span> <span class="st">"w"</span><span class="op">);</span></span>
<span id="cb380-5"><a href="#cb380-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="op">{</span></span>
<span id="cb380-6"><a href="#cb380-6" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"Open failed"</span><span class="op">);</span></span>
<span id="cb380-7"><a href="#cb380-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb380-8"><a href="#cb380-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb380-9"><a href="#cb380-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-10"><a href="#cb380-10" aria-hidden="true" tabindex="-1"></a>    fputs<span class="op">(</span><span class="st">"Buffered I/O makes C fast.</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb380-11"><a href="#cb380-11" aria-hidden="true" tabindex="-1"></a>    fputs<span class="op">(</span><span class="st">"fgets and fputs are line-based tools.</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb380-12"><a href="#cb380-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-13"><a href="#cb380-13" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb380-14"><a href="#cb380-14" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Wrote to output.txt</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb380-15"><a href="#cb380-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb380-16"><a href="#cb380-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output file:</p>
<pre><code>Buffered I/O makes C fast.
fgets and fputs are line-based tools.</code></pre>
</section>
<section id="why-fgets-is-safer-than-scanfs" class="level4">
<h4 class="anchored" data-anchor-id="why-fgets-is-safer-than-scanfs">Why <code>fgets</code> Is Safer Than <code>scanf("%s", …)</code></h4>
<ul>
<li><code>fgets()</code> respects buffer boundaries</li>
<li>It reads spaces and tabs correctly</li>
<li>It prevents undefined behavior from overflows</li>
</ul>
<p>Avoid this:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb382"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a>scanf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> buffer<span class="op">);</span> <span class="co">// stops at first space and may overflow</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Prefer this:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb383"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb383-1"><a href="#cb383-1" aria-hidden="true" tabindex="-1"></a>fgets<span class="op">(</span>buffer<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buffer<span class="op">),</span> stdin<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="writing-to-stdout-or-stderr-with-fputs" class="level4">
<h4 class="anchored" data-anchor-id="writing-to-stdout-or-stderr-with-fputs">Writing to <code>stdout</code> or <code>stderr</code> with <code>fputs</code></h4>
<p><code>fputs()</code> works on any output stream, not just files.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb384"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a>fputs<span class="op">(</span><span class="st">"Message to screen.</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> stdout<span class="op">);</span></span>
<span id="cb384-2"><a href="#cb384-2" aria-hidden="true" tabindex="-1"></a>fputs<span class="op">(</span><span class="st">"Error to stderr!</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> stderr<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You can even redirect these in the shell:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb385"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./program</span> <span class="op">&gt;</span> result.txt <span class="dv">2</span><span class="op">&gt;</span> error.log</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="reading-files-line-by-line" class="level4">
<h4 class="anchored" data-anchor-id="reading-files-line-by-line">Reading Files Line by Line</h4>
<p>Here’s how to read a file safely using <code>fgets()</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb386"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb386-2"><a href="#cb386-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-3"><a href="#cb386-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb386-4"><a href="#cb386-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"poem.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb386-5"><a href="#cb386-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="op">{</span></span>
<span id="cb386-6"><a href="#cb386-6" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"Failed to open file"</span><span class="op">);</span></span>
<span id="cb386-7"><a href="#cb386-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb386-8"><a href="#cb386-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb386-9"><a href="#cb386-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-10"><a href="#cb386-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> line<span class="op">[</span><span class="dv">200</span><span class="op">];</span></span>
<span id="cb386-11"><a href="#cb386-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>fgets<span class="op">(</span>line<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>line<span class="op">),</span> fp<span class="op">))</span></span>
<span id="cb386-12"><a href="#cb386-12" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> line<span class="op">);</span></span>
<span id="cb386-13"><a href="#cb386-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-14"><a href="#cb386-14" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb386-15"><a href="#cb386-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb386-16"><a href="#cb386-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="tiny-code-copy-a-file" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-copy-a-file">Tiny Code: Copy a File</h4>
<p>A minimal file copier using <code>fgets</code> and <code>fputs</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb387"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb387-2"><a href="#cb387-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-3"><a href="#cb387-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb387-4"><a href="#cb387-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>in <span class="op">=</span> fopen<span class="op">(</span><span class="st">"input.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb387-5"><a href="#cb387-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>out <span class="op">=</span> fopen<span class="op">(</span><span class="st">"copy.txt"</span><span class="op">,</span> <span class="st">"w"</span><span class="op">);</span></span>
<span id="cb387-6"><a href="#cb387-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-7"><a href="#cb387-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>in <span class="op">||</span> <span class="op">!</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb387-8"><a href="#cb387-8" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"File error"</span><span class="op">);</span></span>
<span id="cb387-9"><a href="#cb387-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb387-10"><a href="#cb387-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb387-11"><a href="#cb387-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-12"><a href="#cb387-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buf<span class="op">[</span><span class="dv">256</span><span class="op">];</span></span>
<span id="cb387-13"><a href="#cb387-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>fgets<span class="op">(</span>buf<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buf<span class="op">),</span> in<span class="op">))</span></span>
<span id="cb387-14"><a href="#cb387-14" aria-hidden="true" tabindex="-1"></a>        fputs<span class="op">(</span>buf<span class="op">,</span> out<span class="op">);</span></span>
<span id="cb387-15"><a href="#cb387-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-16"><a href="#cb387-16" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>in<span class="op">);</span></span>
<span id="cb387-17"><a href="#cb387-17" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>out<span class="op">);</span></span>
<span id="cb387-18"><a href="#cb387-18" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Copied successfully.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb387-19"><a href="#cb387-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb387-20"><a href="#cb387-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="buffer-flushing" class="level4">
<h4 class="anchored" data-anchor-id="buffer-flushing">Buffer Flushing</h4>
<p>Sometimes you need to manually flush output:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb388"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a>fflush<span class="op">(</span>stdout<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This is useful for interactive programs that must show messages immediately.</p>
<p>To disable buffering entirely (e.g., for logging):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb389"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb389-1"><a href="#cb389-1" aria-hidden="true" tabindex="-1"></a>setbuf<span class="op">(</span>stdout<span class="op">,</span> NULL<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-42" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-42">Why It Matters</h4>
<p>Buffered I/O balances <strong>speed</strong> and <strong>safety</strong>:</p>
<ul>
<li><code>fgets</code> protects against overflow</li>
<li><code>fputs</code> ensures efficient output</li>
<li>Buffering minimizes slow disk and console calls</li>
</ul>
<p>It’s what makes C both low-level and performant without forcing you to manage every byte yourself.</p>
</section>
<section id="try-it-yourself-43" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-43">Try It Yourself</h4>
<ol type="1">
<li>Write a program that reads lines from stdin and writes them to a new file.</li>
<li>Count how many lines you read before EOF.</li>
<li>Print each line with line numbers using <code>fgets</code> and <code>printf</code>.</li>
<li>Experiment with buffer sizes, try 16 vs 256 bytes and note the performance difference.</li>
<li>Flush output after every line for an interactive logging program.</li>
</ol>
<p><code>fgets</code> and <code>fputs</code> give you a safe, line-based foundation for file and console I/O. Next, you’ll learn how to <strong>handle errors correctly</strong> using <code>errno</code>, <code>perror</code>, and <code>strerror</code>, essential tools for writing reliable system programs in C.</p>
</section>
</section>
<section id="error-checking-with-errno-and-perror" class="level3">
<h3 class="anchored" data-anchor-id="error-checking-with-errno-and-perror">46. Error Checking with <code>errno</code> and <code>perror</code></h3>
<p>Even the best-written C programs can encounter errors, missing files, permission issues, division by zero, or failed memory allocations. Unlike some languages that throw exceptions, C reports errors <strong>manually</strong> using return values and a global variable named <strong><code>errno</code></strong>.</p>
<p>Understanding how to use <code>errno</code>, <code>perror()</code>, and <code>strerror()</code> is essential for writing <strong>robust, production-grade</strong> C programs that fail gracefully and informatively.</p>
<section id="the-idea-behind-errno" class="level4">
<h4 class="anchored" data-anchor-id="the-idea-behind-errno">The Idea Behind <code>errno</code></h4>
<p><code>errno</code> is a global integer (declared in <code>&lt;errno.h&gt;</code>) that stores an <strong>error code</strong> whenever a library function fails.</p>
<ul>
<li>On success, most functions leave <code>errno</code> unchanged.</li>
<li>On failure, they typically set <code>errno</code> and return an error value (often <code>NULL</code>, <code>-1</code>, or <code>0</code> depending on the function).</li>
<li>You must check the return value first, only then should you inspect <code>errno</code>.</li>
</ul>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb390"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb390-2"><a href="#cb390-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;errno.h&gt;</span></span>
<span id="cb390-3"><a href="#cb390-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb390-4"><a href="#cb390-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb390-5"><a href="#cb390-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"missing.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb390-6"><a href="#cb390-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="op">{</span></span>
<span id="cb390-7"><a href="#cb390-7" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Error code: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> errno<span class="op">);</span></span>
<span id="cb390-8"><a href="#cb390-8" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"fopen failed"</span><span class="op">);</span></span>
<span id="cb390-9"><a href="#cb390-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb390-10"><a href="#cb390-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb390-11"><a href="#cb390-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Error code: 2
fopen failed: No such file or directory</code></pre>
</section>
<section id="common-errno-codes" class="level4">
<h4 class="anchored" data-anchor-id="common-errno-codes">Common <code>errno</code> Codes</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Code</th>
<th>Name</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td><code>ENOENT</code></td>
<td>No such file or directory</td>
</tr>
<tr class="even">
<td>13</td>
<td><code>EACCES</code></td>
<td>Permission denied</td>
</tr>
<tr class="odd">
<td>12</td>
<td><code>ENOMEM</code></td>
<td>Not enough memory</td>
</tr>
<tr class="even">
<td>22</td>
<td><code>EINVAL</code></td>
<td>Invalid argument</td>
</tr>
<tr class="odd">
<td>17</td>
<td><code>EEXIST</code></td>
<td>File already exists</td>
</tr>
<tr class="even">
<td>5</td>
<td><code>EIO</code></td>
<td>Input/output error</td>
</tr>
<tr class="odd">
<td>111</td>
<td><code>ECONNREFUSED</code></td>
<td>Connection refused (network)</td>
</tr>
</tbody>
</table>
<p>Include <code>&lt;errno.h&gt;</code> to use these symbolic names:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb392"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>errno <span class="op">==</span> ENOENT<span class="op">)</span> printf<span class="op">(</span><span class="st">"File missing.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="using-perror" class="level4">
<h4 class="anchored" data-anchor-id="using-perror">Using <code>perror()</code></h4>
<p><code>perror()</code> prints a human-readable error message to <code>stderr</code>, based on the current value of <code>errno</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb393"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb393-1"><a href="#cb393-1" aria-hidden="true" tabindex="-1"></a>perror<span class="op">(</span><span class="st">"File open error"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb394"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb394-2"><a href="#cb394-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;errno.h&gt;</span></span>
<span id="cb394-3"><a href="#cb394-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb394-4"><a href="#cb394-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb394-5"><a href="#cb394-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>f <span class="op">=</span> fopen<span class="op">(</span><span class="st">"ghost.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb394-6"><a href="#cb394-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>f<span class="op">)</span></span>
<span id="cb394-7"><a href="#cb394-7" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"Unable to open file"</span><span class="op">);</span></span>
<span id="cb394-8"><a href="#cb394-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb394-9"><a href="#cb394-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Unable to open file: No such file or directory</code></pre>
</section>
<section id="using-strerror" class="level4">
<h4 class="anchored" data-anchor-id="using-strerror">Using <code>strerror()</code></h4>
<p>If you want to use the error message in your own formatted output, use <code>strerror()</code> from <code>&lt;string.h&gt;</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb396"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb396-2"><a href="#cb396-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb396-3"><a href="#cb396-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;errno.h&gt;</span></span>
<span id="cb396-4"><a href="#cb396-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb396-5"><a href="#cb396-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb396-6"><a href="#cb396-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>f <span class="op">=</span> fopen<span class="op">(</span><span class="st">"/root/secret.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb396-7"><a href="#cb396-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>f<span class="op">)</span></span>
<span id="cb396-8"><a href="#cb396-8" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Error (</span><span class="sc">%d</span><span class="st">): </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> errno<span class="op">,</span> strerror<span class="op">(</span>errno<span class="op">));</span></span>
<span id="cb396-9"><a href="#cb396-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb396-10"><a href="#cb396-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Error (13): Permission denied</code></pre>
</section>
<section id="tiny-code-robust-file-reader" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-robust-file-reader">Tiny Code: Robust File Reader</h4>
<p>Here’s a simple file reader that checks for errors at every step:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb398"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb398-2"><a href="#cb398-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb398-3"><a href="#cb398-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;errno.h&gt;</span></span>
<span id="cb398-4"><a href="#cb398-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb398-5"><a href="#cb398-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span> <span class="op">{</span></span>
<span id="cb398-6"><a href="#cb398-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>argc <span class="op">!=</span> <span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb398-7"><a href="#cb398-7" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Usage: </span><span class="sc">%s</span><span class="st"> &lt;filename&gt;</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb398-8"><a href="#cb398-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb398-9"><a href="#cb398-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb398-10"><a href="#cb398-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb398-11"><a href="#cb398-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb398-12"><a href="#cb398-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="op">{</span></span>
<span id="cb398-13"><a href="#cb398-13" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Error opening </span><span class="sc">%s</span><span class="st">: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span> strerror<span class="op">(</span>errno<span class="op">));</span></span>
<span id="cb398-14"><a href="#cb398-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb398-15"><a href="#cb398-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb398-16"><a href="#cb398-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb398-17"><a href="#cb398-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buf<span class="op">[</span><span class="dv">128</span><span class="op">];</span></span>
<span id="cb398-18"><a href="#cb398-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>fgets<span class="op">(</span>buf<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buf<span class="op">),</span> fp<span class="op">))</span></span>
<span id="cb398-19"><a href="#cb398-19" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> buf<span class="op">);</span></span>
<span id="cb398-20"><a href="#cb398-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb398-21"><a href="#cb398-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ferror<span class="op">(</span>fp<span class="op">))</span> <span class="op">{</span></span>
<span id="cb398-22"><a href="#cb398-22" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Error reading file: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> strerror<span class="op">(</span>errno<span class="op">));</span></span>
<span id="cb398-23"><a href="#cb398-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb398-24"><a href="#cb398-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb398-25"><a href="#cb398-25" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb398-26"><a href="#cb398-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb398-27"><a href="#cb398-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Usage:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb399"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./readfile</span> poem.txt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If the file is missing:</p>
<pre><code>Error opening poem.txt: No such file or directory</code></pre>
</section>
<section id="clearing-and-resetting-errno" class="level4">
<h4 class="anchored" data-anchor-id="clearing-and-resetting-errno">Clearing and Resetting <code>errno</code></h4>
<p>Some functions may set <code>errno</code> even if they succeed later. To be safe, you can clear it before a call:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb401"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb401-1"><a href="#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;errno.h&gt;</span></span>
<span id="cb401-2"><a href="#cb401-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-3"><a href="#cb401-3" aria-hidden="true" tabindex="-1"></a>errno <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb401-4"><a href="#cb401-4" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> <span class="op">*</span>f <span class="op">=</span> fopen<span class="op">(</span><span class="st">"file.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb401-5"><a href="#cb401-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span>f<span class="op">)</span> perror<span class="op">(</span><span class="st">"fopen"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This ensures you don’t read a leftover error from an earlier operation.</p>
</section>
<section id="checking-other-system-errors" class="level4">
<h4 class="anchored" data-anchor-id="checking-other-system-errors">Checking Other System Errors</h4>
<p><code>errno</code> isn’t limited to file I/O, it applies to many system calls and library functions:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb402"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb402-2"><a href="#cb402-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb402-3"><a href="#cb402-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;errno.h&gt;</span></span>
<span id="cb402-4"><a href="#cb402-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb402-5"><a href="#cb402-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-6"><a href="#cb402-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb402-7"><a href="#cb402-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>f <span class="op">=</span> fopen<span class="op">(</span><span class="st">"/dev/full"</span><span class="op">,</span> <span class="st">"w"</span><span class="op">);</span> <span class="co">// special Linux device that fails on write</span></span>
<span id="cb402-8"><a href="#cb402-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>f<span class="op">)</span> <span class="op">{</span></span>
<span id="cb402-9"><a href="#cb402-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>fputc<span class="op">(</span><span class="ch">'A'</span><span class="op">,</span> f<span class="op">)</span> <span class="op">==</span> EOF<span class="op">)</span></span>
<span id="cb402-10"><a href="#cb402-10" aria-hidden="true" tabindex="-1"></a>            perror<span class="op">(</span><span class="st">"Write failed"</span><span class="op">);</span></span>
<span id="cb402-11"><a href="#cb402-11" aria-hidden="true" tabindex="-1"></a>        fclose<span class="op">(</span>f<span class="op">);</span></span>
<span id="cb402-12"><a href="#cb402-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb402-13"><a href="#cb402-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb402-14"><a href="#cb402-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Write failed: No space left on device</code></pre>
</section>
<section id="why-it-matters-43" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-43">Why It Matters</h4>
<p><code>errno</code> and its helpers (<code>perror</code>, <code>strerror</code>) make your programs <em>explain themselves</em> when things go wrong. This is vital for:</p>
<ul>
<li>System tools that must report specific error causes</li>
<li>Debugging production code</li>
<li>Writing portable, maintainable programs</li>
</ul>
<p>Good C developers never just “fail silently.”</p>
</section>
<section id="try-it-yourself-44" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-44">Try It Yourself</h4>
<ol type="1">
<li>Open a file that doesn’t exist, then create it and try again.</li>
<li>Simulate a read error by using <code>ferror()</code> after reading a closed file.</li>
<li>Try writing to a directory (<code>fopen("/tmp", "w")</code>) and inspect <code>errno</code>.</li>
<li>Print all known error codes and messages using a loop and <code>strerror()</code>.</li>
<li>Write a small “safe_open” function that wraps <code>fopen</code> with error reporting.</li>
</ol>
<p>With error handling mastered, you now know how to make C programs both informative and reliable. Next, you’ll explore <strong>command-line arguments (<code>argc</code>, <code>argv</code>)</strong>, the gateway to building flexible, scriptable tools that process user input dynamically.</p>
</section>
</section>
<section id="command-line-arguments-argc-argv" class="level3">
<h3 class="anchored" data-anchor-id="command-line-arguments-argc-argv">47. Command-Line Arguments (<code>argc</code>, <code>argv</code>)</h3>
<p>Every C program can receive input directly from the <strong>command line</strong>, no <code>scanf</code>, no <code>fgets</code>, just arguments passed when you run the executable. This is how professional C tools (like <code>gcc</code>, <code>ls</code>, and <code>grep</code>) receive filenames, options, and flags.</p>
<section id="the-function-signature" class="level4">
<h4 class="anchored" data-anchor-id="the-function-signature">The Function Signature</h4>
<p>Your <code>main</code> function can take <strong>two parameters</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb404"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Parameter</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>argc</code></td>
<td>Argument count (number of command-line arguments)</td>
</tr>
<tr class="even">
<td><code>argv</code></td>
<td>Argument vector (array of C strings, each argument)</td>
</tr>
</tbody>
</table>
<p><code>argv[0]</code> is the program name itself, and <code>argv[1]</code> onward are the user-provided arguments.</p>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb405"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb405-1"><a href="#cb405-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./hello</span> world test</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then:</p>
<ul>
<li><code>argc == 3</code></li>
<li><code>argv[0] = "./hello"</code></li>
<li><code>argv[1] = "world"</code></li>
<li><code>argv[2] = "test"</code></li>
</ul>
</section>
<section id="tiny-code-print-command-line-arguments" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-print-command-line-arguments">Tiny Code: Print Command-Line Arguments</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb406"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb406-2"><a href="#cb406-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-3"><a href="#cb406-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span> <span class="op">{</span></span>
<span id="cb406-4"><a href="#cb406-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Argument count: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> argc<span class="op">);</span></span>
<span id="cb406-5"><a href="#cb406-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> argc<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb406-6"><a href="#cb406-6" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"argv[</span><span class="sc">%d</span><span class="st">] = </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> argv<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb406-7"><a href="#cb406-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb406-8"><a href="#cb406-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb407"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb407-1"><a href="#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./args</span> foo bar 123</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Argument count: 4
argv[0] = ./args
argv[1] = foo
argv[2] = bar
argv[3] = 123</code></pre>
</section>
<section id="checking-for-missing-arguments" class="level4">
<h4 class="anchored" data-anchor-id="checking-for-missing-arguments">Checking for Missing Arguments</h4>
<p>If your program needs arguments, check <code>argc</code> before accessing them.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb409"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb409-1"><a href="#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb409-2"><a href="#cb409-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-3"><a href="#cb409-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span> <span class="op">{</span></span>
<span id="cb409-4"><a href="#cb409-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>argc <span class="op">&lt;</span> <span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb409-5"><a href="#cb409-5" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Usage: </span><span class="sc">%s</span><span class="st"> &lt;filename&gt;</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb409-6"><a href="#cb409-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb409-7"><a href="#cb409-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb409-8"><a href="#cb409-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Opening file: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> argv<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb409-9"><a href="#cb409-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb409-10"><a href="#cb409-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb410"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./fileop</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Usage: ./fileop &lt;filename&gt;</code></pre>
<p>Run again:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb412"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb412-1"><a href="#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./fileop</span> data.txt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Opening file: data.txt</code></pre>
</section>
<section id="converting-string-arguments-to-numbers" class="level4">
<h4 class="anchored" data-anchor-id="converting-string-arguments-to-numbers">Converting String Arguments to Numbers</h4>
<p>All command-line arguments are <strong>strings</strong>. To use them as numbers, convert using:</p>
<ul>
<li><code>atoi()</code> – string to int</li>
<li><code>atof()</code> – string to float</li>
<li><code>strtol()</code> / <code>strtod()</code> – safer and more flexible alternatives</li>
</ul>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb414"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb414-1"><a href="#cb414-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb414-2"><a href="#cb414-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb414-3"><a href="#cb414-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb414-4"><a href="#cb414-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span> <span class="op">{</span></span>
<span id="cb414-5"><a href="#cb414-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>argc <span class="op">!=</span> <span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb414-6"><a href="#cb414-6" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Usage: </span><span class="sc">%s</span><span class="st"> &lt;a&gt; &lt;b&gt;</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb414-7"><a href="#cb414-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb414-8"><a href="#cb414-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb414-9"><a href="#cb414-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb414-10"><a href="#cb414-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a <span class="op">=</span> atoi<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb414-11"><a href="#cb414-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> b <span class="op">=</span> atoi<span class="op">(</span>argv<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb414-12"><a href="#cb414-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> + </span><span class="sc">%d</span><span class="st"> = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">,</span> b<span class="op">,</span> a <span class="op">+</span> b<span class="op">);</span></span>
<span id="cb414-13"><a href="#cb414-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb414-14"><a href="#cb414-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb415"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb415-1"><a href="#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./sum</span> 10 25</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>10 + 25 = 35</code></pre>
</section>
<section id="handling-options-flags" class="level4">
<h4 class="anchored" data-anchor-id="handling-options-flags">Handling Options (Flags)</h4>
<p>You can build simple command-line tools that handle options manually:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb417"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb417-1"><a href="#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb417-2"><a href="#cb417-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb417-3"><a href="#cb417-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-4"><a href="#cb417-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span> <span class="op">{</span></span>
<span id="cb417-5"><a href="#cb417-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> verbose <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb417-6"><a href="#cb417-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-7"><a href="#cb417-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> argc<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb417-8"><a href="#cb417-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>argv<span class="op">[</span>i<span class="op">],</span> <span class="st">"-v"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb417-9"><a href="#cb417-9" aria-hidden="true" tabindex="-1"></a>            verbose <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb417-10"><a href="#cb417-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb417-11"><a href="#cb417-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-12"><a href="#cb417-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>verbose<span class="op">)</span></span>
<span id="cb417-13"><a href="#cb417-13" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Verbose mode on</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb417-14"><a href="#cb417-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb417-15"><a href="#cb417-15" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Run quietly</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb417-16"><a href="#cb417-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-17"><a href="#cb417-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb417-18"><a href="#cb417-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb418"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb418-1"><a href="#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./tool</span> <span class="at">-v</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Verbose mode on</code></pre>
</section>
<section id="tiny-code-mini-file-echo-tool" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-mini-file-echo-tool">Tiny Code: Mini File Echo Tool</h4>
<p>This program prints the content of a file passed as an argument:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb420"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb420-1"><a href="#cb420-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb420-2"><a href="#cb420-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-3"><a href="#cb420-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span> <span class="op">{</span></span>
<span id="cb420-4"><a href="#cb420-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>argc <span class="op">!=</span> <span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb420-5"><a href="#cb420-5" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Usage: </span><span class="sc">%s</span><span class="st"> &lt;file&gt;</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb420-6"><a href="#cb420-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb420-7"><a href="#cb420-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb420-8"><a href="#cb420-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-9"><a href="#cb420-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb420-10"><a href="#cb420-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="op">{</span></span>
<span id="cb420-11"><a href="#cb420-11" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"Error"</span><span class="op">);</span></span>
<span id="cb420-12"><a href="#cb420-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb420-13"><a href="#cb420-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb420-14"><a href="#cb420-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-15"><a href="#cb420-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buf<span class="op">[</span><span class="dv">128</span><span class="op">];</span></span>
<span id="cb420-16"><a href="#cb420-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>fgets<span class="op">(</span>buf<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buf<span class="op">),</span> fp<span class="op">))</span></span>
<span id="cb420-17"><a href="#cb420-17" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> buf<span class="op">);</span></span>
<span id="cb420-18"><a href="#cb420-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-19"><a href="#cb420-19" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb420-20"><a href="#cb420-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb420-21"><a href="#cb420-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb421"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./echo</span> mytext.txt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-44" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-44">Why It Matters</h4>
<p><code>argc</code> and <code>argv</code> make your C programs scriptable and composable:</p>
<ul>
<li>Automate tasks from the command line</li>
<li>Integrate with shell scripts or pipelines</li>
<li>Process multiple input files</li>
<li>Implement command-line flags and options</li>
</ul>
<p>Every real-world C utility, from <code>ls</code> to <code>gcc</code>, depends on this pattern.</p>
</section>
<section id="try-it-yourself-45" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-45">Try It Yourself</h4>
<ol type="1">
<li><p>Write a program that takes a list of integers and prints their sum.</p></li>
<li><p>Add a <code>-r</code> flag to reverse the order of printed arguments.</p></li>
<li><p>Build a “greet” tool:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb422"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb422-1"><a href="#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./greet</span> Alice Bob Charlie</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>→ <code>Hello, Alice! Hello, Bob! Hello, Charlie!</code></p></li>
<li><p>Write a “compare” tool that checks if two file names are identical.</p></li>
<li><p>Combine <code>argc</code> and file I/O: copy one file to another with</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb423"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./copy</span> source.txt dest.txt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ol>
<p>With command-line arguments, your C programs evolve from static exercises to <strong>flexible, real-world tools</strong>. Next, you’ll explore <strong>reading configuration files</strong>, a powerful way to let your programs adapt automatically without recompilation.</p>
</section>
</section>
<section id="reading-configuration-files" class="level3">
<h3 class="anchored" data-anchor-id="reading-configuration-files">48. Reading Configuration Files</h3>
<p>As your C programs grow, hardcoding settings like file paths, thresholds, or user preferences becomes limiting. Configuration files let your program read settings at runtime, a critical capability for tools, servers, and embedded systems.</p>
<p>You’ll learn how to read and parse configuration files using standard I/O and string handling.</p>
<section id="the-goal" class="level4">
<h4 class="anchored" data-anchor-id="the-goal">The Goal</h4>
<p>A configuration file might look like this:</p>
<pre><code>port=8080
host=localhost
max_clients=100
log_file=server.log</code></pre>
<p>Your program should:</p>
<ol type="1">
<li>Open the file</li>
<li>Read it line by line</li>
<li>Split each line into <code>key</code> and <code>value</code></li>
<li>Store or use those values</li>
</ol>
</section>
<section id="step-1.-define-a-structure-for-config" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-define-a-structure-for-config">Step 1. Define a Structure for Config</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb425"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb425-1"><a href="#cb425-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb425-2"><a href="#cb425-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb425-3"><a href="#cb425-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb425-4"><a href="#cb425-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb425-5"><a href="#cb425-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAX_LINE </span><span class="dv">128</span></span>
<span id="cb425-6"><a href="#cb425-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb425-7"><a href="#cb425-7" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb425-8"><a href="#cb425-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> port<span class="op">;</span></span>
<span id="cb425-9"><a href="#cb425-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> host<span class="op">[</span><span class="dv">64</span><span class="op">];</span></span>
<span id="cb425-10"><a href="#cb425-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> max_clients<span class="op">;</span></span>
<span id="cb425-11"><a href="#cb425-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> log_file<span class="op">[</span><span class="dv">64</span><span class="op">];</span></span>
<span id="cb425-12"><a href="#cb425-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Config<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This <code>Config</code> struct will hold parsed values.</p>
</section>
<section id="step-2.-implement-the-parser" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-implement-the-parser">Step 2. Implement the Parser</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb426"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb426-1"><a href="#cb426-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> load_config<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>filename<span class="op">,</span> Config <span class="op">*</span>cfg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb426-2"><a href="#cb426-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span>filename<span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb426-3"><a href="#cb426-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="op">{</span></span>
<span id="cb426-4"><a href="#cb426-4" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"Cannot open config file"</span><span class="op">);</span></span>
<span id="cb426-5"><a href="#cb426-5" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb426-6"><a href="#cb426-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb426-7"><a href="#cb426-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-8"><a href="#cb426-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> line<span class="op">[</span>MAX_LINE<span class="op">];</span></span>
<span id="cb426-9"><a href="#cb426-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>fgets<span class="op">(</span>line<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>line<span class="op">),</span> fp<span class="op">))</span> <span class="op">{</span></span>
<span id="cb426-10"><a href="#cb426-10" aria-hidden="true" tabindex="-1"></a>        line<span class="op">[</span>strcspn<span class="op">(</span>line<span class="op">,</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">)]</span> <span class="op">=</span> <span class="ch">'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">;</span> <span class="co">// remove newline</span></span>
<span id="cb426-11"><a href="#cb426-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-12"><a href="#cb426-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>line<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">==</span> <span class="ch">'#'</span> <span class="op">||</span> strlen<span class="op">(</span>line<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb426-13"><a href="#cb426-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span><span class="op">;</span> <span class="co">// skip comments and blanks</span></span>
<span id="cb426-14"><a href="#cb426-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-15"><a href="#cb426-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> key<span class="op">[</span><span class="dv">64</span><span class="op">],</span> value<span class="op">[</span><span class="dv">64</span><span class="op">];</span></span>
<span id="cb426-16"><a href="#cb426-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sscanf<span class="op">(</span>line<span class="op">,</span> <span class="st">"%63[^=]=</span><span class="sc">%63s</span><span class="st">"</span><span class="op">,</span> key<span class="op">,</span> value<span class="op">)</span> <span class="op">==</span> <span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb426-17"><a href="#cb426-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>key<span class="op">,</span> <span class="st">"port"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb426-18"><a href="#cb426-18" aria-hidden="true" tabindex="-1"></a>                cfg<span class="op">-&gt;</span>port <span class="op">=</span> atoi<span class="op">(</span>value<span class="op">);</span></span>
<span id="cb426-19"><a href="#cb426-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>key<span class="op">,</span> <span class="st">"host"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb426-20"><a href="#cb426-20" aria-hidden="true" tabindex="-1"></a>                strncpy<span class="op">(</span>cfg<span class="op">-&gt;</span>host<span class="op">,</span> value<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>cfg<span class="op">-&gt;</span>host<span class="op">));</span></span>
<span id="cb426-21"><a href="#cb426-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>key<span class="op">,</span> <span class="st">"max_clients"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb426-22"><a href="#cb426-22" aria-hidden="true" tabindex="-1"></a>                cfg<span class="op">-&gt;</span>max_clients <span class="op">=</span> atoi<span class="op">(</span>value<span class="op">);</span></span>
<span id="cb426-23"><a href="#cb426-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>key<span class="op">,</span> <span class="st">"log_file"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb426-24"><a href="#cb426-24" aria-hidden="true" tabindex="-1"></a>                strncpy<span class="op">(</span>cfg<span class="op">-&gt;</span>log_file<span class="op">,</span> value<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>cfg<span class="op">-&gt;</span>log_file<span class="op">));</span></span>
<span id="cb426-25"><a href="#cb426-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb426-26"><a href="#cb426-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb426-27"><a href="#cb426-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-28"><a href="#cb426-28" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb426-29"><a href="#cb426-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This function:</p>
<ul>
<li>Reads each line</li>
<li>Ignores comments and empty lines</li>
<li>Extracts key-value pairs using <code>sscanf()</code></li>
<li>Updates fields in <code>Config</code></li>
</ul>
</section>
<section id="step-3.-use-the-configuration" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-use-the-configuration">Step 3. Use the Configuration</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb427"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb427-1"><a href="#cb427-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb427-2"><a href="#cb427-2" aria-hidden="true" tabindex="-1"></a>    Config cfg <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb427-3"><a href="#cb427-3" aria-hidden="true" tabindex="-1"></a>    load_config<span class="op">(</span><span class="st">"config.txt"</span><span class="op">,</span> <span class="op">&amp;</span>cfg<span class="op">);</span></span>
<span id="cb427-4"><a href="#cb427-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-5"><a href="#cb427-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Server settings:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb427-6"><a href="#cb427-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Host: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> cfg<span class="op">.</span>host<span class="op">);</span></span>
<span id="cb427-7"><a href="#cb427-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Port: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> cfg<span class="op">.</span>port<span class="op">);</span></span>
<span id="cb427-8"><a href="#cb427-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Max clients: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> cfg<span class="op">.</span>max_clients<span class="op">);</span></span>
<span id="cb427-9"><a href="#cb427-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Log file: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> cfg<span class="op">.</span>log_file<span class="op">);</span></span>
<span id="cb427-10"><a href="#cb427-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-11"><a href="#cb427-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb427-12"><a href="#cb427-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run with a <code>config.txt</code> file:</p>
<pre><code>host=127.0.0.1
port=9090
max_clients=250
log_file=/tmp/server.log</code></pre>
<p>Output:</p>
<pre><code>Server settings:
Host: 127.0.0.1
Port: 9090
Max clients: 250
Log file: /tmp/server.log</code></pre>
</section>
<section id="tiny-code-default-fallbacks" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-default-fallbacks">Tiny Code: Default Fallbacks</h4>
<p>You can initialize sensible defaults before reading the file:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb430"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb430-1"><a href="#cb430-1" aria-hidden="true" tabindex="-1"></a>Config cfg <span class="op">=</span> <span class="op">{</span></span>
<span id="cb430-2"><a href="#cb430-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>port <span class="op">=</span> <span class="dv">8080</span><span class="op">,</span></span>
<span id="cb430-3"><a href="#cb430-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>host <span class="op">=</span> <span class="st">"localhost"</span><span class="op">,</span></span>
<span id="cb430-4"><a href="#cb430-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>max_clients <span class="op">=</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb430-5"><a href="#cb430-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>log_file <span class="op">=</span> <span class="st">"server.log"</span></span>
<span id="cb430-6"><a href="#cb430-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This ensures your program still works even if the file is missing some values.</p>
</section>
<section id="step-4.-optional-handle-quoted-values" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-optional-handle-quoted-values">Step 4. Optional: Handle Quoted Values</h4>
<p>If you expect values with spaces (like <code>name="My Server"</code>), you can modify parsing logic:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb431"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb431-1"><a href="#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sscanf<span class="op">(</span>line<span class="op">,</span> <span class="st">"%63[^=]=</span><span class="sc">\"</span><span class="st">%63[^</span><span class="sc">\"</span><span class="st">]</span><span class="sc">\"</span><span class="st">"</span><span class="op">,</span> key<span class="op">,</span> value<span class="op">)</span> <span class="op">==</span> <span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb431-2"><a href="#cb431-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// handle quoted strings</span></span>
<span id="cb431-3"><a href="#cb431-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-5.-optional-generic-storage" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-optional-generic-storage">Step 5. Optional: Generic Storage</h4>
<p>For more flexible systems, you can use a hash table or array of key-value pairs instead of fixed fields:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb432"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb432-1"><a href="#cb432-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb432-2"><a href="#cb432-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> key<span class="op">[</span><span class="dv">64</span><span class="op">];</span></span>
<span id="cb432-3"><a href="#cb432-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> value<span class="op">[</span><span class="dv">64</span><span class="op">];</span></span>
<span id="cb432-4"><a href="#cb432-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> KVPair<span class="op">;</span></span>
<span id="cb432-5"><a href="#cb432-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-6"><a href="#cb432-6" aria-hidden="true" tabindex="-1"></a>KVPair settings<span class="op">[</span><span class="dv">100</span><span class="op">];</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This allows loading arbitrary keys without recompiling the program.</p>
</section>
<section id="why-it-matters-45" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-45">Why It Matters</h4>
<p>Configuration files let you:</p>
<ul>
<li><strong>Separate code from data</strong>, no need to recompile to change behavior</li>
<li><strong>Adapt to environments</strong>, dev, test, production</li>
<li><strong>Make your program reusable</strong> by others</li>
</ul>
<p>They’re used everywhere, from <code>.ini</code> and <code>.conf</code> files to complex YAML/JSON formats in modern systems.</p>
</section>
<section id="try-it-yourself-46" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-46">Try It Yourself</h4>
<ol type="1">
<li>Add support for <code>#</code> comments and empty lines (skip them safely).</li>
<li>Make the parser print a warning for unknown keys.</li>
<li>Add a function <code>save_config()</code> that writes the struct back to a file.</li>
<li>Add <code>reload_config()</code> to update settings at runtime.</li>
<li>Implement your own <code>.ini</code> format parser supporting <code>[section]</code> headers.</li>
</ol>
<p>With configuration files, your C programs gain flexibility and real-world usability, they can adapt, reload, and persist settings just like professional systems software. Next, you’ll learn how to <strong>serialize and deserialize structs to disk</strong>, the next level of persistent data handling in Section 49.</p>
</section>
</section>
<section id="serializing-structs-to-disk" class="level3">
<h3 class="anchored" data-anchor-id="serializing-structs-to-disk">49. Serializing Structs to Disk</h3>
<p>So far, you’ve worked with text files, configuration files, and basic binary data. Now it’s time to combine those ideas into something more powerful, <strong>serialization</strong>: saving complete C structs to disk and restoring them later, exactly as they were in memory.</p>
<p>This is the foundation for databases, caches, and persistent state in operating systems and games.</p>
<section id="what-is-serialization" class="level4">
<h4 class="anchored" data-anchor-id="what-is-serialization">What Is Serialization?</h4>
<p><strong>Serialization</strong> means converting in-memory data into a format that can be stored or transmitted (like a file). <strong>Deserialization</strong> is the reverse: reconstructing that data from the file.</p>
<p>In C, this often means writing structs directly as binary data with <code>fwrite()</code> and reading them back with <code>fread()</code>.</p>
</section>
<section id="step-1.-define-a-struct-to-store" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-define-a-struct-to-store">Step 1. Define a Struct to Store</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb433"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb433-2"><a href="#cb433-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb433-3"><a href="#cb433-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb433-4"><a href="#cb433-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb433-5"><a href="#cb433-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb433-6"><a href="#cb433-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb433-7"><a href="#cb433-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">50</span><span class="op">];</span></span>
<span id="cb433-8"><a href="#cb433-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> price<span class="op">;</span></span>
<span id="cb433-9"><a href="#cb433-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Product<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Each field is fixed-size, which makes it safe to write directly to disk as binary.</p>
</section>
<section id="step-2.-write-structs-to-disk" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-write-structs-to-disk">Step 2. Write Structs to Disk</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb434"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb434-1"><a href="#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> save_products<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>filename<span class="op">,</span> Product <span class="op">*</span>arr<span class="op">,</span> <span class="dt">size_t</span> count<span class="op">)</span> <span class="op">{</span></span>
<span id="cb434-2"><a href="#cb434-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span>filename<span class="op">,</span> <span class="st">"wb"</span><span class="op">);</span></span>
<span id="cb434-3"><a href="#cb434-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="op">{</span></span>
<span id="cb434-4"><a href="#cb434-4" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"Cannot open file for writing"</span><span class="op">);</span></span>
<span id="cb434-5"><a href="#cb434-5" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb434-6"><a href="#cb434-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb434-7"><a href="#cb434-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb434-8"><a href="#cb434-8" aria-hidden="true" tabindex="-1"></a>    fwrite<span class="op">(</span>arr<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Product<span class="op">),</span> count<span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb434-9"><a href="#cb434-9" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb434-10"><a href="#cb434-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-3.-read-structs-from-disk" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-read-structs-from-disk">Step 3. Read Structs from Disk</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb435"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb435-1"><a href="#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="dt">size_t</span> load_products<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>filename<span class="op">,</span> Product <span class="op">*</span>arr<span class="op">,</span> <span class="dt">size_t</span> max_count<span class="op">)</span> <span class="op">{</span></span>
<span id="cb435-2"><a href="#cb435-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span>filename<span class="op">,</span> <span class="st">"rb"</span><span class="op">);</span></span>
<span id="cb435-3"><a href="#cb435-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="op">{</span></span>
<span id="cb435-4"><a href="#cb435-4" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"Cannot open file for reading"</span><span class="op">);</span></span>
<span id="cb435-5"><a href="#cb435-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb435-6"><a href="#cb435-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb435-7"><a href="#cb435-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-8"><a href="#cb435-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> n <span class="op">=</span> fread<span class="op">(</span>arr<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Product<span class="op">),</span> max_count<span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb435-9"><a href="#cb435-9" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb435-10"><a href="#cb435-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb435-11"><a href="#cb435-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="tiny-code-complete-example" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-complete-example">Tiny Code: Complete Example</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb436"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb436-1"><a href="#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb436-2"><a href="#cb436-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb436-3"><a href="#cb436-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb436-4"><a href="#cb436-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-5"><a href="#cb436-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb436-6"><a href="#cb436-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb436-7"><a href="#cb436-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">50</span><span class="op">];</span></span>
<span id="cb436-8"><a href="#cb436-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> price<span class="op">;</span></span>
<span id="cb436-9"><a href="#cb436-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Product<span class="op">;</span></span>
<span id="cb436-10"><a href="#cb436-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-11"><a href="#cb436-11" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> save_products<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>filename<span class="op">,</span> Product <span class="op">*</span>arr<span class="op">,</span> <span class="dt">size_t</span> count<span class="op">)</span> <span class="op">{</span></span>
<span id="cb436-12"><a href="#cb436-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span>filename<span class="op">,</span> <span class="st">"wb"</span><span class="op">);</span></span>
<span id="cb436-13"><a href="#cb436-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="op">{</span></span>
<span id="cb436-14"><a href="#cb436-14" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"Cannot open file"</span><span class="op">);</span></span>
<span id="cb436-15"><a href="#cb436-15" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb436-16"><a href="#cb436-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb436-17"><a href="#cb436-17" aria-hidden="true" tabindex="-1"></a>    fwrite<span class="op">(</span>arr<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Product<span class="op">),</span> count<span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb436-18"><a href="#cb436-18" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb436-19"><a href="#cb436-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb436-20"><a href="#cb436-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-21"><a href="#cb436-21" aria-hidden="true" tabindex="-1"></a><span class="dt">size_t</span> load_products<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>filename<span class="op">,</span> Product <span class="op">*</span>arr<span class="op">,</span> <span class="dt">size_t</span> max_count<span class="op">)</span> <span class="op">{</span></span>
<span id="cb436-22"><a href="#cb436-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span>filename<span class="op">,</span> <span class="st">"rb"</span><span class="op">);</span></span>
<span id="cb436-23"><a href="#cb436-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="op">{</span></span>
<span id="cb436-24"><a href="#cb436-24" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"Cannot open file"</span><span class="op">);</span></span>
<span id="cb436-25"><a href="#cb436-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb436-26"><a href="#cb436-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb436-27"><a href="#cb436-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> n <span class="op">=</span> fread<span class="op">(</span>arr<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Product<span class="op">),</span> max_count<span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb436-28"><a href="#cb436-28" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb436-29"><a href="#cb436-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb436-30"><a href="#cb436-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb436-31"><a href="#cb436-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-32"><a href="#cb436-32" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb436-33"><a href="#cb436-33" aria-hidden="true" tabindex="-1"></a>    Product products<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb436-34"><a href="#cb436-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="st">"Notebook"</span><span class="op">,</span> <span class="fl">2.99</span><span class="op">},</span></span>
<span id="cb436-35"><a href="#cb436-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">2</span><span class="op">,</span> <span class="st">"Pencil"</span><span class="op">,</span> <span class="fl">0.49</span><span class="op">},</span></span>
<span id="cb436-36"><a href="#cb436-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">3</span><span class="op">,</span> <span class="st">"Backpack"</span><span class="op">,</span> <span class="fl">25.00</span><span class="op">}</span></span>
<span id="cb436-37"><a href="#cb436-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb436-38"><a href="#cb436-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-39"><a href="#cb436-39" aria-hidden="true" tabindex="-1"></a>    save_products<span class="op">(</span><span class="st">"store.bin"</span><span class="op">,</span> products<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb436-40"><a href="#cb436-40" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Products saved.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb436-41"><a href="#cb436-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-42"><a href="#cb436-42" aria-hidden="true" tabindex="-1"></a>    Product loaded<span class="op">[</span><span class="dv">3</span><span class="op">];</span></span>
<span id="cb436-43"><a href="#cb436-43" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> n <span class="op">=</span> load_products<span class="op">(</span><span class="st">"store.bin"</span><span class="op">,</span> loaded<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb436-44"><a href="#cb436-44" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Loaded </span><span class="sc">%zu</span><span class="st"> products:</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> n<span class="op">);</span></span>
<span id="cb436-45"><a href="#cb436-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-46"><a href="#cb436-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb436-47"><a href="#cb436-47" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> | </span><span class="sc">%-10s</span><span class="st"> | $</span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> loaded<span class="op">[</span>i<span class="op">].</span>id<span class="op">,</span> loaded<span class="op">[</span>i<span class="op">].</span>name<span class="op">,</span> loaded<span class="op">[</span>i<span class="op">].</span>price<span class="op">);</span></span>
<span id="cb436-48"><a href="#cb436-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-49"><a href="#cb436-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb436-50"><a href="#cb436-50" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Products saved.
Loaded 3 products:
1 | Notebook   | $2.99
2 | Pencil     | $0.49
3 | Backpack   | $25.00</code></pre>
</section>
<section id="step-4.-appending-records" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-appending-records">Step 4. Appending Records</h4>
<p>You can add more data without overwriting by using append mode <code>"ab"</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb438"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb438-1"><a href="#cb438-1" aria-hidden="true" tabindex="-1"></a>Product p <span class="op">=</span> <span class="op">{</span><span class="dv">4</span><span class="op">,</span> <span class="st">"Eraser"</span><span class="op">,</span> <span class="fl">0.99</span><span class="op">};</span></span>
<span id="cb438-2"><a href="#cb438-2" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"store.bin"</span><span class="op">,</span> <span class="st">"ab"</span><span class="op">);</span></span>
<span id="cb438-3"><a href="#cb438-3" aria-hidden="true" tabindex="-1"></a>fwrite<span class="op">(&amp;</span>p<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Product<span class="op">),</span> <span class="dv">1</span><span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb438-4"><a href="#cb438-4" aria-hidden="true" tabindex="-1"></a>fclose<span class="op">(</span>fp<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-5.-random-access-to-records" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-random-access-to-records">Step 5. Random Access to Records</h4>
<p>You can use <code>fseek()</code> to jump to a specific record (useful for updating or reading one record at a time).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb439"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb439-1"><a href="#cb439-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"store.bin"</span><span class="op">,</span> <span class="st">"rb"</span><span class="op">);</span></span>
<span id="cb439-2"><a href="#cb439-2" aria-hidden="true" tabindex="-1"></a>fseek<span class="op">(</span>fp<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Product<span class="op">)</span> <span class="op">*</span> <span class="dv">1</span><span class="op">,</span> SEEK_SET<span class="op">);</span>  <span class="co">// skip first record</span></span>
<span id="cb439-3"><a href="#cb439-3" aria-hidden="true" tabindex="-1"></a>Product p<span class="op">;</span></span>
<span id="cb439-4"><a href="#cb439-4" aria-hidden="true" tabindex="-1"></a>fread<span class="op">(&amp;</span>p<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Product<span class="op">),</span> <span class="dv">1</span><span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb439-5"><a href="#cb439-5" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Record 2: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> p<span class="op">.</span>name<span class="op">);</span></span>
<span id="cb439-6"><a href="#cb439-6" aria-hidden="true" tabindex="-1"></a>fclose<span class="op">(</span>fp<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-6.-portability-considerations" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-portability-considerations">Step 6. Portability Considerations</h4>
<p>Serialization like this is <strong>machine-dependent</strong> because of:</p>
<ul>
<li><strong>Endianness</strong> (byte order of integers/floats)</li>
<li><strong>Structure padding</strong> (compiler alignment)</li>
<li><strong>Data type sizes</strong></li>
</ul>
<p>To make it portable:</p>
<ul>
<li>Use <code>#pragma pack(1)</code> or <code>__attribute__((packed))</code> to disable padding.</li>
<li>Convert integers to a standard byte order (e.g., use <code>htonl()</code> and <code>ntohl()</code>).</li>
<li>Consider text-based or portable formats like CSV, JSON, or protobuf for cross-platform storage.</li>
</ul>
</section>
<section id="step-7.-text-based-alternative-human-readable" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-text-based-alternative-human-readable">Step 7. Text-Based Alternative (Human-Readable)</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb440"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb440-1"><a href="#cb440-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> save_as_text<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>filename<span class="op">,</span> Product <span class="op">*</span>arr<span class="op">,</span> <span class="dt">size_t</span> count<span class="op">)</span> <span class="op">{</span></span>
<span id="cb440-2"><a href="#cb440-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span>filename<span class="op">,</span> <span class="st">"w"</span><span class="op">);</span></span>
<span id="cb440-3"><a href="#cb440-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb440-4"><a href="#cb440-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> count<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb440-5"><a href="#cb440-5" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>fp<span class="op">,</span> <span class="st">"</span><span class="sc">%d</span><span class="st">,</span><span class="sc">%s</span><span class="st">,</span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> arr<span class="op">[</span>i<span class="op">].</span>id<span class="op">,</span> arr<span class="op">[</span>i<span class="op">].</span>name<span class="op">,</span> arr<span class="op">[</span>i<span class="op">].</span>price<span class="op">);</span></span>
<span id="cb440-6"><a href="#cb440-6" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb440-7"><a href="#cb440-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This produces:</p>
<pre><code>1,Notebook,2.99
2,Pencil,0.49
3,Backpack,25.00</code></pre>
<p>Easy to read, but slower to parse and less space-efficient.</p>
</section>
<section id="why-it-matters-46" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-46">Why It Matters</h4>
<p>Serialization makes your C programs <em>stateful</em>, they can save progress, store data, or recover after restarts. It’s the basis for:</p>
<ul>
<li>Databases and key-value stores</li>
<li>Save files in games</li>
<li>Checkpointing in scientific software</li>
<li>System daemons and caches</li>
</ul>
<p>You’re now handling <strong>real persistence</strong> in C.</p>
</section>
<section id="try-it-yourself-47" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-47">Try It Yourself</h4>
<ol type="1">
<li>Add a function <code>add_product()</code> that appends new records safely.</li>
<li>Implement <code>list_products()</code> that prints all products from file.</li>
<li>Add a “delete by id” operation by copying all but one record to a new file.</li>
<li>Experiment with structure padding (<code>sizeof(Product)</code> may not be what you expect).</li>
<li>Add a checksum field to detect corrupted data.</li>
</ol>
<p>You now know how to persist structured data in binary or text form. Next, you’ll close Chapter 5 by combining all this knowledge, writing a <strong>log reader and writer</strong> system that records events, rotates files, and safely replays logs on startup.</p>
</section>
</section>
<section id="practice-build-a-log-reader-and-writer" class="level3">
<h3 class="anchored" data-anchor-id="practice-build-a-log-reader-and-writer">50. Practice: Build a Log Reader and Writer</h3>
<p>You’ve explored text and binary I/O, buffering, error handling, and configuration. Now it’s time to bring everything together in one real-world practice project, a <strong>Log Reader and Writer</strong> in C.</p>
<p>This system will let you write structured logs to a file and later read them back, a foundation for tools like servers, daemons, and debugging utilities.</p>
<section id="project-overview-1" class="level4">
<h4 class="anchored" data-anchor-id="project-overview-1">Project Overview</h4>
<p>You’ll build a minimal logging system with two main parts:</p>
<ol type="1">
<li><p><strong>Logger (Writer):</strong></p>
<ul>
<li>Appends log messages to a file with timestamps and levels (INFO, WARN, ERROR).</li>
<li>Handles file opening, writing, and safe closure.</li>
</ul></li>
<li><p><strong>Reader:</strong></p>
<ul>
<li>Reads log entries line by line.</li>
<li>Filters by log level or keyword.</li>
</ul></li>
</ol>
<p>This project teaches structured file I/O, formatted output, parsing, and simple text search, all in clean C.</p>
</section>
<section id="step-1.-define-the-log-format" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-define-the-log-format">Step 1. Define the Log Format</h4>
<p>A log line will look like this:</p>
<pre><code>[2025-10-15 21:00:32] [INFO] Server started
[2025-10-15 21:01:05] [WARN] High CPU usage
[2025-10-15 21:02:10] [ERROR] Connection failed</code></pre>
<p>Each entry includes:</p>
<ul>
<li>Timestamp</li>
<li>Level (INFO/WARN/ERROR)</li>
<li>Message</li>
</ul>
</section>
<section id="step-2.-implement-the-logger" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-implement-the-logger">Step 2. Implement the Logger</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb443"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb443-1"><a href="#cb443-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb443-2"><a href="#cb443-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb443-3"><a href="#cb443-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb443-4"><a href="#cb443-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdarg.h&gt;</span></span>
<span id="cb443-5"><a href="#cb443-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb443-6"><a href="#cb443-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-7"><a href="#cb443-7" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">enum</span> <span class="op">{</span></span>
<span id="cb443-8"><a href="#cb443-8" aria-hidden="true" tabindex="-1"></a>    INFO<span class="op">,</span></span>
<span id="cb443-9"><a href="#cb443-9" aria-hidden="true" tabindex="-1"></a>    WARN<span class="op">,</span></span>
<span id="cb443-10"><a href="#cb443-10" aria-hidden="true" tabindex="-1"></a>    ERROR</span>
<span id="cb443-11"><a href="#cb443-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> LogLevel<span class="op">;</span></span>
<span id="cb443-12"><a href="#cb443-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-13"><a href="#cb443-13" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">char</span><span class="op">*</span> level_to_string<span class="op">(</span>LogLevel level<span class="op">)</span> <span class="op">{</span></span>
<span id="cb443-14"><a href="#cb443-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>level<span class="op">)</span> <span class="op">{</span></span>
<span id="cb443-15"><a href="#cb443-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> INFO<span class="op">:</span> <span class="cf">return</span> <span class="st">"INFO"</span><span class="op">;</span></span>
<span id="cb443-16"><a href="#cb443-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> WARN<span class="op">:</span> <span class="cf">return</span> <span class="st">"WARN"</span><span class="op">;</span></span>
<span id="cb443-17"><a href="#cb443-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> ERROR<span class="op">:</span> <span class="cf">return</span> <span class="st">"ERROR"</span><span class="op">;</span></span>
<span id="cb443-18"><a href="#cb443-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">default</span><span class="op">:</span> <span class="cf">return</span> <span class="st">"UNKNOWN"</span><span class="op">;</span></span>
<span id="cb443-19"><a href="#cb443-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb443-20"><a href="#cb443-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb443-21"><a href="#cb443-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-22"><a href="#cb443-22" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> write_log<span class="op">(</span><span class="dt">FILE</span> <span class="op">*</span>fp<span class="op">,</span> LogLevel level<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>fmt<span class="op">,</span> <span class="op">...)</span> <span class="op">{</span></span>
<span id="cb443-23"><a href="#cb443-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb443-24"><a href="#cb443-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-25"><a href="#cb443-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Timestamp</span></span>
<span id="cb443-26"><a href="#cb443-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">time_t</span> t <span class="op">=</span> time<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb443-27"><a href="#cb443-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> tm <span class="op">*</span>tm_info <span class="op">=</span> localtime<span class="op">(&amp;</span>t<span class="op">);</span></span>
<span id="cb443-28"><a href="#cb443-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> timebuf<span class="op">[</span><span class="dv">32</span><span class="op">];</span></span>
<span id="cb443-29"><a href="#cb443-29" aria-hidden="true" tabindex="-1"></a>    strftime<span class="op">(</span>timebuf<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>timebuf<span class="op">),</span> <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S"</span><span class="op">,</span> tm_info<span class="op">);</span></span>
<span id="cb443-30"><a href="#cb443-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-31"><a href="#cb443-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Format message</span></span>
<span id="cb443-32"><a href="#cb443-32" aria-hidden="true" tabindex="-1"></a>    <span class="dt">va_list</span> args<span class="op">;</span></span>
<span id="cb443-33"><a href="#cb443-33" aria-hidden="true" tabindex="-1"></a>    va_start<span class="op">(</span>args<span class="op">,</span> fmt<span class="op">);</span></span>
<span id="cb443-34"><a href="#cb443-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-35"><a href="#cb443-35" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>fp<span class="op">,</span> <span class="st">"[</span><span class="sc">%s</span><span class="st">] [</span><span class="sc">%s</span><span class="st">] "</span><span class="op">,</span> timebuf<span class="op">,</span> level_to_string<span class="op">(</span>level<span class="op">));</span></span>
<span id="cb443-36"><a href="#cb443-36" aria-hidden="true" tabindex="-1"></a>    vfprintf<span class="op">(</span>fp<span class="op">,</span> fmt<span class="op">,</span> args<span class="op">);</span></span>
<span id="cb443-37"><a href="#cb443-37" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>fp<span class="op">,</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb443-38"><a href="#cb443-38" aria-hidden="true" tabindex="-1"></a>    fflush<span class="op">(</span>fp<span class="op">);</span> <span class="co">// flush immediately for safety</span></span>
<span id="cb443-39"><a href="#cb443-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-40"><a href="#cb443-40" aria-hidden="true" tabindex="-1"></a>    va_end<span class="op">(</span>args<span class="op">);</span></span>
<span id="cb443-41"><a href="#cb443-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-3.-example-writer-program" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-example-writer-program">Step 3. Example Writer Program</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb444"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb444-1"><a href="#cb444-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb444-2"><a href="#cb444-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>log <span class="op">=</span> fopen<span class="op">(</span><span class="st">"system.log"</span><span class="op">,</span> <span class="st">"a"</span><span class="op">);</span></span>
<span id="cb444-3"><a href="#cb444-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>log<span class="op">)</span> <span class="op">{</span></span>
<span id="cb444-4"><a href="#cb444-4" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"Cannot open log file"</span><span class="op">);</span></span>
<span id="cb444-5"><a href="#cb444-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb444-6"><a href="#cb444-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb444-7"><a href="#cb444-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-8"><a href="#cb444-8" aria-hidden="true" tabindex="-1"></a>    write_log<span class="op">(</span>log<span class="op">,</span> INFO<span class="op">,</span> <span class="st">"System started"</span><span class="op">);</span></span>
<span id="cb444-9"><a href="#cb444-9" aria-hidden="true" tabindex="-1"></a>    write_log<span class="op">(</span>log<span class="op">,</span> WARN<span class="op">,</span> <span class="st">"Low disk space on /dev/sda1"</span><span class="op">);</span></span>
<span id="cb444-10"><a href="#cb444-10" aria-hidden="true" tabindex="-1"></a>    write_log<span class="op">(</span>log<span class="op">,</span> ERROR<span class="op">,</span> <span class="st">"Failed to connect to database"</span><span class="op">);</span></span>
<span id="cb444-11"><a href="#cb444-11" aria-hidden="true" tabindex="-1"></a>    write_log<span class="op">(</span>log<span class="op">,</span> INFO<span class="op">,</span> <span class="st">"Shutdown complete"</span><span class="op">);</span></span>
<span id="cb444-12"><a href="#cb444-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-13"><a href="#cb444-13" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>log<span class="op">);</span></span>
<span id="cb444-14"><a href="#cb444-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb444-15"><a href="#cb444-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run it:</p>
<pre><code>[2025-10-15 21:00:32] [INFO] System started
[2025-10-15 21:00:35] [WARN] Low disk space on /dev/sda1
[2025-10-15 21:00:38] [ERROR] Failed to connect to database
[2025-10-15 21:01:00] [INFO] Shutdown complete</code></pre>
</section>
<section id="step-4.-implement-the-reader" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-implement-the-reader">Step 4. Implement the Reader</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb446"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb446-1"><a href="#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb446-2"><a href="#cb446-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb446-3"><a href="#cb446-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-4"><a href="#cb446-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> read_logs<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>filename<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>filter<span class="op">)</span> <span class="op">{</span></span>
<span id="cb446-5"><a href="#cb446-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span>filename<span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb446-6"><a href="#cb446-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="op">{</span></span>
<span id="cb446-7"><a href="#cb446-7" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"Cannot open log file"</span><span class="op">);</span></span>
<span id="cb446-8"><a href="#cb446-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb446-9"><a href="#cb446-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb446-10"><a href="#cb446-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-11"><a href="#cb446-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> line<span class="op">[</span><span class="dv">256</span><span class="op">];</span></span>
<span id="cb446-12"><a href="#cb446-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>fgets<span class="op">(</span>line<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>line<span class="op">),</span> fp<span class="op">))</span> <span class="op">{</span></span>
<span id="cb446-13"><a href="#cb446-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>filter <span class="op">==</span> NULL <span class="op">||</span> strstr<span class="op">(</span>line<span class="op">,</span> filter<span class="op">))</span></span>
<span id="cb446-14"><a href="#cb446-14" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> line<span class="op">);</span></span>
<span id="cb446-15"><a href="#cb446-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb446-16"><a href="#cb446-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-17"><a href="#cb446-17" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb446-18"><a href="#cb446-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example usage:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb447"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb447-1"><a href="#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb447-2"><a href="#cb447-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"All logs:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb447-3"><a href="#cb447-3" aria-hidden="true" tabindex="-1"></a>    read_logs<span class="op">(</span><span class="st">"system.log"</span><span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb447-4"><a href="#cb447-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-5"><a href="#cb447-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Only errors:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb447-6"><a href="#cb447-6" aria-hidden="true" tabindex="-1"></a>    read_logs<span class="op">(</span><span class="st">"system.log"</span><span class="op">,</span> <span class="st">"ERROR"</span><span class="op">);</span></span>
<span id="cb447-7"><a href="#cb447-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb447-8"><a href="#cb447-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>All logs:
[2025-10-15 21:00:32] [INFO] System started
[2025-10-15 21:00:35] [WARN] Low disk space on /dev/sda1
[2025-10-15 21:00:38] [ERROR] Failed to connect to database
[2025-10-15 21:01:00] [INFO] Shutdown complete

Only errors:
[2025-10-15 21:00:38] [ERROR] Failed to connect to database</code></pre>
</section>
<section id="step-5.-add-command-line-interface" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-add-command-line-interface">Step 5. Add Command-Line Interface</h4>
<p>Combine both features using <code>argc</code> and <code>argv</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb449"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb449-1"><a href="#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span> <span class="op">{</span></span>
<span id="cb449-2"><a href="#cb449-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>argc <span class="op">&lt;</span> <span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb449-3"><a href="#cb449-3" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Usage: </span><span class="sc">%s</span><span class="st"> [write|read] [message/filter]</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb449-4"><a href="#cb449-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb449-5"><a href="#cb449-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb449-6"><a href="#cb449-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb449-7"><a href="#cb449-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span> <span class="st">"write"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb449-8"><a href="#cb449-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">FILE</span> <span class="op">*</span>log <span class="op">=</span> fopen<span class="op">(</span><span class="st">"system.log"</span><span class="op">,</span> <span class="st">"a"</span><span class="op">);</span></span>
<span id="cb449-9"><a href="#cb449-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>log<span class="op">)</span> <span class="op">{</span></span>
<span id="cb449-10"><a href="#cb449-10" aria-hidden="true" tabindex="-1"></a>            perror<span class="op">(</span><span class="st">"open"</span><span class="op">);</span></span>
<span id="cb449-11"><a href="#cb449-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb449-12"><a href="#cb449-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb449-13"><a href="#cb449-13" aria-hidden="true" tabindex="-1"></a>        write_log<span class="op">(</span>log<span class="op">,</span> INFO<span class="op">,</span> <span class="st">"</span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> argc <span class="op">&gt;</span> <span class="dv">2</span> <span class="op">?</span> argv<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">:</span> <span class="st">"Generic log entry"</span><span class="op">);</span></span>
<span id="cb449-14"><a href="#cb449-14" aria-hidden="true" tabindex="-1"></a>        fclose<span class="op">(</span>log<span class="op">);</span></span>
<span id="cb449-15"><a href="#cb449-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span> <span class="st">"read"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb449-16"><a href="#cb449-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>filter <span class="op">=</span> argc <span class="op">&gt;</span> <span class="dv">2</span> <span class="op">?</span> argv<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">:</span> NULL<span class="op">;</span></span>
<span id="cb449-17"><a href="#cb449-17" aria-hidden="true" tabindex="-1"></a>        read_logs<span class="op">(</span><span class="st">"system.log"</span><span class="op">,</span> filter<span class="op">);</span></span>
<span id="cb449-18"><a href="#cb449-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb449-19"><a href="#cb449-19" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Invalid command. Use write or read.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb449-20"><a href="#cb449-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb449-21"><a href="#cb449-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb449-22"><a href="#cb449-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Usage:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb450"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb450-1"><a href="#cb450-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./logger</span> write <span class="st">"Hello world"</span></span>
<span id="cb450-2"><a href="#cb450-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./logger</span> read</span>
<span id="cb450-3"><a href="#cb450-3" aria-hidden="true" tabindex="-1"></a><span class="ex">./logger</span> read ERROR</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-6.-handling-errors-gracefully" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-handling-errors-gracefully">Step 6. Handling Errors Gracefully</h4>
<ul>
<li>Always check return values from <code>fopen</code>, <code>fgets</code>, and <code>fprintf</code>.</li>
<li>Use <code>perror()</code> for system-level diagnostics.</li>
<li>Flush frequently or close properly to ensure logs persist after crashes.</li>
</ul>
</section>
<section id="step-7.-optional-enhancements" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-optional-enhancements">Step 7. Optional Enhancements</h4>
<ul>
<li>Add log rotation (rename or truncate after N lines).</li>
<li>Add log levels (only write logs above a threshold).</li>
<li>Implement <code>save_config()</code> to define a log file path and verbosity from a config file.</li>
<li>Add timestamps in UTC or with milliseconds for precision.</li>
<li>Write logs in binary format for higher speed, then parse later.</li>
</ul>
</section>
<section id="why-it-matters-47" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-47">Why It Matters</h4>
<p>Logging is a <strong>core system capability</strong>. This project reinforces:</p>
<ul>
<li>Structured file I/O</li>
<li>Error handling (<code>errno</code>, <code>perror</code>)</li>
<li>String parsing and filtering</li>
<li>Command-line tool design</li>
</ul>
<p>Every C-based system, from embedded devices to Linux daemons, relies on some form of logging.</p>
</section>
<section id="try-it-yourself-48" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-48">Try It Yourself</h4>
<ol type="1">
<li>Add a <code>LogLevel</code> threshold (ignore logs below WARN).</li>
<li>Implement a <code>rotate_logs()</code> that renames <code>system.log</code> to <code>system.log.1</code> when it exceeds 100 lines.</li>
<li>Add timestamps in UTC instead of localtime.</li>
<li>Use <code>argv</code> to let users specify a custom log file name.</li>
<li>Store logs both to file and to <code>stderr</code> simultaneously.</li>
</ol>
<p>This completes <strong>Chapter 5: Input, Output, and Files</strong>, a milestone in your journey. You can now handle text, binary, streams, and persistent data with safety and clarity. Next, you’ll step into <strong>Chapter 6: Compilation and the Build Process</strong>, where source code transforms into executable binaries through preprocessing, compilation, linking, and automation.</p>
</section>
</section>
</section>
<section id="chapter-6.-compilation-and-the-build-process" class="level1">
<h1>Chapter 6. Compilation and the build process</h1>
<section id="from-source-to-executable-the-compilation-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="from-source-to-executable-the-compilation-pipeline">51. From Source to Executable: The Compilation Pipeline</h3>
<p>Every time you run</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb451"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb451-1"><a href="#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> hello.c <span class="at">-o</span> hello</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>you’re launching a complex, multi-stage process that transforms human-readable C code into a machine-executable binary. Understanding this <strong>compilation pipeline</strong> is the heart of becoming a real systems programmer.</p>
<p>Let’s unpack what happens between your <code>.c</code> file and the final executable.</p>
<section id="step-1.-the-four-stages" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-the-four-stages">Step 1. The Four Stages</h4>
<p>A C compiler (like <code>gcc</code> or <code>clang</code>) performs four major stages internally:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 5%">
<col style="width: 16%">
<col style="width: 15%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th>Stage</th>
<th>Tool</th>
<th>Input</th>
<th>Output</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1. Preprocessing</td>
<td><code>cpp</code></td>
<td><code>hello.c</code></td>
<td>expanded source</td>
<td>Handles <code>#include</code>, <code>#define</code>, and macros</td>
</tr>
<tr class="even">
<td>2. Compilation</td>
<td><code>cc1</code></td>
<td>expanded source</td>
<td><code>hello.s</code></td>
<td>Translates C into assembly</td>
</tr>
<tr class="odd">
<td>3. Assembly</td>
<td><code>as</code></td>
<td><code>hello.s</code></td>
<td><code>hello.o</code></td>
<td>Converts assembly into machine code</td>
</tr>
<tr class="even">
<td>4. Linking</td>
<td><code>ld</code></td>
<td><code>.o</code> + libraries</td>
<td><code>hello</code></td>
<td>Combines everything into a runnable program</td>
</tr>
</tbody>
</table>
<p>You can stop at any step with compiler flags to see what’s happening.</p>
</section>
<section id="tiny-code-observe-each-stage" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-observe-each-stage">Tiny Code: Observe Each Stage</h4>
<p>Let’s use a simple program:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb452"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb452-1"><a href="#cb452-1" aria-hidden="true" tabindex="-1"></a><span class="co">// hello.c</span></span>
<span id="cb452-2"><a href="#cb452-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb452-3"><a href="#cb452-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-4"><a href="#cb452-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb452-5"><a href="#cb452-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hello, C!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb452-6"><a href="#cb452-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb452-7"><a href="#cb452-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run these commands to inspect each stage:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb453"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb453-1"><a href="#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Preprocessing</span></span>
<span id="cb453-2"><a href="#cb453-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-E</span> hello.c <span class="at">-o</span> hello.i</span>
<span id="cb453-3"><a href="#cb453-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-4"><a href="#cb453-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Compilation to Assembly</span></span>
<span id="cb453-5"><a href="#cb453-5" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-S</span> hello.i <span class="at">-o</span> hello.s</span>
<span id="cb453-6"><a href="#cb453-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-7"><a href="#cb453-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Assembly to Object File</span></span>
<span id="cb453-8"><a href="#cb453-8" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> hello.s <span class="at">-o</span> hello.o</span>
<span id="cb453-9"><a href="#cb453-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-10"><a href="#cb453-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Linking</span></span>
<span id="cb453-11"><a href="#cb453-11" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> hello.o <span class="at">-o</span> hello</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now check what each file looks like:</p>
<ul>
<li><code>hello.i</code>: C code with headers expanded</li>
<li><code>hello.s</code>: Human-readable assembly instructions</li>
<li><code>hello.o</code>: Machine code (binary object)</li>
<li><code>hello</code>: Final executable</li>
</ul>
<p>Run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb454"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb454-1"><a href="#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./hello</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Hello, C!</code></pre>
</section>
<section id="step-2.-preprocessing-include-define-if" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-preprocessing-include-define-if">Step 2. Preprocessing (<code>#include</code>, <code>#define</code>, <code>#if</code>)</h4>
<p>The preprocessor handles all lines starting with <code>#</code>. It’s purely textual, no code execution yet.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb456"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb456-1"><a href="#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-E</span> hello.c <span class="at">-o</span> hello.i</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Open <code>hello.i</code> and you’ll see thousands of lines from <code>stdio.h</code> inserted into your code. It also replaces macros and removes comments.</p>
<p>This is the stage where your <strong>headers</strong>, <strong>macros</strong>, and <strong>conditional compilation</strong> come to life.</p>
</section>
<section id="step-3.-compilation-to-assembly" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-compilation-to-assembly">Step 3. Compilation (to Assembly)</h4>
<p>Next, the compiler translates your preprocessed C code into <strong>assembly language</strong> for your target CPU.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb457"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb457-1"><a href="#cb457-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-S</span> hello.i <span class="at">-o</span> hello.s</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Open <code>hello.s</code> to peek at low-level instructions like:</p>
<pre><code>mov     edi, OFFSET FLAT:.LC0
call    puts</code></pre>
<p>These are CPU-specific, on x86, ARM, or RISC-V, they’ll differ. This stage also performs <strong>optimization</strong>, <strong>type checking</strong>, and <strong>error detection</strong>.</p>
</section>
<section id="step-4.-assembly-to-object-file" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-assembly-to-object-file">Step 4. Assembly (to Object File)</h4>
<p>The assembler converts the <code>.s</code> file into raw machine instructions and data structures, producing a <strong>relocatable object file</strong>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb459"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb459-1"><a href="#cb459-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> hello.s <span class="at">-o</span> hello.o</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You can inspect it with:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb460"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb460-1"><a href="#cb460-1" aria-hidden="true" tabindex="-1"></a><span class="ex">objdump</span> <span class="at">-d</span> hello.o</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Each function in your code becomes a <strong>symbol</strong> in this object file.</p>
</section>
<section id="step-5.-linking" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-linking">Step 5. Linking</h4>
<p>The linker (<code>ld</code>) combines object files and libraries into a single executable.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb461"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb461-1"><a href="#cb461-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> hello.o <span class="at">-o</span> hello</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If your program uses external functions (like <code>printf</code>), the linker locates them in system libraries (e.g., <code>/usr/lib/libc.so</code>) and records their addresses.</p>
<p>The result: one self-contained executable ready to run.</p>
</section>
<section id="step-6.-inspect-the-final-binary" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-inspect-the-final-binary">Step 6. Inspect the Final Binary</h4>
<p>Use tools like:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb462"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb462-1"><a href="#cb462-1" aria-hidden="true" tabindex="-1"></a><span class="fu">file</span> hello</span>
<span id="cb462-2"><a href="#cb462-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nm</span> hello <span class="kw">|</span> <span class="fu">head</span></span>
<span id="cb462-3"><a href="#cb462-3" aria-hidden="true" tabindex="-1"></a><span class="ex">readelf</span> <span class="at">-h</span> hello</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>These reveal:</p>
<ul>
<li>File type (ELF, Mach-O, etc.)</li>
<li>Defined and undefined symbols</li>
<li>Sections like <code>.text</code>, <code>.data</code>, <code>.bss</code></li>
</ul>
<p>You’re now seeing your C code at the machine level.</p>
</section>
<section id="step-7.-cleanup-and-automation" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-cleanup-and-automation">Step 7. Cleanup and Automation</h4>
<p>While it’s educational to run each step manually, most of the time you’ll rely on:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb463"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb463-1"><a href="#cb463-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> hello.c <span class="at">-o</span> hello</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>or a <code>Makefile</code> to orchestrate multiple files (we’ll cover that in Section 55).</p>
</section>
<section id="tiny-code-multi-file-example" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-multi-file-example">Tiny Code: Multi-File Example</h4>
<p>Let’s build a two-file program manually:</p>
<p><strong>main.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb464"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb464-1"><a href="#cb464-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"greet.h"</span></span>
<span id="cb464-2"><a href="#cb464-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb464-3"><a href="#cb464-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb464-4"><a href="#cb464-4" aria-hidden="true" tabindex="-1"></a>    greet<span class="op">(</span><span class="st">"C programmer"</span><span class="op">);</span></span>
<span id="cb464-5"><a href="#cb464-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb464-6"><a href="#cb464-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>greet.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb465"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb465-1"><a href="#cb465-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb465-2"><a href="#cb465-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> greet<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb465-3"><a href="#cb465-3" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hello, </span><span class="sc">%s</span><span class="st">!</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> name<span class="op">);</span></span>
<span id="cb465-4"><a href="#cb465-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>greet.h</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb466"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb466-1"><a href="#cb466-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> greet<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and link manually:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb467"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb467-1"><a href="#cb467-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> main.c</span>
<span id="cb467-2"><a href="#cb467-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> greet.c</span>
<span id="cb467-3"><a href="#cb467-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.o greet.o <span class="at">-o</span> app</span>
<span id="cb467-4"><a href="#cb467-4" aria-hidden="true" tabindex="-1"></a><span class="ex">./app</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Hello, C programmer!</code></pre>
</section>
<section id="why-it-matters-48" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-48">Why It Matters</h4>
<p>Understanding the compilation pipeline helps you:</p>
<ul>
<li>Debug tricky build errors (<code>undefined reference</code>, <code>multiple definition</code>, etc.)</li>
<li>Control optimization and debugging symbols</li>
<li>Inspect intermediate stages for learning or tuning performance</li>
<li>Build your own lightweight build systems or compilers</li>
</ul>
<p>This is how <strong>source code becomes machine reality</strong>, step by step, precisely defined.</p>
</section>
<section id="try-it-yourself-49" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-49">Try It Yourself</h4>
<ol type="1">
<li>Generate all intermediate files (<code>.i</code>, <code>.s</code>, <code>.o</code>) for a few programs and inspect them.</li>
<li>Experiment with <code>gcc -O0</code>, <code>-O2</code>, and <code>-O3</code> and observe how assembly changes.</li>
<li>Add <code>-g</code> and explore the binary with <code>gdb</code>.</li>
<li>Build a program that spans multiple <code>.c</code> files.</li>
<li>Use <code>nm</code> and <code>objdump</code> to trace how symbols move through the stages.</li>
</ol>
<p>Next, you’ll explore the <strong>preprocessor and macros</strong>, the engine behind includes, constants, and compile-time code generation.</p>
</section>
</section>
<section id="the-preprocessor-and-macros" class="level3">
<h3 class="anchored" data-anchor-id="the-preprocessor-and-macros">52. The Preprocessor and Macros</h3>
<p>Before your C code is ever compiled, it passes through a powerful text-handling stage called the <strong>preprocessor</strong>. This is where headers are included, macros are expanded, and conditional compilation happens.</p>
<p>The preprocessor doesn’t “understand” C, it performs text substitution and file inclusion, preparing your code for the compiler.</p>
<section id="step-1.-what-the-preprocessor-does" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-the-preprocessor-does">Step 1. What the Preprocessor Does</h4>
<p>Every line that starts with <code>#</code> is a <strong>preprocessor directive</strong>. Common ones include:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Directive</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>#include</code></td>
<td>Insert contents of a header file</td>
</tr>
<tr class="even">
<td><code>#define</code></td>
<td>Define a macro or constant</td>
</tr>
<tr class="odd">
<td><code>#undef</code></td>
<td>Remove a macro definition</td>
</tr>
<tr class="even">
<td><code>#if</code>, <code>#ifdef</code>, <code>#ifndef</code></td>
<td>Conditional compilation</td>
</tr>
<tr class="odd">
<td><code>#else</code>, <code>#elif</code>, <code>#endif</code></td>
<td>Branch logic for the preprocessor</td>
</tr>
<tr class="even">
<td><code>#error</code></td>
<td>Stop compilation with a message</td>
</tr>
<tr class="odd">
<td><code>#pragma</code></td>
<td>Compiler-specific instruction</td>
</tr>
</tbody>
</table>
</section>
<section id="tiny-code-see-it-in-action" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-see-it-in-action">Tiny Code: See It in Action</h4>
<p>Create <code>macro.c</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb469"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb469-1"><a href="#cb469-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb469-2"><a href="#cb469-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-3"><a href="#cb469-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PI </span><span class="fl">3.14159</span></span>
<span id="cb469-4"><a href="#cb469-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define CIRCLE_AREA</span><span class="op">(</span><span class="pp">r</span><span class="op">)</span><span class="pp"> </span><span class="op">(</span><span class="pp">PI </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">r</span><span class="op">)</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">r</span><span class="op">))</span></span>
<span id="cb469-5"><a href="#cb469-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SQUARE</span><span class="op">(</span><span class="pp">x</span><span class="op">)</span><span class="pp"> </span><span class="op">((</span><span class="pp">x</span><span class="op">)</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">x</span><span class="op">))</span></span>
<span id="cb469-6"><a href="#cb469-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-7"><a href="#cb469-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb469-8"><a href="#cb469-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"PI = </span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> PI<span class="op">);</span></span>
<span id="cb469-9"><a href="#cb469-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Area of circle (r=2): </span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> CIRCLE_AREA<span class="op">(</span><span class="dv">2</span><span class="op">));</span></span>
<span id="cb469-10"><a href="#cb469-10" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Square of 5: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> SQUARE<span class="op">(</span><span class="dv">5</span><span class="op">));</span></span>
<span id="cb469-11"><a href="#cb469-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb469-12"><a href="#cb469-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb470"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb470-1"><a href="#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> macro.c <span class="at">-o</span> macro</span>
<span id="cb470-2"><a href="#cb470-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./macro</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>PI = 3.14
Area of circle (r=2): 12.57
Square of 5: 25</code></pre>
</section>
<section id="step-2.-expanding-macros" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-expanding-macros">Step 2. Expanding Macros</h4>
<p>You can inspect the preprocessor output before compilation:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb472"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb472-1"><a href="#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-E</span> macro.c <span class="at">-o</span> macro.i</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Open <code>macro.i</code>, you’ll see all <code>#include</code> files expanded and macros replaced with their values.</p>
<p>This is a great way to <strong>debug macro behavior</strong> or check how large standard headers expand.</p>
</section>
<section id="step-3.-function-like-macros" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-function-like-macros">Step 3. Function-Like Macros</h4>
<p>Macros can look like functions, but they are <strong>expanded inline</strong>, meaning no call overhead, but also no type safety.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb473"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb473-1"><a href="#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define ADD</span><span class="op">(</span><span class="pp">a</span><span class="op">,</span><span class="pp"> b</span><span class="op">)</span><span class="pp"> </span><span class="op">((</span><span class="pp">a</span><span class="op">)</span><span class="pp"> </span><span class="op">+</span><span class="pp"> </span><span class="op">(</span><span class="pp">b</span><span class="op">))</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Usage:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb474"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb474-1"><a href="#cb474-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> ADD<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">));</span>  <span class="co">// becomes ((2) + (3))</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Be careful with missing parentheses:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb475"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb475-1"><a href="#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define BAD_ADD</span><span class="op">(</span><span class="pp">a</span><span class="op">,</span><span class="pp"> b</span><span class="op">)</span><span class="pp"> a </span><span class="op">+</span><span class="pp"> b</span></span>
<span id="cb475-2"><a href="#cb475-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="dv">2</span> <span class="op">*</span> BAD_ADD<span class="op">(</span><span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">));</span> <span class="co">// expands to 2 * 3 + 4 → 10, not 14</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Always wrap parameters and entire expressions in parentheses.</p>
</section>
<section id="step-4.-stringizing-and-token-pasting" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-stringizing-and-token-pasting">Step 4. Stringizing and Token Pasting</h4>
<p>Macros can manipulate text using special operators.</p>
<p><strong>Stringizing (<code>#</code>)</strong> turns an argument into a string literal:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb476"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb476-1"><a href="#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PRINT_EXPR</span><span class="op">(</span><span class="pp">expr</span><span class="op">)</span><span class="pp"> printf</span><span class="op">(#</span><span class="pp">expr </span><span class="st">" = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> expr</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Usage:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb477"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb477-1"><a href="#cb477-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">5</span><span class="op">,</span> y <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb477-2"><a href="#cb477-2" aria-hidden="true" tabindex="-1"></a>PRINT_EXPR<span class="op">(</span>x <span class="op">+</span> y<span class="op">);</span>  <span class="co">// prints: x + y = 15</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Token Pasting (<code>##</code>)</strong> concatenates tokens:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb478"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb478-1"><a href="#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAKE_VAR</span><span class="op">(</span><span class="pp">name</span><span class="op">,</span><span class="pp"> num</span><span class="op">)</span><span class="pp"> name</span><span class="op">##</span><span class="pp">num</span></span>
<span id="cb478-2"><a href="#cb478-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> MAKE_VAR<span class="op">(</span>counter<span class="op">,</span> <span class="dv">1</span><span class="op">)</span> <span class="op">=</span> <span class="dv">42</span><span class="op">;</span>  <span class="co">// becomes int counter1 = 42;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-5.-conditional-compilation" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-conditional-compilation">Step 5. Conditional Compilation</h4>
<p>You can include or exclude code based on conditions:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb479"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb479-1"><a href="#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define DEBUG </span><span class="dv">1</span></span>
<span id="cb479-2"><a href="#cb479-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-3"><a href="#cb479-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#if DEBUG</span></span>
<span id="cb479-4"><a href="#cb479-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define LOG</span><span class="op">(</span><span class="pp">msg</span><span class="op">)</span><span class="pp"> printf</span><span class="op">(</span><span class="st">"DEBUG: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> msg</span><span class="op">)</span></span>
<span id="cb479-5"><a href="#cb479-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span>
<span id="cb479-6"><a href="#cb479-6" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define LOG</span><span class="op">(</span><span class="pp">msg</span><span class="op">)</span></span>
<span id="cb479-7"><a href="#cb479-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Usage:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb480"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb480-1"><a href="#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb480-2"><a href="#cb480-2" aria-hidden="true" tabindex="-1"></a>    LOG<span class="op">(</span><span class="st">"Starting program"</span><span class="op">);</span></span>
<span id="cb480-3"><a href="#cb480-3" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Running main logic</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb480-4"><a href="#cb480-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb480-5"><a href="#cb480-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile with or without <code>-DDEBUG=1</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb481"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb481-1"><a href="#cb481-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-DDEBUG</span><span class="op">=</span>1 log.c <span class="at">-o</span> log</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You can also use:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb482"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb482-1"><a href="#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef DEBUG</span></span>
<span id="cb482-2"><a href="#cb482-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef RELEASE</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-6.-header-guards" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-header-guards">Step 6. Header Guards</h4>
<p>Prevent multiple inclusions of the same header file by using preprocessor guards:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb483"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb483-1"><a href="#cb483-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef MY_HEADER_H</span></span>
<span id="cb483-2"><a href="#cb483-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MY_HEADER_H</span></span>
<span id="cb483-3"><a href="#cb483-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-4"><a href="#cb483-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> greet<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span>
<span id="cb483-5"><a href="#cb483-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-6"><a href="#cb483-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If <code>MY_HEADER_H</code> is already defined, the contents are skipped. This prevents duplicate definitions across multiple includes.</p>
</section>
<section id="step-7.-built-in-macros" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-built-in-macros">Step 7. Built-in Macros</h4>
<p>The compiler defines a few handy macros automatically:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Macro</th>
<th>Expands To</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>__FILE__</code></td>
<td>current filename</td>
</tr>
<tr class="even">
<td><code>__LINE__</code></td>
<td>current line number</td>
</tr>
<tr class="odd">
<td><code>__DATE__</code></td>
<td>compilation date</td>
</tr>
<tr class="even">
<td><code>__TIME__</code></td>
<td>compilation time</td>
</tr>
<tr class="odd">
<td><code>__func__</code></td>
<td>current function name (C99+)</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb484"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb484-1"><a href="#cb484-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Error at </span><span class="sc">%s</span><span class="st">:</span><span class="sc">%d</span><span class="st"> in </span><span class="sc">%s</span><span class="st">()</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> __FILE__<span class="op">,</span> __LINE__<span class="op">,</span> __func__<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Error at macro.c:10 in main()</code></pre>
</section>
<section id="tiny-code-debug-macro" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-debug-macro">Tiny Code: Debug Macro</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb486"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb486-1"><a href="#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define DEBUG_PRINT</span><span class="op">(</span><span class="pp">fmt</span><span class="op">,</span><span class="pp"> </span><span class="op">...)</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb486-2"><a href="#cb486-2" aria-hidden="true" tabindex="-1"></a><span class="pp">    fprintf</span><span class="op">(</span><span class="pp">stderr</span><span class="op">,</span><span class="pp"> </span><span class="st">"[</span><span class="sc">%s</span><span class="st">:</span><span class="sc">%d</span><span class="st">] "</span><span class="pp"> fmt </span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> __FILE__</span><span class="op">,</span><span class="pp"> __LINE__</span><span class="op">,</span><span class="pp"> __VA_ARGS__</span><span class="op">)</span></span>
<span id="cb486-3"><a href="#cb486-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb486-4"><a href="#cb486-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb486-5"><a href="#cb486-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb486-6"><a href="#cb486-6" aria-hidden="true" tabindex="-1"></a>    DEBUG_PRINT<span class="op">(</span><span class="st">"x = </span><span class="sc">%d</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb486-7"><a href="#cb486-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb486-8"><a href="#cb486-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>[macro.c:5] x = 10</code></pre>
<p>This is how logging frameworks are implemented in C using macros.</p>
</section>
<section id="step-8.-undefining-and-redefining" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-undefining-and-redefining">Step 8. Undefining and Redefining</h4>
<p>You can remove a macro with <code>#undef</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb488"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb488-1"><a href="#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#undef PI</span></span>
<span id="cb488-2"><a href="#cb488-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PI </span><span class="fl">3.14</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This is often used in large projects to avoid macro name collisions between libraries.</p>
</section>
<section id="why-it-matters-49" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-49">Why It Matters</h4>
<p>The preprocessor gives C flexibility and power at <strong>compile time</strong>, enabling:</p>
<ul>
<li>Cross-platform builds (conditional compilation)</li>
<li>Debug logging systems</li>
<li>Inline performance optimizations</li>
<li>Simplified configuration management</li>
</ul>
<p>It’s also a double-edged sword, overusing macros can make code hard to debug and maintain. Modern C favors <strong>inline functions</strong> for most use cases (see Section 54), but macros remain indispensable for low-level systems work.</p>
</section>
<section id="try-it-yourself-50" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-50">Try It Yourself</h4>
<ol type="1">
<li>Write a macro that swaps two variables without a temporary.</li>
<li>Implement a <code>LOG(level, msg)</code> macro that prints messages only if <code>level &gt;= MIN_LOG_LEVEL</code>.</li>
<li>Use <code>__DATE__</code> and <code>__TIME__</code> to print build information.</li>
<li>Add header guards to all your <code>.h</code> files and test multiple inclusions.</li>
<li>Try <code>gcc -E</code> on different programs to understand how preprocessing changes the source.</li>
</ol>
<p>In the next section, you’ll go deeper into <strong>conditional compilation</strong>, controlling which parts of your program are built based on platform, features, or debugging needs.</p>
</section>
</section>
<section id="conditional-compilation-if-ifdef-ifndef" class="level3">
<h3 class="anchored" data-anchor-id="conditional-compilation-if-ifdef-ifndef">53. Conditional Compilation (<code>#if</code>, <code>#ifdef</code>, <code>#ifndef</code>)</h3>
<p>Conditional compilation lets you <strong>control which code gets compiled</strong>, not at runtime, but at compile time. This is how C programs adapt to different operating systems, architectures, or build configurations without changing source files manually.</p>
<p>Think of it as logic for the compiler’s <em>eyes only</em>.</p>
<section id="step-1.-why-conditional-compilation-exists" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-why-conditional-compilation-exists">Step 1. Why Conditional Compilation Exists</h4>
<p>Large C programs often need to handle differences such as:</p>
<ul>
<li>Platform (Windows, Linux, macOS, embedded)</li>
<li>Compiler (gcc, clang, MSVC)</li>
<li>Debug vs release builds</li>
<li>Optional features or experimental modules</li>
</ul>
<p>Instead of maintaining multiple versions of the same file, you can use conditional directives to selectively include or exclude code.</p>
</section>
<section id="step-2.-the-core-directives" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-the-core-directives">Step 2. The Core Directives</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Directive</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>#if &lt;expr&gt;</code></td>
<td>Compile code if expression is true</td>
</tr>
<tr class="even">
<td><code>#ifdef &lt;macro&gt;</code></td>
<td>Compile if macro is defined</td>
</tr>
<tr class="odd">
<td><code>#ifndef &lt;macro&gt;</code></td>
<td>Compile if macro is not defined</td>
</tr>
<tr class="even">
<td><code>#else</code></td>
<td>Alternate block</td>
</tr>
<tr class="odd">
<td><code>#elif &lt;expr&gt;</code></td>
<td>Else-if for preprocessor</td>
</tr>
<tr class="even">
<td><code>#endif</code></td>
<td>Marks the end of a conditional block</td>
</tr>
</tbody>
</table>
<p>These work only during <strong>preprocessing</strong>, before compilation starts.</p>
</section>
<section id="tiny-code-platform-specific-compilation" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-platform-specific-compilation">Tiny Code: Platform-Specific Compilation</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb489"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb489-1"><a href="#cb489-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb489-2"><a href="#cb489-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-3"><a href="#cb489-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb489-4"><a href="#cb489-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef _WIN32</span></span>
<span id="cb489-5"><a href="#cb489-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Running on Windows</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb489-6"><a href="#cb489-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#elif __linux__</span></span>
<span id="cb489-7"><a href="#cb489-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Running on Linux</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb489-8"><a href="#cb489-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#elif __APPLE__</span></span>
<span id="cb489-9"><a href="#cb489-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Running on macOS</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb489-10"><a href="#cb489-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span>
<span id="cb489-11"><a href="#cb489-11" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Unknown platform</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb489-12"><a href="#cb489-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb489-13"><a href="#cb489-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb489-14"><a href="#cb489-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run on your system. The output will depend on which predefined macros your compiler sets automatically.</p>
</section>
<section id="step-3.-enabling-and-disabling-features" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-enabling-and-disabling-features">Step 3. Enabling and Disabling Features</h4>
<p>You can define flags at compile time with <code>-D</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb490"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb490-1"><a href="#cb490-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-DDEBUG</span> log.c <span class="at">-o</span> log</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>In your code:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb491"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb491-1"><a href="#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef DEBUG</span></span>
<span id="cb491-2"><a href="#cb491-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Debug mode: extra checks enabled</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb491-3"><a href="#cb491-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>No recompilation needed to switch, just re-run <code>gcc</code> with or without <code>-DDEBUG</code>.</p>
<p>You can also assign values:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb492"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb492-1"><a href="#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-DVERSION</span><span class="op">=</span>2 main.c <span class="at">-o</span> main</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb493"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb493-1"><a href="#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#if VERSION &gt;= 2</span></span>
<span id="cb493-2"><a href="#cb493-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"New feature enabled!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb493-3"><a href="#cb493-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-4.-guarding-code-with-ifndef" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-guarding-code-with-ifndef">Step 4. Guarding Code with <code>#ifndef</code></h4>
<p>This is one of the most common idioms in C headers:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb494"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb494-1"><a href="#cb494-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef CONFIG_H</span></span>
<span id="cb494-2"><a href="#cb494-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define CONFIG_H</span></span>
<span id="cb494-3"><a href="#cb494-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-4"><a href="#cb494-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAX_CLIENTS </span><span class="dv">100</span></span>
<span id="cb494-5"><a href="#cb494-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define TIMEOUT_MS </span><span class="dv">3000</span></span>
<span id="cb494-6"><a href="#cb494-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-7"><a href="#cb494-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>It ensures that if <code>config.h</code> is included multiple times, it only gets processed once. Every header in the C standard library uses this pattern.</p>
</section>
<section id="step-5.-excluding-experimental-code" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-excluding-experimental-code">Step 5. Excluding Experimental Code</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb495"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb495-1"><a href="#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define ENABLE_EXPERIMENTAL </span><span class="dv">0</span></span>
<span id="cb495-2"><a href="#cb495-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb495-3"><a href="#cb495-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#if ENABLE_EXPERIMENTAL</span></span>
<span id="cb495-4"><a href="#cb495-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> experimental_feature<span class="op">()</span> <span class="op">{</span></span>
<span id="cb495-5"><a href="#cb495-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Running experimental feature</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb495-6"><a href="#cb495-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb495-7"><a href="#cb495-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If <code>ENABLE_EXPERIMENTAL</code> is set to <code>0</code>, this code is completely removed before compilation, it doesn’t even exist in the object file.</p>
</section>
<section id="tiny-code-debug-mode-example" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-debug-mode-example">Tiny Code: Debug Mode Example</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb496"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb496-1"><a href="#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb496-2"><a href="#cb496-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-3"><a href="#cb496-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define DEBUG_MODE </span><span class="dv">1</span></span>
<span id="cb496-4"><a href="#cb496-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-5"><a href="#cb496-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> compute<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb496-6"><a href="#cb496-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#if DEBUG_MODE</span></span>
<span id="cb496-7"><a href="#cb496-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"[DEBUG] compute() called with x=</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb496-8"><a href="#cb496-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb496-9"><a href="#cb496-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Result: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x <span class="op">*</span> x<span class="op">);</span></span>
<span id="cb496-10"><a href="#cb496-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb496-11"><a href="#cb496-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-12"><a href="#cb496-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb496-13"><a href="#cb496-13" aria-hidden="true" tabindex="-1"></a>    compute<span class="op">(</span><span class="dv">5</span><span class="op">);</span></span>
<span id="cb496-14"><a href="#cb496-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb496-15"><a href="#cb496-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output when <code>DEBUG_MODE</code> is 1:</p>
<pre><code>[DEBUG] compute() called with x=5
Result: 25</code></pre>
<p>Set <code>DEBUG_MODE</code> to 0, recompile, and the <code>[DEBUG]</code> message disappears entirely.</p>
</section>
<section id="step-6.-using-elif-and-else" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-using-elif-and-else">Step 6. Using <code>#elif</code> and <code>#else</code></h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb498"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb498-1"><a href="#cb498-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define OS </span><span class="dv">2</span></span>
<span id="cb498-2"><a href="#cb498-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-3"><a href="#cb498-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#if OS == 1</span></span>
<span id="cb498-4"><a href="#cb498-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define OS_NAME </span><span class="st">"Windows"</span></span>
<span id="cb498-5"><a href="#cb498-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#elif OS == 2</span></span>
<span id="cb498-6"><a href="#cb498-6" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define OS_NAME </span><span class="st">"Linux"</span></span>
<span id="cb498-7"><a href="#cb498-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span>
<span id="cb498-8"><a href="#cb498-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define OS_NAME </span><span class="st">"Unknown"</span></span>
<span id="cb498-9"><a href="#cb498-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb498-10"><a href="#cb498-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-11"><a href="#cb498-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb498-12"><a href="#cb498-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"OS: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> OS_NAME<span class="op">);</span></span>
<span id="cb498-13"><a href="#cb498-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb498-14"><a href="#cb498-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>OS: Linux</code></pre>
</section>
<section id="step-7.-combining-with-logical-operators" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-combining-with-logical-operators">Step 7. Combining with Logical Operators</h4>
<p>You can use <code>&amp;&amp;</code>, <code>||</code>, and <code>!</code> in preprocessor conditions.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb500"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb500-1"><a href="#cb500-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#if defined(DEBUG) &amp;&amp; !defined(RELEASE)</span></span>
<span id="cb500-2"><a href="#cb500-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Debug build only</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb500-3"><a href="#cb500-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You can even use numeric comparisons:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb501"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb501-1"><a href="#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#if VERSION &gt;= 3</span></span>
<span id="cb501-2"><a href="#cb501-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Version 3+ detected</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb501-3"><a href="#cb501-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-8.-forcing-compilation-errors" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-forcing-compilation-errors">Step 8. Forcing Compilation Errors</h4>
<p>Sometimes you want to stop compilation if a required macro is missing:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb502"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb502-1"><a href="#cb502-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef API_KEY</span></span>
<span id="cb502-2"><a href="#cb502-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#error "API_KEY not defined! Please compile with -DAPI_KEY=your_key"</span></span>
<span id="cb502-3"><a href="#cb502-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This is useful for configuration validation at build time.</p>
</section>
<section id="step-9.-compiler-specific-macros" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-compiler-specific-macros">Step 9. Compiler-Specific Macros</h4>
<p>Compilers automatically define macros to identify themselves and the environment.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Macro</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>__GNUC__</code></td>
<td>Defined by GCC</td>
</tr>
<tr class="even">
<td><code>__clang__</code></td>
<td>Defined by Clang</td>
</tr>
<tr class="odd">
<td><code>_MSC_VER</code></td>
<td>Defined by MSVC</td>
</tr>
<tr class="even">
<td><code>__x86_64__</code></td>
<td>64-bit architecture</td>
</tr>
<tr class="odd">
<td><code>__arm__</code>, <code>__aarch64__</code></td>
<td>ARM architectures</td>
</tr>
<tr class="even">
<td><code>__STDC__</code></td>
<td>Conforms to ANSI C standard</td>
</tr>
</tbody>
</table>
<p>You can use these to write portable, adaptive code:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb503"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb503-1"><a href="#cb503-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef __clang__</span></span>
<span id="cb503-2"><a href="#cb503-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Compiled with Clang</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb503-3"><a href="#cb503-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#elif defined(__GNUC__)</span></span>
<span id="cb503-4"><a href="#cb503-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Compiled with GCC</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb503-5"><a href="#cb503-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="tiny-code-portable-sleep-function" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-portable-sleep-function">Tiny Code: Portable Sleep Function</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb504"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb504-1"><a href="#cb504-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb504-2"><a href="#cb504-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb504-3"><a href="#cb504-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef _WIN32</span></span>
<span id="cb504-4"><a href="#cb504-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;windows.h&gt;</span></span>
<span id="cb504-5"><a href="#cb504-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define SLEEP</span><span class="op">(</span><span class="pp">ms</span><span class="op">)</span><span class="pp"> Sleep</span><span class="op">(</span><span class="pp">ms</span><span class="op">)</span></span>
<span id="cb504-6"><a href="#cb504-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span>
<span id="cb504-7"><a href="#cb504-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb504-8"><a href="#cb504-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define SLEEP</span><span class="op">(</span><span class="pp">ms</span><span class="op">)</span><span class="pp"> </span>usleep<span class="op">((</span><span class="pp">ms</span><span class="op">)</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="dv">1000</span><span class="op">)</span></span>
<span id="cb504-9"><a href="#cb504-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb504-10"><a href="#cb504-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb504-11"><a href="#cb504-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb504-12"><a href="#cb504-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Waiting...</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb504-13"><a href="#cb504-13" aria-hidden="true" tabindex="-1"></a>    SLEEP<span class="op">(</span><span class="dv">1000</span><span class="op">);</span></span>
<span id="cb504-14"><a href="#cb504-14" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Done!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb504-15"><a href="#cb504-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb504-16"><a href="#cb504-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This compiles cleanly on both Windows and Linux with no code changes.</p>
</section>
<section id="why-it-matters-50" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-50">Why It Matters</h4>
<p>Conditional compilation makes your C code:</p>
<ul>
<li><strong>Portable</strong>, same code runs on multiple systems</li>
<li><strong>Configurable</strong>, features can be toggled at build time</li>
<li><strong>Maintainable</strong>, no need for multiple codebases</li>
<li><strong>Efficient</strong>, excluded code doesn’t even enter the binary</li>
</ul>
<p>In system software and embedded development, this is indispensable.</p>
</section>
<section id="try-it-yourself-51" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-51">Try It Yourself</h4>
<ol type="1">
<li>Write a program that prints a different greeting depending on the OS.</li>
<li>Use <code>#if</code> and <code>#error</code> to enforce that only one of <code>DEBUG</code> or <code>RELEASE</code> can be defined.</li>
<li>Write a header that defines constants for different CPU architectures.</li>
<li>Add a feature flag (<code>ENABLE_LOGGING</code>) that can be turned on/off via <code>gcc -D</code>.</li>
<li>Use <code>#ifdef</code> and <code>#ifndef</code> to create a lightweight build-time configuration system.</li>
</ol>
<p>In the next section, you’ll take the next step toward clean, maintainable C code by learning about <strong>inline functions</strong> and <strong>header hygiene</strong>, modern, safer replacements for many macro patterns.</p>
</section>
</section>
<section id="inline-functions-and-header-hygiene" class="level3">
<h3 class="anchored" data-anchor-id="inline-functions-and-header-hygiene">54. Inline Functions and Header Hygiene</h3>
<p>In early C, programmers often relied on macros for performance and reuse. But macros have big drawbacks, no type checking, no debugging symbols, and messy error messages.</p>
<p><strong>Inline functions</strong> were introduced to solve this problem. They combine the efficiency of macros with the safety of real functions.</p>
<p>This section also covers <strong>header hygiene</strong>, or how to write clean, reusable <code>.h</code> files that scale safely across large projects.</p>
<section id="step-1.-what-does-inline-mean" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-does-inline-mean">Step 1. What Does “Inline” Mean?</h4>
<p>Normally, calling a function like <code>add(a, b)</code> incurs a small overhead, the CPU jumps to the function and back. Inlining means the compiler <strong>replaces the call with the function’s code directly</strong>, avoiding that jump.</p>
<p>You can suggest this with the <code>inline</code> keyword:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb505"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb505-1"><a href="#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb505-2"><a href="#cb505-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb505-3"><a href="#cb505-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>When used properly, it’s as fast as a macro but behaves like a real function.</p>
</section>
<section id="step-2.-comparing-macros-vs-inline-functions" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-comparing-macros-vs-inline-functions">Step 2. Comparing Macros vs Inline Functions</h4>
<p><strong>Macro version:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb506"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb506-1"><a href="#cb506-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define ADD</span><span class="op">(</span><span class="pp">a</span><span class="op">,</span><span class="pp"> b</span><span class="op">)</span><span class="pp"> </span><span class="op">((</span><span class="pp">a</span><span class="op">)</span><span class="pp"> </span><span class="op">+</span><span class="pp"> </span><span class="op">(</span><span class="pp">b</span><span class="op">))</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Inline version:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb507"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb507-1"><a href="#cb507-1" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb507-2"><a href="#cb507-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb507-3"><a href="#cb507-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Macro:</strong></p>
<ul>
<li>No type checking</li>
<li>May cause multiple evaluations (e.g., <code>ADD(x++, y++)</code>)</li>
<li>Harder to debug</li>
</ul>
<p><strong>Inline function:</strong></p>
<ul>
<li>Type-checked</li>
<li>Single evaluation</li>
<li>Can be stepped through in a debugger</li>
</ul>
</section>
<section id="step-3.-declaring-inline-functions-in-headers" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-declaring-inline-functions-in-headers">Step 3. Declaring Inline Functions in Headers</h4>
<p>When defining inline functions in header files, add <code>static</code> to avoid multiple-definition errors:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb508"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb508-1"><a href="#cb508-1" aria-hidden="true" tabindex="-1"></a><span class="co">// math_utils.h</span></span>
<span id="cb508-2"><a href="#cb508-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef MATH_UTILS_H</span></span>
<span id="cb508-3"><a href="#cb508-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MATH_UTILS_H</span></span>
<span id="cb508-4"><a href="#cb508-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb508-5"><a href="#cb508-5" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="kw">inline</span> <span class="dt">int</span> square<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb508-6"><a href="#cb508-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">*</span> x<span class="op">;</span></span>
<span id="cb508-7"><a href="#cb508-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb508-8"><a href="#cb508-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb508-9"><a href="#cb508-9" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="kw">inline</span> <span class="dt">int</span> max<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb508-10"><a href="#cb508-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>a <span class="op">&gt;</span> b<span class="op">)</span> <span class="op">?</span> a <span class="op">:</span> b<span class="op">;</span></span>
<span id="cb508-11"><a href="#cb508-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb508-12"><a href="#cb508-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb508-13"><a href="#cb508-13" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This ensures each <code>.c</code> file that includes the header gets its own copy, avoiding linker conflicts.</p>
</section>
<section id="tiny-code-inline-utilities" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-inline-utilities">Tiny Code: Inline Utilities</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb509"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb509-1"><a href="#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb509-2"><a href="#cb509-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb509-3"><a href="#cb509-3" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="kw">inline</span> <span class="dt">int</span> cube<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb509-4"><a href="#cb509-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">*</span> x <span class="op">*</span> x<span class="op">;</span></span>
<span id="cb509-5"><a href="#cb509-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb509-6"><a href="#cb509-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb509-7"><a href="#cb509-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb509-8"><a href="#cb509-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb509-9"><a href="#cb509-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"cube(</span><span class="sc">%d</span><span class="st">) = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> n<span class="op">,</span> cube<span class="op">(</span>n<span class="op">));</span></span>
<span id="cb509-10"><a href="#cb509-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb509-11"><a href="#cb509-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>cube(3) = 27</code></pre>
<p>The compiler will expand <code>cube(3)</code> directly into <code>3 * 3 * 3</code>, no function call overhead.</p>
</section>
<section id="step-4.-inline-and-the-compiler" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-inline-and-the-compiler">Step 4. Inline and the Compiler</h4>
<p><code>inline</code> is a <em>hint</em> to the compiler, not a command. The compiler decides whether inlining actually improves performance.</p>
<p>You can force inlining (non-portably) with attributes:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb511"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb511-1"><a href="#cb511-1" aria-hidden="true" tabindex="-1"></a>__attribute__<span class="op">((</span>always_inline<span class="op">))</span> <span class="kw">inline</span> <span class="dt">void</span> fast_add<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>x<span class="op">,</span> <span class="dt">int</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb511-2"><a href="#cb511-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>x <span class="op">+=</span> y<span class="op">;</span></span>
<span id="cb511-3"><a href="#cb511-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>But it’s best to let the optimizer choose. Inlining too much can increase binary size (known as “code bloat”).</p>
</section>
<section id="step-5.-inline-and-linkage" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-inline-and-linkage">Step 5. Inline and Linkage</h4>
<p>Inline functions behave differently depending on whether they’re declared <code>static</code>, <code>extern</code>, or plain <code>inline</code>.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 74%">
</colgroup>
<thead>
<tr class="header">
<th>Keyword Combination</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>static inline</code></td>
<td>Visible only in this translation unit (safe for headers)</td>
</tr>
<tr class="even">
<td><code>extern inline</code></td>
<td>Shared across translation units (rarely needed)</td>
</tr>
<tr class="odd">
<td><code>inline</code> (alone)</td>
<td>Behavior depends on compiler and standard version</td>
</tr>
</tbody>
</table>
<p>Stick with <code>static inline</code> for header-defined helpers.</p>
</section>
<section id="step-6.-inline-vs-macros-debug-example" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-inline-vs-macros-debug-example">Step 6. Inline vs Macros: Debug Example</h4>
<p><strong>Macro:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb512"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb512-1"><a href="#cb512-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PRINT</span><span class="op">(</span><span class="pp">x</span><span class="op">)</span><span class="pp"> printf</span><span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> x</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Error output when debugging might show:</p>
<pre><code>macro.c: In function 'main': macro.c:5: error: expected ';'</code></pre>
<p><strong>Inline:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb514"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb514-1"><a href="#cb514-1" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">void</span> print<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb514-2"><a href="#cb514-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb514-3"><a href="#cb514-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now you get a clean message:</p>
<pre><code>error: too few arguments to function 'print'</code></pre>
<p>Inlining makes error handling and debugging much cleaner.</p>
</section>
<section id="step-7.-header-hygiene-the-rules-of-clean-headers" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-header-hygiene-the-rules-of-clean-headers">Step 7. Header Hygiene, The Rules of Clean Headers</h4>
<p>Headers define your program’s public interface. Poorly written headers cause multiple-definition errors, redefinition warnings, and broken builds.</p>
<p>Follow these guidelines:</p>
<ol type="1">
<li><p><strong>Use header guards</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb516"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb516-1"><a href="#cb516-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef MYLIB_H</span></span>
<span id="cb516-2"><a href="#cb516-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MYLIB_H</span></span>
<span id="cb516-3"><a href="#cb516-3" aria-hidden="true" tabindex="-1"></a><span class="co">// contents</span></span>
<span id="cb516-4"><a href="#cb516-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong>Keep headers minimal</strong> Only include what’s necessary, use forward declarations when possible.</p></li>
<li><p><strong>Don’t put function definitions unless they’re <code>static inline</code>.</strong></p></li>
<li><p><strong>Never use <code>using namespace</code>, global variables, or large macros</strong> in headers.</p></li>
<li><p><strong>Group related declarations together</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb517"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb517-1"><a href="#cb517-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Point <span class="op">{</span> <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span> <span class="op">}</span> Point<span class="op">;</span></span>
<span id="cb517-2"><a href="#cb517-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> move<span class="op">(</span>Point <span class="op">*</span>p<span class="op">,</span> <span class="dt">int</span> dx<span class="op">,</span> <span class="dt">int</span> dy<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong>Include standard headers only when required</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb518"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb518-1"><a href="#cb518-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span><span class="pp">  </span><span class="co">// only if you use FILE*</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ol>
</section>
<section id="tiny-code-clean-header-implementation-example" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-clean-header-implementation-example">Tiny Code: Clean Header + Implementation Example</h4>
<p><strong>mathlib.h</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb519"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb519-1"><a href="#cb519-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef MATHLIB_H</span></span>
<span id="cb519-2"><a href="#cb519-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MATHLIB_H</span></span>
<span id="cb519-3"><a href="#cb519-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb519-4"><a href="#cb519-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb519-5"><a href="#cb519-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span></span>
<span id="cb519-6"><a href="#cb519-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Point<span class="op">;</span></span>
<span id="cb519-7"><a href="#cb519-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb519-8"><a href="#cb519-8" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="kw">inline</span> <span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb519-9"><a href="#cb519-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_point<span class="op">(</span>Point p<span class="op">);</span></span>
<span id="cb519-10"><a href="#cb519-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb519-11"><a href="#cb519-11" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>mathlib.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb520"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb520-1"><a href="#cb520-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb520-2"><a href="#cb520-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"mathlib.h"</span></span>
<span id="cb520-3"><a href="#cb520-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb520-4"><a href="#cb520-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_point<span class="op">(</span>Point p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb520-5"><a href="#cb520-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"(</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d</span><span class="st">)</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> p<span class="op">.</span>x<span class="op">,</span> p<span class="op">.</span>y<span class="op">);</span></span>
<span id="cb520-6"><a href="#cb520-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>main.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb521"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb521-1"><a href="#cb521-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"mathlib.h"</span></span>
<span id="cb521-2"><a href="#cb521-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb521-3"><a href="#cb521-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb521-4"><a href="#cb521-4" aria-hidden="true" tabindex="-1"></a>    Point p <span class="op">=</span> <span class="op">{</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">};</span></span>
<span id="cb521-5"><a href="#cb521-5" aria-hidden="true" tabindex="-1"></a>    print_point<span class="op">(</span>p<span class="op">);</span></span>
<span id="cb521-6"><a href="#cb521-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Sum = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> add<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">5</span><span class="op">));</span></span>
<span id="cb521-7"><a href="#cb521-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb521-8"><a href="#cb521-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Build:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb522"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb522-1"><a href="#cb522-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.c mathlib.c <span class="at">-o</span> demo</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>(2, 3)
Sum = 7</code></pre>
<p>This structure mirrors real-world C libraries, headers for declarations, <code>.c</code> files for definitions, and inline helpers where performance matters.</p>
</section>
<section id="step-8.-inline-and-optimization-flags" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-inline-and-optimization-flags">Step 8. Inline and Optimization Flags</h4>
<p>Use <code>-O2</code> or higher optimization to let the compiler inline aggressively:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb524"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb524-1"><a href="#cb524-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-O2</span> main.c <span class="at">-o</span> main</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>At <code>-O0</code> (no optimization), even inline functions may not be expanded.</p>
</section>
<section id="step-9.-inline-in-c99-and-beyond" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-inline-in-c99-and-beyond">Step 9. Inline in C99 and Beyond</h4>
<p>Inline semantics were standardized in <strong>C99</strong>. Older compilers (pre-C99) treated inline inconsistently. Always compile with <code>-std=c99</code> or later for predictable behavior:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb525"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb525-1"><a href="#cb525-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-std</span><span class="op">=</span>c99 main.c <span class="at">-o</span> main</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-51" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-51">Why It Matters</h4>
<p>Inline functions give you:</p>
<ul>
<li>Performance like macros</li>
<li>Type safety and cleaner debugging</li>
<li>Reusable logic in headers</li>
<li>Safer and smaller helper functions</li>
</ul>
<p>They are a modern C programmer’s best tool for writing efficient yet maintainable code.</p>
</section>
<section id="try-it-yourself-52" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-52">Try It Yourself</h4>
<ol type="1">
<li>Replace three of your macros from previous exercises with inline functions.</li>
<li>Benchmark your program with and without <code>-O2</code> to see the difference.</li>
<li>Write a header-only math library using <code>static inline</code> functions.</li>
<li>Add header guards and check with multiple includes.</li>
<li>Use <code>objdump -d</code> to confirm whether your inline code actually got expanded.</li>
</ol>
<p>Next, you’ll automate your growing C projects with <strong>Makefiles and build systems</strong>, the tools that manage compilation, linking, and dependencies efficiently.</p>
</section>
</section>
<section id="makefiles-and-build-automation" class="level3">
<h3 class="anchored" data-anchor-id="makefiles-and-build-automation">55. Makefiles and Build Automation</h3>
<p>Compiling one or two C files by hand is fine, but real projects quickly grow to dozens or hundreds of files. Typing long <code>gcc</code> commands every time becomes tedious, error-prone, and inconsistent across environments.</p>
<p>That’s where <strong>Makefiles</strong> come in. They automate the build process, track dependencies, and rebuild only what changed.</p>
<p>Let’s build a complete understanding of how to use <code>make</code> and write simple but powerful Makefiles.</p>
<section id="step-1.-what-is-make" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-is-make">Step 1. What Is <code>make</code>?</h4>
<p><code>make</code> is a tool that reads a file called <strong>Makefile</strong> and executes the build rules it defines.</p>
<p>Each rule describes:</p>
<ol type="1">
<li>A <strong>target</strong> (the thing you want to build)</li>
<li>Its <strong>dependencies</strong> (what it needs)</li>
<li>The <strong>commands</strong> to build it</li>
</ol>
<p>Basic syntax:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb526"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb526-1"><a href="#cb526-1" aria-hidden="true" tabindex="-1"></a><span class="dv">target:</span><span class="dt"> dependencies</span></span>
<span id="cb526-2"><a href="#cb526-2" aria-hidden="true" tabindex="-1"></a>&lt;TAB&gt;command</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Yes, the indentation <strong>must</strong> be a real tab, not spaces.</p>
</section>
<section id="step-2.-the-simplest-makefile" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-the-simplest-makefile">Step 2. The Simplest Makefile</h4>
<p>Suppose your project has:</p>
<pre><code>main.c
math.c
math.h</code></pre>
<p><strong>Makefile:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb528"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb528-1"><a href="#cb528-1" aria-hidden="true" tabindex="-1"></a><span class="dv">app:</span><span class="dt"> main.c math.c</span></span>
<span id="cb528-2"><a href="#cb528-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>gcc main.c math.c -o app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Build:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb529"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb529-1"><a href="#cb529-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>gcc main.c math.c -o app</code></pre>
<p>Run:</p>
<pre><code>./app</code></pre>
<p>Now if you run <code>make</code> again, nothing happens, because <code>make</code> sees that the output (<code>app</code>) is newer than the sources. That’s the magic of dependency tracking.</p>
</section>
<section id="step-3.-split-into-compilation-steps" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-split-into-compilation-steps">Step 3. Split into Compilation Steps</h4>
<p>A better version builds <code>.o</code> files separately:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb532"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb532-1"><a href="#cb532-1" aria-hidden="true" tabindex="-1"></a><span class="dv">app:</span><span class="dt"> main.o math.o</span></span>
<span id="cb532-2"><a href="#cb532-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>gcc main.o math.o -o app</span>
<span id="cb532-3"><a href="#cb532-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-4"><a href="#cb532-4" aria-hidden="true" tabindex="-1"></a><span class="dv">main.o:</span><span class="dt"> main.c math.h</span></span>
<span id="cb532-5"><a href="#cb532-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>gcc -c main.c</span>
<span id="cb532-6"><a href="#cb532-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-7"><a href="#cb532-7" aria-hidden="true" tabindex="-1"></a><span class="dv">math.o:</span><span class="dt"> math.c math.h</span></span>
<span id="cb532-8"><a href="#cb532-8" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>gcc -c math.c</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now when you change only <code>math.c</code>, only <code>math.o</code> recompiles.</p>
</section>
<section id="tiny-code-minimal-project" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-minimal-project">Tiny Code: Minimal Project</h4>
<p><strong>main.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb533"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb533-1"><a href="#cb533-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb533-2"><a href="#cb533-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"math.h"</span></span>
<span id="cb533-3"><a href="#cb533-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb533-4"><a href="#cb533-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb533-5"><a href="#cb533-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"2 + 3 = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> add<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">));</span></span>
<span id="cb533-6"><a href="#cb533-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb533-7"><a href="#cb533-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>math.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb534"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb534-1"><a href="#cb534-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>math.h</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb535"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb535-1"><a href="#cb535-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Makefile</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb536"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb536-1"><a href="#cb536-1" aria-hidden="true" tabindex="-1"></a><span class="dv">app:</span><span class="dt"> main.o math.o</span></span>
<span id="cb536-2"><a href="#cb536-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>gcc main.o math.o -o app</span>
<span id="cb536-3"><a href="#cb536-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-4"><a href="#cb536-4" aria-hidden="true" tabindex="-1"></a><span class="dv">main.o:</span><span class="dt"> main.c math.h</span></span>
<span id="cb536-5"><a href="#cb536-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>gcc -c main.c</span>
<span id="cb536-6"><a href="#cb536-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-7"><a href="#cb536-7" aria-hidden="true" tabindex="-1"></a><span class="dv">math.o:</span><span class="dt"> math.c math.h</span></span>
<span id="cb536-8"><a href="#cb536-8" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>gcc -c math.c</span>
<span id="cb536-9"><a href="#cb536-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-10"><a href="#cb536-10" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb536-11"><a href="#cb536-11" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f *.o app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb537"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb537-1"><a href="#cb537-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span>
<span id="cb537-2"><a href="#cb537-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./app</span></span>
<span id="cb537-3"><a href="#cb537-3" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> clean</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-4.-use-variables" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-use-variables">Step 4. Use Variables</h4>
<p>Makefiles support variables to avoid repetition:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb538"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb538-1"><a href="#cb538-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span> <span class="ch">=</span><span class="st"> gcc</span></span>
<span id="cb538-2"><a href="#cb538-2" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span> <span class="ch">=</span><span class="st"> -Wall -Wextra -std=c99</span></span>
<span id="cb538-3"><a href="#cb538-3" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJ</span> <span class="ch">=</span><span class="st"> main.o math.o</span></span>
<span id="cb538-4"><a href="#cb538-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb538-5"><a href="#cb538-5" aria-hidden="true" tabindex="-1"></a><span class="dv">app:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span></span>
<span id="cb538-6"><a href="#cb538-6" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span> -o app</span>
<span id="cb538-7"><a href="#cb538-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb538-8"><a href="#cb538-8" aria-hidden="true" tabindex="-1"></a><span class="dv">%.o:</span><span class="dt"> %.c</span></span>
<span id="cb538-9"><a href="#cb538-9" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> -c <span class="ch">$&lt;</span> -o <span class="ch">$@</span></span>
<span id="cb538-10"><a href="#cb538-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb538-11"><a href="#cb538-11" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb538-12"><a href="#cb538-12" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f <span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Here:</p>
<ul>
<li><code>$&lt;</code> = first dependency</li>
<li><code>$@</code> = target name</li>
<li><code>%.o: %.c</code> = pattern rule (applies to all matching files)</li>
</ul>
</section>
<section id="step-5.-add-debug-and-release-modes" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-add-debug-and-release-modes">Step 5. Add Debug and Release Modes</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb539"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb539-1"><a href="#cb539-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span> <span class="ch">=</span><span class="st"> gcc</span></span>
<span id="cb539-2"><a href="#cb539-2" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span> <span class="ch">=</span><span class="st"> -Wall -std=c99</span></span>
<span id="cb539-3"><a href="#cb539-3" aria-hidden="true" tabindex="-1"></a><span class="dt">DEBUG_FLAGS</span> <span class="ch">=</span><span class="st"> -g -O0</span></span>
<span id="cb539-4"><a href="#cb539-4" aria-hidden="true" tabindex="-1"></a><span class="dt">RELEASE_FLAGS</span> <span class="ch">=</span><span class="st"> -O2</span></span>
<span id="cb539-5"><a href="#cb539-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb539-6"><a href="#cb539-6" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJ</span> <span class="ch">=</span><span class="st"> main.o math.o</span></span>
<span id="cb539-7"><a href="#cb539-7" aria-hidden="true" tabindex="-1"></a><span class="dt">TARGET</span> <span class="ch">=</span><span class="st"> app</span></span>
<span id="cb539-8"><a href="#cb539-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb539-9"><a href="#cb539-9" aria-hidden="true" tabindex="-1"></a><span class="dv">all:</span><span class="dt"> release</span></span>
<span id="cb539-10"><a href="#cb539-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb539-11"><a href="#cb539-11" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span><span class="dt"> CFLAGS</span> <span class="ch">+=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">DEBUG_FLAGS</span><span class="ch">)</span></span>
<span id="cb539-12"><a href="#cb539-12" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span>
<span id="cb539-13"><a href="#cb539-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb539-14"><a href="#cb539-14" aria-hidden="true" tabindex="-1"></a><span class="dv">release:</span><span class="dt"> CFLAGS</span> <span class="ch">+=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">RELEASE_FLAGS</span><span class="ch">)</span></span>
<span id="cb539-15"><a href="#cb539-15" aria-hidden="true" tabindex="-1"></a><span class="dv">release:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span>
<span id="cb539-16"><a href="#cb539-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb539-17"><a href="#cb539-17" aria-hidden="true" tabindex="-1"></a><span class="dv">$(TARGET):</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span></span>
<span id="cb539-18"><a href="#cb539-18" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span> -o <span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span>
<span id="cb539-19"><a href="#cb539-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb539-20"><a href="#cb539-20" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb539-21"><a href="#cb539-21" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f <span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Build in debug mode:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb540"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb540-1"><a href="#cb540-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> debug</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Build optimized release:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb541"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb541-1"><a href="#cb541-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> release</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-6.-automatic-dependencies" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-automatic-dependencies">Step 6. Automatic Dependencies</h4>
<p>You can have <code>gcc</code> generate dependency files automatically:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb542"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb542-1"><a href="#cb542-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-MMD</span> <span class="at">-c</span> main.c</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This creates <code>main.d</code> which tracks included headers. You can include these files in your Makefile for automatic rebuilds:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb543"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb543-1"><a href="#cb543-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-include</span> <span class="ch">$(</span><span class="dt">OBJ</span><span class="kw">:</span><span class="ss">.o</span><span class="kw">=</span><span class="ss">.d</span><span class="ch">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>That’s how professional build systems keep dependencies accurate.</p>
</section>
<section id="step-7.-phony-targets" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-phony-targets">Step 7. Phony Targets</h4>
<p>Targets that don’t produce actual files should be marked <strong>phony</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb544"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb544-1"><a href="#cb544-1" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY:</span><span class="dt"> clean all debug release</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This prevents file name collisions (e.g., if a file named <code>clean</code> exists).</p>
</section>
<section id="step-8.-organize-larger-projects" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-organize-larger-projects">Step 8. Organize Larger Projects</h4>
<p>For multi-directory projects:</p>
<pre><code>src/
 ├── main.c
 ├── util.c
include/
 ├── util.h</code></pre>
<p>You can structure your Makefile like:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb546"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb546-1"><a href="#cb546-1" aria-hidden="true" tabindex="-1"></a><span class="dt">SRC</span> <span class="ch">=</span><span class="st"> src/main.c src/util.c</span></span>
<span id="cb546-2"><a href="#cb546-2" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJ</span> <span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">SRC</span><span class="kw">:</span><span class="ss">.c</span><span class="kw">=</span><span class="ss">.o</span><span class="ch">)</span></span>
<span id="cb546-3"><a href="#cb546-3" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span> <span class="ch">=</span><span class="st"> -Iinclude -Wall</span></span>
<span id="cb546-4"><a href="#cb546-4" aria-hidden="true" tabindex="-1"></a><span class="dt">TARGET</span> <span class="ch">=</span><span class="st"> app</span></span>
<span id="cb546-5"><a href="#cb546-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb546-6"><a href="#cb546-6" aria-hidden="true" tabindex="-1"></a><span class="dv">$(TARGET):</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span></span>
<span id="cb546-7"><a href="#cb546-7" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span> -o <span class="ch">$@</span></span>
<span id="cb546-8"><a href="#cb546-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb546-9"><a href="#cb546-9" aria-hidden="true" tabindex="-1"></a><span class="dv">%.o:</span><span class="dt"> %.c</span></span>
<span id="cb546-10"><a href="#cb546-10" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> -c <span class="ch">$&lt;</span> -o <span class="ch">$@</span></span>
<span id="cb546-11"><a href="#cb546-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb546-12"><a href="#cb546-12" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb546-13"><a href="#cb546-13" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f <span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><code>-Iinclude</code> tells the compiler where to find header files.</p>
</section>
<section id="step-9.-use-built-in-rules" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-use-built-in-rules">Step 9. Use Built-in Rules</h4>
<p><code>make</code> already knows how to build <code>.o</code> from <code>.c</code>. A minimalist Makefile can be:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb547"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb547-1"><a href="#cb547-1" aria-hidden="true" tabindex="-1"></a><span class="dv">app:</span><span class="dt"> main.o math.o</span></span>
<span id="cb547-2"><a href="#cb547-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>gcc <span class="ch">$^</span> -o <span class="ch">$@</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Where <code>$^</code> expands to all dependencies (<code>main.o math.o</code>).</p>
</section>
<section id="step-10.-tiny-code-library-build-example" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-library-build-example">Step 10. Tiny Code: Library Build Example</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb548"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb548-1"><a href="#cb548-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span> <span class="ch">=</span><span class="st"> gcc</span></span>
<span id="cb548-2"><a href="#cb548-2" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span> <span class="ch">=</span><span class="st"> -Wall -std=c99</span></span>
<span id="cb548-3"><a href="#cb548-3" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJ</span> <span class="ch">=</span><span class="st"> util.o io.o</span></span>
<span id="cb548-4"><a href="#cb548-4" aria-hidden="true" tabindex="-1"></a><span class="dt">LIB</span> <span class="ch">=</span><span class="st"> libtools.a</span></span>
<span id="cb548-5"><a href="#cb548-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb548-6"><a href="#cb548-6" aria-hidden="true" tabindex="-1"></a><span class="dv">$(LIB):</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span></span>
<span id="cb548-7"><a href="#cb548-7" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>ar rcs <span class="ch">$(</span><span class="dt">LIB</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span></span>
<span id="cb548-8"><a href="#cb548-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb548-9"><a href="#cb548-9" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb548-10"><a href="#cb548-10" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f <span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">LIB</span><span class="ch">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Build your static library:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb549"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb549-1"><a href="#cb549-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now link it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb550"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb550-1"><a href="#cb550-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.c <span class="at">-L.</span> <span class="at">-ltools</span> <span class="at">-o</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-52" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-52">Why It Matters</h4>
<p>Makefiles give you:</p>
<ul>
<li><strong>Reproducible builds</strong>, same commands every time</li>
<li><strong>Incremental recompilation</strong>, only changed files rebuild</li>
<li><strong>Multiple configurations</strong>, debug, release, test</li>
<li><strong>Extensibility</strong>, can run scripts, code generation, packaging, etc.</li>
</ul>
<p>Every serious C project, from the Linux kernel to tiny embedded tools, relies on <code>make</code> or its descendants (like CMake, Ninja, Meson).</p>
</section>
<section id="try-it-yourself-53" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-53">Try It Yourself</h4>
<ol type="1">
<li>Create a project with 3 <code>.c</code> files and 2 <code>.h</code> files.</li>
<li>Write a Makefile that supports <code>make debug</code>, <code>make release</code>, and <code>make clean</code>.</li>
<li>Add a <code>make install</code> target that copies the binary to <code>/usr/local/bin</code>.</li>
<li>Use variables like <code>CC</code>, <code>CFLAGS</code>, and pattern rules to simplify your file list.</li>
<li>Run <code>make -n</code> to preview commands without executing them.</li>
</ol>
<p>In the next section, you’ll learn how to <strong>link multiple files and libraries</strong>, understanding object files, symbols, and how your code connects together during the build process.</p>
</section>
</section>
<section id="linking-multiple-files" class="level3">
<h3 class="anchored" data-anchor-id="linking-multiple-files">56. Linking Multiple Files</h3>
<p>When a program grows beyond one <code>.c</code> file, the compiler must combine them into a single executable. This process, <strong>linking</strong>, is what joins all your functions, variables, and library references into one binary.</p>
<p>You’ve already seen snippets of it with:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb551"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb551-1"><a href="#cb551-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.o math.o <span class="at">-o</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>But now we’ll go deeper into <em>how</em> linking works and what happens when things go wrong.</p>
<section id="step-1.-the-two-compilation-phases" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-the-two-compilation-phases">Step 1. The Two Compilation Phases</h4>
<p>Every C build has two main phases:</p>
<ol type="1">
<li><p><strong>Compilation</strong> – each <code>.c</code> file becomes a <code>.o</code> (object file).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb552"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb552-1"><a href="#cb552-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> main.c <span class="at">-o</span> main.o</span>
<span id="cb552-2"><a href="#cb552-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> math.c <span class="at">-o</span> math.o</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Each <code>.o</code> file contains <em>machine code</em> and <em>symbol tables</em> (lists of what it defines and what it needs).</p></li>
<li><p><strong>Linking</strong> – the linker (<code>ld</code>) merges all <code>.o</code> files and libraries into an executable:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb553"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb553-1"><a href="#cb553-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.o math.o <span class="at">-o</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ol>
<p>If any symbol is missing (like an undefined function), the linker fails.</p>
</section>
<section id="step-2.-what-are-symbols" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-what-are-symbols">Step 2. What Are Symbols?</h4>
<p>Symbols are names the compiler uses to track functions and global variables. There are two kinds:</p>
<ul>
<li><strong>Defined symbols</strong> – functions or variables provided by this file.</li>
<li><strong>Undefined symbols</strong> – things it <em>needs</em> from another file.</li>
</ul>
<p>Example:</p>
<p><strong>math.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb554"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb554-1"><a href="#cb554-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>main.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb555"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb555-1"><a href="#cb555-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb555-2"><a href="#cb555-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span><span class="op">);</span></span>
<span id="cb555-3"><a href="#cb555-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb555-4"><a href="#cb555-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb555-5"><a href="#cb555-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> add<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">));</span></span>
<span id="cb555-6"><a href="#cb555-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb555-7"><a href="#cb555-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and link:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb556"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb556-1"><a href="#cb556-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> main.c</span>
<span id="cb556-2"><a href="#cb556-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> math.c</span>
<span id="cb556-3"><a href="#cb556-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.o math.o <span class="at">-o</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run:</p>
<pre><code>5</code></pre>
<p>If you forget to link <code>math.o</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb558"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb558-1"><a href="#cb558-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.o <span class="at">-o</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You’ll get:</p>
<pre><code>undefined reference to `add'</code></pre>
</section>
<section id="step-3.-using-header-files-for-declarations" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-using-header-files-for-declarations">Step 3. Using Header Files for Declarations</h4>
<p>Each <code>.c</code> file should declare (not define) external functions in a header:</p>
<p><strong>math.h</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb560"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb560-1"><a href="#cb560-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef MATH_H</span></span>
<span id="cb560-2"><a href="#cb560-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MATH_H</span></span>
<span id="cb560-3"><a href="#cb560-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">);</span></span>
<span id="cb560-4"><a href="#cb560-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then include it in both <code>main.c</code> and <code>math.c</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb561"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb561-1"><a href="#cb561-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"math.h"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This ensures consistency between the declaration and definition.</p>
</section>
<section id="step-4.-linking-object-files-and-libraries" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-linking-object-files-and-libraries">Step 4. Linking Object Files and Libraries</h4>
<p>You can link any number of <code>.o</code> files:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb562"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb562-1"><a href="#cb562-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.o math.o util.o io.o <span class="at">-o</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You can also link with libraries:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb563"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb563-1"><a href="#cb563-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.o <span class="at">-lm</span> <span class="at">-o</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>(<code>-lm</code> links the math library that provides functions like <code>sqrt</code>, <code>sin</code>, etc.)</p>
<p>The <code>-l</code> flag searches <code>/usr/lib</code> and <code>/lib</code> by default.</p>
<p>Custom library example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb564"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb564-1"><a href="#cb564-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.o <span class="at">-L.</span> <span class="at">-lmyutils</span> <span class="at">-o</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Here, <code>-L.</code> adds the current directory to the library search path, and <code>-lmyutils</code> links <code>libmyutils.a</code> or <code>libmyutils.so</code>.</p>
</section>
<section id="step-5.-the-order-of-linking-matters" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-the-order-of-linking-matters">Step 5. The Order of Linking Matters</h4>
<p>The linker reads from <strong>left to right</strong>. If a symbol is used before its definition appears, it might fail.</p>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb565"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb565-1"><a href="#cb565-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-lm</span> main.o <span class="at">-o</span> app    <span class="co"># ❌ wrong order</span></span>
<span id="cb565-2"><a href="#cb565-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.o <span class="at">-lm</span> <span class="at">-o</span> app    <span class="co"># ✅ correct</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Always list libraries <strong>after</strong> the object files that need them.</p>
</section>
<section id="step-6.-splitting-and-linking-a-multi-file-project" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-splitting-and-linking-a-multi-file-project">Step 6. Splitting and Linking a Multi-File Project</h4>
<pre><code>project/
├── main.c
├── math.c
├── io.c
├── math.h
├── io.h
└── Makefile</code></pre>
<p><strong>Makefile</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb567"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb567-1"><a href="#cb567-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span> <span class="ch">=</span><span class="st"> gcc</span></span>
<span id="cb567-2"><a href="#cb567-2" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span> <span class="ch">=</span><span class="st"> -Wall -std=c99</span></span>
<span id="cb567-3"><a href="#cb567-3" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJ</span> <span class="ch">=</span><span class="st"> main.o math.o io.o</span></span>
<span id="cb567-4"><a href="#cb567-4" aria-hidden="true" tabindex="-1"></a><span class="dt">TARGET</span> <span class="ch">=</span><span class="st"> app</span></span>
<span id="cb567-5"><a href="#cb567-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb567-6"><a href="#cb567-6" aria-hidden="true" tabindex="-1"></a><span class="dv">$(TARGET):</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span></span>
<span id="cb567-7"><a href="#cb567-7" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span> -o <span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span>
<span id="cb567-8"><a href="#cb567-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb567-9"><a href="#cb567-9" aria-hidden="true" tabindex="-1"></a><span class="dv">%.o:</span><span class="dt"> %.c</span></span>
<span id="cb567-10"><a href="#cb567-10" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> -c <span class="ch">$&lt;</span> -o <span class="ch">$@</span></span>
<span id="cb567-11"><a href="#cb567-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb567-12"><a href="#cb567-12" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb567-13"><a href="#cb567-13" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f <span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now, just run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb568"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb568-1"><a href="#cb568-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span>
<span id="cb568-2"><a href="#cb568-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./app</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The Makefile takes care of compiling and linking everything in order.</p>
</section>
<section id="tiny-code-building-a-small-modular-program" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-building-a-small-modular-program">Tiny Code: Building a Small Modular Program</h4>
<p><strong>math.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb569"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb569-1"><a href="#cb569-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"math.h"</span></span>
<span id="cb569-2"><a href="#cb569-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> square<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> x <span class="op">*</span> x<span class="op">;</span> <span class="op">}</span></span>
<span id="cb569-3"><a href="#cb569-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> cube<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> x <span class="op">*</span> x <span class="op">*</span> x<span class="op">;</span> <span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>math.h</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb570"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb570-1"><a href="#cb570-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef MATH_H</span></span>
<span id="cb570-2"><a href="#cb570-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MATH_H</span></span>
<span id="cb570-3"><a href="#cb570-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> square<span class="op">(</span><span class="dt">int</span> x<span class="op">);</span></span>
<span id="cb570-4"><a href="#cb570-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> cube<span class="op">(</span><span class="dt">int</span> x<span class="op">);</span></span>
<span id="cb570-5"><a href="#cb570-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>main.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb571"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb571-1"><a href="#cb571-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb571-2"><a href="#cb571-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"math.h"</span></span>
<span id="cb571-3"><a href="#cb571-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb571-4"><a href="#cb571-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb571-5"><a href="#cb571-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"square(3) = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> square<span class="op">(</span><span class="dv">3</span><span class="op">));</span></span>
<span id="cb571-6"><a href="#cb571-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"cube(2) = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> cube<span class="op">(</span><span class="dv">2</span><span class="op">));</span></span>
<span id="cb571-7"><a href="#cb571-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb571-8"><a href="#cb571-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Build manually:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb572"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb572-1"><a href="#cb572-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> math.c <span class="at">-o</span> math.o</span>
<span id="cb572-2"><a href="#cb572-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> main.c <span class="at">-o</span> main.o</span>
<span id="cb572-3"><a href="#cb572-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.o math.o <span class="at">-o</span> app</span>
<span id="cb572-4"><a href="#cb572-4" aria-hidden="true" tabindex="-1"></a><span class="ex">./app</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>square(3) = 9
cube(2) = 8</code></pre>
</section>
<section id="step-7.-static-vs-dynamic-linking" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-static-vs-dynamic-linking">Step 7. Static vs Dynamic Linking</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>File</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Static</td>
<td><code>.a</code></td>
<td>Code is copied into the executable</td>
</tr>
<tr class="even">
<td>Dynamic</td>
<td><code>.so</code></td>
<td>Code is shared at runtime via system libraries</td>
</tr>
</tbody>
</table>
<p>Static linking:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb574"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb574-1"><a href="#cb574-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.o <span class="at">-L.</span> <span class="at">-lmath</span> <span class="at">-static</span> <span class="at">-o</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Dynamic linking (default):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb575"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb575-1"><a href="#cb575-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.o <span class="at">-L.</span> <span class="at">-lmath</span> <span class="at">-o</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Dynamic executables are smaller and share libraries across programs.</p>
</section>
<section id="step-8.-inspecting-linked-binaries" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-inspecting-linked-binaries">Step 8. Inspecting Linked Binaries</h4>
<p>To see which symbols are defined or missing:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb576"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb576-1"><a href="#cb576-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nm</span> main.o <span class="kw">|</span> <span class="fu">head</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Or for a full binary:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb577"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb577-1"><a href="#cb577-1" aria-hidden="true" tabindex="-1"></a><span class="ex">objdump</span> <span class="at">-t</span> app <span class="kw">|</span> <span class="fu">less</span></span>
<span id="cb577-2"><a href="#cb577-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ldd</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><code>ldd</code> shows which shared libraries the program depends on.</p>
</section>
<section id="step-9.-common-linking-errors" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-common-linking-errors">Step 9. Common Linking Errors</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 28%">
<col style="width: 34%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th>Error</th>
<th>Meaning</th>
<th>Fix</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>undefined reference to &lt;symbol&gt;</code></td>
<td>Missing <code>.o</code> or library</td>
<td>Add all object files or correct <code>-l</code> flags</td>
</tr>
<tr class="even">
<td><code>multiple definition of &lt;symbol&gt;</code></td>
<td>Same function defined in multiple files</td>
<td>Use <code>extern</code> in declarations</td>
</tr>
<tr class="odd">
<td><code>cannot find -lfoo</code></td>
<td>Missing library file</td>
<td>Check <code>-L</code> paths or install dev package</td>
</tr>
<tr class="even">
<td><code>relocation truncated</code></td>
<td>Mismatched architectures</td>
<td>Ensure all files are built for same target</td>
</tr>
</tbody>
</table>
</section>
<section id="step-10.-inline-vs-external-linking" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-inline-vs-external-linking">Step 10. Inline vs External Linking</h4>
<p>Inline functions defined as <code>static inline</code> in headers do <em>not</em> require linking, each <code>.c</code> file gets its own copy. But normal functions in <code>.c</code> files must be linked exactly once.</p>
</section>
<section id="why-it-matters-53" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-53">Why It Matters</h4>
<p>Linking is where your program becomes <em>whole</em>. It teaches you:</p>
<ul>
<li>How <code>.o</code> and <code>.h</code> files interact</li>
<li>How libraries integrate with your binaries</li>
<li>How to debug missing symbols and multiple definitions</li>
<li>How modular design affects build architecture</li>
</ul>
<p>Understanding the linker is essential for building scalable, multi-file systems, from small utilities to entire kernels.</p>
</section>
<section id="try-it-yourself-54" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-54">Try It Yourself</h4>
<ol type="1">
<li>Create a program with 3 <code>.c</code> files and 3 <code>.h</code> files.</li>
<li>Intentionally omit one object file and observe the linker error.</li>
<li>Use <code>nm</code> to inspect which functions each <code>.o</code> defines and references.</li>
<li>Build a static library (<code>ar rcs libutils.a util.o</code>) and link it manually.</li>
<li>Use <code>ldd</code> to list shared libraries your compiled program depends on.</li>
</ol>
<p>Next, you’ll learn how to create and use <strong>static and shared libraries</strong>, the modular building blocks that every serious C project relies on for reusability and scalability.</p>
</section>
</section>
<section id="static-and-shared-libraries" class="level3">
<h3 class="anchored" data-anchor-id="static-and-shared-libraries">57. Static and Shared Libraries</h3>
<p>In large C projects, you often want to <strong>reuse code</strong> across multiple programs, without copying the same <code>.c</code> files everywhere. That’s exactly what <strong>libraries</strong> are for.</p>
<p>A <strong>library</strong> is a collection of precompiled object files (<code>.o</code>) packaged together. There are two main kinds:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 11%">
<col style="width: 19%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Extension</th>
<th>Loaded</th>
<th>Typical Use</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Static Library</td>
<td><code>.a</code></td>
<td>At compile time</td>
<td>Simpler, self-contained executables</td>
</tr>
<tr class="even">
<td>Shared Library</td>
<td><code>.so</code></td>
<td>At runtime</td>
<td>Smaller binaries, reusable system-wide</td>
</tr>
</tbody>
</table>
<p>Let’s see how to build and use both.</p>
<section id="step-1.-build-a-static-library-.a" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-build-a-static-library-.a">Step 1. Build a Static Library (<code>.a</code>)</h4>
<p>A static library is just an archive of object files.</p>
<p>Example project:</p>
<pre><code>math.c
string_utils.c
main.c</code></pre>
<p><strong>math.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb579"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb579-1"><a href="#cb579-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb579-2"><a href="#cb579-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> mul<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">*</span> b<span class="op">;</span> <span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>string_utils.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb580"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb580-1"><a href="#cb580-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb580-2"><a href="#cb580-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb580-3"><a href="#cb580-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> str_eq<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb580-4"><a href="#cb580-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> strcmp<span class="op">(</span>a<span class="op">,</span> b<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb580-5"><a href="#cb580-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>math.h</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb581"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb581-1"><a href="#cb581-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">);</span></span>
<span id="cb581-2"><a href="#cb581-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> mul<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>string_utils.h</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb582"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb582-1"><a href="#cb582-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> str_eq<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>b<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile the object files:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb583"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb583-1"><a href="#cb583-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> math.c string_utils.c</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Create a static library:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb584"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb584-1"><a href="#cb584-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ar</span> rcs libmylib.a math.o string_utils.o</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now you have <code>libmylib.a</code>, your first static library.</p>
</section>
<section id="step-2.-link-the-library" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-link-the-library">Step 2. Link the Library</h4>
<p><strong>main.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb585"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb585-1"><a href="#cb585-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb585-2"><a href="#cb585-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"math.h"</span></span>
<span id="cb585-3"><a href="#cb585-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"string_utils.h"</span></span>
<span id="cb585-4"><a href="#cb585-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb585-5"><a href="#cb585-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb585-6"><a href="#cb585-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"3 + 4 = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> add<span class="op">(</span><span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">));</span></span>
<span id="cb585-7"><a href="#cb585-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Equal? </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> str_eq<span class="op">(</span><span class="st">"abc"</span><span class="op">,</span> <span class="st">"abc"</span><span class="op">));</span></span>
<span id="cb585-8"><a href="#cb585-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb585-9"><a href="#cb585-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Link it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb586"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb586-1"><a href="#cb586-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.c <span class="at">-L.</span> <span class="at">-lmylib</span> <span class="at">-o</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>3 + 4 = 7
Equal? 1</code></pre>
<p>Here:</p>
<ul>
<li><code>-L.</code> tells the compiler to look in the current directory</li>
<li><code>-lmylib</code> links against <code>libmylib.a</code></li>
</ul>
<p>The <code>.a</code> file is copied into your executable, you can now delete it and your program will still run.</p>
</section>
<section id="step-3.-inspect-the-static-library" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-inspect-the-static-library">Step 3. Inspect the Static Library</h4>
<p>List its contents:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb588"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb588-1"><a href="#cb588-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ar</span> <span class="at">-t</span> libmylib.a</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>math.o
string_utils.o</code></pre>
<p>Extract a file:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb590"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb590-1"><a href="#cb590-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ar</span> <span class="at">-x</span> libmylib.a math.o</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You can think of <code>.a</code> files like a “.zip” of <code>.o</code> modules.</p>
</section>
<section id="step-4.-build-a-shared-library-.so" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-build-a-shared-library-.so">Step 4. Build a Shared Library (<code>.so</code>)</h4>
<p>A shared library is loaded dynamically at runtime, not compiled into the executable. They’re what you see in <code>/usr/lib</code> as <code>.so</code> (Linux) or <code>.dll</code> (Windows).</p>
<p>Build one:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb591"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb591-1"><a href="#cb591-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-fPIC</span> <span class="at">-c</span> math.c string_utils.c</span>
<span id="cb591-2"><a href="#cb591-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-shared</span> <span class="at">-o</span> libmylib.so math.o string_utils.o</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now you have a shared library:</p>
<pre><code>libmylib.so</code></pre>
<p><code>-fPIC</code> means “position-independent code”, required for shared libraries.</p>
</section>
<section id="step-5.-link-a-program-against-it" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-link-a-program-against-it">Step 5. Link a Program Against It</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb593"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb593-1"><a href="#cb593-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.c <span class="at">-L.</span> <span class="at">-lmylib</span> <span class="at">-o</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb594"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb594-1"><a href="#cb594-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./app</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If you get:</p>
<pre><code>error while loading shared libraries: libmylib.so: cannot open shared object file</code></pre>
<p>You need to add the current directory to the runtime library path:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb596"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb596-1"><a href="#cb596-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">LD_LIBRARY_PATH</span><span class="op">=</span>.</span>
<span id="cb596-2"><a href="#cb596-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./app</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>3 + 4 = 7
Equal? 1</code></pre>
</section>
<section id="step-6.-verify-the-linking-type" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-verify-the-linking-type">Step 6. Verify the Linking Type</h4>
<p>Check whether your program is statically or dynamically linked:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb598"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb598-1"><a href="#cb598-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ldd</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output for dynamic linking:</p>
<pre><code>libmylib.so =&gt; ./libmylib.so (0x00007f8e8b...)
libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (...)</code></pre>
<p>For static linking, <code>libmylib.a</code> won’t appear, it’s baked into the executable.</p>
</section>
<section id="step-7.-installing-libraries-system-wide" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-installing-libraries-system-wide">Step 7. Installing Libraries System-Wide</h4>
<p>To make your library accessible globally:</p>
<p>Copy the <code>.so</code> file to <code>/usr/local/lib</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb600"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb600-1"><a href="#cb600-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> cp libmylib.so /usr/local/lib</span>
<span id="cb600-2"><a href="#cb600-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ldconfig</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Copy headers to <code>/usr/local/include</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb601"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb601-1"><a href="#cb601-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> cp math.h string_utils.h /usr/local/include</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now you can compile anywhere with:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb602"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb602-1"><a href="#cb602-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.c <span class="at">-lmylib</span> <span class="at">-o</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-8.-versioning-shared-libraries" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-versioning-shared-libraries">Step 8. Versioning Shared Libraries</h4>
<p>Real-world shared libraries include version numbers for compatibility:</p>
<pre><code>libmylib.so.1.0.0
libmylib.so -&gt; libmylib.so.1.0.0  (symlink)</code></pre>
<p>You can set this during build:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb604"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb604-1"><a href="#cb604-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-shared</span> <span class="at">-Wl,-soname,libmylib.so.1</span> <span class="at">-o</span> libmylib.so.1.0.0 math.o string_utils.o</span>
<span id="cb604-2"><a href="#cb604-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ln</span> <span class="at">-sf</span> libmylib.so.1.0.0 libmylib.so</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="tiny-code-combined-example" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-combined-example">Tiny Code: Combined Example</h4>
<p><strong>Makefile</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb605"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb605-1"><a href="#cb605-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span> <span class="ch">=</span><span class="st"> gcc</span></span>
<span id="cb605-2"><a href="#cb605-2" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span> <span class="ch">=</span><span class="st"> -Wall -fPIC</span></span>
<span id="cb605-3"><a href="#cb605-3" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJS</span> <span class="ch">=</span><span class="st"> math.o string_utils.o</span></span>
<span id="cb605-4"><a href="#cb605-4" aria-hidden="true" tabindex="-1"></a><span class="dt">TARGET_STATIC</span> <span class="ch">=</span><span class="st"> libmylib.a</span></span>
<span id="cb605-5"><a href="#cb605-5" aria-hidden="true" tabindex="-1"></a><span class="dt">TARGET_SHARED</span> <span class="ch">=</span><span class="st"> libmylib.so</span></span>
<span id="cb605-6"><a href="#cb605-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-7"><a href="#cb605-7" aria-hidden="true" tabindex="-1"></a><span class="dv">all:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">TARGET_STATIC</span><span class="ch">)</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">TARGET_SHARED</span><span class="ch">)</span></span>
<span id="cb605-8"><a href="#cb605-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-9"><a href="#cb605-9" aria-hidden="true" tabindex="-1"></a><span class="dv">$(TARGET_STATIC):</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span></span>
<span id="cb605-10"><a href="#cb605-10" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>ar rcs <span class="ch">$@</span> <span class="ch">$^</span></span>
<span id="cb605-11"><a href="#cb605-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-12"><a href="#cb605-12" aria-hidden="true" tabindex="-1"></a><span class="dv">$(TARGET_SHARED):</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span></span>
<span id="cb605-13"><a href="#cb605-13" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> -shared -o <span class="ch">$@</span> <span class="ch">$^</span></span>
<span id="cb605-14"><a href="#cb605-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-15"><a href="#cb605-15" aria-hidden="true" tabindex="-1"></a><span class="dv">%.o:</span><span class="dt"> %.c</span></span>
<span id="cb605-16"><a href="#cb605-16" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> -c <span class="ch">$&lt;</span> -o <span class="ch">$@</span></span>
<span id="cb605-17"><a href="#cb605-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-18"><a href="#cb605-18" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb605-19"><a href="#cb605-19" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f <span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">TARGET_STATIC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">TARGET_SHARED</span><span class="ch">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Build:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb606"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb606-1"><a href="#cb606-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Link app:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb607"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb607-1"><a href="#cb607-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.c <span class="at">-L.</span> <span class="at">-lmylib</span> <span class="at">-o</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb608"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb608-1"><a href="#cb608-1" aria-hidden="true" tabindex="-1"></a><span class="va">LD_LIBRARY_PATH</span><span class="op">=</span>. <span class="ex">./app</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-9.-static-vs-shared-tradeoffs" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-static-vs-shared-tradeoffs">Step 9. Static vs Shared Tradeoffs</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Feature</th>
<th>Static (<code>.a</code>)</th>
<th>Shared (<code>.so</code>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Linking</td>
<td>At compile time</td>
<td>At runtime</td>
</tr>
<tr class="even">
<td>File size</td>
<td>Larger executable</td>
<td>Smaller executable</td>
</tr>
<tr class="odd">
<td>Update</td>
<td>Recompile required</td>
<td>Replace <code>.so</code> file</td>
</tr>
<tr class="even">
<td>Portability</td>
<td>Fully self-contained</td>
<td>Needs library present</td>
</tr>
<tr class="odd">
<td>Speed</td>
<td>Slightly faster</td>
<td>Slight load delay</td>
</tr>
</tbody>
</table>
<p>For small tools or embedded systems, use static. For large or updatable software, prefer shared.</p>
</section>
<section id="step-10.-inspecting-library-symbols" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-inspecting-library-symbols">Step 10. Inspecting Library Symbols</h4>
<p>To see what functions are exported:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb609"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb609-1"><a href="#cb609-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nm</span> <span class="at">-D</span> libmylib.so <span class="kw">|</span> <span class="fu">grep</span> add</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>To check dynamic symbol resolution:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb610"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb610-1"><a href="#cb610-1" aria-hidden="true" tabindex="-1"></a><span class="ex">objdump</span> <span class="at">-T</span> libmylib.so <span class="kw">|</span> <span class="fu">head</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="why-it-matters-54" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-54">Why It Matters</h4>
<p>Libraries make your C code modular, maintainable, and reusable. They are the foundation of every serious C ecosystem, from <code>libc</code> to OpenSSL to SDL.</p>
<p>Once you understand how to build and link your own <code>.a</code> and <code>.so</code> files, you can:</p>
<ul>
<li>Ship APIs others can use</li>
<li>Organize large codebases cleanly</li>
<li>Understand how system libraries integrate into every program you compile</li>
</ul>
</section>
<section id="try-it-yourself-55" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-55">Try It Yourself</h4>
<ol type="1">
<li>Build a small math library (<code>libmathx.a</code>, <code>libmathx.so</code>).</li>
<li>Create a header-only helper and test it in multiple programs.</li>
<li>Try mixing static and shared libraries in one build.</li>
<li>Inspect your shared library with <code>ldd</code> and <code>nm</code>.</li>
<li>Version your <code>.so</code> file using symbolic links and test compatibility.</li>
</ol>
<p>Next, you’ll explore how <strong>compiler flags and optimization levels</strong> affect performance, safety, and debugging, learning how to tune <code>gcc</code> for both development and release builds.</p>
</section>
</section>
<section id="compiler-flags-and-optimization-levels" class="level3">
<h3 class="anchored" data-anchor-id="compiler-flags-and-optimization-levels">58. Compiler Flags and Optimization Levels</h3>
<p>Once your program compiles and links correctly, the next step is mastering <strong>compiler flags</strong>, the switches that control warnings, debugging info, optimization, and performance.</p>
<p>Using the right flags can make your C code <strong>safer</strong>, <strong>faster</strong>, and <strong>easier to debug</strong>.</p>
<p>Let’s go through the essential <code>gcc</code> and <code>clang</code> options every C developer should know.</p>
<section id="step-1.-the-basic-compilation-command" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-the-basic-compilation-command">Step 1. The Basic Compilation Command</h4>
<p>The most common compile command looks like:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb611"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb611-1"><a href="#cb611-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.c <span class="at">-o</span> main</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This compiles <code>main.c</code> into an executable called <code>main</code> using <strong>default settings</strong>, minimal warnings, no optimization, and no debug info.</p>
<p>For serious development, you’ll want more control.</p>
</section>
<section id="step-2.-warning-flags" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-warning-flags">Step 2. Warning Flags</h4>
<p>Warnings are the compiler’s early-warning system. They catch mistakes before they become bugs.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Flag</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>-Wall</code></td>
<td>Enable most common warnings</td>
</tr>
<tr class="even">
<td><code>-Wextra</code></td>
<td>Enable additional, stricter warnings</td>
</tr>
<tr class="odd">
<td><code>-Werror</code></td>
<td>Treat warnings as errors</td>
</tr>
<tr class="even">
<td><code>-Wpedantic</code></td>
<td>Enforce strict ISO C compliance</td>
</tr>
<tr class="odd">
<td><code>-Wshadow</code></td>
<td>Warn if a local variable hides another variable</td>
</tr>
<tr class="even">
<td><code>-Wconversion</code></td>
<td>Warn about implicit type conversions</td>
</tr>
<tr class="odd">
<td><code>-Wunused</code></td>
<td>Warn about unused variables or functions</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb612"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb612-1"><a href="#cb612-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-Wall</span> <span class="at">-Wextra</span> <span class="at">-Werror</span> main.c <span class="at">-o</span> main</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If your code has:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb613"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb613-1"><a href="#cb613-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x<span class="op">;</span></span>
<span id="cb613-2"><a href="#cb613-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You’ll get:</p>
<pre><code>warning: 'x' is used uninitialized</code></pre>
<p>With <code>-Werror</code>, that warning becomes a build-stopping error, a good habit for clean codebases.</p>
</section>
<section id="step-3.-debugging-flags" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-debugging-flags">Step 3. Debugging Flags</h4>
<p>Debugging information allows tools like <code>gdb</code> or <code>lldb</code> to map machine code back to your C source.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>-g</code></td>
<td>Include debug symbols (file names, line numbers)</td>
</tr>
<tr class="even">
<td><code>-ggdb</code></td>
<td>Include GNU-specific symbols for gdb</td>
</tr>
<tr class="odd">
<td><code>-O0</code></td>
<td>Disable optimization (makes debugging easier)</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb615"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb615-1"><a href="#cb615-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-g</span> <span class="at">-O0</span> main.c <span class="at">-o</span> main</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb616"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb616-1"><a href="#cb616-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gdb</span> ./main</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You’ll be able to inspect variables and step through source lines.</p>
</section>
<section id="step-4.-optimization-levels" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-optimization-levels">Step 4. Optimization Levels</h4>
<p>Optimization tells the compiler how aggressively to transform your code for speed or size.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>-O0</code></td>
<td>No optimization (fast compile, easy to debug)</td>
</tr>
<tr class="even">
<td><code>-O1</code></td>
<td>Basic optimization</td>
</tr>
<tr class="odd">
<td><code>-O2</code></td>
<td>General speed optimization (default for most builds)</td>
</tr>
<tr class="even">
<td><code>-O3</code></td>
<td>Aggressive optimization (may increase size)</td>
</tr>
<tr class="odd">
<td><code>-Os</code></td>
<td>Optimize for size</td>
</tr>
<tr class="even">
<td><code>-Ofast</code></td>
<td>Ignore strict standards for speed (dangerous)</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb617"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb617-1"><a href="#cb617-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-O2</span> main.c <span class="at">-o</span> main</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compare sizes:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb618"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb618-1"><a href="#cb618-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-O0</span> main.c <span class="at">-o</span> slow</span>
<span id="cb618-2"><a href="#cb618-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-O2</span> main.c <span class="at">-o</span> fast</span>
<span id="cb618-3"><a href="#cb618-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-lh</span> slow fast</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><code>fast</code> will be smaller and run faster, the compiler reorders code, inlines functions, and removes dead logic.</p>
</section>
<section id="step-5.-profiling-and-instrumentation-flags" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-profiling-and-instrumentation-flags">Step 5. Profiling and Instrumentation Flags</h4>
<p>Profiling helps measure which parts of your program consume the most CPU time.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 48%">
<col style="width: 51%">
</colgroup>
<thead>
<tr class="header">
<th>Flag</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>-pg</code></td>
<td>Generate profiling data for <code>gprof</code></td>
</tr>
<tr class="even">
<td><code>-fprofile-generate</code> / <code>-fprofile-use</code></td>
<td>Use profile-guided optimization (PGO)</td>
</tr>
<tr class="odd">
<td><code>-ftime-report</code></td>
<td>Show how long each compilation phase took</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb619"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb619-1"><a href="#cb619-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-pg</span> main.c <span class="at">-o</span> main</span>
<span id="cb619-2"><a href="#cb619-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./main</span></span>
<span id="cb619-3"><a href="#cb619-3" aria-hidden="true" tabindex="-1"></a><span class="ex">gprof</span> main gmon.out <span class="op">&gt;</span> report.txt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-6.-standards-compliance-flags" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-standards-compliance-flags">Step 6. Standards Compliance Flags</h4>
<p>The C language evolves, you can specify which version to follow.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Flag</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>-std=c89</code></td>
<td>ANSI C (1989)</td>
</tr>
<tr class="even">
<td><code>-std=c99</code></td>
<td>Modern C with <code>inline</code>, <code>bool</code>, <code>// comments</code></td>
</tr>
<tr class="odd">
<td><code>-std=c11</code></td>
<td>Adds <code>_Generic</code>, <code>_Thread_local</code>, safer atomics</td>
</tr>
<tr class="even">
<td><code>-std=c17</code></td>
<td>Minor cleanup</td>
</tr>
<tr class="odd">
<td><code>-std=c23</code></td>
<td>Latest (adds <code>typeof</code>, safer macros, etc.)</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb620"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb620-1"><a href="#cb620-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-std</span><span class="op">=</span>c99 <span class="at">-Wall</span> main.c <span class="at">-o</span> main</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Always choose a consistent standard for your project.</p>
</section>
<section id="step-7.-platform-and-architecture-flags" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-platform-and-architecture-flags">Step 7. Platform and Architecture Flags</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 79%">
</colgroup>
<thead>
<tr class="header">
<th>Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>-m32</code> / <code>-m64</code></td>
<td>Compile for 32-bit or 64-bit architecture</td>
</tr>
<tr class="even">
<td><code>-march=native</code></td>
<td>Optimize for the host CPU</td>
</tr>
<tr class="odd">
<td><code>-fPIC</code></td>
<td>Position-independent code (required for shared libraries)</td>
</tr>
<tr class="even">
<td><code>-static</code></td>
<td>Fully static linking</td>
</tr>
<tr class="odd">
<td><code>-DNAME=value</code></td>
<td>Define a macro (same as <code>#define</code> in code)</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb621"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb621-1"><a href="#cb621-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-DDEBUG</span><span class="op">=</span>1 <span class="at">-O2</span> <span class="at">-m64</span> main.c <span class="at">-o</span> main</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-8.-linking-flags" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-linking-flags">Step 8. Linking Flags</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>-L&lt;dir&gt;</code></td>
<td>Add library search path</td>
</tr>
<tr class="even">
<td><code>-l&lt;name&gt;</code></td>
<td>Link with library (e.g., <code>-lm</code> for math)</td>
</tr>
<tr class="odd">
<td><code>-static</code></td>
<td>Force static linking</td>
</tr>
<tr class="even">
<td><code>-shared</code></td>
<td>Build a shared library</td>
</tr>
<tr class="odd">
<td><code>-rpath &lt;dir&gt;</code></td>
<td>Add runtime library search path</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb622"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb622-1"><a href="#cb622-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.o <span class="at">-L.</span> <span class="at">-lmylib</span> <span class="at">-Wl,-rpath</span><span class="op">=</span>. <span class="at">-o</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><code>-Wl,</code> passes options directly to the linker (<code>ld</code>).</p>
</section>
<section id="tiny-code-debug-and-release-builds" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-debug-and-release-builds">Tiny Code: Debug and Release Builds</h4>
<p><strong>Makefile</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb623"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb623-1"><a href="#cb623-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span> <span class="ch">=</span><span class="st"> gcc</span></span>
<span id="cb623-2"><a href="#cb623-2" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span> <span class="ch">=</span><span class="st"> -Wall -std=c99</span></span>
<span id="cb623-3"><a href="#cb623-3" aria-hidden="true" tabindex="-1"></a><span class="dt">DEBUG_FLAGS</span> <span class="ch">=</span><span class="st"> -g -O0 -DDEBUG</span></span>
<span id="cb623-4"><a href="#cb623-4" aria-hidden="true" tabindex="-1"></a><span class="dt">RELEASE_FLAGS</span> <span class="ch">=</span><span class="st"> -O2 -DNDEBUG</span></span>
<span id="cb623-5"><a href="#cb623-5" aria-hidden="true" tabindex="-1"></a><span class="dt">SRC</span> <span class="ch">=</span><span class="st"> main.c util.c</span></span>
<span id="cb623-6"><a href="#cb623-6" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJ</span> <span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">SRC</span><span class="kw">:</span><span class="ss">.c</span><span class="kw">=</span><span class="ss">.o</span><span class="ch">)</span></span>
<span id="cb623-7"><a href="#cb623-7" aria-hidden="true" tabindex="-1"></a><span class="dt">TARGET</span> <span class="ch">=</span><span class="st"> app</span></span>
<span id="cb623-8"><a href="#cb623-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-9"><a href="#cb623-9" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span><span class="dt"> CFLAGS</span> <span class="ch">+=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">DEBUG_FLAGS</span><span class="ch">)</span></span>
<span id="cb623-10"><a href="#cb623-10" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span>
<span id="cb623-11"><a href="#cb623-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-12"><a href="#cb623-12" aria-hidden="true" tabindex="-1"></a><span class="dv">release:</span><span class="dt"> CFLAGS</span> <span class="ch">+=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">RELEASE_FLAGS</span><span class="ch">)</span></span>
<span id="cb623-13"><a href="#cb623-13" aria-hidden="true" tabindex="-1"></a><span class="dv">release:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span>
<span id="cb623-14"><a href="#cb623-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-15"><a href="#cb623-15" aria-hidden="true" tabindex="-1"></a><span class="dv">$(TARGET):</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span></span>
<span id="cb623-16"><a href="#cb623-16" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span> -o <span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span>
<span id="cb623-17"><a href="#cb623-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-18"><a href="#cb623-18" aria-hidden="true" tabindex="-1"></a><span class="dv">%.o:</span><span class="dt"> %.c</span></span>
<span id="cb623-19"><a href="#cb623-19" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> -c <span class="ch">$&lt;</span> -o <span class="ch">$@</span></span>
<span id="cb623-20"><a href="#cb623-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-21"><a href="#cb623-21" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb623-22"><a href="#cb623-22" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f <span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb624"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb624-1"><a href="#cb624-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> debug</span>
<span id="cb624-2"><a href="#cb624-2" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> release</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>Debug build: full symbols, no optimization.</li>
<li>Release build: optimized, no debugging info.</li>
</ul>
</section>
<section id="step-9.-sanitizers-runtime-safety-tools" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-sanitizers-runtime-safety-tools">Step 9. Sanitizers (Runtime Safety Tools)</h4>
<p>Modern compilers include built-in <strong>sanitizers</strong> to detect memory and thread errors:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Flag</th>
<th>Detects</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>-fsanitize=address</code></td>
<td>Memory leaks, buffer overflows</td>
</tr>
<tr class="even">
<td><code>-fsanitize=undefined</code></td>
<td>Undefined behavior</td>
</tr>
<tr class="odd">
<td><code>-fsanitize=thread</code></td>
<td>Data races in multithreaded code</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb625"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb625-1"><a href="#cb625-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-g</span> <span class="at">-fsanitize</span><span class="op">=</span>address main.c <span class="at">-o</span> main</span>
<span id="cb625-2"><a href="#cb625-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./main</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If your code writes past an array boundary, you’ll get an instant, readable report, no guessing.</p>
</section>
<section id="step-10.-combining-flags" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-combining-flags">Step 10. Combining Flags</h4>
<p>Typical <strong>development build:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb626"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb626-1"><a href="#cb626-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-Wall</span> <span class="at">-Wextra</span> <span class="at">-Werror</span> <span class="at">-g</span> <span class="at">-O0</span> <span class="at">-std</span><span class="op">=</span>c99 main.c <span class="at">-o</span> debug_app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Typical <strong>release build:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb627"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb627-1"><a href="#cb627-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-O2</span> <span class="at">-march</span><span class="op">=</span>native <span class="at">-flto</span> <span class="at">-DNDEBUG</span> main.c <span class="at">-o</span> fast_app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><code>-flto</code> enables <strong>link-time optimization</strong> (LTO), optimizing across files.</li>
<li><code>-DNDEBUG</code> disables <code>assert()</code> calls.</li>
</ul>
</section>
<section id="why-it-matters-55" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-55">Why It Matters</h4>
<p>Compiler flags are how professionals control:</p>
<ul>
<li><strong>Safety</strong> (warnings, sanitizers)</li>
<li><strong>Performance</strong> (optimization levels)</li>
<li><strong>Debuggability</strong> (symbols and checks)</li>
<li><strong>Portability</strong> (standards and architectures)</li>
</ul>
<p>Mastering them gives you precise control over how your code behaves, builds, and performs, essential for reliable systems programming.</p>
</section>
<section id="try-it-yourself-56" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-56">Try It Yourself</h4>
<ol type="1">
<li>Compile the same program with <code>-O0</code>, <code>-O2</code>, and <code>-O3</code>, time each run.</li>
<li>Add <code>-fsanitize=address</code> and find hidden memory bugs.</li>
<li>Compare binary sizes between <code>-g</code> and <code>-s</code>.</li>
<li>Add <code>-Wall -Wextra -Werror</code> to your Makefile and fix every warning.</li>
<li>Explore <code>gcc --help=optimizers</code> to see all available optimization passes.</li>
</ol>
<p>Next, you’ll peek <strong>inside the object file itself</strong>, learning what’s stored inside <code>.o</code> binaries and how the linker stitches them together to form a complete executable.</p>
</section>
</section>
<section id="understanding-the-object-file" class="level3">
<h3 class="anchored" data-anchor-id="understanding-the-object-file">59. Understanding the Object File</h3>
<p>By now, you’ve seen <code>.o</code> files appear in every build step, the intermediate products between source and executable. But what exactly is <em>inside</em> them?</p>
<p>Object files are the compiler’s way of packaging machine code, symbol tables, and metadata, ready for the linker to assemble into a final program. Understanding object files helps you debug linking errors, inspect performance, and even reverse-engineer compiled code.</p>
<section id="step-1.-the-lifecycle-recap" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-the-lifecycle-recap">Step 1. The Lifecycle Recap</h4>
<p>The compilation pipeline looks like this:</p>
<pre><code>source.c ──&gt; preprocessor ──&gt; compiler ──&gt; assembler ──&gt; linker
     |                           |             |          |
     |                        hello.s        hello.o     a.out</code></pre>
<p>Your <code>.c</code> file becomes a <code>.o</code> file after <strong>assembly</strong>, but before <strong>linking</strong>.</p>
<p>Each <code>.o</code> is self-contained, it knows what it defines, what it needs, and where its code lives in memory.</p>
</section>
<section id="step-2.-object-file-formats" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-object-file-formats">Step 2. Object File Formats</h4>
<p>Different operating systems use different binary formats:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 54%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th>OS</th>
<th>Format</th>
<th>Typical Extension</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Linux</td>
<td>ELF (Executable and Linkable Format)</td>
<td><code>.o</code>, <code>.so</code>, executable</td>
</tr>
<tr class="even">
<td>macOS</td>
<td>Mach-O</td>
<td><code>.o</code>, <code>.dylib</code></td>
</tr>
<tr class="odd">
<td>Windows</td>
<td>COFF/PE</td>
<td><code>.obj</code>, <code>.dll</code>, <code>.exe</code></td>
</tr>
</tbody>
</table>
<p>On Linux, ELF dominates, so we’ll use it as our reference.</p>
</section>
<section id="step-3.-sections-inside-an-object-file" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-sections-inside-an-object-file">Step 3. Sections Inside an Object File</h4>
<p>Run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb629"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb629-1"><a href="#cb629-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> main.c <span class="at">-o</span> main.o</span>
<span id="cb629-2"><a href="#cb629-2" aria-hidden="true" tabindex="-1"></a><span class="ex">readelf</span> <span class="at">-S</span> main.o</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You’ll see output like:</p>
<pre><code>[ 1] .text     PROGBITS  code and functions
[ 2] .data     PROGBITS  initialized global variables
[ 3] .bss      NOBITS    uninitialized globals
[ 4] .rodata   PROGBITS  constants (e.g., string literals)
[ 5] .symtab   SYMTAB    symbol table
[ 6] .strtab   STRTAB    string table
[ 7] .rel.text RELA      relocation info</code></pre>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Section</th>
<th>Contents</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>.text</code></td>
<td>Compiled machine code (functions)</td>
</tr>
<tr class="even">
<td><code>.data</code></td>
<td>Global variables with initial values</td>
</tr>
<tr class="odd">
<td><code>.bss</code></td>
<td>Global variables without initial values</td>
</tr>
<tr class="even">
<td><code>.rodata</code></td>
<td>Constants, <code>const</code> variables, string literals</td>
</tr>
<tr class="odd">
<td><code>.symtab</code></td>
<td>Symbol table: function and variable metadata</td>
</tr>
<tr class="even">
<td><code>.rel*</code></td>
<td>Relocation info, how to connect this file to others</td>
</tr>
</tbody>
</table>
</section>
<section id="step-4.-inspecting-symbols" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-inspecting-symbols">Step 4. Inspecting Symbols</h4>
<p>Every <code>.o</code> file contains <strong>symbols</strong> that describe its functions and variables. List them:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb631"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb631-1"><a href="#cb631-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nm</span> main.o</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>0000000000000000 T main
                 U printf</code></pre>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Symbol</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>T</code></td>
<td>Defined in the text (code) section</td>
</tr>
<tr class="even">
<td><code>U</code></td>
<td>Undefined, must be provided by another file or library</td>
</tr>
<tr class="odd">
<td><code>D</code></td>
<td>Defined in data section</td>
</tr>
<tr class="even">
<td><code>B</code></td>
<td>Defined in bss section</td>
</tr>
<tr class="odd">
<td><code>R</code></td>
<td>Defined in read-only data</td>
</tr>
<tr class="even">
<td><code>W</code></td>
<td>Weak symbol (can be overridden)</td>
</tr>
</tbody>
</table>
<p>Here, <code>main</code> is defined, <code>printf</code> is undefined, meaning the linker must find it in the C standard library.</p>
</section>
<section id="tiny-code-inspecting-a-multi-file-example" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-inspecting-a-multi-file-example">Tiny Code: Inspecting a Multi-File Example</h4>
<p><strong>math.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb633"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb633-1"><a href="#cb633-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb633-2"><a href="#cb633-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> mul<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">*</span> b<span class="op">;</span> <span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>main.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb634"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb634-1"><a href="#cb634-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb634-2"><a href="#cb634-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span><span class="op">);</span></span>
<span id="cb634-3"><a href="#cb634-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> mul<span class="op">(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span><span class="op">);</span></span>
<span id="cb634-4"><a href="#cb634-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-5"><a href="#cb634-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb634-6"><a href="#cb634-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> add<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">)</span> <span class="op">*</span> mul<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">4</span><span class="op">));</span></span>
<span id="cb634-7"><a href="#cb634-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb634-8"><a href="#cb634-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile but don’t link:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb635"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb635-1"><a href="#cb635-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> main.c</span>
<span id="cb635-2"><a href="#cb635-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> math.c</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Inspect:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb636"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb636-1"><a href="#cb636-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nm</span> main.o</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>U add
U mul
U printf
T main</code></pre>
<p><code>U</code> means <em>undefined</em>, the linker must resolve these.</p>
<p>Now inspect <code>math.o</code>:</p>
<pre><code>T add
T mul</code></pre>
<p>These are <em>definitions</em> that will satisfy the linker.</p>
<p>Link and inspect the result:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb639"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb639-1"><a href="#cb639-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.o math.o <span class="at">-o</span> app</span>
<span id="cb639-2"><a href="#cb639-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nm</span> app <span class="kw">|</span> <span class="fu">grep</span> add</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now you’ll see:</p>
<pre><code>0000000000401136 T add</code></pre>
<p>The linker relocated <code>add()</code> into its final address.</p>
</section>
<section id="step-5.-symbol-visibility" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-symbol-visibility">Step 5. Symbol Visibility</h4>
<p>By default, every function and global variable has <strong>external linkage</strong>, visible to the linker.</p>
<p>Use <code>static</code> to limit visibility to the current file:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb641"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb641-1"><a href="#cb641-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">int</span> hidden_func<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> <span class="dv">42</span><span class="op">;</span> <span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now <code>nm</code> will not list it as an exported symbol. This keeps your binary clean and prevents name collisions across files.</p>
</section>
<section id="step-6.-inspecting-relocations" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-inspecting-relocations">Step 6. Inspecting Relocations</h4>
<p>Object files can’t know final addresses yet, so they store <strong>relocation entries</strong>: placeholders for addresses that the linker must fill later.</p>
<p>Check them:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb642"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb642-1"><a href="#cb642-1" aria-hidden="true" tabindex="-1"></a><span class="ex">readelf</span> <span class="at">-r</span> main.o</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Relocation section '.rela.text':
0000000000000010 R_X86_64_PC32 printf-0x4</code></pre>
<p>This tells the linker:</p>
<blockquote class="blockquote">
<p>“When linking, replace this placeholder with the address of <code>printf()</code>.”</p>
</blockquote>
</section>
<section id="step-7.-disassemble-the-code" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-disassemble-the-code">Step 7. Disassemble the Code</h4>
<p>You can see the actual machine instructions:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb644"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb644-1"><a href="#cb644-1" aria-hidden="true" tabindex="-1"></a><span class="ex">objdump</span> <span class="at">-d</span> main.o</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output snippet:</p>
<pre><code>0000000000000000 &lt;main&gt;:
   0: 55                    push   %rbp
   1: 48 89 e5              mov    %rsp,%rbp
   4: b8 00 00 00 00        mov    $0x0,%eax</code></pre>
<p>Each instruction corresponds to compiled C code. This is how you verify optimizations, inspect inlining, or study generated assembly.</p>
</section>
<section id="step-8.-mixing-object-files" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-mixing-object-files">Step 8. Mixing Object Files</h4>
<p>Because <code>.o</code> files contain clear symbol metadata, you can mix object files from different languages, for example, C and assembly.</p>
<p><strong>sum.s</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb646"><pre class="sourceCode asm code-with-copy"><code class="sourceCode fasm"><span id="cb646-1"><a href="#cb646-1" aria-hidden="true" tabindex="-1"></a>.globl sum</span>
<span id="cb646-2"><a href="#cb646-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum:</span></span>
<span id="cb646-3"><a href="#cb646-3" aria-hidden="true" tabindex="-1"></a>    addq <span class="op">%</span><span class="kw">rsi</span><span class="op">,</span> <span class="op">%</span><span class="kw">rdi</span></span>
<span id="cb646-4"><a href="#cb646-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">movq</span> <span class="op">%</span><span class="kw">rdi</span><span class="op">,</span> <span class="op">%</span><span class="kw">rax</span></span>
<span id="cb646-5"><a href="#cb646-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">ret</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and link:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb647"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb647-1"><a href="#cb647-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as</span> sum.s <span class="at">-o</span> sum.o</span>
<span id="cb647-2"><a href="#cb647-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.c sum.o <span class="at">-o</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This is how C integrates cleanly with low-level code.</p>
</section>
<section id="step-9.-object-file-size-and-contents" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-object-file-size-and-contents">Step 9. Object File Size and Contents</h4>
<p>Check file size:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb648"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb648-1"><a href="#cb648-1" aria-hidden="true" tabindex="-1"></a><span class="fu">size</span> main.o</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>text    data     bss     dec     hex filename
45      4        0       49      31  main.o</code></pre>
<ul>
<li><code>text</code> → code size</li>
<li><code>data</code> → initialized global variables</li>
<li><code>bss</code> → uninitialized variables</li>
</ul>
</section>
<section id="step-10.-tiny-code-investigate-everything" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-investigate-everything">Step 10. Tiny Code: Investigate Everything</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb650"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb650-1"><a href="#cb650-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> hello.c <span class="at">-o</span> hello.o</span>
<span id="cb650-2"><a href="#cb650-2" aria-hidden="true" tabindex="-1"></a><span class="ex">readelf</span> <span class="at">-h</span> hello.o          <span class="co"># ELF header</span></span>
<span id="cb650-3"><a href="#cb650-3" aria-hidden="true" tabindex="-1"></a><span class="ex">readelf</span> <span class="at">-S</span> hello.o          <span class="co"># Sections</span></span>
<span id="cb650-4"><a href="#cb650-4" aria-hidden="true" tabindex="-1"></a><span class="ex">readelf</span> <span class="at">-s</span> hello.o <span class="kw">|</span> <span class="fu">head</span>   <span class="co"># Symbol table</span></span>
<span id="cb650-5"><a href="#cb650-5" aria-hidden="true" tabindex="-1"></a><span class="ex">readelf</span> <span class="at">-r</span> hello.o          <span class="co"># Relocations</span></span>
<span id="cb650-6"><a href="#cb650-6" aria-hidden="true" tabindex="-1"></a><span class="ex">objdump</span> <span class="at">-d</span> hello.o <span class="kw">|</span> <span class="fu">head</span>   <span class="co"># Disassembly</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You’ll get a complete low-level view of how your C code looks to the compiler.</p>
</section>
<section id="why-it-matters-56" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-56">Why It Matters</h4>
<p>Understanding object files helps you:</p>
<ul>
<li>Debug linking errors and symbol conflicts</li>
<li>Inspect compiler optimizations</li>
<li>Integrate C with assembly</li>
<li>Build static and shared libraries manually</li>
<li>See what’s actually inside the binary</li>
</ul>
<p>In systems programming, this insight separates code <em>users</em> from code <em>engineers</em>.</p>
</section>
<section id="try-it-yourself-57" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-57">Try It Yourself</h4>
<ol type="1">
<li>Create two <code>.o</code> files that depend on each other and inspect their undefined symbols.</li>
<li>Use <code>readelf -S</code> to compare <code>.text</code>, <code>.data</code>, and <code>.bss</code> for different programs.</li>
<li>Add a global variable and see how it appears in <code>.data</code> or <code>.bss</code>.</li>
<li>Mark a function as <code>static</code> and confirm it disappears from <code>nm</code> output.</li>
<li>Compile with <code>-O2</code> and observe changes in disassembly with <code>objdump -d</code>.</li>
</ol>
<p>Next, you’ll complete Chapter 6 by building your own <strong>Makefile-based compilation pipeline</strong> from scratch, writing every stage explicitly to transform <code>.c</code> files into <code>.o</code>, <code>.a</code>, and <code>.so</code> artifacts just like a real compiler toolchain.</p>
</section>
</section>
<section id="practice-write-your-own-makefile" class="level3">
<h3 class="anchored" data-anchor-id="practice-write-your-own-makefile">60. Practice: Write Your Own Makefile</h3>
<p>Now that you understand how the C build process works, preprocessing, compiling, linking, and libraries, it’s time to <strong>tie everything together</strong> with your own <strong>Makefile</strong>.</p>
<p><code>make</code> is one of the oldest and most powerful automation tools in C development. It watches file timestamps, builds only what has changed, and lets you define build rules in a concise way.</p>
<p>By writing your own Makefile, you’ll automate your entire compilation workflow like a professional.</p>
<section id="step-1.-create-the-project" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-create-the-project">Step 1. Create the Project</h4>
<p>Let’s build a small multi-file project:</p>
<pre><code>project/
├── Makefile
├── main.c
├── math.c
├── math.h
└── string_utils.c</code></pre>
<p><strong>main.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb652"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb652-1"><a href="#cb652-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb652-2"><a href="#cb652-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"math.h"</span></span>
<span id="cb652-3"><a href="#cb652-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb652-4"><a href="#cb652-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb652-5"><a href="#cb652-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"2 + 3 = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> add<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">));</span></span>
<span id="cb652-6"><a href="#cb652-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"2 * 3 = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> mul<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">));</span></span>
<span id="cb652-7"><a href="#cb652-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb652-8"><a href="#cb652-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>math.c</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb653"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb653-1"><a href="#cb653-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"math.h"</span></span>
<span id="cb653-2"><a href="#cb653-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb653-3"><a href="#cb653-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb653-4"><a href="#cb653-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> mul<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">*</span> b<span class="op">;</span> <span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>math.h</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb654"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb654-1"><a href="#cb654-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef MATH_H</span></span>
<span id="cb654-2"><a href="#cb654-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MATH_H</span></span>
<span id="cb654-3"><a href="#cb654-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-4"><a href="#cb654-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">);</span></span>
<span id="cb654-5"><a href="#cb654-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> mul<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">);</span></span>
<span id="cb654-6"><a href="#cb654-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-7"><a href="#cb654-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-2.-write-the-simplest-makefile" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-write-the-simplest-makefile">Step 2. Write the Simplest Makefile</h4>
<p><strong>Makefile</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb655"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb655-1"><a href="#cb655-1" aria-hidden="true" tabindex="-1"></a><span class="dv">main:</span><span class="dt"> main.c math.c</span></span>
<span id="cb655-2"><a href="#cb655-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>gcc main.c math.c -o main</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb656"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb656-1"><a href="#cb656-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span>
<span id="cb656-2"><a href="#cb656-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./main</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>2 + 3 = 5
2 * 3 = 6</code></pre>
<p>This works, but <code>make</code> will rebuild everything every time, even if only one file changed.</p>
<p>Let’s make it smarter.</p>
</section>
<section id="step-3.-split-the-compilation-steps" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-split-the-compilation-steps">Step 3. Split the Compilation Steps</h4>
<p>Separate compilation into object files:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb658"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb658-1"><a href="#cb658-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span> <span class="ch">=</span><span class="st"> gcc</span></span>
<span id="cb658-2"><a href="#cb658-2" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span> <span class="ch">=</span><span class="st"> -Wall -std=c99</span></span>
<span id="cb658-3"><a href="#cb658-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-4"><a href="#cb658-4" aria-hidden="true" tabindex="-1"></a><span class="dv">main:</span><span class="dt"> main.o math.o</span></span>
<span id="cb658-5"><a href="#cb658-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> main.o math.o -o main</span>
<span id="cb658-6"><a href="#cb658-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-7"><a href="#cb658-7" aria-hidden="true" tabindex="-1"></a><span class="dv">main.o:</span><span class="dt"> main.c math.h</span></span>
<span id="cb658-8"><a href="#cb658-8" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> -c main.c</span>
<span id="cb658-9"><a href="#cb658-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-10"><a href="#cb658-10" aria-hidden="true" tabindex="-1"></a><span class="dv">math.o:</span><span class="dt"> math.c math.h</span></span>
<span id="cb658-11"><a href="#cb658-11" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> -c math.c</span>
<span id="cb658-12"><a href="#cb658-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-13"><a href="#cb658-13" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb658-14"><a href="#cb658-14" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f *.o main</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now when you run <code>make</code>, it builds <code>.o</code> files only once, and recompiles only what changed.</p>
<p>Test it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb659"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb659-1"><a href="#cb659-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span>
<span id="cb659-2"><a href="#cb659-2" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> math.c</span>
<span id="cb659-3"><a href="#cb659-3" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You’ll see that only <code>math.o</code> is rebuilt.</p>
</section>
<section id="step-4.-add-automatic-dependency-handling" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-add-automatic-dependency-handling">Step 4. Add Automatic Dependency Handling</h4>
<p>Use <strong>pattern rules</strong> to avoid repeating commands for every <code>.c</code> file:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb660"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb660-1"><a href="#cb660-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span> <span class="ch">=</span><span class="st"> gcc</span></span>
<span id="cb660-2"><a href="#cb660-2" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span> <span class="ch">=</span><span class="st"> -Wall -std=c99</span></span>
<span id="cb660-3"><a href="#cb660-3" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJS</span> <span class="ch">=</span><span class="st"> main.o math.o string_utils.o</span></span>
<span id="cb660-4"><a href="#cb660-4" aria-hidden="true" tabindex="-1"></a><span class="dt">TARGET</span> <span class="ch">=</span><span class="st"> app</span></span>
<span id="cb660-5"><a href="#cb660-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb660-6"><a href="#cb660-6" aria-hidden="true" tabindex="-1"></a><span class="dv">$(TARGET):</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span></span>
<span id="cb660-7"><a href="#cb660-7" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span> -o <span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span>
<span id="cb660-8"><a href="#cb660-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb660-9"><a href="#cb660-9" aria-hidden="true" tabindex="-1"></a><span class="dv">%.o:</span><span class="dt"> %.c</span></span>
<span id="cb660-10"><a href="#cb660-10" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> -c <span class="ch">$&lt;</span> -o <span class="ch">$@</span></span>
<span id="cb660-11"><a href="#cb660-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb660-12"><a href="#cb660-12" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb660-13"><a href="#cb660-13" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f <span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><code>$&lt;</code> means “the first dependency” (like <code>main.c</code>). <code>$@</code> means “the target” (like <code>main.o</code>).</p>
<p>Now the Makefile works for any <code>.c</code> file automatically.</p>
</section>
<section id="step-5.-add-debug-and-release-targets" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-add-debug-and-release-targets">Step 5. Add Debug and Release Targets</h4>
<p>Real projects have multiple build modes:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb661"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb661-1"><a href="#cb661-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span> <span class="ch">=</span><span class="st"> gcc</span></span>
<span id="cb661-2"><a href="#cb661-2" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span> <span class="ch">=</span><span class="st"> -Wall -std=c99</span></span>
<span id="cb661-3"><a href="#cb661-3" aria-hidden="true" tabindex="-1"></a><span class="dt">DEBUG_FLAGS</span> <span class="ch">=</span><span class="st"> -g -O0 -DDEBUG</span></span>
<span id="cb661-4"><a href="#cb661-4" aria-hidden="true" tabindex="-1"></a><span class="dt">RELEASE_FLAGS</span> <span class="ch">=</span><span class="st"> -O2 -DNDEBUG</span></span>
<span id="cb661-5"><a href="#cb661-5" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJS</span> <span class="ch">=</span><span class="st"> main.o math.o</span></span>
<span id="cb661-6"><a href="#cb661-6" aria-hidden="true" tabindex="-1"></a><span class="dt">TARGET</span> <span class="ch">=</span><span class="st"> app</span></span>
<span id="cb661-7"><a href="#cb661-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-8"><a href="#cb661-8" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY:</span><span class="dt"> all clean debug release</span></span>
<span id="cb661-9"><a href="#cb661-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-10"><a href="#cb661-10" aria-hidden="true" tabindex="-1"></a><span class="dv">all:</span><span class="dt"> release</span></span>
<span id="cb661-11"><a href="#cb661-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-12"><a href="#cb661-12" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span><span class="dt"> CFLAGS</span> <span class="ch">+=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">DEBUG_FLAGS</span><span class="ch">)</span></span>
<span id="cb661-13"><a href="#cb661-13" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span>
<span id="cb661-14"><a href="#cb661-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-15"><a href="#cb661-15" aria-hidden="true" tabindex="-1"></a><span class="dv">release:</span><span class="dt"> CFLAGS</span> <span class="ch">+=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">RELEASE_FLAGS</span><span class="ch">)</span></span>
<span id="cb661-16"><a href="#cb661-16" aria-hidden="true" tabindex="-1"></a><span class="dv">release:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span>
<span id="cb661-17"><a href="#cb661-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-18"><a href="#cb661-18" aria-hidden="true" tabindex="-1"></a><span class="dv">$(TARGET):</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span></span>
<span id="cb661-19"><a href="#cb661-19" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span> -o <span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span>
<span id="cb661-20"><a href="#cb661-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-21"><a href="#cb661-21" aria-hidden="true" tabindex="-1"></a><span class="dv">%.o:</span><span class="dt"> %.c</span></span>
<span id="cb661-22"><a href="#cb661-22" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> -c <span class="ch">$&lt;</span> -o <span class="ch">$@</span></span>
<span id="cb661-23"><a href="#cb661-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-24"><a href="#cb661-24" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb661-25"><a href="#cb661-25" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f <span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb662"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb662-1"><a href="#cb662-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> debug</span>
<span id="cb662-2"><a href="#cb662-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./app</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb663"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb663-1"><a href="#cb663-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> clean</span>
<span id="cb663-2"><a href="#cb663-2" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> release</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The debug build has symbols for <code>gdb</code>; the release build is optimized.</p>
</section>
<section id="step-6.-add-static-and-shared-library-targets" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-add-static-and-shared-library-targets">Step 6. Add Static and Shared Library Targets</h4>
<p>Add these to your Makefile:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb664"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb664-1"><a href="#cb664-1" aria-hidden="true" tabindex="-1"></a><span class="dv">libmylib.a:</span><span class="dt"> math.o</span></span>
<span id="cb664-2"><a href="#cb664-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>ar rcs libmylib.a math.o</span>
<span id="cb664-3"><a href="#cb664-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-4"><a href="#cb664-4" aria-hidden="true" tabindex="-1"></a><span class="dv">libmylib.so:</span><span class="dt"> math.o</span></span>
<span id="cb664-5"><a href="#cb664-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> -shared -o libmylib.so math.o</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now you can build a reusable library:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb665"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb665-1"><a href="#cb665-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> libmylib.a</span>
<span id="cb665-2"><a href="#cb665-2" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> libmylib.so</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-7.-add-installation-and-help" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-add-installation-and-help">Step 7. Add Installation and Help</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb666"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb666-1"><a href="#cb666-1" aria-hidden="true" tabindex="-1"></a><span class="dv">install:</span></span>
<span id="cb666-2"><a href="#cb666-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>cp app /usr/local/bin/</span>
<span id="cb666-3"><a href="#cb666-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb666-4"><a href="#cb666-4" aria-hidden="true" tabindex="-1"></a><span class="dv">help:</span></span>
<span id="cb666-5"><a href="#cb666-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="st">"make [target]"</span></span>
<span id="cb666-6"><a href="#cb666-6" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="st">"Targets: all, debug, release, clean, install, libmylib.a, libmylib.so"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The <code>@</code> suppresses command echoing, only prints your messages.</p>
<p>Run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb667"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb667-1"><a href="#cb667-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> help</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-8.-use-variables-for-paths-and-options" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-use-variables-for-paths-and-options">Step 8. Use Variables for Paths and Options</h4>
<p>Clean up your Makefile by grouping related flags:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb668"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb668-1"><a href="#cb668-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span> <span class="ch">=</span><span class="st"> gcc</span></span>
<span id="cb668-2"><a href="#cb668-2" aria-hidden="true" tabindex="-1"></a><span class="dt">SRC</span> <span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">wildcard</span><span class="st"> *.c</span><span class="ch">)</span></span>
<span id="cb668-3"><a href="#cb668-3" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJ</span> <span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">SRC</span><span class="kw">:</span><span class="ss">.c</span><span class="kw">=</span><span class="ss">.o</span><span class="ch">)</span></span>
<span id="cb668-4"><a href="#cb668-4" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span> <span class="ch">=</span><span class="st"> -Wall -Wextra -std=c99</span></span>
<span id="cb668-5"><a href="#cb668-5" aria-hidden="true" tabindex="-1"></a><span class="dt">LDFLAGS</span> <span class="ch">=</span><span class="st"> -lm</span></span>
<span id="cb668-6"><a href="#cb668-6" aria-hidden="true" tabindex="-1"></a><span class="dt">TARGET</span> <span class="ch">=</span><span class="st"> app</span></span>
<span id="cb668-7"><a href="#cb668-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb668-8"><a href="#cb668-8" aria-hidden="true" tabindex="-1"></a><span class="dv">$(TARGET):</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span></span>
<span id="cb668-9"><a href="#cb668-9" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span> -o <span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">LDFLAGS</span><span class="ch">)</span></span>
<span id="cb668-10"><a href="#cb668-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb668-11"><a href="#cb668-11" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb668-12"><a href="#cb668-12" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f <span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><code>wildcard</code> and <code>patsubst</code> let you automatically include new <code>.c</code> files as the project grows.</p>
</section>
<section id="tiny-code-final-polished-makefile" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-final-polished-makefile">Tiny Code: Final Polished Makefile</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb669"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb669-1"><a href="#cb669-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span> <span class="ch">=</span><span class="st"> gcc</span></span>
<span id="cb669-2"><a href="#cb669-2" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span> <span class="ch">=</span><span class="st"> -Wall -Wextra -std=c99 -O2</span></span>
<span id="cb669-3"><a href="#cb669-3" aria-hidden="true" tabindex="-1"></a><span class="dt">LDFLAGS</span> <span class="ch">=</span><span class="st"> -lm</span></span>
<span id="cb669-4"><a href="#cb669-4" aria-hidden="true" tabindex="-1"></a><span class="dt">SRC</span> <span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">wildcard</span><span class="st"> *.c</span><span class="ch">)</span></span>
<span id="cb669-5"><a href="#cb669-5" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJ</span> <span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">SRC</span><span class="kw">:</span><span class="ss">.c</span><span class="kw">=</span><span class="ss">.o</span><span class="ch">)</span></span>
<span id="cb669-6"><a href="#cb669-6" aria-hidden="true" tabindex="-1"></a><span class="dt">TARGET</span> <span class="ch">=</span><span class="st"> app</span></span>
<span id="cb669-7"><a href="#cb669-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb669-8"><a href="#cb669-8" aria-hidden="true" tabindex="-1"></a><span class="dv">all:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span>
<span id="cb669-9"><a href="#cb669-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb669-10"><a href="#cb669-10" aria-hidden="true" tabindex="-1"></a><span class="dv">$(TARGET):</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span></span>
<span id="cb669-11"><a href="#cb669-11" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span> -o <span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">LDFLAGS</span><span class="ch">)</span></span>
<span id="cb669-12"><a href="#cb669-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb669-13"><a href="#cb669-13" aria-hidden="true" tabindex="-1"></a><span class="dv">%.o:</span><span class="dt"> %.c</span></span>
<span id="cb669-14"><a href="#cb669-14" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> -c <span class="ch">$&lt;</span> -o <span class="ch">$@</span></span>
<span id="cb669-15"><a href="#cb669-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb669-16"><a href="#cb669-16" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb669-17"><a href="#cb669-17" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f <span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb670"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb670-1"><a href="#cb670-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span>
<span id="cb670-2"><a href="#cb670-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./app</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This pattern is simple, robust, and scalable, the foundation of nearly all C build systems.</p>
</section>
<section id="step-9.-makefile-debugging" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-makefile-debugging">Step 9. Makefile Debugging</h4>
<p>To see what commands <code>make</code> is running:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb671"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb671-1"><a href="#cb671-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> VERBOSE=1</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Or trace variable expansions:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb672"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb672-1"><a href="#cb672-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> <span class="at">-p</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Add <code>@echo "Building $@"</code> before commands for clarity.</p>
</section>
<section id="step-10.-why-it-matters" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-why-it-matters">Step 10. Why It Matters</h4>
<p>A well-crafted Makefile:</p>
<ul>
<li>Automates your entire C build workflow</li>
<li>Avoids recompiling unchanged files</li>
<li>Scales to large multi-directory projects</li>
<li>Makes your builds reproducible across systems</li>
</ul>
<p>It’s your first step toward professional build systems like <strong>CMake</strong>, <strong>Meson</strong>, or <strong>Bazel</strong>, all of which build on these principles.</p>
</section>
<section id="try-it-yourself-58" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-58">Try It Yourself</h4>
<ol type="1">
<li>Add a new <code>.c</code> file and watch your Makefile compile it automatically.</li>
<li>Add a <code>test</code> target that compiles and runs unit tests.</li>
<li>Add colorized output using <code>tput</code> or ANSI escapes.</li>
<li>Build both static and shared libraries in one run.</li>
<li>Convert your Makefile to use multiple directories (<code>src/</code>, <code>include/</code>, <code>build/</code>).</li>
</ol>
<p><strong>Congratulations!</strong> You’ve completed <strong>Chapter 6 – Compilation and the Build Process</strong>. You now understand how source becomes an executable, every stage from preprocessor to linker, and every tool in between.</p>
<p>Next, we’ll step deeper into <strong>Chapter 7: Working Close to the System</strong>, where your programs start interacting directly with the operating system through system calls, processes, and files.</p>
</section>
</section>
</section>
<section id="chapter-7.-working-close-to-the-system" class="level1">
<h1>Chapter 7. Working Close to the System</h1>
<section id="system-calls-and-the-standard-library" class="level3">
<h3 class="anchored" data-anchor-id="system-calls-and-the-standard-library">61. System Calls and the Standard Library</h3>
<p>When you write C programs that touch files, processes, or devices, you’re talking to the <strong>operating system</strong>, not directly to hardware. That communication happens through <strong>system calls</strong>.</p>
<p>System calls are the lowest-level interface between user-space programs and the OS kernel. C’s <strong>standard library (libc)</strong> is a thin layer of wrappers built on top of those calls, making them easier to use and more portable.</p>
<p>Let’s explore how this works, and how to use system calls directly from your C code.</p>
<section id="step-1.-what-is-a-system-call" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-is-a-system-call">Step 1. What Is a System Call?</h4>
<p>A <strong>system call</strong> (syscall) lets a program request a service from the OS kernel, like reading a file, creating a process, or allocating memory.</p>
<p>Examples:</p>
<ul>
<li><code>read()</code>, <code>write()</code> – access files and devices</li>
<li><code>fork()</code>, <code>exec()</code> – create and manage processes</li>
<li><code>open()</code>, <code>close()</code> – handle file descriptors</li>
<li><code>mmap()</code> – map files into memory</li>
<li><code>socket()</code> – network communication</li>
</ul>
<p>When you call a system function, control passes from <strong>user space</strong> to <strong>kernel space</strong>, then back again.</p>
</section>
<section id="step-2.-the-role-of-libc" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-the-role-of-libc">Step 2. The Role of libc</h4>
<p>The C standard library (glibc, musl, etc.) provides <em>wrappers</em> around these system calls.</p>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb673"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb673-1"><a href="#cb673-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb673-2"><a href="#cb673-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb673-3"><a href="#cb673-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb673-4"><a href="#cb673-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>f <span class="op">=</span> fopen<span class="op">(</span><span class="st">"test.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb673-5"><a href="#cb673-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>f<span class="op">)</span> <span class="op">{</span></span>
<span id="cb673-6"><a href="#cb673-6" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"fopen failed"</span><span class="op">);</span></span>
<span id="cb673-7"><a href="#cb673-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb673-8"><a href="#cb673-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb673-9"><a href="#cb673-9" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>f<span class="op">);</span></span>
<span id="cb673-10"><a href="#cb673-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Under the hood, <code>fopen()</code> eventually calls <code>open()</code>, a system call defined in <code>&lt;fcntl.h&gt;</code>. You can call it directly too.</p>
</section>
<section id="step-3.-calling-system-calls-directly" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-calling-system-calls-directly">Step 3. Calling System Calls Directly</h4>
<p>Here’s the same operation without stdio helpers:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb674"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb674-1"><a href="#cb674-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fcntl.h&gt;</span><span class="pp">     </span><span class="co">// open</span></span>
<span id="cb674-2"><a href="#cb674-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span><span class="pp">    </span><span class="co">// read, write, close</span></span>
<span id="cb674-3"><a href="#cb674-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span><span class="pp">     </span><span class="co">// perror</span></span>
<span id="cb674-4"><a href="#cb674-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb674-5"><a href="#cb674-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb674-6"><a href="#cb674-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span><span class="st">"test.txt"</span><span class="op">,</span> O_RDONLY<span class="op">);</span></span>
<span id="cb674-7"><a href="#cb674-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fd <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb674-8"><a href="#cb674-8" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"open failed"</span><span class="op">);</span></span>
<span id="cb674-9"><a href="#cb674-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb674-10"><a href="#cb674-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb674-11"><a href="#cb674-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb674-12"><a href="#cb674-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buf<span class="op">[</span><span class="dv">128</span><span class="op">];</span></span>
<span id="cb674-13"><a href="#cb674-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ssize_t</span> n <span class="op">=</span> read<span class="op">(</span>fd<span class="op">,</span> buf<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buf<span class="op">)</span> <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb674-14"><a href="#cb674-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb674-15"><a href="#cb674-15" aria-hidden="true" tabindex="-1"></a>        buf<span class="op">[</span>n<span class="op">]</span> <span class="op">=</span> <span class="ch">'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">;</span></span>
<span id="cb674-16"><a href="#cb674-16" aria-hidden="true" tabindex="-1"></a>        write<span class="op">(</span>STDOUT_FILENO<span class="op">,</span> buf<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb674-17"><a href="#cb674-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb674-18"><a href="#cb674-18" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb674-19"><a href="#cb674-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb675"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb675-1"><a href="#cb675-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> sysread.c <span class="at">-o</span> sysread</span>
<span id="cb675-2"><a href="#cb675-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./sysread</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This prints the first 128 bytes of <code>test.txt</code> directly using system calls, no <code>fopen()</code> or <code>printf()</code> involved.</p>
</section>
<section id="tiny-code-minimal-system-call-example" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-minimal-system-call-example">Tiny Code: Minimal System Call Example</h4>
<p>Let’s drop even the C library and use a <strong>raw syscall</strong> interface.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb676"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb676-1"><a href="#cb676-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb676-2"><a href="#cb676-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb676-3"><a href="#cb676-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb676-4"><a href="#cb676-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> msg<span class="op">[]</span> <span class="op">=</span> <span class="st">"Hello via system call</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="cb676-5"><a href="#cb676-5" aria-hidden="true" tabindex="-1"></a>    write<span class="op">(</span><span class="dv">1</span><span class="op">,</span> msg<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>msg<span class="op">)</span> <span class="op">-</span> <span class="dv">1</span><span class="op">);</span>  <span class="co">// 1 = STDOUT</span></span>
<span id="cb676-6"><a href="#cb676-6" aria-hidden="true" tabindex="-1"></a>    _exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb676-7"><a href="#cb676-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb677"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb677-1"><a href="#cb677-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-nostdlib</span> <span class="at">-static</span> syshello.c <span class="at">-o</span> syshello</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run:</p>
<pre><code>Hello via system call</code></pre>
<p>You just executed a system call directly, bypassing the standard library entirely.</p>
</section>
<section id="step-4.-file-descriptors" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-file-descriptors">Step 4. File Descriptors</h4>
<p>System calls like <code>read()</code> and <code>write()</code> work with <strong>file descriptors</strong>, small integer handles managed by the OS.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Descriptor</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>Standard input (<code>stdin</code>)</td>
</tr>
<tr class="even">
<td>1</td>
<td>Standard output (<code>stdout</code>)</td>
</tr>
<tr class="odd">
<td>2</td>
<td>Standard error (<code>stderr</code>)</td>
</tr>
</tbody>
</table>
<p>Every open file, socket, or pipe has a unique descriptor.</p>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb679"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb679-1"><a href="#cb679-1" aria-hidden="true" tabindex="-1"></a>write<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="st">"Output to stdout</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> <span class="dv">17</span><span class="op">);</span></span>
<span id="cb679-2"><a href="#cb679-2" aria-hidden="true" tabindex="-1"></a>write<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="st">"Output to stderr</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> <span class="dv">17</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-5.-inspecting-system-calls" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-inspecting-system-calls">Step 5. Inspecting System Calls</h4>
<p>You can watch your program’s system calls using <code>strace</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb680"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb680-1"><a href="#cb680-1" aria-hidden="true" tabindex="-1"></a><span class="ex">strace</span> ./sysread</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example output:</p>
<pre><code>open("test.txt", O_RDONLY) = 3
read(3, "Hello World\n", 12) = 12
write(1, "Hello World\n", 12) = 12
close(3) = 0</code></pre>
<p>This shows the real kernel-level operations, a great debugging and learning tool.</p>
</section>
<section id="step-6.-return-values-and-errors" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-return-values-and-errors">Step 6. Return Values and Errors</h4>
<p>System calls usually return:</p>
<ul>
<li><strong>≥ 0</strong> → success (bytes read, process ID, etc.)</li>
<li><strong>-1</strong> → error (with <code>errno</code> set to an error code)</li>
</ul>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb682"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb682-1"><a href="#cb682-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;errno.h&gt;</span></span>
<span id="cb682-2"><a href="#cb682-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb682-3"><a href="#cb682-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb682-4"><a href="#cb682-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span><span class="st">"missing.txt"</span><span class="op">,</span> O_RDONLY<span class="op">);</span></span>
<span id="cb682-5"><a href="#cb682-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>fd <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb682-6"><a href="#cb682-6" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Error: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> strerror<span class="op">(</span>errno<span class="op">));</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Common error codes:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Code</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>ENOENT</code></td>
<td>File not found</td>
</tr>
<tr class="even">
<td><code>EACCES</code></td>
<td>Permission denied</td>
</tr>
<tr class="odd">
<td><code>EBADF</code></td>
<td>Invalid descriptor</td>
</tr>
<tr class="even">
<td><code>EINTR</code></td>
<td>Interrupted system call</td>
</tr>
</tbody>
</table>
</section>
<section id="step-7.-mixing-system-calls-and-stdio" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-mixing-system-calls-and-stdio">Step 7. Mixing System Calls and stdio</h4>
<p>You can combine both layers safely, just don’t mix them on the <em>same</em> file descriptor.</p>
<p>Example (safe):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb683"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb683-1"><a href="#cb683-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> <span class="op">*</span>f <span class="op">=</span> fopen<span class="op">(</span><span class="st">"log.txt"</span><span class="op">,</span> <span class="st">"w"</span><span class="op">);</span></span>
<span id="cb683-2"><a href="#cb683-2" aria-hidden="true" tabindex="-1"></a>write<span class="op">(</span>STDOUT_FILENO<span class="op">,</span> <span class="st">"Console log</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> <span class="dv">12</span><span class="op">);</span></span>
<span id="cb683-3"><a href="#cb683-3" aria-hidden="true" tabindex="-1"></a>fprintf<span class="op">(</span>f<span class="op">,</span> <span class="st">"File log</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb683-4"><a href="#cb683-4" aria-hidden="true" tabindex="-1"></a>fclose<span class="op">(</span>f<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example (unsafe):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb684"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb684-1"><a href="#cb684-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> <span class="op">*</span>f <span class="op">=</span> fopen<span class="op">(</span><span class="st">"data.txt"</span><span class="op">,</span> <span class="st">"w"</span><span class="op">);</span></span>
<span id="cb684-2"><a href="#cb684-2" aria-hidden="true" tabindex="-1"></a>write<span class="op">(</span>fileno<span class="op">(</span>f<span class="op">),</span> <span class="st">"mixed output</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> <span class="dv">13</span><span class="op">);</span>  <span class="co">// may confuse buffering</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-8.-system-call-wrappers" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-system-call-wrappers">Step 8. System Call Wrappers</h4>
<p>The Linux kernel provides hundreds of system calls. You can call most through <code>&lt;unistd.h&gt;</code>, but for rare ones, you can use <code>syscall()</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb685"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb685-1"><a href="#cb685-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/syscall.h&gt;</span></span>
<span id="cb685-2"><a href="#cb685-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb685-3"><a href="#cb685-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb685-4"><a href="#cb685-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb685-5"><a href="#cb685-5" aria-hidden="true" tabindex="-1"></a>    syscall<span class="op">(</span>SYS_write<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="st">"Hello syscall</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> <span class="dv">14</span><span class="op">);</span></span>
<span id="cb685-6"><a href="#cb685-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb685-7"><a href="#cb685-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-9.-viewing-available-syscalls" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-viewing-available-syscalls">Step 9. Viewing Available Syscalls</h4>
<p>Check all available system calls for your platform:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb686"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb686-1"><a href="#cb686-1" aria-hidden="true" tabindex="-1"></a><span class="fu">man</span> 2 intro</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>or</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb687"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb687-1"><a href="#cb687-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ausyscall</span> <span class="at">--dump</span> <span class="kw">|</span> <span class="fu">head</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You’ll see a list like:</p>
<pre><code>read, write, open, close, stat, fork, execve, mmap, ...</code></pre>
</section>
<section id="step-10.-why-it-matters-1" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-why-it-matters-1">Step 10. Why It Matters</h4>
<p>System calls are the <em>foundation</em> of everything in C and Unix-like systems.</p>
<p>They give your program direct access to:</p>
<ul>
<li>Files and devices</li>
<li>Processes and signals</li>
<li>Memory and networking</li>
<li>Time and environment</li>
</ul>
<p>Learning to use them directly is essential for understanding how higher-level abstractions (like <code>stdio</code>, <code>pthreads</code>, or sockets) are built.</p>
</section>
<section id="try-it-yourself-59" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-59">Try It Yourself</h4>
<ol type="1">
<li>Use <code>strace</code> on <code>ls</code> or <code>cat</code> to see how system calls drive them.</li>
<li>Replace a <code>fopen()</code>/<code>fread()</code> pair with direct <code>open()</code> and <code>read()</code> calls.</li>
<li>Write a tiny file copier using only <code>open</code>, <code>read</code>, <code>write</code>, and <code>close</code>.</li>
<li>Experiment with invalid file descriptors and print out <code>errno</code>.</li>
<li>Build a version of <code>echo</code> that uses only raw system calls.</li>
</ol>
<p>Next, you’ll take this a step further: learning how to <strong>create and manage processes</strong> with <code>fork()</code> and <code>exec()</code>, the heart of Unix multitasking.</p>
</section>
</section>
<section id="process-creation-fork-exec-wait" class="level3">
<h3 class="anchored" data-anchor-id="process-creation-fork-exec-wait">62. Process Creation (fork, exec, wait)</h3>
<p>Every program in a Unix-like system runs inside a <strong>process</strong>, a running instance of a program with its own memory, file descriptors, and environment. When you type <code>ls</code> or <code>cat</code>, the shell doesn’t just “jump” into those programs. It <strong>creates a new process</strong> to run them.</p>
<p>In C, you can do exactly the same thing, create new processes, run other programs, and synchronize them.</p>
<p>This section teaches you how <strong><code>fork()</code></strong>, <strong><code>exec()</code></strong>, and <strong><code>wait()</code></strong> work together, the three essential building blocks of process control.</p>
<section id="step-1.-the-idea-of-a-process" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-the-idea-of-a-process">Step 1. The Idea of a Process</h4>
<p>When your program starts, it runs as <strong>one process</strong>, with:</p>
<ul>
<li>a <strong>PID</strong> (process ID),</li>
<li>its own <strong>memory space</strong>,</li>
<li><strong>file descriptors</strong> (stdin, stdout, stderr),</li>
<li>and environment variables.</li>
</ul>
<p>You can check your own PID:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb689"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb689-1"><a href="#cb689-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb689-2"><a href="#cb689-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb689-3"><a href="#cb689-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb689-4"><a href="#cb689-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb689-5"><a href="#cb689-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"My PID is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> getpid<span class="op">());</span></span>
<span id="cb689-6"><a href="#cb689-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb689-7"><a href="#cb689-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb690"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb690-1"><a href="#cb690-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> pid.c <span class="at">-o</span> pid</span>
<span id="cb690-2"><a href="#cb690-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./pid</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>My PID is 5231</code></pre>
</section>
<section id="step-2.-creating-a-new-process-with-fork" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-creating-a-new-process-with-fork">Step 2. Creating a New Process with <code>fork()</code></h4>
<p><code>fork()</code> creates a <strong>new process</strong> by duplicating the current one.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb692"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb692-1"><a href="#cb692-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb692-2"><a href="#cb692-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb692-3"><a href="#cb692-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb692-4"><a href="#cb692-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb692-5"><a href="#cb692-5" aria-hidden="true" tabindex="-1"></a>    pid_t pid <span class="op">=</span> fork<span class="op">();</span></span>
<span id="cb692-6"><a href="#cb692-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb692-7"><a href="#cb692-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb692-8"><a href="#cb692-8" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"fork failed"</span><span class="op">);</span></span>
<span id="cb692-9"><a href="#cb692-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb692-10"><a href="#cb692-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb692-11"><a href="#cb692-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb692-12"><a href="#cb692-12" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Child process! PID = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> getpid<span class="op">());</span></span>
<span id="cb692-13"><a href="#cb692-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb692-14"><a href="#cb692-14" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Parent process! PID = </span><span class="sc">%d</span><span class="st">, child PID = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> getpid<span class="op">(),</span> pid<span class="op">);</span></span>
<span id="cb692-15"><a href="#cb692-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb692-16"><a href="#cb692-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb692-17"><a href="#cb692-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb693"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb693-1"><a href="#cb693-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> fork_demo.c <span class="at">-o</span> fork_demo</span>
<span id="cb693-2"><a href="#cb693-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./fork_demo</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example output:</p>
<pre><code>Parent process! PID = 5231, child PID = 5232
Child process! PID = 5232</code></pre>
<ul>
<li><code>fork()</code> returns <strong>0</strong> in the child process</li>
<li><code>fork()</code> returns <strong>child PID</strong> in the parent process</li>
<li>Both processes continue executing from the same point</li>
</ul>
</section>
<section id="step-3.-independent-memory-after-fork" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-independent-memory-after-fork">Step 3. Independent Memory After <code>fork()</code></h4>
<p>Each process gets a <strong>copy</strong> of the parent’s memory. Changing a variable in the child doesn’t affect the parent.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb695"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb695-1"><a href="#cb695-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb695-2"><a href="#cb695-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb695-3"><a href="#cb695-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb695-4"><a href="#cb695-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb695-5"><a href="#cb695-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> counter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb695-6"><a href="#cb695-6" aria-hidden="true" tabindex="-1"></a>    pid_t pid <span class="op">=</span> fork<span class="op">();</span></span>
<span id="cb695-7"><a href="#cb695-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb695-8"><a href="#cb695-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb695-9"><a href="#cb695-9" aria-hidden="true" tabindex="-1"></a>        counter <span class="op">+=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb695-10"><a href="#cb695-10" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Child counter: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> counter<span class="op">);</span></span>
<span id="cb695-11"><a href="#cb695-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb695-12"><a href="#cb695-12" aria-hidden="true" tabindex="-1"></a>        counter <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb695-13"><a href="#cb695-13" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Parent counter: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> counter<span class="op">);</span></span>
<span id="cb695-14"><a href="#cb695-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb695-15"><a href="#cb695-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb695-16"><a href="#cb695-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Parent counter: 1
Child counter: 10</code></pre>
<p>Each process has its own copy of <code>counter</code>.</p>
</section>
<section id="step-4.-replacing-a-process-image-with-exec" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-replacing-a-process-image-with-exec">Step 4. Replacing a Process Image with <code>exec()</code></h4>
<p>After <code>fork()</code>, the child can <strong>replace itself</strong> with a new program using <code>exec()</code>.</p>
<p>There are multiple versions:</p>
<ul>
<li><code>execl(path, arg0, arg1, ..., NULL)</code></li>
<li><code>execv(path, argv[])</code></li>
<li><code>execlp(file, arg0, arg1, ..., NULL)</code>, searches <code>$PATH</code></li>
<li><code>execvp(file, argv[])</code>, most commonly used</li>
</ul>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb697"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb697-1"><a href="#cb697-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb697-2"><a href="#cb697-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb697-3"><a href="#cb697-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb697-4"><a href="#cb697-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb697-5"><a href="#cb697-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Before exec</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb697-6"><a href="#cb697-6" aria-hidden="true" tabindex="-1"></a>    execlp<span class="op">(</span><span class="st">"ls"</span><span class="op">,</span> <span class="st">"ls"</span><span class="op">,</span> <span class="st">"-l"</span><span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb697-7"><a href="#cb697-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"This will not run if exec succeeds</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb697-8"><a href="#cb697-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb697-9"><a href="#cb697-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb698"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb698-1"><a href="#cb698-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> exec_demo.c <span class="at">-o</span> exec_demo</span>
<span id="cb698-2"><a href="#cb698-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./exec_demo</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Before exec
(total listing from `ls`)</code></pre>
<p>After <code>exec</code>, the current process image is replaced, the PID stays the same, but the program running inside changes.</p>
</section>
<section id="step-5.-combining-fork-and-exec" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-combining-fork-and-exec">Step 5. Combining <code>fork()</code> and <code>exec()</code></h4>
<p>This is how your shell launches commands.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb700"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb700-1"><a href="#cb700-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb700-2"><a href="#cb700-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb700-3"><a href="#cb700-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb700-4"><a href="#cb700-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb700-5"><a href="#cb700-5" aria-hidden="true" tabindex="-1"></a>    pid_t pid <span class="op">=</span> fork<span class="op">();</span></span>
<span id="cb700-6"><a href="#cb700-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb700-7"><a href="#cb700-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb700-8"><a href="#cb700-8" aria-hidden="true" tabindex="-1"></a>        execlp<span class="op">(</span><span class="st">"echo"</span><span class="op">,</span> <span class="st">"echo"</span><span class="op">,</span> <span class="st">"Hello from child"</span><span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb700-9"><a href="#cb700-9" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"exec failed"</span><span class="op">);</span></span>
<span id="cb700-10"><a href="#cb700-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb700-11"><a href="#cb700-11" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Parent is waiting...</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb700-12"><a href="#cb700-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb700-13"><a href="#cb700-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb700-14"><a href="#cb700-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Parent is waiting...
Hello from child</code></pre>
<p>The parent forks; the child replaces itself with <code>echo</code>.</p>
</section>
<section id="step-6.-waiting-for-the-child-wait-and-waitpid" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-waiting-for-the-child-wait-and-waitpid">Step 6. Waiting for the Child (<code>wait()</code> and <code>waitpid()</code>)</h4>
<p>The parent can <strong>wait</strong> for its child process to finish.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb702"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb702-1"><a href="#cb702-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb702-2"><a href="#cb702-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb702-3"><a href="#cb702-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/wait.h&gt;</span></span>
<span id="cb702-4"><a href="#cb702-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb702-5"><a href="#cb702-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb702-6"><a href="#cb702-6" aria-hidden="true" tabindex="-1"></a>    pid_t pid <span class="op">=</span> fork<span class="op">();</span></span>
<span id="cb702-7"><a href="#cb702-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb702-8"><a href="#cb702-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb702-9"><a href="#cb702-9" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Child running</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb702-10"><a href="#cb702-10" aria-hidden="true" tabindex="-1"></a>        execlp<span class="op">(</span><span class="st">"sleep"</span><span class="op">,</span> <span class="st">"sleep"</span><span class="op">,</span> <span class="st">"1"</span><span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb702-11"><a href="#cb702-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb702-12"><a href="#cb702-12" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Parent waiting for child...</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb702-13"><a href="#cb702-13" aria-hidden="true" tabindex="-1"></a>        wait<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb702-14"><a href="#cb702-14" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Child finished</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb702-15"><a href="#cb702-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb702-16"><a href="#cb702-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb702-17"><a href="#cb702-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb703"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb703-1"><a href="#cb703-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> wait_demo.c <span class="at">-o</span> wait_demo</span>
<span id="cb703-2"><a href="#cb703-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./wait_demo</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Parent waiting for child...
Child running
Child finished</code></pre>
</section>
<section id="step-7.-checking-exit-status" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-checking-exit-status">Step 7. Checking Exit Status</h4>
<p>You can get the child’s <strong>exit code</strong> using <code>waitpid()</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb705"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb705-1"><a href="#cb705-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb705-2"><a href="#cb705-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/wait.h&gt;</span></span>
<span id="cb705-3"><a href="#cb705-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb705-4"><a href="#cb705-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb705-5"><a href="#cb705-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb705-6"><a href="#cb705-6" aria-hidden="true" tabindex="-1"></a>    pid_t pid <span class="op">=</span> fork<span class="op">();</span></span>
<span id="cb705-7"><a href="#cb705-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb705-8"><a href="#cb705-8" aria-hidden="true" tabindex="-1"></a>        _exit<span class="op">(</span><span class="dv">42</span><span class="op">);</span>  <span class="co">// child exits with status 42</span></span>
<span id="cb705-9"><a href="#cb705-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb705-10"><a href="#cb705-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> status<span class="op">;</span></span>
<span id="cb705-11"><a href="#cb705-11" aria-hidden="true" tabindex="-1"></a>        waitpid<span class="op">(</span>pid<span class="op">,</span> <span class="op">&amp;</span>status<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb705-12"><a href="#cb705-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>WIFEXITED<span class="op">(</span>status<span class="op">))</span></span>
<span id="cb705-13"><a href="#cb705-13" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"Child exited with code </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> WEXITSTATUS<span class="op">(</span>status<span class="op">));</span></span>
<span id="cb705-14"><a href="#cb705-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb705-15"><a href="#cb705-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Child exited with code 42</code></pre>
</section>
<section id="step-8.-multiple-children" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-multiple-children">Step 8. Multiple Children</h4>
<p>You can spawn multiple processes and wait for them all:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb707"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb707-1"><a href="#cb707-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb707-2"><a href="#cb707-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb707-3"><a href="#cb707-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/wait.h&gt;</span></span>
<span id="cb707-4"><a href="#cb707-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb707-5"><a href="#cb707-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb707-6"><a href="#cb707-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb707-7"><a href="#cb707-7" aria-hidden="true" tabindex="-1"></a>        pid_t pid <span class="op">=</span> fork<span class="op">();</span></span>
<span id="cb707-8"><a href="#cb707-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>pid <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb707-9"><a href="#cb707-9" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"Child </span><span class="sc">%d</span><span class="st"> PID </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> getpid<span class="op">());</span></span>
<span id="cb707-10"><a href="#cb707-10" aria-hidden="true" tabindex="-1"></a>            _exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb707-11"><a href="#cb707-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb707-12"><a href="#cb707-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb707-13"><a href="#cb707-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb707-14"><a href="#cb707-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb707-15"><a href="#cb707-15" aria-hidden="true" tabindex="-1"></a>        wait<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb707-16"><a href="#cb707-16" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"All children done</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb707-17"><a href="#cb707-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Child 0 PID 5321
Child 1 PID 5322
Child 2 PID 5323
All children done</code></pre>
</section>
<section id="step-9.-orphan-and-zombie-processes" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-orphan-and-zombie-processes">Step 9. Orphan and Zombie Processes</h4>
<p>If the parent doesn’t call <code>wait()</code>, the child becomes a <strong>zombie</strong> (terminated, but still in process table). If the parent terminates before the child, the child becomes an <strong>orphan</strong> and gets adopted by <code>init</code> (PID 1).</p>
<p>Run this:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb709"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb709-1"><a href="#cb709-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ps</span> <span class="at">-l</span> <span class="kw">|</span> <span class="fu">grep</span> Z</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You’ll see zombie processes marked with a <code>Z</code>.</p>
</section>
<section id="tiny-code-minimal-shell-launcher" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-minimal-shell-launcher">Tiny Code: Minimal Shell Launcher</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb710"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb710-1"><a href="#cb710-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb710-2"><a href="#cb710-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb710-3"><a href="#cb710-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/wait.h&gt;</span></span>
<span id="cb710-4"><a href="#cb710-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb710-5"><a href="#cb710-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb710-6"><a href="#cb710-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="st">"ls"</span><span class="op">,</span> <span class="st">"-1"</span><span class="op">,</span> NULL<span class="op">};</span></span>
<span id="cb710-7"><a href="#cb710-7" aria-hidden="true" tabindex="-1"></a>    pid_t pid <span class="op">=</span> fork<span class="op">();</span></span>
<span id="cb710-8"><a href="#cb710-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb710-9"><a href="#cb710-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb710-10"><a href="#cb710-10" aria-hidden="true" tabindex="-1"></a>        execvp<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">],</span> argv<span class="op">);</span></span>
<span id="cb710-11"><a href="#cb710-11" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"exec failed"</span><span class="op">);</span></span>
<span id="cb710-12"><a href="#cb710-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb710-13"><a href="#cb710-13" aria-hidden="true" tabindex="-1"></a>        wait<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb710-14"><a href="#cb710-14" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Command finished</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb710-15"><a href="#cb710-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb710-16"><a href="#cb710-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb711"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb711-1"><a href="#cb711-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> mini_shell.c <span class="at">-o</span> mini_shell</span>
<span id="cb711-2"><a href="#cb711-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./mini_shell</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>(file listing)
Command finished</code></pre>
</section>
<section id="step-10.-why-it-matters-2" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-why-it-matters-2">Step 10. Why It Matters</h4>
<p><code>fork()</code>, <code>exec()</code>, and <code>wait()</code> form the <strong>core process model</strong> of Unix. Every command-line program, daemon, and service uses these under the hood.</p>
<p>They let you:</p>
<ul>
<li>Launch other programs</li>
<li>Build parallel workers</li>
<li>Implement your own shell</li>
<li>Control process trees and jobs</li>
</ul>
<p>Once you understand these, you’re ready to dive into <strong>inter-process communication</strong>, making your processes talk via <strong>pipes and redirection</strong>.</p>
</section>
<section id="try-it-yourself-60" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-60">Try It Yourself</h4>
<ol type="1">
<li>Write a program that forks two children, one runs <code>date</code>, one runs <code>whoami</code>.</li>
<li>Modify it to wait for both children to finish.</li>
<li>Create a program that forks a child, but the parent exits immediately (observe orphan adoption).</li>
<li>Write your own <code>run(command)</code> function using <code>fork()</code>, <code>execvp()</code>, and <code>waitpid()</code>.</li>
<li>Combine all this into a tiny shell that accepts commands and executes them interactively.</li>
</ol>
<p>Next, you’ll learn how these processes can <strong>communicate and share data</strong>, using <strong>file descriptors, pipes, and redirection</strong> in the next section.</p>
</section>
</section>
<section id="file-descriptors-and-openreadwrite" class="level3">
<h3 class="anchored" data-anchor-id="file-descriptors-and-openreadwrite">63. File Descriptors and open/read/write</h3>
<p>Now that you can create and manage processes, let’s explore how those processes <strong>communicate with files, devices, and even each other</strong>, through <strong>file descriptors</strong>.</p>
<p>File descriptors (FDs) are one of the simplest yet most powerful abstractions in Unix and C. Everything, files, pipes, sockets, terminals, is represented by a small integer handle. Once you understand how to open, read, write, and close file descriptors, you can interact with any I/O system on a Unix machine.</p>
<section id="step-1.-what-is-a-file-descriptor" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-is-a-file-descriptor">Step 1. What Is a File Descriptor?</h4>
<p>A <strong>file descriptor</strong> is an integer that identifies an open resource in your process. Every process starts with three open descriptors by default:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>FD</th>
<th>Symbolic Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td><code>STDIN_FILENO</code></td>
<td>Standard input (keyboard)</td>
</tr>
<tr class="even">
<td>1</td>
<td><code>STDOUT_FILENO</code></td>
<td>Standard output (screen)</td>
</tr>
<tr class="odd">
<td>2</td>
<td><code>STDERR_FILENO</code></td>
<td>Standard error (screen)</td>
</tr>
</tbody>
</table>
<p>Each time you open a file, socket, or pipe, the kernel gives you the <strong>lowest unused FD</strong>.</p>
</section>
<section id="step-2.-opening-files-with-open" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-opening-files-with-open">Step 2. Opening Files with <code>open()</code></h4>
<p>You can open files directly using the <strong>system call layer</strong>, instead of <code>fopen()</code> from stdio.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb713"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb713-1"><a href="#cb713-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fcntl.h&gt;</span><span class="pp">     </span><span class="co">// open</span></span>
<span id="cb713-2"><a href="#cb713-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span><span class="pp">    </span><span class="co">// close, read, write</span></span>
<span id="cb713-3"><a href="#cb713-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span><span class="pp">     </span><span class="co">// perror</span></span>
<span id="cb713-4"><a href="#cb713-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb713-5"><a href="#cb713-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb713-6"><a href="#cb713-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span><span class="st">"data.txt"</span><span class="op">,</span> O_RDONLY<span class="op">);</span></span>
<span id="cb713-7"><a href="#cb713-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fd <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb713-8"><a href="#cb713-8" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"open failed"</span><span class="op">);</span></span>
<span id="cb713-9"><a href="#cb713-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb713-10"><a href="#cb713-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb713-11"><a href="#cb713-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb713-12"><a href="#cb713-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"File descriptor: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> fd<span class="op">);</span></span>
<span id="cb713-13"><a href="#cb713-13" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb713-14"><a href="#cb713-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb714"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb714-1"><a href="#cb714-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> open_demo.c <span class="at">-o</span> open_demo</span>
<span id="cb714-2"><a href="#cb714-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./open_demo</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output example:</p>
<pre><code>File descriptor: 3</code></pre>
</section>
<section id="step-3.-reading-from-a-file" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-reading-from-a-file">Step 3. Reading from a File</h4>
<p><code>read(fd, buffer, size)</code> reads raw bytes into a memory buffer.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb716"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb716-1"><a href="#cb716-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fcntl.h&gt;</span></span>
<span id="cb716-2"><a href="#cb716-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb716-3"><a href="#cb716-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb716-4"><a href="#cb716-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb716-5"><a href="#cb716-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb716-6"><a href="#cb716-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span><span class="st">"data.txt"</span><span class="op">,</span> O_RDONLY<span class="op">);</span></span>
<span id="cb716-7"><a href="#cb716-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fd <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb716-8"><a href="#cb716-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb716-9"><a href="#cb716-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buf<span class="op">[</span><span class="dv">64</span><span class="op">];</span></span>
<span id="cb716-10"><a href="#cb716-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ssize_t</span> n <span class="op">=</span> read<span class="op">(</span>fd<span class="op">,</span> buf<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buf<span class="op">)</span> <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb716-11"><a href="#cb716-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb716-12"><a href="#cb716-12" aria-hidden="true" tabindex="-1"></a>        buf<span class="op">[</span>n<span class="op">]</span> <span class="op">=</span> <span class="ch">'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">;</span></span>
<span id="cb716-13"><a href="#cb716-13" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Read </span><span class="sc">%zd</span><span class="st"> bytes: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> n<span class="op">,</span> buf<span class="op">);</span></span>
<span id="cb716-14"><a href="#cb716-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb716-15"><a href="#cb716-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb716-16"><a href="#cb716-16" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb716-17"><a href="#cb716-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Read 12 bytes: Hello world</code></pre>
</section>
<section id="step-4.-writing-to-a-file" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-writing-to-a-file">Step 4. Writing to a File</h4>
<p><code>write(fd, buffer, size)</code> writes raw bytes from memory to a file descriptor.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb718"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb718-1"><a href="#cb718-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fcntl.h&gt;</span></span>
<span id="cb718-2"><a href="#cb718-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb718-3"><a href="#cb718-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb718-4"><a href="#cb718-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb718-5"><a href="#cb718-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb718-6"><a href="#cb718-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span><span class="st">"out.txt"</span><span class="op">,</span> O_WRONLY <span class="op">|</span> O_CREAT <span class="op">|</span> O_TRUNC<span class="op">,</span> <span class="bn">0644</span><span class="op">);</span></span>
<span id="cb718-7"><a href="#cb718-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> msg<span class="op">[]</span> <span class="op">=</span> <span class="st">"Writing from C using write()</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="cb718-8"><a href="#cb718-8" aria-hidden="true" tabindex="-1"></a>    write<span class="op">(</span>fd<span class="op">,</span> msg<span class="op">,</span> strlen<span class="op">(</span>msg<span class="op">));</span></span>
<span id="cb718-9"><a href="#cb718-9" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb718-10"><a href="#cb718-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This overwrites <code>out.txt</code> with your message. Flags:</p>
<ul>
<li><code>O_WRONLY</code> → write-only</li>
<li><code>O_CREAT</code> → create if it doesn’t exist</li>
<li><code>O_TRUNC</code> → truncate (clear) existing contents</li>
</ul>
<p>The final argument <code>0644</code> sets Unix permissions:</p>
<ul>
<li>Owner can read/write,</li>
<li>Group/others can read.</li>
</ul>
</section>
<section id="step-5.-append-and-non-blocking-modes" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-append-and-non-blocking-modes">Step 5. Append and Non-blocking Modes</h4>
<p>You can combine flags using bitwise OR:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb719"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb719-1"><a href="#cb719-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span><span class="st">"log.txt"</span><span class="op">,</span> O_WRONLY <span class="op">|</span> O_CREAT <span class="op">|</span> O_APPEND<span class="op">,</span> <span class="bn">0644</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><code>O_APPEND</code> moves the file offset to the end before every write, ideal for logs.</p>
<p>You can also open files as <strong>non-blocking</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb720"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb720-1"><a href="#cb720-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span><span class="st">"pipe"</span><span class="op">,</span> O_RDONLY <span class="op">|</span> O_NONBLOCK<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Useful for I/O on sockets or named pipes.</p>
</section>
<section id="step-6.-duplicating-descriptors" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-duplicating-descriptors">Step 6. Duplicating Descriptors</h4>
<p>You can duplicate an FD using <code>dup()</code> or <code>dup2()</code>. This is how <strong>redirection</strong> works (<code>&gt;</code> in shells).</p>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb721"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb721-1"><a href="#cb721-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb721-2"><a href="#cb721-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fcntl.h&gt;</span></span>
<span id="cb721-3"><a href="#cb721-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb721-4"><a href="#cb721-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb721-5"><a href="#cb721-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb721-6"><a href="#cb721-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span><span class="st">"output.txt"</span><span class="op">,</span> O_WRONLY <span class="op">|</span> O_CREAT <span class="op">|</span> O_TRUNC<span class="op">,</span> <span class="bn">0644</span><span class="op">);</span></span>
<span id="cb721-7"><a href="#cb721-7" aria-hidden="true" tabindex="-1"></a>    dup2<span class="op">(</span>fd<span class="op">,</span> STDOUT_FILENO<span class="op">);</span>  <span class="co">// redirect stdout to file</span></span>
<span id="cb721-8"><a href="#cb721-8" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb721-9"><a href="#cb721-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb721-10"><a href="#cb721-10" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"This goes into output.txt!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb721-11"><a href="#cb721-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>After <code>dup2</code>, everything printed to stdout goes to <code>output.txt</code>.</p>
<p>Run and inspect:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb722"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb722-1"><a href="#cb722-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./redir_demo</span></span>
<span id="cb722-2"><a href="#cb722-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> output.txt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>This goes into output.txt!</code></pre>
</section>
<section id="step-7.-offsets-and-lseek" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-offsets-and-lseek">Step 7. Offsets and <code>lseek()</code></h4>
<p>You can move around inside a file using <code>lseek(fd, offset, whence)</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb724"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb724-1"><a href="#cb724-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fcntl.h&gt;</span></span>
<span id="cb724-2"><a href="#cb724-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb724-3"><a href="#cb724-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb724-4"><a href="#cb724-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb724-5"><a href="#cb724-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb724-6"><a href="#cb724-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span><span class="st">"data.txt"</span><span class="op">,</span> O_RDONLY<span class="op">);</span></span>
<span id="cb724-7"><a href="#cb724-7" aria-hidden="true" tabindex="-1"></a>    lseek<span class="op">(</span>fd<span class="op">,</span> <span class="dv">5</span><span class="op">,</span> SEEK_SET<span class="op">);</span> <span class="co">// move to byte 5</span></span>
<span id="cb724-8"><a href="#cb724-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buf<span class="op">[</span><span class="dv">16</span><span class="op">];</span></span>
<span id="cb724-9"><a href="#cb724-9" aria-hidden="true" tabindex="-1"></a>    read<span class="op">(</span>fd<span class="op">,</span> buf<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb724-10"><a href="#cb724-10" aria-hidden="true" tabindex="-1"></a>    buf<span class="op">[</span><span class="dv">10</span><span class="op">]</span> <span class="op">=</span> <span class="ch">'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">;</span></span>
<span id="cb724-11"><a href="#cb724-11" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Chunk: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> buf<span class="op">);</span></span>
<span id="cb724-12"><a href="#cb724-12" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb724-13"><a href="#cb724-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><code>whence</code> can be:</p>
<ul>
<li><code>SEEK_SET</code> (from start)</li>
<li><code>SEEK_CUR</code> (from current)</li>
<li><code>SEEK_END</code> (from end)</li>
</ul>
</section>
<section id="step-8.-error-checking-and-return-values" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-error-checking-and-return-values">Step 8. Error Checking and Return Values</h4>
<p>All system calls return:</p>
<ul>
<li>A nonnegative value → success</li>
<li><code>-1</code> → error (check <code>errno</code>)</li>
</ul>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb725"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb725-1"><a href="#cb725-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;errno.h&gt;</span></span>
<span id="cb725-2"><a href="#cb725-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb725-3"><a href="#cb725-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb725-4"><a href="#cb725-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fcntl.h&gt;</span></span>
<span id="cb725-5"><a href="#cb725-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb725-6"><a href="#cb725-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb725-7"><a href="#cb725-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb725-8"><a href="#cb725-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span><span class="st">"missing.txt"</span><span class="op">,</span> O_RDONLY<span class="op">);</span></span>
<span id="cb725-9"><a href="#cb725-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fd <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb725-10"><a href="#cb725-10" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Error: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> strerror<span class="op">(</span>errno<span class="op">));</span></span>
<span id="cb725-11"><a href="#cb725-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Error: No such file or directory</code></pre>
</section>
<section id="tiny-code-copy-file-using-system-calls" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-copy-file-using-system-calls">Tiny Code: Copy File Using System Calls</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb727"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb727-1"><a href="#cb727-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fcntl.h&gt;</span></span>
<span id="cb727-2"><a href="#cb727-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb727-3"><a href="#cb727-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb727-4"><a href="#cb727-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb727-5"><a href="#cb727-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb727-6"><a href="#cb727-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> src <span class="op">=</span> open<span class="op">(</span><span class="st">"source.txt"</span><span class="op">,</span> O_RDONLY<span class="op">);</span></span>
<span id="cb727-7"><a href="#cb727-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> dst <span class="op">=</span> open<span class="op">(</span><span class="st">"copy.txt"</span><span class="op">,</span> O_WRONLY <span class="op">|</span> O_CREAT <span class="op">|</span> O_TRUNC<span class="op">,</span> <span class="bn">0644</span><span class="op">);</span></span>
<span id="cb727-8"><a href="#cb727-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb727-9"><a href="#cb727-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>src <span class="op">==</span> <span class="op">-</span><span class="dv">1</span> <span class="op">||</span> dst <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb727-10"><a href="#cb727-10" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"open failed"</span><span class="op">);</span></span>
<span id="cb727-11"><a href="#cb727-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb727-12"><a href="#cb727-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb727-13"><a href="#cb727-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb727-14"><a href="#cb727-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buf<span class="op">[</span><span class="dv">256</span><span class="op">];</span></span>
<span id="cb727-15"><a href="#cb727-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ssize_t</span> n<span class="op">;</span></span>
<span id="cb727-16"><a href="#cb727-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">((</span>n <span class="op">=</span> read<span class="op">(</span>src<span class="op">,</span> buf<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buf<span class="op">)))</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb727-17"><a href="#cb727-17" aria-hidden="true" tabindex="-1"></a>        write<span class="op">(</span>dst<span class="op">,</span> buf<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb727-18"><a href="#cb727-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb727-19"><a href="#cb727-19" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>src<span class="op">);</span></span>
<span id="cb727-20"><a href="#cb727-20" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>dst<span class="op">);</span></span>
<span id="cb727-21"><a href="#cb727-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb727-22"><a href="#cb727-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb728"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb728-1"><a href="#cb728-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> copy.c <span class="at">-o</span> copy</span>
<span id="cb728-2"><a href="#cb728-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./copy</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now <code>copy.txt</code> is identical to <code>source.txt</code>, using pure syscalls.</p>
</section>
<section id="step-9.-reading-from-stdin-and-writing-to-stdout" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-reading-from-stdin-and-writing-to-stdout">Step 9. Reading from STDIN and Writing to STDOUT</h4>
<p>You can use <code>read(0, ...)</code> and <code>write(1, ...)</code> directly for console I/O.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb729"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb729-1"><a href="#cb729-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb729-2"><a href="#cb729-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb729-3"><a href="#cb729-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb729-4"><a href="#cb729-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buf<span class="op">[</span><span class="dv">64</span><span class="op">];</span></span>
<span id="cb729-5"><a href="#cb729-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ssize_t</span> n <span class="op">=</span> read<span class="op">(</span>STDIN_FILENO<span class="op">,</span> buf<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buf<span class="op">));</span></span>
<span id="cb729-6"><a href="#cb729-6" aria-hidden="true" tabindex="-1"></a>    write<span class="op">(</span>STDOUT_FILENO<span class="op">,</span> buf<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb729-7"><a href="#cb729-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb730"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb730-1"><a href="#cb730-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./echo_demo</span></span>
<span id="cb730-2"><a href="#cb730-2" aria-hidden="true" tabindex="-1"></a><span class="ex">hello</span> world</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>hello world</code></pre>
<p>That’s the essence of every shell command.</p>
</section>
<section id="step-10.-why-it-matters-3" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-why-it-matters-3">Step 10. Why It Matters</h4>
<p>File descriptors unify I/O across everything:</p>
<ul>
<li>Regular files</li>
<li>Pipes and sockets</li>
<li>Devices and terminals</li>
</ul>
<p>They let you control exactly how data flows in and out of your program, a foundation for system tools, servers, and OS-level programming.</p>
<p>Once you understand these primitives, you can build your own versions of tools like <code>cat</code>, <code>tee</code>, and even simple shells.</p>
</section>
<section id="try-it-yourself-61" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-61">Try It Yourself</h4>
<ol type="1">
<li>Write a mini <code>cat</code> clone using <code>read()</code> and <code>write()</code>.</li>
<li>Use <code>dup2()</code> to redirect both stdout and stderr to a file.</li>
<li>Add error messages using <code>perror()</code> and handle <code>EINTR</code>.</li>
<li>Use <code>lseek()</code> to skip the first N bytes of a file before printing.</li>
<li>Implement a simple file appender with <code>O_APPEND</code>.</li>
</ol>
<p>Next, you’ll use these file descriptors to make <strong>processes communicate</strong>, building <strong>pipes and redirection</strong>, the same mechanisms shells use to connect commands like <code>ls | grep</code>.</p>
</section>
</section>
<section id="pipes-and-redirection" class="level3">
<h3 class="anchored" data-anchor-id="pipes-and-redirection">64. Pipes and Redirection</h3>
<p>Now that you can read and write with file descriptors, you can connect <strong>two processes</strong> so that one’s output becomes the other’s input, just like <code>ls | grep c</code> in a shell.</p>
<p>This magic happens through <strong>pipes</strong>, one of Unix’s simplest and most elegant inter-process communication (IPC) mechanisms.</p>
<section id="step-1.-what-is-a-pipe" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-is-a-pipe">Step 1. What Is a Pipe?</h4>
<p>A <strong>pipe</strong> is a unidirectional data channel between two file descriptors, one for reading, one for writing.</p>
<p>In the shell:</p>
<pre><code>ls | grep main</code></pre>
<p>is equivalent to:</p>
<ul>
<li>Process A (<code>ls</code>) writes into the pipe.</li>
<li>Process B (<code>grep</code>) reads from the pipe.</li>
</ul>
<p>In C, you can do the same thing using <code>pipe()</code> and <code>fork()</code>.</p>
</section>
<section id="step-2.-creating-a-pipe" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-creating-a-pipe">Step 2. Creating a Pipe</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb733"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb733-1"><a href="#cb733-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb733-2"><a href="#cb733-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb733-3"><a href="#cb733-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb733-4"><a href="#cb733-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb733-5"><a href="#cb733-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fds<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb733-6"><a href="#cb733-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pipe<span class="op">(</span>fds<span class="op">)</span> <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb733-7"><a href="#cb733-7" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"pipe failed"</span><span class="op">);</span></span>
<span id="cb733-8"><a href="#cb733-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb733-9"><a href="#cb733-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb733-10"><a href="#cb733-10" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Read end: </span><span class="sc">%d</span><span class="st">, Write end: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> fds<span class="op">[</span><span class="dv">0</span><span class="op">],</span> fds<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb733-11"><a href="#cb733-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb733-12"><a href="#cb733-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb734"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb734-1"><a href="#cb734-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> pipe_demo.c <span class="at">-o</span> pipe_demo</span>
<span id="cb734-2"><a href="#cb734-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./pipe_demo</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output example:</p>
<pre><code>Read end: 3, Write end: 4</code></pre>
<p>You now have two connected file descriptors:</p>
<ul>
<li><code>fds[0]</code>: read end</li>
<li><code>fds[1]</code>: write end</li>
</ul>
<p>Whatever you write into <code>fds[1]</code> can be read from <code>fds[0]</code>.</p>
</section>
<section id="step-3.-writing-and-reading-through-a-pipe" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-writing-and-reading-through-a-pipe">Step 3. Writing and Reading Through a Pipe</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb736"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb736-1"><a href="#cb736-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb736-2"><a href="#cb736-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb736-3"><a href="#cb736-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb736-4"><a href="#cb736-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb736-5"><a href="#cb736-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb736-6"><a href="#cb736-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fds<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb736-7"><a href="#cb736-7" aria-hidden="true" tabindex="-1"></a>    pipe<span class="op">(</span>fds<span class="op">);</span></span>
<span id="cb736-8"><a href="#cb736-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb736-9"><a href="#cb736-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> msg<span class="op">[]</span> <span class="op">=</span> <span class="st">"hello through pipe"</span><span class="op">;</span></span>
<span id="cb736-10"><a href="#cb736-10" aria-hidden="true" tabindex="-1"></a>    write<span class="op">(</span>fds<span class="op">[</span><span class="dv">1</span><span class="op">],</span> msg<span class="op">,</span> strlen<span class="op">(</span>msg<span class="op">));</span></span>
<span id="cb736-11"><a href="#cb736-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb736-12"><a href="#cb736-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buf<span class="op">[</span><span class="dv">64</span><span class="op">];</span></span>
<span id="cb736-13"><a href="#cb736-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ssize_t</span> n <span class="op">=</span> read<span class="op">(</span>fds<span class="op">[</span><span class="dv">0</span><span class="op">],</span> buf<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buf<span class="op">)</span> <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb736-14"><a href="#cb736-14" aria-hidden="true" tabindex="-1"></a>    buf<span class="op">[</span>n<span class="op">]</span> <span class="op">=</span> <span class="ch">'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">;</span></span>
<span id="cb736-15"><a href="#cb736-15" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Received: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> buf<span class="op">);</span></span>
<span id="cb736-16"><a href="#cb736-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb736-17"><a href="#cb736-17" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>fds<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb736-18"><a href="#cb736-18" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>fds<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb736-19"><a href="#cb736-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Received: hello through pipe</code></pre>
<p>You’ve just communicated through memory between two file descriptors, no files, no network.</p>
</section>
<section id="step-4.-pipes-between-parent-and-child" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-pipes-between-parent-and-child">Step 4. Pipes Between Parent and Child</h4>
<p>Here’s where it gets powerful: <strong>pipes can connect processes</strong>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb738"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb738-1"><a href="#cb738-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb738-2"><a href="#cb738-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb738-3"><a href="#cb738-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb738-4"><a href="#cb738-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb738-5"><a href="#cb738-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb738-6"><a href="#cb738-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fds<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb738-7"><a href="#cb738-7" aria-hidden="true" tabindex="-1"></a>    pipe<span class="op">(</span>fds<span class="op">);</span></span>
<span id="cb738-8"><a href="#cb738-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb738-9"><a href="#cb738-9" aria-hidden="true" tabindex="-1"></a>    pid_t pid <span class="op">=</span> fork<span class="op">();</span></span>
<span id="cb738-10"><a href="#cb738-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb738-11"><a href="#cb738-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Child</span></span>
<span id="cb738-12"><a href="#cb738-12" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>fds<span class="op">[</span><span class="dv">1</span><span class="op">]);</span> <span class="co">// close write end</span></span>
<span id="cb738-13"><a href="#cb738-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> buf<span class="op">[</span><span class="dv">64</span><span class="op">];</span></span>
<span id="cb738-14"><a href="#cb738-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ssize_t</span> n <span class="op">=</span> read<span class="op">(</span>fds<span class="op">[</span><span class="dv">0</span><span class="op">],</span> buf<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buf<span class="op">)</span> <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb738-15"><a href="#cb738-15" aria-hidden="true" tabindex="-1"></a>        buf<span class="op">[</span>n<span class="op">]</span> <span class="op">=</span> <span class="ch">'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">;</span></span>
<span id="cb738-16"><a href="#cb738-16" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Child got: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> buf<span class="op">);</span></span>
<span id="cb738-17"><a href="#cb738-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb738-18"><a href="#cb738-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Parent</span></span>
<span id="cb738-19"><a href="#cb738-19" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>fds<span class="op">[</span><span class="dv">0</span><span class="op">]);</span> <span class="co">// close read end</span></span>
<span id="cb738-20"><a href="#cb738-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">const</span> <span class="dt">char</span> msg<span class="op">[]</span> <span class="op">=</span> <span class="st">"Hi from parent!"</span><span class="op">;</span></span>
<span id="cb738-21"><a href="#cb738-21" aria-hidden="true" tabindex="-1"></a>        write<span class="op">(</span>fds<span class="op">[</span><span class="dv">1</span><span class="op">],</span> msg<span class="op">,</span> strlen<span class="op">(</span>msg<span class="op">));</span></span>
<span id="cb738-22"><a href="#cb738-22" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>fds<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb738-23"><a href="#cb738-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb738-24"><a href="#cb738-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Child got: Hi from parent!</code></pre>
<p>Parent writes, child reads, a clean data channel between two processes.</p>
</section>
<section id="step-5.-redirecting-stdinstdout-to-a-pipe" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-redirecting-stdinstdout-to-a-pipe">Step 5. Redirecting STDIN/STDOUT to a Pipe</h4>
<p>You can use <code>dup2()</code> to connect a pipe directly to standard input/output.</p>
<p>Example: connect parent’s write end to child’s stdin.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb740"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb740-1"><a href="#cb740-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb740-2"><a href="#cb740-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb740-3"><a href="#cb740-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb740-4"><a href="#cb740-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb740-5"><a href="#cb740-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fds<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb740-6"><a href="#cb740-6" aria-hidden="true" tabindex="-1"></a>    pipe<span class="op">(</span>fds<span class="op">);</span></span>
<span id="cb740-7"><a href="#cb740-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb740-8"><a href="#cb740-8" aria-hidden="true" tabindex="-1"></a>    pid_t pid <span class="op">=</span> fork<span class="op">();</span></span>
<span id="cb740-9"><a href="#cb740-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb740-10"><a href="#cb740-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb740-11"><a href="#cb740-11" aria-hidden="true" tabindex="-1"></a>        dup2<span class="op">(</span>fds<span class="op">[</span><span class="dv">0</span><span class="op">],</span> STDIN_FILENO<span class="op">);</span></span>
<span id="cb740-12"><a href="#cb740-12" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>fds<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb740-13"><a href="#cb740-13" aria-hidden="true" tabindex="-1"></a>        execlp<span class="op">(</span><span class="st">"wc"</span><span class="op">,</span> <span class="st">"wc"</span><span class="op">,</span> <span class="st">"-w"</span><span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb740-14"><a href="#cb740-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb740-15"><a href="#cb740-15" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>fds<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb740-16"><a href="#cb740-16" aria-hidden="true" tabindex="-1"></a>        write<span class="op">(</span>fds<span class="op">[</span><span class="dv">1</span><span class="op">],</span> <span class="st">"Hello from parent</span><span class="sc">\n</span><span class="st">This is a pipe test</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> <span class="dv">39</span><span class="op">);</span></span>
<span id="cb740-17"><a href="#cb740-17" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>fds<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb740-18"><a href="#cb740-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb740-19"><a href="#cb740-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>6</code></pre>
<p>Here’s what happens:</p>
<ul>
<li>Parent writes data into the pipe.</li>
<li>Child’s stdin is connected to that pipe.</li>
<li><code>wc -w</code> counts the words received.</li>
</ul>
<p>This is exactly how the shell implements pipelines like <code>echo "hi" | wc -w</code>.</p>
</section>
<section id="step-6.-chaining-multiple-commands" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-chaining-multiple-commands">Step 6. Chaining Multiple Commands</h4>
<p>You can chain multiple commands by creating multiple pipes and connecting them in series.</p>
<p>Example concept:</p>
<pre><code>cat file.txt | grep "error" | wc -l</code></pre>
<p>Each process reads from the previous pipe and writes to the next, the shell’s fundamental design.</p>
<p>You can implement the same concept in C by:</p>
<ol type="1">
<li>Creating a pipe between each process pair.</li>
<li>Forking a new process for each command.</li>
<li>Redirecting its stdin/stdout via <code>dup2()</code>.</li>
</ol>
</section>
<section id="step-7.-named-pipes-fifos" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-named-pipes-fifos">Step 7. Named Pipes (FIFOs)</h4>
<p>Pipes normally exist only between related processes. To share data between unrelated programs, you can use <strong>named pipes</strong> (FIFOs).</p>
<p>Create one:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb743"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb743-1"><a href="#cb743-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkfifo</span> mypipe</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then in one terminal:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb744"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb744-1"><a href="#cb744-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&gt;</span> mypipe</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>And in another:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb745"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb745-1"><a href="#cb745-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&lt;</span> mypipe</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Data flows through the named pipe like a file.</p>
<p>In C:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb746"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb746-1"><a href="#cb746-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fcntl.h&gt;</span></span>
<span id="cb746-2"><a href="#cb746-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/stat.h&gt;</span></span>
<span id="cb746-3"><a href="#cb746-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb746-4"><a href="#cb746-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb746-5"><a href="#cb746-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb746-6"><a href="#cb746-6" aria-hidden="true" tabindex="-1"></a>    mkfifo<span class="op">(</span><span class="st">"mypipe"</span><span class="op">,</span> <span class="bn">0666</span><span class="op">);</span></span>
<span id="cb746-7"><a href="#cb746-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span><span class="st">"mypipe"</span><span class="op">,</span> O_WRONLY<span class="op">);</span></span>
<span id="cb746-8"><a href="#cb746-8" aria-hidden="true" tabindex="-1"></a>    write<span class="op">(</span>fd<span class="op">,</span> <span class="st">"Hello FIFO</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> <span class="dv">11</span><span class="op">);</span></span>
<span id="cb746-9"><a href="#cb746-9" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb746-10"><a href="#cb746-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-8.-error-handling-and-eof" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-error-handling-and-eof">Step 8. Error Handling and EOF</h4>
<p>If all write ends of a pipe are closed, <code>read()</code> returns <code>0</code>, indicating EOF.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb747"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb747-1"><a href="#cb747-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> fds<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb747-2"><a href="#cb747-2" aria-hidden="true" tabindex="-1"></a>pipe<span class="op">(</span>fds<span class="op">);</span></span>
<span id="cb747-3"><a href="#cb747-3" aria-hidden="true" tabindex="-1"></a>close<span class="op">(</span>fds<span class="op">[</span><span class="dv">1</span><span class="op">]);</span> <span class="co">// no writers</span></span>
<span id="cb747-4"><a href="#cb747-4" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> buf<span class="op">[</span><span class="dv">10</span><span class="op">];</span></span>
<span id="cb747-5"><a href="#cb747-5" aria-hidden="true" tabindex="-1"></a><span class="dt">ssize_t</span> n <span class="op">=</span> read<span class="op">(</span>fds<span class="op">[</span><span class="dv">0</span><span class="op">],</span> buf<span class="op">,</span> <span class="dv">10</span><span class="op">);</span> <span class="co">// n == 0 =&gt; EOF</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If you try to write after all readers are gone, you’ll get <code>SIGPIPE</code>.</p>
</section>
<section id="tiny-code-minimal-shell-pipeline" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-minimal-shell-pipeline">Tiny Code: Minimal Shell Pipeline</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb748"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb748-1"><a href="#cb748-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb748-2"><a href="#cb748-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/wait.h&gt;</span></span>
<span id="cb748-3"><a href="#cb748-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-4"><a href="#cb748-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb748-5"><a href="#cb748-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fds<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb748-6"><a href="#cb748-6" aria-hidden="true" tabindex="-1"></a>    pipe<span class="op">(</span>fds<span class="op">);</span></span>
<span id="cb748-7"><a href="#cb748-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-8"><a href="#cb748-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fork<span class="op">()</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb748-9"><a href="#cb748-9" aria-hidden="true" tabindex="-1"></a>        dup2<span class="op">(</span>fds<span class="op">[</span><span class="dv">1</span><span class="op">],</span> STDOUT_FILENO<span class="op">);</span></span>
<span id="cb748-10"><a href="#cb748-10" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>fds<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb748-11"><a href="#cb748-11" aria-hidden="true" tabindex="-1"></a>        execlp<span class="op">(</span><span class="st">"ls"</span><span class="op">,</span> <span class="st">"ls"</span><span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb748-12"><a href="#cb748-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb748-13"><a href="#cb748-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-14"><a href="#cb748-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fork<span class="op">()</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb748-15"><a href="#cb748-15" aria-hidden="true" tabindex="-1"></a>        dup2<span class="op">(</span>fds<span class="op">[</span><span class="dv">0</span><span class="op">],</span> STDIN_FILENO<span class="op">);</span></span>
<span id="cb748-16"><a href="#cb748-16" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>fds<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb748-17"><a href="#cb748-17" aria-hidden="true" tabindex="-1"></a>        execlp<span class="op">(</span><span class="st">"wc"</span><span class="op">,</span> <span class="st">"wc"</span><span class="op">,</span> <span class="st">"-l"</span><span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb748-18"><a href="#cb748-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb748-19"><a href="#cb748-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb748-20"><a href="#cb748-20" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>fds<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb748-21"><a href="#cb748-21" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>fds<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb748-22"><a href="#cb748-22" aria-hidden="true" tabindex="-1"></a>    wait<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb748-23"><a href="#cb748-23" aria-hidden="true" tabindex="-1"></a>    wait<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb748-24"><a href="#cb748-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb749"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb749-1"><a href="#cb749-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> pipe_chain.c <span class="at">-o</span> pipe_chain</span>
<span id="cb749-2"><a href="#cb749-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./pipe_chain</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>(number of files in directory)</code></pre>
<p>You just recreated <code>ls | wc -l</code> in C.</p>
</section>
<section id="step-9.-combining-redirection-and-files" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-combining-redirection-and-files">Step 9. Combining Redirection and Files</h4>
<p>You can redirect stdout or stderr to files the same way:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb751"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb751-1"><a href="#cb751-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span><span class="st">"output.txt"</span><span class="op">,</span> O_WRONLY <span class="op">|</span> O_CREAT <span class="op">|</span> O_TRUNC<span class="op">,</span> <span class="bn">0644</span><span class="op">);</span></span>
<span id="cb751-2"><a href="#cb751-2" aria-hidden="true" tabindex="-1"></a>dup2<span class="op">(</span>fd<span class="op">,</span> STDOUT_FILENO<span class="op">);</span></span>
<span id="cb751-3"><a href="#cb751-3" aria-hidden="true" tabindex="-1"></a>close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb751-4"><a href="#cb751-4" aria-hidden="true" tabindex="-1"></a>execlp<span class="op">(</span><span class="st">"ls"</span><span class="op">,</span> <span class="st">"ls"</span><span class="op">,</span> NULL<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now the output of <code>ls</code> goes to <code>output.txt</code>.</p>
</section>
<section id="step-10.-why-it-matters-4" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-why-it-matters-4">Step 10. Why It Matters</h4>
<p>Pipes and redirection are the <strong>heart of Unix philosophy</strong>:</p>
<ul>
<li>Programs do one thing well.</li>
<li>Communicate through text streams.</li>
<li>Compose complex workflows by chaining simple tools.</li>
</ul>
<p>Understanding how to implement pipes makes you capable of:</p>
<ul>
<li>Building your own shell</li>
<li>Connecting processes dynamically</li>
<li>Implementing inter-process communication safely</li>
</ul>
</section>
<section id="try-it-yourself-62" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-62">Try It Yourself</h4>
<ol type="1">
<li>Recreate <code>ls | grep c</code> using two <code>fork()</code> calls and one pipe.</li>
<li>Build <code>cat file | wc -l</code>.</li>
<li>Implement a “tee” program that duplicates output to both stdout and a file.</li>
<li>Create a named pipe and write to it from one process, read from another.</li>
<li>Extend your shell to support pipelines of any length.</li>
</ol>
<p>Next, you’ll explore how processes <strong>signal and interrupt each other</strong>, using <strong>signals</strong> and <strong>signal handlers</strong>, a crucial concept for handling interrupts, timeouts, and graceful termination.</p>
</section>
</section>
<section id="signals-and-signal-handlers" class="level3">
<h3 class="anchored" data-anchor-id="signals-and-signal-handlers">65. Signals and Signal Handlers</h3>
<p>When you press <strong>Ctrl+C</strong> and your program stops, that’s not magic, it’s a <strong>signal</strong>. Signals are how the operating system tells your process that something important has happened.</p>
<p>They’re asynchronous, lightweight messages from the kernel or other processes. Your C program can catch, ignore, or handle them, giving you full control over shutdowns, interrupts, and errors.</p>
<section id="step-1.-what-is-a-signal" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-is-a-signal">Step 1. What Is a Signal?</h4>
<p>A <strong>signal</strong> is an integer code sent to a process to notify it of an event.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 36%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th>Signal</th>
<th>Meaning</th>
<th>Default Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>SIGINT</code></td>
<td>Interrupt (Ctrl+C)</td>
<td>Terminate</td>
</tr>
<tr class="even">
<td><code>SIGTERM</code></td>
<td>Termination request</td>
<td>Terminate</td>
</tr>
<tr class="odd">
<td><code>SIGKILL</code></td>
<td>Forced kill (cannot catch)</td>
<td>Terminate immediately</td>
</tr>
<tr class="even">
<td><code>SIGSEGV</code></td>
<td>Invalid memory access</td>
<td>Core dump</td>
</tr>
<tr class="odd">
<td><code>SIGCHLD</code></td>
<td>Child process exited</td>
<td>Ignore or handle</td>
</tr>
<tr class="even">
<td><code>SIGALRM</code></td>
<td>Timer expired</td>
<td>Terminate</td>
</tr>
<tr class="odd">
<td><code>SIGUSR1</code>, <code>SIGUSR2</code></td>
<td>User-defined</td>
<td>Terminate (unless handled)</td>
</tr>
</tbody>
</table>
<p>You can list all signals:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb752"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb752-1"><a href="#cb752-1" aria-hidden="true" tabindex="-1"></a><span class="bu">kill</span> <span class="at">-l</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output example:</p>
<pre><code>1) SIGHUP  2) SIGINT  3) SIGQUIT  9) SIGKILL  15) SIGTERM  ...</code></pre>
</section>
<section id="step-2.-sending-signals" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-sending-signals">Step 2. Sending Signals</h4>
<p>Any process can send a signal to another using the <code>kill()</code> system call.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb754"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb754-1"><a href="#cb754-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;signal.h&gt;</span></span>
<span id="cb754-2"><a href="#cb754-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb754-3"><a href="#cb754-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb754-4"><a href="#cb754-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb754-5"><a href="#cb754-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb754-6"><a href="#cb754-6" aria-hidden="true" tabindex="-1"></a>    pid_t pid <span class="op">=</span> getpid<span class="op">();</span></span>
<span id="cb754-7"><a href="#cb754-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"My PID: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> pid<span class="op">);</span></span>
<span id="cb754-8"><a href="#cb754-8" aria-hidden="true" tabindex="-1"></a>    pause<span class="op">();</span>  <span class="co">// wait for signal</span></span>
<span id="cb754-9"><a href="#cb754-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run this in one terminal:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb755"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb755-1"><a href="#cb755-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./signal_wait</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then in another:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb756"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb756-1"><a href="#cb756-1" aria-hidden="true" tabindex="-1"></a><span class="bu">kill</span> <span class="at">-SIGUSR1</span> <span class="op">&lt;</span>pid<span class="op">&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The program will wake up from <code>pause()</code> and terminate (default behavior for SIGUSR1).</p>
</section>
<section id="step-3.-installing-a-signal-handler" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-installing-a-signal-handler">Step 3. Installing a Signal Handler</h4>
<p>You can <strong>override</strong> the default action by installing a <strong>handler function</strong>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb757"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb757-1"><a href="#cb757-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;signal.h&gt;</span></span>
<span id="cb757-2"><a href="#cb757-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb757-3"><a href="#cb757-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb757-4"><a href="#cb757-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb757-5"><a href="#cb757-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> handle_sigint<span class="op">(</span><span class="dt">int</span> sig<span class="op">)</span> <span class="op">{</span></span>
<span id="cb757-6"><a href="#cb757-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Caught signal </span><span class="sc">%d</span><span class="st"> (SIGINT). Exiting gracefully.</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> sig<span class="op">);</span></span>
<span id="cb757-7"><a href="#cb757-7" aria-hidden="true" tabindex="-1"></a>    _exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb757-8"><a href="#cb757-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb757-9"><a href="#cb757-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb757-10"><a href="#cb757-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb757-11"><a href="#cb757-11" aria-hidden="true" tabindex="-1"></a>    signal<span class="op">(</span>SIGINT<span class="op">,</span> handle_sigint<span class="op">);</span></span>
<span id="cb757-12"><a href="#cb757-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb757-13"><a href="#cb757-13" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Running... Press Ctrl+C to stop.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb757-14"><a href="#cb757-14" aria-hidden="true" tabindex="-1"></a>        sleep<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb757-15"><a href="#cb757-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb757-16"><a href="#cb757-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb758"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb758-1"><a href="#cb758-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> sigint_demo.c <span class="at">-o</span> sigint_demo</span>
<span id="cb758-2"><a href="#cb758-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./sigint_demo</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Running... Press Ctrl+C to stop.
Running... Press Ctrl+C to stop.
^C
Caught signal 2 (SIGINT). Exiting gracefully.</code></pre>
</section>
<section id="step-4.-using-sigaction-modern-api" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-using-sigaction-modern-api">Step 4. Using <code>sigaction()</code> (Modern API)</h4>
<p><code>signal()</code> is simple but inconsistent across systems. The <strong>recommended</strong> modern interface is <code>sigaction()</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb760"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb760-1"><a href="#cb760-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;signal.h&gt;</span></span>
<span id="cb760-2"><a href="#cb760-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb760-3"><a href="#cb760-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb760-4"><a href="#cb760-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb760-5"><a href="#cb760-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> handler<span class="op">(</span><span class="dt">int</span> sig<span class="op">)</span> <span class="op">{</span></span>
<span id="cb760-6"><a href="#cb760-6" aria-hidden="true" tabindex="-1"></a>    write<span class="op">(</span>STDOUT_FILENO<span class="op">,</span> <span class="st">"Caught signal</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> <span class="dv">14</span><span class="op">);</span></span>
<span id="cb760-7"><a href="#cb760-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb760-8"><a href="#cb760-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb760-9"><a href="#cb760-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb760-10"><a href="#cb760-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> sigaction sa <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb760-11"><a href="#cb760-11" aria-hidden="true" tabindex="-1"></a>    sa<span class="op">.</span>sa_handler <span class="op">=</span> handler<span class="op">;</span></span>
<span id="cb760-12"><a href="#cb760-12" aria-hidden="true" tabindex="-1"></a>    sigaction<span class="op">(</span>SIGUSR1<span class="op">,</span> <span class="op">&amp;</span>sa<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb760-13"><a href="#cb760-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb760-14"><a href="#cb760-14" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"PID: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> getpid<span class="op">());</span></span>
<span id="cb760-15"><a href="#cb760-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> pause<span class="op">();</span></span>
<span id="cb760-16"><a href="#cb760-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Send a signal:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb761"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb761-1"><a href="#cb761-1" aria-hidden="true" tabindex="-1"></a><span class="bu">kill</span> <span class="at">-SIGUSR1</span> <span class="op">&lt;</span>pid<span class="op">&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Caught signal</code></pre>
<p>Unlike <code>signal()</code>, this version is <strong>reliable and reentrant-safe</strong> (you can call only async-safe functions like <code>write()</code> inside handlers).</p>
</section>
<section id="step-5.-ignoring-and-resetting-signals" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-ignoring-and-resetting-signals">Step 5. Ignoring and Resetting Signals</h4>
<p>You can <strong>ignore</strong> a signal:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb763"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb763-1"><a href="#cb763-1" aria-hidden="true" tabindex="-1"></a>signal<span class="op">(</span>SIGINT<span class="op">,</span> SIG_IGN<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Or <strong>reset</strong> to default behavior:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb764"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb764-1"><a href="#cb764-1" aria-hidden="true" tabindex="-1"></a>signal<span class="op">(</span>SIGINT<span class="op">,</span> SIG_DFL<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This can be useful if you don’t want Ctrl+C to interrupt certain sections of code.</p>
</section>
<section id="step-6.-sending-signals-to-other-processes" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-sending-signals-to-other-processes">Step 6. Sending Signals to Other Processes</h4>
<p>Example: parent signaling its child.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb765"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb765-1"><a href="#cb765-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;signal.h&gt;</span></span>
<span id="cb765-2"><a href="#cb765-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb765-3"><a href="#cb765-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb765-4"><a href="#cb765-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb765-5"><a href="#cb765-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> child_handler<span class="op">(</span><span class="dt">int</span> sig<span class="op">)</span> <span class="op">{</span></span>
<span id="cb765-6"><a href="#cb765-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Child got signal </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> sig<span class="op">);</span></span>
<span id="cb765-7"><a href="#cb765-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb765-8"><a href="#cb765-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb765-9"><a href="#cb765-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb765-10"><a href="#cb765-10" aria-hidden="true" tabindex="-1"></a>    pid_t pid <span class="op">=</span> fork<span class="op">();</span></span>
<span id="cb765-11"><a href="#cb765-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb765-12"><a href="#cb765-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb765-13"><a href="#cb765-13" aria-hidden="true" tabindex="-1"></a>        signal<span class="op">(</span>SIGUSR1<span class="op">,</span> child_handler<span class="op">);</span></span>
<span id="cb765-14"><a href="#cb765-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> pause<span class="op">();</span></span>
<span id="cb765-15"><a href="#cb765-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb765-16"><a href="#cb765-16" aria-hidden="true" tabindex="-1"></a>        sleep<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb765-17"><a href="#cb765-17" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Parent sending SIGUSR1</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb765-18"><a href="#cb765-18" aria-hidden="true" tabindex="-1"></a>        kill<span class="op">(</span>pid<span class="op">,</span> SIGUSR1<span class="op">);</span></span>
<span id="cb765-19"><a href="#cb765-19" aria-hidden="true" tabindex="-1"></a>        sleep<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb765-20"><a href="#cb765-20" aria-hidden="true" tabindex="-1"></a>        kill<span class="op">(</span>pid<span class="op">,</span> SIGTERM<span class="op">);</span></span>
<span id="cb765-21"><a href="#cb765-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb765-22"><a href="#cb765-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Parent sending SIGUSR1
Child got signal 10</code></pre>
</section>
<section id="step-7.-blocking-and-unblocking-signals" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-blocking-and-unblocking-signals">Step 7. Blocking and Unblocking Signals</h4>
<p>Sometimes you want to delay signal handling. You can use <code>sigprocmask()</code> to block signals temporarily.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb767"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb767-1"><a href="#cb767-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;signal.h&gt;</span></span>
<span id="cb767-2"><a href="#cb767-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb767-3"><a href="#cb767-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb767-4"><a href="#cb767-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb767-5"><a href="#cb767-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb767-6"><a href="#cb767-6" aria-hidden="true" tabindex="-1"></a>    sigset_t set<span class="op">;</span></span>
<span id="cb767-7"><a href="#cb767-7" aria-hidden="true" tabindex="-1"></a>    sigemptyset<span class="op">(&amp;</span>set<span class="op">);</span></span>
<span id="cb767-8"><a href="#cb767-8" aria-hidden="true" tabindex="-1"></a>    sigaddset<span class="op">(&amp;</span>set<span class="op">,</span> SIGINT<span class="op">);</span></span>
<span id="cb767-9"><a href="#cb767-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb767-10"><a href="#cb767-10" aria-hidden="true" tabindex="-1"></a>    sigprocmask<span class="op">(</span>SIG_BLOCK<span class="op">,</span> <span class="op">&amp;</span>set<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb767-11"><a href="#cb767-11" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"SIGINT blocked for 5 seconds...</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb767-12"><a href="#cb767-12" aria-hidden="true" tabindex="-1"></a>    sleep<span class="op">(</span><span class="dv">5</span><span class="op">);</span></span>
<span id="cb767-13"><a href="#cb767-13" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Unblocking now.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb767-14"><a href="#cb767-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb767-15"><a href="#cb767-15" aria-hidden="true" tabindex="-1"></a>    sigprocmask<span class="op">(</span>SIG_UNBLOCK<span class="op">,</span> <span class="op">&amp;</span>set<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb767-16"><a href="#cb767-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> pause<span class="op">();</span></span>
<span id="cb767-17"><a href="#cb767-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Press Ctrl+C during the block, nothing happens. Once unblocked, it terminates normally.</p>
</section>
<section id="step-8.-timers-with-alarm-and-sigalrm" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-timers-with-alarm-and-sigalrm">Step 8. Timers with <code>alarm()</code> and <code>SIGALRM</code></h4>
<p>You can set a timer that sends a signal after a delay.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb768"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb768-1"><a href="#cb768-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb768-2"><a href="#cb768-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;signal.h&gt;</span></span>
<span id="cb768-3"><a href="#cb768-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb768-4"><a href="#cb768-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb768-5"><a href="#cb768-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> handler<span class="op">(</span><span class="dt">int</span> sig<span class="op">)</span> <span class="op">{</span></span>
<span id="cb768-6"><a href="#cb768-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Timer expired!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb768-7"><a href="#cb768-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb768-8"><a href="#cb768-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb768-9"><a href="#cb768-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb768-10"><a href="#cb768-10" aria-hidden="true" tabindex="-1"></a>    signal<span class="op">(</span>SIGALRM<span class="op">,</span> handler<span class="op">);</span></span>
<span id="cb768-11"><a href="#cb768-11" aria-hidden="true" tabindex="-1"></a>    alarm<span class="op">(</span><span class="dv">3</span><span class="op">);</span>  <span class="co">// after 3 seconds, send SIGALRM</span></span>
<span id="cb768-12"><a href="#cb768-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Waiting...</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb768-13"><a href="#cb768-13" aria-hidden="true" tabindex="-1"></a>    pause<span class="op">();</span></span>
<span id="cb768-14"><a href="#cb768-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Waiting...
Timer expired!</code></pre>
</section>
<section id="step-9.-cleaning-up-on-exit" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-cleaning-up-on-exit">Step 9. Cleaning Up on Exit</h4>
<p>Signals let you implement graceful cleanup (e.g., close files, delete temp files).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb770"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb770-1"><a href="#cb770-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;signal.h&gt;</span></span>
<span id="cb770-2"><a href="#cb770-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb770-3"><a href="#cb770-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb770-4"><a href="#cb770-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb770-5"><a href="#cb770-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> cleanup<span class="op">(</span><span class="dt">int</span> sig<span class="op">)</span> <span class="op">{</span></span>
<span id="cb770-6"><a href="#cb770-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Cleaning up before exit...</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb770-7"><a href="#cb770-7" aria-hidden="true" tabindex="-1"></a>    unlink<span class="op">(</span><span class="st">"tempfile.tmp"</span><span class="op">);</span></span>
<span id="cb770-8"><a href="#cb770-8" aria-hidden="true" tabindex="-1"></a>    _exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb770-9"><a href="#cb770-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb770-10"><a href="#cb770-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb770-11"><a href="#cb770-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb770-12"><a href="#cb770-12" aria-hidden="true" tabindex="-1"></a>    signal<span class="op">(</span>SIGINT<span class="op">,</span> cleanup<span class="op">);</span></span>
<span id="cb770-13"><a href="#cb770-13" aria-hidden="true" tabindex="-1"></a>    open<span class="op">(</span><span class="st">"tempfile.tmp"</span><span class="op">,</span> O_CREAT <span class="op">|</span> O_WRONLY<span class="op">,</span> <span class="bn">0644</span><span class="op">);</span></span>
<span id="cb770-14"><a href="#cb770-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb770-15"><a href="#cb770-15" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Running... (Ctrl+C to exit)</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb770-16"><a href="#cb770-16" aria-hidden="true" tabindex="-1"></a>        sleep<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb770-17"><a href="#cb770-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb770-18"><a href="#cb770-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now pressing Ctrl+C removes the temporary file safely.</p>
</section>
<section id="tiny-code-graceful-shutdown-server" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-graceful-shutdown-server">Tiny Code: Graceful Shutdown Server</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb771"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb771-1"><a href="#cb771-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;signal.h&gt;</span></span>
<span id="cb771-2"><a href="#cb771-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb771-3"><a href="#cb771-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb771-4"><a href="#cb771-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb771-5"><a href="#cb771-5" aria-hidden="true" tabindex="-1"></a><span class="dt">volatile</span> <span class="dt">sig_atomic_t</span> running <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb771-6"><a href="#cb771-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb771-7"><a href="#cb771-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> stop<span class="op">(</span><span class="dt">int</span> sig<span class="op">)</span> <span class="op">{</span></span>
<span id="cb771-8"><a href="#cb771-8" aria-hidden="true" tabindex="-1"></a>    running <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb771-9"><a href="#cb771-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb771-10"><a href="#cb771-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb771-11"><a href="#cb771-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb771-12"><a href="#cb771-12" aria-hidden="true" tabindex="-1"></a>    signal<span class="op">(</span>SIGINT<span class="op">,</span> stop<span class="op">);</span></span>
<span id="cb771-13"><a href="#cb771-13" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Server running. Press Ctrl+C to stop.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb771-14"><a href="#cb771-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb771-15"><a href="#cb771-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>running<span class="op">)</span> <span class="op">{</span></span>
<span id="cb771-16"><a href="#cb771-16" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Handling request...</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb771-17"><a href="#cb771-17" aria-hidden="true" tabindex="-1"></a>        sleep<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb771-18"><a href="#cb771-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb771-19"><a href="#cb771-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb771-20"><a href="#cb771-20" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Server shutting down cleanly.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb771-21"><a href="#cb771-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-10.-why-it-matters-5" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-why-it-matters-5">Step 10. Why It Matters</h4>
<p>Signals are essential for:</p>
<ul>
<li>Graceful termination (Ctrl+C)</li>
<li>Timeouts and alarms</li>
<li>Child process monitoring (<code>SIGCHLD</code>)</li>
<li>Error handling (segmentation faults)</li>
<li>Daemon and server control</li>
</ul>
<p>Every real-world Unix program, from editors to web servers, depends on correct signal handling for stability.</p>
</section>
<section id="try-it-yourself-63" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-63">Try It Yourself</h4>
<ol type="1">
<li>Write a program that ignores SIGINT for 5 seconds, then restores default behavior.</li>
<li>Catch SIGTERM and print “Termination requested”.</li>
<li>Make a parent send SIGUSR1 to its child every second.</li>
<li>Use <code>alarm()</code> to implement a timeout for user input.</li>
<li>Add a signal handler to your shell that cleans up child processes before exit.</li>
</ol>
<p>Next, you’ll learn how programs <strong>share and map memory directly</strong>, using <strong><code>mmap()</code></strong>, a system call that powers databases, shared memory, and file-backed data structures.</p>
</section>
</section>
<section id="memory-mapping-mmap" class="level3">
<h3 class="anchored" data-anchor-id="memory-mapping-mmap">66. Memory Mapping (mmap)</h3>
<p>In previous sections, you learned how to read and write files using <code>read()</code> and <code>write()</code>. Those system calls move data between <strong>files</strong> and <strong>user-space buffers</strong> in RAM.</p>
<p>But what if you could <strong>map a file directly into memory</strong>, and then treat it as part of your process’s address space?</p>
<p>That’s exactly what <strong>memory mapping</strong> (via <code>mmap</code>) does, it’s faster, more flexible, and forms the backbone of databases, shared memory systems, and even virtual memory itself.</p>
<section id="step-1.-what-is-mmap" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-is-mmap">Step 1. What Is <code>mmap</code>?</h4>
<p><code>mmap()</code> maps a file or device into memory so you can access it directly, as if it were an array in RAM.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb772"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb772-1"><a href="#cb772-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/mman.h&gt;</span></span>
<span id="cb772-2"><a href="#cb772-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>mmap<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>addr<span class="op">,</span> <span class="dt">size_t</span> length<span class="op">,</span> <span class="dt">int</span> prot<span class="op">,</span> <span class="dt">int</span> flags<span class="op">,</span> <span class="dt">int</span> fd<span class="op">,</span> off_t offset<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>addr</code></td>
<td>Hint for mapping address (usually <code>NULL</code>)</td>
</tr>
<tr class="even">
<td><code>length</code></td>
<td>Number of bytes to map</td>
</tr>
<tr class="odd">
<td><code>prot</code></td>
<td>Protection: <code>PROT_READ</code>, <code>PROT_WRITE</code>, etc.</td>
</tr>
<tr class="even">
<td><code>flags</code></td>
<td>Type: <code>MAP_PRIVATE</code>, <code>MAP_SHARED</code>, etc.</td>
</tr>
<tr class="odd">
<td><code>fd</code></td>
<td>File descriptor to map</td>
</tr>
<tr class="even">
<td><code>offset</code></td>
<td>Start offset in file (must be multiple of page size)</td>
</tr>
</tbody>
</table>
</section>
<section id="step-2.-simple-file-mapping-example" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-simple-file-mapping-example">Step 2. Simple File Mapping Example</h4>
<p>Let’s map a file into memory and print its contents.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb773"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb773-1"><a href="#cb773-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb773-2"><a href="#cb773-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb773-3"><a href="#cb773-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/mman.h&gt;</span></span>
<span id="cb773-4"><a href="#cb773-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/stat.h&gt;</span></span>
<span id="cb773-5"><a href="#cb773-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fcntl.h&gt;</span></span>
<span id="cb773-6"><a href="#cb773-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb773-7"><a href="#cb773-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb773-8"><a href="#cb773-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb773-9"><a href="#cb773-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span><span class="st">"data.txt"</span><span class="op">,</span> O_RDONLY<span class="op">);</span></span>
<span id="cb773-10"><a href="#cb773-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fd <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span> perror<span class="op">(</span><span class="st">"open"</span><span class="op">);</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb773-11"><a href="#cb773-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb773-12"><a href="#cb773-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> stat st<span class="op">;</span></span>
<span id="cb773-13"><a href="#cb773-13" aria-hidden="true" tabindex="-1"></a>    fstat<span class="op">(</span>fd<span class="op">,</span> <span class="op">&amp;</span>st<span class="op">);</span></span>
<span id="cb773-14"><a href="#cb773-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb773-15"><a href="#cb773-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>data <span class="op">=</span> mmap<span class="op">(</span>NULL<span class="op">,</span> st<span class="op">.</span>st_size<span class="op">,</span> PROT_READ<span class="op">,</span> MAP_PRIVATE<span class="op">,</span> fd<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb773-16"><a href="#cb773-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>data <span class="op">==</span> MAP_FAILED<span class="op">)</span> <span class="op">{</span> perror<span class="op">(</span><span class="st">"mmap"</span><span class="op">);</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb773-17"><a href="#cb773-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb773-18"><a href="#cb773-18" aria-hidden="true" tabindex="-1"></a>    write<span class="op">(</span>STDOUT_FILENO<span class="op">,</span> data<span class="op">,</span> st<span class="op">.</span>st_size<span class="op">);</span></span>
<span id="cb773-19"><a href="#cb773-19" aria-hidden="true" tabindex="-1"></a>    munmap<span class="op">(</span>data<span class="op">,</span> st<span class="op">.</span>st_size<span class="op">);</span></span>
<span id="cb773-20"><a href="#cb773-20" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb773-21"><a href="#cb773-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb774"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb774-1"><a href="#cb774-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> mmap_read.c <span class="at">-o</span> mmap_read</span>
<span id="cb774-2"><a href="#cb774-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./mmap_read</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This directly prints the file contents, no loops, no <code>read()</code> calls.</p>
</section>
<section id="step-3.-reading-vs.-writing" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-reading-vs.-writing">Step 3. Reading vs.&nbsp;Writing</h4>
<p>If you want to modify a file through memory, you must open it read-write and use <code>PROT_WRITE</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb775"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb775-1"><a href="#cb775-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/mman.h&gt;</span></span>
<span id="cb775-2"><a href="#cb775-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fcntl.h&gt;</span></span>
<span id="cb775-3"><a href="#cb775-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb775-4"><a href="#cb775-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb775-5"><a href="#cb775-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/stat.h&gt;</span></span>
<span id="cb775-6"><a href="#cb775-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb775-7"><a href="#cb775-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb775-8"><a href="#cb775-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span><span class="st">"memo.txt"</span><span class="op">,</span> O_RDWR <span class="op">|</span> O_CREAT<span class="op">,</span> <span class="bn">0666</span><span class="op">);</span></span>
<span id="cb775-9"><a href="#cb775-9" aria-hidden="true" tabindex="-1"></a>    ftruncate<span class="op">(</span>fd<span class="op">,</span> <span class="dv">64</span><span class="op">);</span> <span class="co">// ensure file has enough size</span></span>
<span id="cb775-10"><a href="#cb775-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb775-11"><a href="#cb775-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>map <span class="op">=</span> mmap<span class="op">(</span>NULL<span class="op">,</span> <span class="dv">64</span><span class="op">,</span> PROT_READ <span class="op">|</span> PROT_WRITE<span class="op">,</span> MAP_SHARED<span class="op">,</span> fd<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb775-12"><a href="#cb775-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>map <span class="op">==</span> MAP_FAILED<span class="op">)</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb775-13"><a href="#cb775-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb775-14"><a href="#cb775-14" aria-hidden="true" tabindex="-1"></a>    strcpy<span class="op">(</span>map<span class="op">,</span> <span class="st">"Hello, memory-mapped file!"</span><span class="op">);</span></span>
<span id="cb775-15"><a href="#cb775-15" aria-hidden="true" tabindex="-1"></a>    msync<span class="op">(</span>map<span class="op">,</span> <span class="dv">64</span><span class="op">,</span> MS_SYNC<span class="op">);</span></span>
<span id="cb775-16"><a href="#cb775-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb775-17"><a href="#cb775-17" aria-hidden="true" tabindex="-1"></a>    munmap<span class="op">(</span>map<span class="op">,</span> <span class="dv">64</span><span class="op">);</span></span>
<span id="cb775-18"><a href="#cb775-18" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb775-19"><a href="#cb775-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Open <code>memo.txt</code>, you’ll see the written text instantly.</p>
<ul>
<li><code>MAP_SHARED</code>: changes are written back to the file.</li>
<li><code>MAP_PRIVATE</code>: copy-on-write (changes visible only to this process).</li>
</ul>
</section>
<section id="step-4.-anonymous-mappings" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-anonymous-mappings">Step 4. Anonymous Mappings</h4>
<p>You can create memory that isn’t tied to any file, purely in RAM.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb776"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb776-1"><a href="#cb776-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/mman.h&gt;</span></span>
<span id="cb776-2"><a href="#cb776-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb776-3"><a href="#cb776-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb776-4"><a href="#cb776-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb776-5"><a href="#cb776-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb776-6"><a href="#cb776-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> len <span class="op">=</span> <span class="dv">4096</span><span class="op">;</span></span>
<span id="cb776-7"><a href="#cb776-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>arr <span class="op">=</span> mmap<span class="op">(</span>NULL<span class="op">,</span> len<span class="op">,</span> PROT_READ <span class="op">|</span> PROT_WRITE<span class="op">,</span></span>
<span id="cb776-8"><a href="#cb776-8" aria-hidden="true" tabindex="-1"></a>                    MAP_PRIVATE <span class="op">|</span> MAP_ANONYMOUS<span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb776-9"><a href="#cb776-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>arr <span class="op">==</span> MAP_FAILED<span class="op">)</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb776-10"><a href="#cb776-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb776-11"><a href="#cb776-11" aria-hidden="true" tabindex="-1"></a>    arr<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">1234</span><span class="op">;</span></span>
<span id="cb776-12"><a href="#cb776-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"arr[0] = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> arr<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb776-13"><a href="#cb776-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb776-14"><a href="#cb776-14" aria-hidden="true" tabindex="-1"></a>    munmap<span class="op">(</span>arr<span class="op">,</span> len<span class="op">);</span></span>
<span id="cb776-15"><a href="#cb776-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>arr[0] = 1234</code></pre>
<p>Anonymous mappings are commonly used for dynamic memory regions or shared memory between processes.</p>
</section>
<section id="step-5.-shared-memory-between-processes" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-shared-memory-between-processes">Step 5. Shared Memory Between Processes</h4>
<p>You can use <code>MAP_SHARED</code> and <code>fork()</code> to let parent and child processes share the same mapped memory.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb778"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb778-1"><a href="#cb778-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/mman.h&gt;</span></span>
<span id="cb778-2"><a href="#cb778-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb778-3"><a href="#cb778-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb778-4"><a href="#cb778-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb778-5"><a href="#cb778-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb778-6"><a href="#cb778-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>shared <span class="op">=</span> mmap<span class="op">(</span>NULL<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">),</span></span>
<span id="cb778-7"><a href="#cb778-7" aria-hidden="true" tabindex="-1"></a>                       PROT_READ <span class="op">|</span> PROT_WRITE<span class="op">,</span></span>
<span id="cb778-8"><a href="#cb778-8" aria-hidden="true" tabindex="-1"></a>                       MAP_SHARED <span class="op">|</span> MAP_ANONYMOUS<span class="op">,</span></span>
<span id="cb778-9"><a href="#cb778-9" aria-hidden="true" tabindex="-1"></a>                       <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb778-10"><a href="#cb778-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb778-11"><a href="#cb778-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>shared <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb778-12"><a href="#cb778-12" aria-hidden="true" tabindex="-1"></a>    pid_t pid <span class="op">=</span> fork<span class="op">();</span></span>
<span id="cb778-13"><a href="#cb778-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb778-14"><a href="#cb778-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pid <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb778-15"><a href="#cb778-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">(*</span>shared<span class="op">)++;</span></span>
<span id="cb778-16"><a href="#cb778-16" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Child: shared = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>shared<span class="op">);</span></span>
<span id="cb778-17"><a href="#cb778-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb778-18"><a href="#cb778-18" aria-hidden="true" tabindex="-1"></a>        sleep<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb778-19"><a href="#cb778-19" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Parent: shared = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>shared<span class="op">);</span></span>
<span id="cb778-20"><a href="#cb778-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb778-21"><a href="#cb778-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb778-22"><a href="#cb778-22" aria-hidden="true" tabindex="-1"></a>    munmap<span class="op">(</span>shared<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb778-23"><a href="#cb778-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Child: shared = 1
Parent: shared = 1</code></pre>
<p>Both processes see the same memory, no pipes or sockets needed.</p>
</section>
<section id="step-6.-memory-protections" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-memory-protections">Step 6. Memory Protections</h4>
<p>Use <code>PROT_*</code> flags to control access:</p>
<ul>
<li><code>PROT_READ</code> → read allowed</li>
<li><code>PROT_WRITE</code> → write allowed</li>
<li><code>PROT_EXEC</code> → executable</li>
<li><code>PROT_NONE</code> → no access</li>
</ul>
<p>You can change permissions later:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb780"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb780-1"><a href="#cb780-1" aria-hidden="true" tabindex="-1"></a>mprotect<span class="op">(</span>ptr<span class="op">,</span> len<span class="op">,</span> PROT_READ<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This helps you simulate “read-only” data regions or test segmentation faults intentionally.</p>
</section>
<section id="step-7.-page-size-and-alignment" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-page-size-and-alignment">Step 7. Page Size and Alignment</h4>
<p>Memory is mapped in units of <strong>pages</strong> (usually 4096 bytes). You can get your system’s page size:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb781"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb781-1"><a href="#cb781-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb781-2"><a href="#cb781-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb781-3"><a href="#cb781-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb781-4"><a href="#cb781-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb781-5"><a href="#cb781-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Page size: </span><span class="sc">%ld</span><span class="st"> bytes</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> sysconf<span class="op">(</span>_SC_PAGESIZE<span class="op">));</span></span>
<span id="cb781-6"><a href="#cb781-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Offsets in <code>mmap</code> must be <strong>aligned</strong> to page size.</p>
</section>
<section id="step-8.-unmapping-and-syncing" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-unmapping-and-syncing">Step 8. Unmapping and Syncing</h4>
<p>When you’re done with a mapped region, always call:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb782"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb782-1"><a href="#cb782-1" aria-hidden="true" tabindex="-1"></a>munmap<span class="op">(</span>addr<span class="op">,</span> length<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If you modified the data:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb783"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb783-1"><a href="#cb783-1" aria-hidden="true" tabindex="-1"></a>msync<span class="op">(</span>addr<span class="op">,</span> length<span class="op">,</span> MS_SYNC<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This ensures changes are written back to disk.</p>
</section>
<section id="step-9.-using-mmap-for-performance" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-using-mmap-for-performance">Step 9. Using <code>mmap</code> for Performance</h4>
<p>Advantages over <code>read()</code> and <code>write()</code>:</p>
<ul>
<li>Avoids extra data copies between kernel and user space.</li>
<li>The OS loads only the pages you touch (lazy loading).</li>
<li>Efficient for random access to large files.</li>
</ul>
<p>Databases, editors, and browsers (like SQLite, Vim, Chrome) rely heavily on <code>mmap</code> for performance.</p>
</section>
<section id="tiny-code-count-lines-in-a-large-file" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-count-lines-in-a-large-file">Tiny Code: Count Lines in a Large File</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb784"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb784-1"><a href="#cb784-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/mman.h&gt;</span></span>
<span id="cb784-2"><a href="#cb784-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/stat.h&gt;</span></span>
<span id="cb784-3"><a href="#cb784-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fcntl.h&gt;</span></span>
<span id="cb784-4"><a href="#cb784-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb784-5"><a href="#cb784-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb784-6"><a href="#cb784-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb784-7"><a href="#cb784-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb784-8"><a href="#cb784-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span><span class="st">"bigfile.txt"</span><span class="op">,</span> O_RDONLY<span class="op">);</span></span>
<span id="cb784-9"><a href="#cb784-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> stat st<span class="op">;</span></span>
<span id="cb784-10"><a href="#cb784-10" aria-hidden="true" tabindex="-1"></a>    fstat<span class="op">(</span>fd<span class="op">,</span> <span class="op">&amp;</span>st<span class="op">);</span></span>
<span id="cb784-11"><a href="#cb784-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb784-12"><a href="#cb784-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>data <span class="op">=</span> mmap<span class="op">(</span>NULL<span class="op">,</span> st<span class="op">.</span>st_size<span class="op">,</span> PROT_READ<span class="op">,</span> MAP_PRIVATE<span class="op">,</span> fd<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb784-13"><a href="#cb784-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> lines <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb784-14"><a href="#cb784-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb784-15"><a href="#cb784-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> st<span class="op">.</span>st_size<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb784-16"><a href="#cb784-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>data<span class="op">[</span>i<span class="op">]</span> <span class="op">==</span> <span class="ch">'</span><span class="sc">\n</span><span class="ch">'</span><span class="op">)</span> lines<span class="op">++;</span></span>
<span id="cb784-17"><a href="#cb784-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb784-18"><a href="#cb784-18" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Lines: </span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> lines<span class="op">);</span></span>
<span id="cb784-19"><a href="#cb784-19" aria-hidden="true" tabindex="-1"></a>    munmap<span class="op">(</span>data<span class="op">,</span> st<span class="op">.</span>st_size<span class="op">);</span></span>
<span id="cb784-20"><a href="#cb784-20" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb784-21"><a href="#cb784-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run it on a multi-GB file, it’ll perform incredibly fast.</p>
</section>
<section id="step-10.-why-it-matters-6" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-why-it-matters-6">Step 10. Why It Matters</h4>
<p><code>mmap</code> opens a new world of <strong>memory-driven file access</strong>:</p>
<ul>
<li>Used by OSes to load executables, shared libs, and pages.</li>
<li>Powers databases, compilers, and search engines.</li>
<li>Enables shared memory between processes.</li>
<li>Reduces I/O overhead for large files.</li>
</ul>
<p>It’s the bridge between <strong>files</strong> and <strong>memory</strong>, unifying two key abstractions in C and Unix.</p>
</section>
<section id="try-it-yourself-64" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-64">Try It Yourself</h4>
<ol type="1">
<li>Write a file and modify it in place using <code>mmap</code>.</li>
<li>Create shared memory between parent and child processes with <code>MAP_SHARED</code>.</li>
<li>Measure performance difference between <code>read()</code> and <code>mmap</code>.</li>
<li>Map only part of a file using an offset aligned to page size.</li>
<li>Implement a small in-memory key-value store backed by <code>mmap</code>.</li>
</ol>
<p>Next, you’ll explore how to work with <strong>time and clocks in C</strong>, retrieving system timestamps, measuring durations, and implementing timers with precision.</p>
</section>
</section>
<section id="time-and-clock-apis" class="level3">
<h3 class="anchored" data-anchor-id="time-and-clock-apis">67. Time and Clock APIs</h3>
<p>Time is one of the simplest things humans understand, and one of the trickiest things for computers to handle correctly. In C, time is represented in <strong>seconds since the Unix epoch (Jan 1, 1970)</strong>, and you can work with it at various levels: wall-clock time, process time, and high-precision timers.</p>
<p>Let’s explore how to <strong>get, format, and measure time</strong> in C.</p>
<section id="step-1.-the-basics-time" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-the-basics-time">Step 1. The Basics: <code>time()</code></h4>
<p>The simplest way to get the current time is with the <code>time()</code> function.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb785"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb785-1"><a href="#cb785-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb785-2"><a href="#cb785-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb785-3"><a href="#cb785-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb785-4"><a href="#cb785-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb785-5"><a href="#cb785-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">time_t</span> now <span class="op">=</span> time<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb785-6"><a href="#cb785-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Seconds since epoch: </span><span class="sc">%ld\n</span><span class="st">"</span><span class="op">,</span> now<span class="op">);</span></span>
<span id="cb785-7"><a href="#cb785-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Seconds since epoch: 1739709201</code></pre>
<p>That’s the number of seconds since <strong>1970-01-01 00:00:00 UTC</strong>.</p>
</section>
<section id="step-2.-converting-to-human-readable-format" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-converting-to-human-readable-format">Step 2. Converting to Human-Readable Format</h4>
<p>You can convert <code>time_t</code> into a calendar date using <code>localtime()</code> or <code>gmtime()</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb787"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb787-1"><a href="#cb787-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb787-2"><a href="#cb787-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb787-3"><a href="#cb787-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb787-4"><a href="#cb787-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb787-5"><a href="#cb787-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">time_t</span> now <span class="op">=</span> time<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb787-6"><a href="#cb787-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> tm <span class="op">*</span>t <span class="op">=</span> localtime<span class="op">(&amp;</span>now<span class="op">);</span></span>
<span id="cb787-7"><a href="#cb787-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Local time: </span><span class="sc">%02d</span><span class="st">-</span><span class="sc">%02d</span><span class="st">-</span><span class="sc">%04d</span><span class="st"> </span><span class="sc">%02d</span><span class="st">:</span><span class="sc">%02d</span><span class="st">:</span><span class="sc">%02d\n</span><span class="st">"</span><span class="op">,</span></span>
<span id="cb787-8"><a href="#cb787-8" aria-hidden="true" tabindex="-1"></a>           t<span class="op">-&gt;</span>tm_mday<span class="op">,</span> t<span class="op">-&gt;</span>tm_mon <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> t<span class="op">-&gt;</span>tm_year <span class="op">+</span> <span class="dv">1900</span><span class="op">,</span></span>
<span id="cb787-9"><a href="#cb787-9" aria-hidden="true" tabindex="-1"></a>           t<span class="op">-&gt;</span>tm_hour<span class="op">,</span> t<span class="op">-&gt;</span>tm_min<span class="op">,</span> t<span class="op">-&gt;</span>tm_sec<span class="op">);</span></span>
<span id="cb787-10"><a href="#cb787-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Local time: 16-10-2025 09:32:10</code></pre>
</section>
<section id="step-3.-formatting-dates-with-strftime" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-formatting-dates-with-strftime">Step 3. Formatting Dates with <code>strftime()</code></h4>
<p><code>strftime()</code> lets you format time into a string safely.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb789"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb789-1"><a href="#cb789-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb789-2"><a href="#cb789-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb789-3"><a href="#cb789-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb789-4"><a href="#cb789-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb789-5"><a href="#cb789-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buf<span class="op">[</span><span class="dv">100</span><span class="op">];</span></span>
<span id="cb789-6"><a href="#cb789-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">time_t</span> now <span class="op">=</span> time<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb789-7"><a href="#cb789-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> tm <span class="op">*</span>t <span class="op">=</span> localtime<span class="op">(&amp;</span>now<span class="op">);</span></span>
<span id="cb789-8"><a href="#cb789-8" aria-hidden="true" tabindex="-1"></a>    strftime<span class="op">(</span>buf<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buf<span class="op">),</span> <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S"</span><span class="op">,</span> t<span class="op">);</span></span>
<span id="cb789-9"><a href="#cb789-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Formatted: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> buf<span class="op">);</span></span>
<span id="cb789-10"><a href="#cb789-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Formatted: 2025-10-16 09:32:10</code></pre>
</section>
<section id="step-4.-measuring-elapsed-time" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-measuring-elapsed-time">Step 4. Measuring Elapsed Time</h4>
<p>To measure how long something takes, use <code>clock()</code> from <code>&lt;time.h&gt;</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb791"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb791-1"><a href="#cb791-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb791-2"><a href="#cb791-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb791-3"><a href="#cb791-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb791-4"><a href="#cb791-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb791-5"><a href="#cb791-5" aria-hidden="true" tabindex="-1"></a>    clock_t start <span class="op">=</span> clock<span class="op">();</span></span>
<span id="cb791-6"><a href="#cb791-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">volatile</span> <span class="dt">long</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">100000000</span><span class="op">;</span> i<span class="op">++);</span></span>
<span id="cb791-7"><a href="#cb791-7" aria-hidden="true" tabindex="-1"></a>    clock_t end <span class="op">=</span> clock<span class="op">();</span></span>
<span id="cb791-8"><a href="#cb791-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> seconds <span class="op">=</span> <span class="op">(</span><span class="dt">double</span><span class="op">)(</span>end <span class="op">-</span> start<span class="op">)</span> <span class="op">/</span> CLOCKS_PER_SEC<span class="op">;</span></span>
<span id="cb791-9"><a href="#cb791-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Elapsed time: </span><span class="sc">%.3f</span><span class="st"> seconds</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> seconds<span class="op">);</span></span>
<span id="cb791-10"><a href="#cb791-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Elapsed time: 0.520 seconds</code></pre>
<p><code>clock()</code> measures <strong>CPU time</strong>, not real elapsed time, so it excludes time spent waiting for I/O or sleeping.</p>
</section>
<section id="step-5.-high-resolution-timing-with-clock_gettime" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-high-resolution-timing-with-clock_gettime">Step 5. High-Resolution Timing with <code>clock_gettime()</code></h4>
<p>For precise measurements, use <code>clock_gettime()</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb793"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb793-1"><a href="#cb793-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb793-2"><a href="#cb793-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb793-3"><a href="#cb793-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb793-4"><a href="#cb793-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb793-5"><a href="#cb793-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> timespec start<span class="op">,</span> end<span class="op">;</span></span>
<span id="cb793-6"><a href="#cb793-6" aria-hidden="true" tabindex="-1"></a>    clock_gettime<span class="op">(</span>CLOCK_MONOTONIC<span class="op">,</span> <span class="op">&amp;</span>start<span class="op">);</span></span>
<span id="cb793-7"><a href="#cb793-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb793-8"><a href="#cb793-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">volatile</span> <span class="dt">long</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">100000000</span><span class="op">;</span> i<span class="op">++);</span></span>
<span id="cb793-9"><a href="#cb793-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb793-10"><a href="#cb793-10" aria-hidden="true" tabindex="-1"></a>    clock_gettime<span class="op">(</span>CLOCK_MONOTONIC<span class="op">,</span> <span class="op">&amp;</span>end<span class="op">);</span></span>
<span id="cb793-11"><a href="#cb793-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb793-12"><a href="#cb793-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> elapsed <span class="op">=</span> <span class="op">(</span>end<span class="op">.</span>tv_sec <span class="op">-</span> start<span class="op">.</span>tv_sec<span class="op">)</span></span>
<span id="cb793-13"><a href="#cb793-13" aria-hidden="true" tabindex="-1"></a>                   <span class="op">+</span> <span class="op">(</span>end<span class="op">.</span>tv_nsec <span class="op">-</span> start<span class="op">.</span>tv_nsec<span class="op">)</span> <span class="op">/</span> <span class="fl">1e9</span><span class="op">;</span></span>
<span id="cb793-14"><a href="#cb793-14" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Elapsed: </span><span class="sc">%.6f</span><span class="st"> seconds</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> elapsed<span class="op">);</span></span>
<span id="cb793-15"><a href="#cb793-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Elapsed: 0.515421 seconds</code></pre>
<p>This measures <strong>real elapsed time</strong>, immune to system clock changes.</p>
</section>
<section id="step-6.-sleeping-for-a-duration" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-sleeping-for-a-duration">Step 6. Sleeping for a Duration</h4>
<p>You can make your program pause using <code>sleep()</code> or <code>nanosleep()</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb795"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb795-1"><a href="#cb795-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb795-2"><a href="#cb795-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb795-3"><a href="#cb795-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb795-4"><a href="#cb795-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb795-5"><a href="#cb795-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Sleeping for 2 seconds...</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb795-6"><a href="#cb795-6" aria-hidden="true" tabindex="-1"></a>    sleep<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb795-7"><a href="#cb795-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Awake!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb795-8"><a href="#cb795-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>For sub-second precision:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb796"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb796-1"><a href="#cb796-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb796-2"><a href="#cb796-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb796-3"><a href="#cb796-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb796-4"><a href="#cb796-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> timespec ts <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">500000000</span><span class="op">};</span> <span class="co">// 0.5 seconds</span></span>
<span id="cb796-5"><a href="#cb796-5" aria-hidden="true" tabindex="-1"></a>    nanosleep<span class="op">(&amp;</span>ts<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb796-6"><a href="#cb796-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-7.-getting-utc-and-local-time-zones" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-getting-utc-and-local-time-zones">Step 7. Getting UTC and Local Time Zones</h4>
<p><code>gmtime()</code> gives you UTC, while <code>localtime()</code> converts to your system’s timezone.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb797"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb797-1"><a href="#cb797-1" aria-hidden="true" tabindex="-1"></a><span class="dt">time_t</span> now <span class="op">=</span> time<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb797-2"><a href="#cb797-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"UTC:   </span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> asctime<span class="op">(</span>gmtime<span class="op">(&amp;</span>now<span class="op">)));</span></span>
<span id="cb797-3"><a href="#cb797-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Local: </span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> asctime<span class="op">(</span>localtime<span class="op">(&amp;</span>now<span class="op">)));</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You can change timezone behavior via the <code>TZ</code> environment variable and <code>tzset()</code>.</p>
</section>
<section id="step-8.-process-time-and-resource-usage" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-process-time-and-resource-usage">Step 8. Process Time and Resource Usage</h4>
<p>You can inspect how much CPU time your program used with <code>getrusage()</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb798"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb798-1"><a href="#cb798-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/resource.h&gt;</span></span>
<span id="cb798-2"><a href="#cb798-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb798-3"><a href="#cb798-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb798-4"><a href="#cb798-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb798-5"><a href="#cb798-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> rusage usage<span class="op">;</span></span>
<span id="cb798-6"><a href="#cb798-6" aria-hidden="true" tabindex="-1"></a>    getrusage<span class="op">(</span>RUSAGE_SELF<span class="op">,</span> <span class="op">&amp;</span>usage<span class="op">);</span></span>
<span id="cb798-7"><a href="#cb798-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"User CPU time: </span><span class="sc">%ld</span><span class="st">.</span><span class="sc">%06ld</span><span class="st">s</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span></span>
<span id="cb798-8"><a href="#cb798-8" aria-hidden="true" tabindex="-1"></a>           usage<span class="op">.</span>ru_utime<span class="op">.</span>tv_sec<span class="op">,</span> usage<span class="op">.</span>ru_utime<span class="op">.</span>tv_usec<span class="op">);</span></span>
<span id="cb798-9"><a href="#cb798-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"System CPU time: </span><span class="sc">%ld</span><span class="st">.</span><span class="sc">%06ld</span><span class="st">s</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span></span>
<span id="cb798-10"><a href="#cb798-10" aria-hidden="true" tabindex="-1"></a>           usage<span class="op">.</span>ru_stime<span class="op">.</span>tv_sec<span class="op">,</span> usage<span class="op">.</span>ru_stime<span class="op">.</span>tv_usec<span class="op">);</span></span>
<span id="cb798-11"><a href="#cb798-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This is how profilers measure CPU consumption.</p>
</section>
<section id="step-9.-time-differences" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-time-differences">Step 9. Time Differences</h4>
<p>You can subtract two <code>time_t</code> values using <code>difftime()</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb799"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb799-1"><a href="#cb799-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb799-2"><a href="#cb799-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb799-3"><a href="#cb799-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-4"><a href="#cb799-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb799-5"><a href="#cb799-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">time_t</span> start <span class="op">=</span> time<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb799-6"><a href="#cb799-6" aria-hidden="true" tabindex="-1"></a>    sleep<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb799-7"><a href="#cb799-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">time_t</span> end <span class="op">=</span> time<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb799-8"><a href="#cb799-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Elapsed: </span><span class="sc">%.0f</span><span class="st"> seconds</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> difftime<span class="op">(</span>end<span class="op">,</span> start<span class="op">));</span></span>
<span id="cb799-9"><a href="#cb799-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Elapsed: 2 seconds</code></pre>
</section>
<section id="step-10.-tiny-code-countdown-timer" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-countdown-timer">Step 10. Tiny Code: Countdown Timer</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb801"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb801-1"><a href="#cb801-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb801-2"><a href="#cb801-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb801-3"><a href="#cb801-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb801-4"><a href="#cb801-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb801-5"><a href="#cb801-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">5</span><span class="op">;</span> i <span class="op">&gt;</span> <span class="dv">0</span><span class="op">;</span> i<span class="op">--)</span> <span class="op">{</span></span>
<span id="cb801-6"><a href="#cb801-6" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">...</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb801-7"><a href="#cb801-7" aria-hidden="true" tabindex="-1"></a>        sleep<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb801-8"><a href="#cb801-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb801-9"><a href="#cb801-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Time's up!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb801-10"><a href="#cb801-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>5...
4...
3...
2...
1...
Time's up!</code></pre>
</section>
<section id="why-it-matters-57" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-57">Why It Matters</h4>
<p>Time functions are critical in:</p>
<ul>
<li>Logging and timestamps</li>
<li>Benchmarking and profiling</li>
<li>Scheduling events</li>
<li>Measuring performance of algorithms</li>
<li>Synchronizing distributed systems</li>
</ul>
<p>Every systems program eventually needs <strong>accurate, reliable time measurement</strong>, and C gives you all the low-level tools to do it efficiently.</p>
</section>
<section id="try-it-yourself-65" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-65">Try It Yourself</h4>
<ol type="1">
<li>Print the current date in ISO 8601 format.</li>
<li>Measure how long it takes to read a large file.</li>
<li>Build a stopwatch that measures elapsed time with <code>clock_gettime()</code>.</li>
<li>Make a countdown timer that updates in place on the terminal.</li>
<li>Display both UTC and local time, formatted nicely.</li>
</ol>
<p>Next, you’ll learn how to <strong>access and modify environment variables</strong>, another key part of how Unix programs communicate with their runtime environment.</p>
</section>
</section>
<section id="environment-variables" class="level3">
<h3 class="anchored" data-anchor-id="environment-variables">68. Environment Variables</h3>
<p>Every program in Unix inherits a <strong>set of key–value pairs</strong> called <strong>environment variables</strong>. They store information about your shell, system configuration, and runtime behavior, such as your username, home directory, and compiler paths.</p>
<p>C gives you full control to <strong>read, modify, and define</strong> these variables directly.</p>
<section id="step-1.-what-are-environment-variables" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-are-environment-variables">Step 1. What Are Environment Variables?</h4>
<p>Environment variables are strings of the form:</p>
<pre><code>KEY=VALUE</code></pre>
<p>You can view them in your shell:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb804"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb804-1"><a href="#cb804-1" aria-hidden="true" tabindex="-1"></a><span class="fu">printenv</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Common examples:</p>
<pre><code>HOME=/home/user
PATH=/usr/local/bin:/usr/bin:/bin
USER=alice
LANG=en_US.UTF-8
SHELL=/bin/bash</code></pre>
<p>These values are passed to every program when you run it.</p>
</section>
<section id="step-2.-accessing-environment-variables-in-c" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-accessing-environment-variables-in-c">Step 2. Accessing Environment Variables in C</h4>
<p>You can use the standard library function <code>getenv()</code> to read a variable.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb806"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb806-1"><a href="#cb806-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb806-2"><a href="#cb806-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb806-3"><a href="#cb806-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb806-4"><a href="#cb806-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb806-5"><a href="#cb806-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>path <span class="op">=</span> getenv<span class="op">(</span><span class="st">"PATH"</span><span class="op">);</span></span>
<span id="cb806-6"><a href="#cb806-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>path<span class="op">)</span></span>
<span id="cb806-7"><a href="#cb806-7" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"PATH = </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> path<span class="op">);</span></span>
<span id="cb806-8"><a href="#cb806-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb806-9"><a href="#cb806-9" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"PATH not found.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb806-10"><a href="#cb806-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output example:</p>
<pre><code>PATH = /usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin</code></pre>
<p>If the variable doesn’t exist, <code>getenv()</code> returns <code>NULL</code>.</p>
</section>
<section id="step-3.-setting-environment-variables" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-setting-environment-variables">Step 3. Setting Environment Variables</h4>
<p>To define or change a variable inside your program, use <code>setenv()</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb808"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb808-1"><a href="#cb808-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb808-2"><a href="#cb808-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb808-3"><a href="#cb808-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb808-4"><a href="#cb808-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb808-5"><a href="#cb808-5" aria-hidden="true" tabindex="-1"></a>    setenv<span class="op">(</span><span class="st">"GREETING"</span><span class="op">,</span> <span class="st">"Hello from C!"</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb808-6"><a href="#cb808-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> getenv<span class="op">(</span><span class="st">"GREETING"</span><span class="op">));</span></span>
<span id="cb808-7"><a href="#cb808-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><code>setenv(name, value, overwrite)</code></p>
<ul>
<li><code>overwrite = 0</code>: don’t overwrite existing variable.</li>
<li><code>overwrite = 1</code>: replace it if it exists.</li>
</ul>
<p>Output:</p>
<pre><code>Hello from C!</code></pre>
</section>
<section id="step-4.-removing-environment-variables" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-removing-environment-variables">Step 4. Removing Environment Variables</h4>
<p>Use <code>unsetenv()</code> to delete a variable.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb810"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb810-1"><a href="#cb810-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb810-2"><a href="#cb810-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb810-3"><a href="#cb810-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb810-4"><a href="#cb810-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb810-5"><a href="#cb810-5" aria-hidden="true" tabindex="-1"></a>    setenv<span class="op">(</span><span class="st">"TEMPVAR"</span><span class="op">,</span> <span class="st">"temporary"</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb810-6"><a href="#cb810-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Before unset: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> getenv<span class="op">(</span><span class="st">"TEMPVAR"</span><span class="op">));</span></span>
<span id="cb810-7"><a href="#cb810-7" aria-hidden="true" tabindex="-1"></a>    unsetenv<span class="op">(</span><span class="st">"TEMPVAR"</span><span class="op">);</span></span>
<span id="cb810-8"><a href="#cb810-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"After unset: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> getenv<span class="op">(</span><span class="st">"TEMPVAR"</span><span class="op">));</span></span>
<span id="cb810-9"><a href="#cb810-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Before unset: temporary
After unset: (null)</code></pre>
</section>
<section id="step-5.-accessing-all-environment-variables" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-accessing-all-environment-variables">Step 5. Accessing All Environment Variables</h4>
<p>The <code>environ</code> global variable gives you access to the entire environment list.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb812"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb812-1"><a href="#cb812-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb812-2"><a href="#cb812-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb812-3"><a href="#cb812-3" aria-hidden="true" tabindex="-1"></a><span class="kw">extern</span> <span class="dt">char</span> <span class="op">**</span>environ<span class="op">;</span></span>
<span id="cb812-4"><a href="#cb812-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb812-5"><a href="#cb812-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb812-6"><a href="#cb812-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">char</span> <span class="op">**</span>env <span class="op">=</span> environ<span class="op">;</span> <span class="op">*</span>env <span class="op">!=</span> NULL<span class="op">;</span> env<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb812-7"><a href="#cb812-7" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>env<span class="op">);</span></span>
<span id="cb812-8"><a href="#cb812-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb812-9"><a href="#cb812-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This prints all environment variables currently active in your process.</p>
</section>
<section id="step-6.-passing-environment-variables-to-child-processes" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-passing-environment-variables-to-child-processes">Step 6. Passing Environment Variables to Child Processes</h4>
<p>When you use <code>fork()</code> and <code>exec()</code>, environment variables are <strong>inherited</strong> by the child process automatically.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb813"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb813-1"><a href="#cb813-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb813-2"><a href="#cb813-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb813-3"><a href="#cb813-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb813-4"><a href="#cb813-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb813-5"><a href="#cb813-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb813-6"><a href="#cb813-6" aria-hidden="true" tabindex="-1"></a>    setenv<span class="op">(</span><span class="st">"HELLO"</span><span class="op">,</span> <span class="st">"world"</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb813-7"><a href="#cb813-7" aria-hidden="true" tabindex="-1"></a>    execlp<span class="op">(</span><span class="st">"printenv"</span><span class="op">,</span> <span class="st">"printenv"</span><span class="op">,</span> <span class="st">"HELLO"</span><span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb813-8"><a href="#cb813-8" aria-hidden="true" tabindex="-1"></a>    perror<span class="op">(</span><span class="st">"execlp"</span><span class="op">);</span></span>
<span id="cb813-9"><a href="#cb813-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>world</code></pre>
<p>You can also provide a custom environment list using <code>execle()</code> or <code>execve()</code>.</p>
</section>
<section id="step-7.-custom-environment-for-a-new-program" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-custom-environment-for-a-new-program">Step 7. Custom Environment for a New Program</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb815"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb815-1"><a href="#cb815-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb815-2"><a href="#cb815-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb815-3"><a href="#cb815-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb815-4"><a href="#cb815-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb815-5"><a href="#cb815-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>newenv<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span> <span class="st">"MODE=debug"</span><span class="op">,</span> <span class="st">"VERSION=1.0"</span><span class="op">,</span> NULL <span class="op">};</span></span>
<span id="cb815-6"><a href="#cb815-6" aria-hidden="true" tabindex="-1"></a>    execle<span class="op">(</span><span class="st">"/usr/bin/env"</span><span class="op">,</span> <span class="st">"env"</span><span class="op">,</span> NULL<span class="op">,</span> newenv<span class="op">);</span></span>
<span id="cb815-7"><a href="#cb815-7" aria-hidden="true" tabindex="-1"></a>    perror<span class="op">(</span><span class="st">"execle"</span><span class="op">);</span></span>
<span id="cb815-8"><a href="#cb815-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>MODE=debug
VERSION=1.0</code></pre>
<p>Only these two variables exist for the new process, everything else is discarded.</p>
</section>
<section id="step-8.-why-environment-variables-matter" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-why-environment-variables-matter">Step 8. Why Environment Variables Matter</h4>
<p>They are a key part of <strong>Unix’s design philosophy</strong>:</p>
<ul>
<li>Programs should be <strong>configurable without recompilation</strong>.</li>
<li>Environment variables provide <strong>global, process-level configuration</strong>.</li>
</ul>
<p>For example:</p>
<ul>
<li><code>PATH</code> controls where executables are searched.</li>
<li><code>HOME</code> defines user directories.</li>
<li><code>LANG</code> defines locale settings.</li>
<li><code>LD_LIBRARY_PATH</code> controls dynamic linking.</li>
</ul>
</section>
<section id="step-9.-security-considerations" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-security-considerations">Step 9. Security Considerations</h4>
<p>Environment variables are inherited automatically, so they can be a security risk if not handled carefully:</p>
<ul>
<li>Avoid trusting environment variables for authentication.</li>
<li>Always validate <code>PATH</code>, <code>HOME</code>, and <code>TMPDIR</code>.</li>
<li>Use <code>unsetenv()</code> for sensitive contexts (e.g., setuid programs).</li>
</ul>
</section>
<section id="tiny-code-mini-shell-with-path-lookup" class="level4">
<h4 class="anchored" data-anchor-id="tiny-code-mini-shell-with-path-lookup">Tiny Code: Mini Shell with <code>PATH</code> Lookup</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb817"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb817-1"><a href="#cb817-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb817-2"><a href="#cb817-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb817-3"><a href="#cb817-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb817-4"><a href="#cb817-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb817-5"><a href="#cb817-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>path <span class="op">=</span> getenv<span class="op">(</span><span class="st">"PATH"</span><span class="op">);</span></span>
<span id="cb817-6"><a href="#cb817-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>path<span class="op">)</span> path <span class="op">=</span> <span class="st">"(none)"</span><span class="op">;</span></span>
<span id="cb817-7"><a href="#cb817-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Current PATH:</span><span class="sc">\n%s\n</span><span class="st">"</span><span class="op">,</span> path<span class="op">);</span></span>
<span id="cb817-8"><a href="#cb817-8" aria-hidden="true" tabindex="-1"></a>    setenv<span class="op">(</span><span class="st">"PATH"</span><span class="op">,</span> <span class="st">"/usr/local/bin:/usr/bin"</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb817-9"><a href="#cb817-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Updated PATH:</span><span class="sc">\n%s\n</span><span class="st">"</span><span class="op">,</span> getenv<span class="op">(</span><span class="st">"PATH"</span><span class="op">));</span></span>
<span id="cb817-10"><a href="#cb817-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Current PATH:
/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin

Updated PATH:
/usr/local/bin:/usr/bin</code></pre>
</section>
<section id="step-10.-why-it-matters-7" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-why-it-matters-7">Step 10. Why It Matters</h4>
<p>Environment variables give your programs <strong>context</strong>:</p>
<ul>
<li>They tell you where files, libraries, and configs live.</li>
<li>They let you control runtime behavior dynamically.</li>
<li>They’re essential for system tools, shells, daemons, and tests.</li>
</ul>
<p>Understanding how to read and modify them is key to mastering Unix programming in C.</p>
</section>
<section id="try-it-yourself-66" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-66">Try It Yourself</h4>
<ol type="1">
<li>Print all environment variables sorted alphabetically.</li>
<li>Implement your own <code>env</code> command in C.</li>
<li>Write a program that modifies <code>PATH</code> and launches another program.</li>
<li>Create a child process that inherits modified variables.</li>
<li>Combine <code>setenv()</code>, <code>execle()</code>, and <code>getenv()</code> to simulate sandboxed runs.</li>
</ol>
<p>Next, you’ll learn about <strong>error handling and return codes</strong>, the invisible signals that every Unix process uses to tell the system whether it succeeded or failed.</p>
</section>
</section>
<section id="error-handling-and-return-codes" class="level3">
<h3 class="anchored" data-anchor-id="error-handling-and-return-codes">69. Error Handling and Return Codes</h3>
<p>Every C program, from the tiniest script to the Linux kernel itself, relies on <strong>error codes</strong> and <strong>return values</strong> to communicate success or failure. Unlike higher-level languages, C gives you <strong>no exceptions</strong>, only clear, explicit status codes and <code>errno</code>.</p>
<p>Mastering these patterns will make your programs robust, predictable, and professional.</p>
<section id="step-1.-exit-codes-and-main" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-exit-codes-and-main">Step 1. Exit Codes and <code>main()</code></h4>
<p>Every process returns an integer exit code to the operating system. Conventionally:</p>
<ul>
<li><code>0</code> → success</li>
<li>nonzero → failure or specific error</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb819"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb819-1"><a href="#cb819-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb819-2"><a href="#cb819-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb819-3"><a href="#cb819-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb819-4"><a href="#cb819-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Everything OK!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb819-5"><a href="#cb819-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// exit success</span></span>
<span id="cb819-6"><a href="#cb819-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Check it in your shell:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb820"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb820-1"><a href="#cb820-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./program</span></span>
<span id="cb820-2"><a href="#cb820-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$?</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Everything OK!
0</code></pre>
<p>If you return a nonzero value:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb822"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb822-1"><a href="#cb822-1" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>then <code>$?</code> will be <code>1</code>, meaning failure.</p>
</section>
<section id="step-2.-using-exit_success-and-exit_failure" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-using-exit_success-and-exit_failure">Step 2. Using <code>EXIT_SUCCESS</code> and <code>EXIT_FAILURE</code></h4>
<p>Instead of hardcoded numbers, use standard macros from <code>&lt;stdlib.h&gt;</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb823"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb823-1"><a href="#cb823-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb823-2"><a href="#cb823-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb823-3"><a href="#cb823-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb823-4"><a href="#cb823-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb823-5"><a href="#cb823-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Failed to open file.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb823-6"><a href="#cb823-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> EXIT_FAILURE<span class="op">;</span></span>
<span id="cb823-7"><a href="#cb823-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>These improve portability and readability.</p>
</section>
<section id="step-3.-the-global-errno" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-the-global-errno">Step 3. The Global <code>errno</code></h4>
<p>When a library or system call fails, it usually sets a global variable named <strong><code>errno</code></strong>. It’s declared in <code>&lt;errno.h&gt;</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb824"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb824-1"><a href="#cb824-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;errno.h&gt;</span></span>
<span id="cb824-2"><a href="#cb824-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb824-3"><a href="#cb824-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb824-4"><a href="#cb824-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fcntl.h&gt;</span></span>
<span id="cb824-5"><a href="#cb824-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb824-6"><a href="#cb824-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb824-7"><a href="#cb824-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb824-8"><a href="#cb824-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span><span class="st">"nonexistent.txt"</span><span class="op">,</span> O_RDONLY<span class="op">);</span></span>
<span id="cb824-9"><a href="#cb824-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fd <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb824-10"><a href="#cb824-10" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Error opening file: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> strerror<span class="op">(</span>errno<span class="op">));</span></span>
<span id="cb824-11"><a href="#cb824-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb824-12"><a href="#cb824-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Error opening file: No such file or directory</code></pre>
<p><code>errno</code> stores an integer code, but <code>strerror()</code> converts it into a readable message.</p>
</section>
<section id="step-4.-common-errno-values" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-common-errno-values">Step 4. Common <code>errno</code> Values</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Code</th>
<th>Macro</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td><code>ENOENT</code></td>
<td>No such file or directory</td>
</tr>
<tr class="even">
<td>13</td>
<td><code>EACCES</code></td>
<td>Permission denied</td>
</tr>
<tr class="odd">
<td>12</td>
<td><code>ENOMEM</code></td>
<td>Out of memory</td>
</tr>
<tr class="even">
<td>22</td>
<td><code>EINVAL</code></td>
<td>Invalid argument</td>
</tr>
<tr class="odd">
<td>9</td>
<td><code>EBADF</code></td>
<td>Bad file descriptor</td>
</tr>
<tr class="even">
<td>11</td>
<td><code>EAGAIN</code></td>
<td>Resource temporarily unavailable</td>
</tr>
</tbody>
</table>
<p>You can check them directly:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb826"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb826-1"><a href="#cb826-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>errno <span class="op">==</span> EACCES<span class="op">)</span> <span class="op">{</span> <span class="op">...</span> <span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-5.-the-perror-function" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-the-perror-function">Step 5. The <code>perror()</code> Function</h4>
<p>A simpler way to print error messages is <code>perror()</code>, it automatically uses the current <code>errno</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb827"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb827-1"><a href="#cb827-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb827-2"><a href="#cb827-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fcntl.h&gt;</span></span>
<span id="cb827-3"><a href="#cb827-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb827-4"><a href="#cb827-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb827-5"><a href="#cb827-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb827-6"><a href="#cb827-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span><span class="st">"nothing.txt"</span><span class="op">,</span> O_RDONLY<span class="op">);</span></span>
<span id="cb827-7"><a href="#cb827-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fd <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb827-8"><a href="#cb827-8" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"open"</span><span class="op">);</span></span>
<span id="cb827-9"><a href="#cb827-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb827-10"><a href="#cb827-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>open: No such file or directory</code></pre>
</section>
<section id="step-6.-returning-meaningful-codes" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-returning-meaningful-codes">Step 6. Returning Meaningful Codes</h4>
<p>Good C programs <strong>translate internal errors into meaningful exit codes</strong>.</p>
<p>Example: file copy program</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb829"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb829-1"><a href="#cb829-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb829-2"><a href="#cb829-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb829-3"><a href="#cb829-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb829-4"><a href="#cb829-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span> <span class="op">{</span></span>
<span id="cb829-5"><a href="#cb829-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>argc <span class="op">!=</span> <span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb829-6"><a href="#cb829-6" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Usage: </span><span class="sc">%s</span><span class="st"> src dest</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb829-7"><a href="#cb829-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb829-8"><a href="#cb829-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb829-9"><a href="#cb829-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>src <span class="op">=</span> fopen<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb829-10"><a href="#cb829-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>src<span class="op">)</span> <span class="op">{</span></span>
<span id="cb829-11"><a href="#cb829-11" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"fopen src"</span><span class="op">);</span></span>
<span id="cb829-12"><a href="#cb829-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb829-13"><a href="#cb829-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb829-14"><a href="#cb829-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>dst <span class="op">=</span> fopen<span class="op">(</span>argv<span class="op">[</span><span class="dv">2</span><span class="op">],</span> <span class="st">"w"</span><span class="op">);</span></span>
<span id="cb829-15"><a href="#cb829-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>dst<span class="op">)</span> <span class="op">{</span></span>
<span id="cb829-16"><a href="#cb829-16" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"fopen dst"</span><span class="op">);</span></span>
<span id="cb829-17"><a href="#cb829-17" aria-hidden="true" tabindex="-1"></a>        fclose<span class="op">(</span>src<span class="op">);</span></span>
<span id="cb829-18"><a href="#cb829-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb829-19"><a href="#cb829-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb829-20"><a href="#cb829-20" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>src<span class="op">);</span></span>
<span id="cb829-21"><a href="#cb829-21" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>dst<span class="op">);</span></span>
<span id="cb829-22"><a href="#cb829-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb829-23"><a href="#cb829-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now each exit code represents a specific type of failure.</p>
</section>
<section id="step-7.-resetting-and-checking-errno" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-resetting-and-checking-errno">Step 7. Resetting and Checking <code>errno</code></h4>
<p>Some system calls set <code>errno</code> only when they fail. So always reset it before use if you plan to inspect it later:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb830"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb830-1"><a href="#cb830-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;errno.h&gt;</span></span>
<span id="cb830-2"><a href="#cb830-2" aria-hidden="true" tabindex="-1"></a>errno <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb830-3"><a href="#cb830-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>some_syscall<span class="op">()</span> <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb830-4"><a href="#cb830-4" aria-hidden="true" tabindex="-1"></a>    perror<span class="op">(</span><span class="st">"syscall failed"</span><span class="op">);</span></span>
<span id="cb830-5"><a href="#cb830-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-8.-custom-error-handling-helpers" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-custom-error-handling-helpers">Step 8. Custom Error Handling Helpers</h4>
<p>You can create your own function to simplify error handling.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb831"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb831-1"><a href="#cb831-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb831-2"><a href="#cb831-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb831-3"><a href="#cb831-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb831-4"><a href="#cb831-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> die<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>msg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb831-5"><a href="#cb831-5" aria-hidden="true" tabindex="-1"></a>    perror<span class="op">(</span>msg<span class="op">);</span></span>
<span id="cb831-6"><a href="#cb831-6" aria-hidden="true" tabindex="-1"></a>    exit<span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
<span id="cb831-7"><a href="#cb831-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb831-8"><a href="#cb831-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb831-9"><a href="#cb831-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb831-10"><a href="#cb831-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>f <span class="op">=</span> fopen<span class="op">(</span><span class="st">"no.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb831-11"><a href="#cb831-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>f<span class="op">)</span> die<span class="op">(</span><span class="st">"fopen"</span><span class="op">);</span></span>
<span id="cb831-12"><a href="#cb831-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>fopen: No such file or directory</code></pre>
<p>This pattern appears throughout Unix utilities.</p>
</section>
<section id="step-9.-handling-partial-failures" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-handling-partial-failures">Step 9. Handling Partial Failures</h4>
<p>Not all errors should abort your program. Sometimes you should log, retry, or ignore.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb833"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb833-1"><a href="#cb833-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> <span class="op">*</span>f <span class="op">=</span> fopen<span class="op">(</span><span class="st">"optional.conf"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb833-2"><a href="#cb833-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span>f<span class="op">)</span> <span class="op">{</span></span>
<span id="cb833-3"><a href="#cb833-3" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Warning: config file missing, using defaults.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb833-4"><a href="#cb833-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This kind of <strong>graceful degradation</strong> is good design.</p>
</section>
<section id="step-10.-tiny-code-safe-file-reader" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-safe-file-reader">Step 10. Tiny Code: Safe File Reader</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb834"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb834-1"><a href="#cb834-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb834-2"><a href="#cb834-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;errno.h&gt;</span></span>
<span id="cb834-3"><a href="#cb834-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb834-4"><a href="#cb834-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb834-5"><a href="#cb834-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb834-6"><a href="#cb834-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>f <span class="op">=</span> fopen<span class="op">(</span><span class="st">"data.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb834-7"><a href="#cb834-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>f<span class="op">)</span> <span class="op">{</span></span>
<span id="cb834-8"><a href="#cb834-8" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Error: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> strerror<span class="op">(</span>errno<span class="op">));</span></span>
<span id="cb834-9"><a href="#cb834-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> EXIT_FAILURE<span class="op">;</span></span>
<span id="cb834-10"><a href="#cb834-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb834-11"><a href="#cb834-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb834-12"><a href="#cb834-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buf<span class="op">[</span><span class="dv">64</span><span class="op">];</span></span>
<span id="cb834-13"><a href="#cb834-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>fgets<span class="op">(</span>buf<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buf<span class="op">),</span> f<span class="op">))</span></span>
<span id="cb834-14"><a href="#cb834-14" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> buf<span class="op">);</span></span>
<span id="cb834-15"><a href="#cb834-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb834-16"><a href="#cb834-16" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>f<span class="op">);</span></span>
<span id="cb834-17"><a href="#cb834-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> EXIT_SUCCESS<span class="op">;</span></span>
<span id="cb834-18"><a href="#cb834-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output (if missing file):</p>
<pre><code>Error: No such file or directory</code></pre>
</section>
<section id="why-it-matters-58" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-58">Why It Matters</h4>
<p>Error handling separates <strong>toy programs</strong> from <strong>real software</strong>:</p>
<ul>
<li>Every syscall can fail, be prepared.</li>
<li>Always check return values.</li>
<li>Always report why it failed.</li>
</ul>
<p>By convention:</p>
<ul>
<li>Return <code>0</code> on success.</li>
<li>Return nonzero for recoverable or fatal errors.</li>
<li>Print messages to <code>stderr</code>, not <code>stdout</code>.</li>
</ul>
</section>
<section id="try-it-yourself-67" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-67">Try It Yourself</h4>
<ol type="1">
<li>Open a nonexistent file and print the full <code>errno</code> value.</li>
<li>Build a small utility that returns specific codes for specific problems.</li>
<li>Use <code>perror()</code> vs <code>strerror()</code> and compare their outputs.</li>
<li>Add a <code>die()</code> helper to your previous exercises.</li>
<li>Write a safe wrapper that retries system calls when <code>errno == EAGAIN</code>.</li>
</ol>
<p>Next, you’ll put all of this together in <strong>Practice 70: Building a Mini Shell in C</strong>, where you’ll handle processes, pipes, and signals to create your own working Unix shell prototype.</p>
</section>
</section>
<section id="practice-mini-shell-in-c" class="level3">
<h3 class="anchored" data-anchor-id="practice-mini-shell-in-c">70. Practice: Mini Shell in C</h3>
<p>It’s time to bring together everything you’ve learned so far, <strong>system calls</strong>, <strong>process creation</strong>, <strong>pipes</strong>, <strong>redirection</strong>, and <strong>signal handling</strong>, into one cohesive project.</p>
<p>In this section, you’ll build a <strong>minimal interactive shell</strong>, just like <code>bash</code> or <code>zsh</code>, but stripped down to the essentials. It will run commands, handle input/output redirection, and even support pipelines.</p>
<section id="step-1.-what-youll-build" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-youll-build">Step 1. What You’ll Build</h4>
<p>Your mini shell will:</p>
<ol type="1">
<li>Display a prompt like <code>$</code></li>
<li>Read user input (e.g., <code>ls -l</code>, <code>cat file.txt</code>)</li>
<li>Parse it into command and arguments</li>
<li>Create a new process using <code>fork()</code></li>
<li>Replace the process image with the requested command using <code>execvp()</code></li>
<li>Wait for the child to finish</li>
</ol>
<p>Optional extensions:</p>
<ul>
<li>Handle signals (Ctrl+C) gracefully</li>
<li>Redirect output to a file (<code>&gt;</code> redirection)</li>
<li>Chain commands using pipes (<code>|</code>)</li>
</ul>
</section>
<section id="step-2.-core-loop-skeleton" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-core-loop-skeleton">Step 2. Core Loop Skeleton</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb836"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb836-1"><a href="#cb836-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb836-2"><a href="#cb836-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb836-3"><a href="#cb836-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb836-4"><a href="#cb836-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb836-5"><a href="#cb836-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/wait.h&gt;</span></span>
<span id="cb836-6"><a href="#cb836-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb836-7"><a href="#cb836-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAX </span><span class="dv">1024</span></span>
<span id="cb836-8"><a href="#cb836-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb836-9"><a href="#cb836-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb836-10"><a href="#cb836-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> input<span class="op">[</span>MAX<span class="op">];</span></span>
<span id="cb836-11"><a href="#cb836-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb836-12"><a href="#cb836-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb836-13"><a href="#cb836-13" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"$ "</span><span class="op">);</span></span>
<span id="cb836-14"><a href="#cb836-14" aria-hidden="true" tabindex="-1"></a>        fflush<span class="op">(</span>stdout<span class="op">);</span></span>
<span id="cb836-15"><a href="#cb836-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb836-16"><a href="#cb836-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>fgets<span class="op">(</span>input<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>input<span class="op">),</span> stdin<span class="op">))</span></span>
<span id="cb836-17"><a href="#cb836-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb836-18"><a href="#cb836-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb836-19"><a href="#cb836-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Remove newline</span></span>
<span id="cb836-20"><a href="#cb836-20" aria-hidden="true" tabindex="-1"></a>        input<span class="op">[</span>strcspn<span class="op">(</span>input<span class="op">,</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">)]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb836-21"><a href="#cb836-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb836-22"><a href="#cb836-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Exit command</span></span>
<span id="cb836-23"><a href="#cb836-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>input<span class="op">,</span> <span class="st">"exit"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb836-24"><a href="#cb836-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb836-25"><a href="#cb836-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb836-26"><a href="#cb836-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Tokenize input</span></span>
<span id="cb836-27"><a href="#cb836-27" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> <span class="op">*</span>args<span class="op">[</span><span class="dv">64</span><span class="op">];</span></span>
<span id="cb836-28"><a href="#cb836-28" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb836-29"><a href="#cb836-29" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> <span class="op">*</span>token <span class="op">=</span> strtok<span class="op">(</span>input<span class="op">,</span> <span class="st">" "</span><span class="op">);</span></span>
<span id="cb836-30"><a href="#cb836-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span>token<span class="op">)</span> <span class="op">{</span></span>
<span id="cb836-31"><a href="#cb836-31" aria-hidden="true" tabindex="-1"></a>            args<span class="op">[</span>i<span class="op">++]</span> <span class="op">=</span> token<span class="op">;</span></span>
<span id="cb836-32"><a href="#cb836-32" aria-hidden="true" tabindex="-1"></a>            token <span class="op">=</span> strtok<span class="op">(</span>NULL<span class="op">,</span> <span class="st">" "</span><span class="op">);</span></span>
<span id="cb836-33"><a href="#cb836-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb836-34"><a href="#cb836-34" aria-hidden="true" tabindex="-1"></a>        args<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb836-35"><a href="#cb836-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb836-36"><a href="#cb836-36" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Fork and execute</span></span>
<span id="cb836-37"><a href="#cb836-37" aria-hidden="true" tabindex="-1"></a>        pid_t pid <span class="op">=</span> fork<span class="op">();</span></span>
<span id="cb836-38"><a href="#cb836-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>pid <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb836-39"><a href="#cb836-39" aria-hidden="true" tabindex="-1"></a>            execvp<span class="op">(</span>args<span class="op">[</span><span class="dv">0</span><span class="op">],</span> args<span class="op">);</span></span>
<span id="cb836-40"><a href="#cb836-40" aria-hidden="true" tabindex="-1"></a>            perror<span class="op">(</span><span class="st">"execvp"</span><span class="op">);</span></span>
<span id="cb836-41"><a href="#cb836-41" aria-hidden="true" tabindex="-1"></a>            exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb836-42"><a href="#cb836-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>pid <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb836-43"><a href="#cb836-43" aria-hidden="true" tabindex="-1"></a>            wait<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb836-44"><a href="#cb836-44" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb836-45"><a href="#cb836-45" aria-hidden="true" tabindex="-1"></a>            perror<span class="op">(</span><span class="st">"fork"</span><span class="op">);</span></span>
<span id="cb836-46"><a href="#cb836-46" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb836-47"><a href="#cb836-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb836-48"><a href="#cb836-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb836-49"><a href="#cb836-49" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Goodbye!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb836-50"><a href="#cb836-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb836-51"><a href="#cb836-51" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb837"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb837-1"><a href="#cb837-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> mini_shell.c <span class="at">-o</span> mini_shell</span>
<span id="cb837-2"><a href="#cb837-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./mini_shell</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Try commands:</p>
<pre><code>$ ls
$ pwd
$ echo hello world
$ exit</code></pre>
</section>
<section id="step-3.-handling-errors-gracefully" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-handling-errors-gracefully">Step 3. Handling Errors Gracefully</h4>
<p>If you enter a wrong command:</p>
<pre><code>$ xyz</code></pre>
<p>Output:</p>
<pre><code>execvp: No such file or directory</code></pre>
<p>This happens because the program handles <code>execvp()</code> failure properly with <code>perror()</code>, just as you learned in section 69.</p>
</section>
<section id="step-4.-adding-signal-handling" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-adding-signal-handling">Step 4. Adding Signal Handling</h4>
<p>Let’s make Ctrl+C stop the running command, but not kill the shell itself.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb841"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb841-1"><a href="#cb841-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;signal.h&gt;</span></span>
<span id="cb841-2"><a href="#cb841-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb841-3"><a href="#cb841-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> sigint_handler<span class="op">(</span><span class="dt">int</span> sig<span class="op">)</span> <span class="op">{</span></span>
<span id="cb841-4"><a href="#cb841-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Type 'exit' to quit.</span><span class="sc">\n</span><span class="st">$ "</span><span class="op">);</span></span>
<span id="cb841-5"><a href="#cb841-5" aria-hidden="true" tabindex="-1"></a>    fflush<span class="op">(</span>stdout<span class="op">);</span></span>
<span id="cb841-6"><a href="#cb841-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb841-7"><a href="#cb841-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb841-8"><a href="#cb841-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb841-9"><a href="#cb841-9" aria-hidden="true" tabindex="-1"></a>    signal<span class="op">(</span>SIGINT<span class="op">,</span> sigint_handler<span class="op">);</span></span>
<span id="cb841-10"><a href="#cb841-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb841-11"><a href="#cb841-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now the shell ignores Ctrl+C while waiting for input, instead of terminating.</p>
</section>
<section id="step-5.-supporting-output-redirection" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-supporting-output-redirection">Step 5. Supporting Output Redirection</h4>
<p>We’ll add <code>&gt;</code> redirection like:</p>
<pre><code>$ echo Hello &gt; out.txt</code></pre>
<p>Add this before the <code>execvp()</code> call in the child:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb843"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb843-1"><a href="#cb843-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fcntl.h&gt;</span></span>
<span id="cb843-2"><a href="#cb843-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb843-3"><a href="#cb843-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> args<span class="op">[</span>j<span class="op">];</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb843-4"><a href="#cb843-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>args<span class="op">[</span>j<span class="op">],</span> <span class="st">"&gt;"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb843-5"><a href="#cb843-5" aria-hidden="true" tabindex="-1"></a>        args<span class="op">[</span>j<span class="op">]</span> <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb843-6"><a href="#cb843-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span>args<span class="op">[</span>j <span class="op">+</span> <span class="dv">1</span><span class="op">],</span> O_WRONLY <span class="op">|</span> O_CREAT <span class="op">|</span> O_TRUNC<span class="op">,</span> <span class="bn">0644</span><span class="op">);</span></span>
<span id="cb843-7"><a href="#cb843-7" aria-hidden="true" tabindex="-1"></a>        dup2<span class="op">(</span>fd<span class="op">,</span> STDOUT_FILENO<span class="op">);</span></span>
<span id="cb843-8"><a href="#cb843-8" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb843-9"><a href="#cb843-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb843-10"><a href="#cb843-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb843-11"><a href="#cb843-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now <code>stdout</code> of the command goes to the file instead of the screen.</p>
</section>
<section id="step-6.-supporting-input-redirection" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-supporting-input-redirection">Step 6. Supporting Input Redirection</h4>
<p>Similarly, for <code>&lt;</code> redirection:</p>
<pre><code>$ cat &lt; in.txt</code></pre>
<p>Add:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb845"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb845-1"><a href="#cb845-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>args<span class="op">[</span>j<span class="op">],</span> <span class="st">"&lt;"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb845-2"><a href="#cb845-2" aria-hidden="true" tabindex="-1"></a>    args<span class="op">[</span>j<span class="op">]</span> <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb845-3"><a href="#cb845-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span>args<span class="op">[</span>j <span class="op">+</span> <span class="dv">1</span><span class="op">],</span> O_RDONLY<span class="op">);</span></span>
<span id="cb845-4"><a href="#cb845-4" aria-hidden="true" tabindex="-1"></a>    dup2<span class="op">(</span>fd<span class="op">,</span> STDIN_FILENO<span class="op">);</span></span>
<span id="cb845-5"><a href="#cb845-5" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb845-6"><a href="#cb845-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span><span class="op">;</span></span>
<span id="cb845-7"><a href="#cb845-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-7.-adding-pipe-support" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-adding-pipe-support">Step 7. Adding Pipe Support</h4>
<p>To handle commands like:</p>
<pre><code>$ ls | wc -l</code></pre>
<p>We create two processes connected by a pipe.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb847"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb847-1"><a href="#cb847-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> pipefd<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb847-2"><a href="#cb847-2" aria-hidden="true" tabindex="-1"></a>pipe<span class="op">(</span>pipefd<span class="op">);</span></span>
<span id="cb847-3"><a href="#cb847-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb847-4"><a href="#cb847-4" aria-hidden="true" tabindex="-1"></a>pid_t p1 <span class="op">=</span> fork<span class="op">();</span></span>
<span id="cb847-5"><a href="#cb847-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>p1 <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb847-6"><a href="#cb847-6" aria-hidden="true" tabindex="-1"></a>    dup2<span class="op">(</span>pipefd<span class="op">[</span><span class="dv">1</span><span class="op">],</span> STDOUT_FILENO<span class="op">);</span></span>
<span id="cb847-7"><a href="#cb847-7" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>pipefd<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb847-8"><a href="#cb847-8" aria-hidden="true" tabindex="-1"></a>    execlp<span class="op">(</span><span class="st">"ls"</span><span class="op">,</span> <span class="st">"ls"</span><span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb847-9"><a href="#cb847-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb847-10"><a href="#cb847-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb847-11"><a href="#cb847-11" aria-hidden="true" tabindex="-1"></a>pid_t p2 <span class="op">=</span> fork<span class="op">();</span></span>
<span id="cb847-12"><a href="#cb847-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>p2 <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb847-13"><a href="#cb847-13" aria-hidden="true" tabindex="-1"></a>    dup2<span class="op">(</span>pipefd<span class="op">[</span><span class="dv">0</span><span class="op">],</span> STDIN_FILENO<span class="op">);</span></span>
<span id="cb847-14"><a href="#cb847-14" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>pipefd<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb847-15"><a href="#cb847-15" aria-hidden="true" tabindex="-1"></a>    execlp<span class="op">(</span><span class="st">"wc"</span><span class="op">,</span> <span class="st">"wc"</span><span class="op">,</span> <span class="st">"-l"</span><span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb847-16"><a href="#cb847-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb847-17"><a href="#cb847-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb847-18"><a href="#cb847-18" aria-hidden="true" tabindex="-1"></a>close<span class="op">(</span>pipefd<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb847-19"><a href="#cb847-19" aria-hidden="true" tabindex="-1"></a>close<span class="op">(</span>pipefd<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb847-20"><a href="#cb847-20" aria-hidden="true" tabindex="-1"></a>wait<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb847-21"><a href="#cb847-21" aria-hidden="true" tabindex="-1"></a>wait<span class="op">(</span>NULL<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>That’s the same pattern you saw in section 64, <code>ls | wc -l</code>.</p>
</section>
<section id="step-8.-combining-all-features" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-combining-all-features">Step 8. Combining All Features</h4>
<p>Your shell now:</p>
<ul>
<li>Parses user input</li>
<li>Spawns child processes</li>
<li>Handles I/O redirection</li>
<li>Supports Ctrl+C interruption</li>
<li>Runs simple pipelines</li>
</ul>
<p>With ~150 lines of code, you have a <strong>working Unix shell prototype</strong>.</p>
</section>
<section id="step-9.-tiny-code-full-mini-shell" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-tiny-code-full-mini-shell">Step 9. Tiny Code: Full Mini Shell</h4>
<p>Here’s the clean, minimal version:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb848"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb848-1"><a href="#cb848-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb848-2"><a href="#cb848-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb848-3"><a href="#cb848-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb848-4"><a href="#cb848-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb848-5"><a href="#cb848-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/wait.h&gt;</span></span>
<span id="cb848-6"><a href="#cb848-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fcntl.h&gt;</span></span>
<span id="cb848-7"><a href="#cb848-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;signal.h&gt;</span></span>
<span id="cb848-8"><a href="#cb848-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-9"><a href="#cb848-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> sigint_handler<span class="op">(</span><span class="dt">int</span> sig<span class="op">)</span> <span class="op">{</span></span>
<span id="cb848-10"><a href="#cb848-10" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">$ "</span><span class="op">);</span></span>
<span id="cb848-11"><a href="#cb848-11" aria-hidden="true" tabindex="-1"></a>    fflush<span class="op">(</span>stdout<span class="op">);</span></span>
<span id="cb848-12"><a href="#cb848-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb848-13"><a href="#cb848-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-14"><a href="#cb848-14" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb848-15"><a href="#cb848-15" aria-hidden="true" tabindex="-1"></a>    signal<span class="op">(</span>SIGINT<span class="op">,</span> sigint_handler<span class="op">);</span></span>
<span id="cb848-16"><a href="#cb848-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> input<span class="op">[</span><span class="dv">1024</span><span class="op">];</span></span>
<span id="cb848-17"><a href="#cb848-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-18"><a href="#cb848-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb848-19"><a href="#cb848-19" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"$ "</span><span class="op">);</span></span>
<span id="cb848-20"><a href="#cb848-20" aria-hidden="true" tabindex="-1"></a>        fflush<span class="op">(</span>stdout<span class="op">);</span></span>
<span id="cb848-21"><a href="#cb848-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>fgets<span class="op">(</span>input<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>input<span class="op">),</span> stdin<span class="op">))</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb848-22"><a href="#cb848-22" aria-hidden="true" tabindex="-1"></a>        input<span class="op">[</span>strcspn<span class="op">(</span>input<span class="op">,</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">)]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb848-23"><a href="#cb848-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>input<span class="op">,</span> <span class="st">"exit"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb848-24"><a href="#cb848-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-25"><a href="#cb848-25" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> <span class="op">*</span>args<span class="op">[</span><span class="dv">64</span><span class="op">];</span></span>
<span id="cb848-26"><a href="#cb848-26" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb848-27"><a href="#cb848-27" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> <span class="op">*</span>token <span class="op">=</span> strtok<span class="op">(</span>input<span class="op">,</span> <span class="st">" "</span><span class="op">);</span></span>
<span id="cb848-28"><a href="#cb848-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span>token<span class="op">)</span> <span class="op">{</span></span>
<span id="cb848-29"><a href="#cb848-29" aria-hidden="true" tabindex="-1"></a>            args<span class="op">[</span>i<span class="op">++]</span> <span class="op">=</span> token<span class="op">;</span></span>
<span id="cb848-30"><a href="#cb848-30" aria-hidden="true" tabindex="-1"></a>            token <span class="op">=</span> strtok<span class="op">(</span>NULL<span class="op">,</span> <span class="st">" "</span><span class="op">);</span></span>
<span id="cb848-31"><a href="#cb848-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb848-32"><a href="#cb848-32" aria-hidden="true" tabindex="-1"></a>        args<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb848-33"><a href="#cb848-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-34"><a href="#cb848-34" aria-hidden="true" tabindex="-1"></a>        pid_t pid <span class="op">=</span> fork<span class="op">();</span></span>
<span id="cb848-35"><a href="#cb848-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>pid <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb848-36"><a href="#cb848-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> args<span class="op">[</span>j<span class="op">];</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb848-37"><a href="#cb848-37" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>args<span class="op">[</span>j<span class="op">],</span> <span class="st">"&gt;"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb848-38"><a href="#cb848-38" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span>args<span class="op">[</span>j <span class="op">+</span> <span class="dv">1</span><span class="op">],</span> O_WRONLY <span class="op">|</span> O_CREAT <span class="op">|</span> O_TRUNC<span class="op">,</span> <span class="bn">0644</span><span class="op">);</span></span>
<span id="cb848-39"><a href="#cb848-39" aria-hidden="true" tabindex="-1"></a>                    dup2<span class="op">(</span>fd<span class="op">,</span> STDOUT_FILENO<span class="op">);</span></span>
<span id="cb848-40"><a href="#cb848-40" aria-hidden="true" tabindex="-1"></a>                    close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb848-41"><a href="#cb848-41" aria-hidden="true" tabindex="-1"></a>                    args<span class="op">[</span>j<span class="op">]</span> <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb848-42"><a href="#cb848-42" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>args<span class="op">[</span>j<span class="op">],</span> <span class="st">"&lt;"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb848-43"><a href="#cb848-43" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">int</span> fd <span class="op">=</span> open<span class="op">(</span>args<span class="op">[</span>j <span class="op">+</span> <span class="dv">1</span><span class="op">],</span> O_RDONLY<span class="op">);</span></span>
<span id="cb848-44"><a href="#cb848-44" aria-hidden="true" tabindex="-1"></a>                    dup2<span class="op">(</span>fd<span class="op">,</span> STDIN_FILENO<span class="op">);</span></span>
<span id="cb848-45"><a href="#cb848-45" aria-hidden="true" tabindex="-1"></a>                    close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb848-46"><a href="#cb848-46" aria-hidden="true" tabindex="-1"></a>                    args<span class="op">[</span>j<span class="op">]</span> <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb848-47"><a href="#cb848-47" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb848-48"><a href="#cb848-48" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb848-49"><a href="#cb848-49" aria-hidden="true" tabindex="-1"></a>            execvp<span class="op">(</span>args<span class="op">[</span><span class="dv">0</span><span class="op">],</span> args<span class="op">);</span></span>
<span id="cb848-50"><a href="#cb848-50" aria-hidden="true" tabindex="-1"></a>            perror<span class="op">(</span><span class="st">"execvp"</span><span class="op">);</span></span>
<span id="cb848-51"><a href="#cb848-51" aria-hidden="true" tabindex="-1"></a>            exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb848-52"><a href="#cb848-52" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>pid <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb848-53"><a href="#cb848-53" aria-hidden="true" tabindex="-1"></a>            wait<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb848-54"><a href="#cb848-54" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb848-55"><a href="#cb848-55" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb848-56"><a href="#cb848-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-57"><a href="#cb848-57" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Exiting shell.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb848-58"><a href="#cb848-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb848-59"><a href="#cb848-59" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Try it out, it’s a real, interactive shell.</p>
</section>
<section id="step-10.-why-it-matters-8" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-why-it-matters-8">Step 10. Why It Matters</h4>
<p>This exercise combines everything you’ve learned in Chapter 7:</p>
<ul>
<li>System calls (<code>fork</code>, <code>exec</code>, <code>wait</code>, <code>pipe</code>, <code>dup2</code>)</li>
<li>Signals (<code>SIGINT</code>)</li>
<li>File descriptors and redirection</li>
<li>Error handling with <code>errno</code></li>
<li>Environment inheritance</li>
</ul>
<p>You’ve just built a simplified version of the core that powers <strong>every Unix shell</strong>, from <code>bash</code> to <code>zsh</code> to <code>fish</code>.</p>
</section>
<section id="try-it-yourself-68" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-68">Try It Yourself</h4>
<ol type="1">
<li>Add support for pipelines (<code>|</code>) by chaining multiple commands.</li>
<li>Implement background processes with <code>&amp;</code>.</li>
<li>Add <code>cd</code> and <code>pwd</code> as built-in commands.</li>
<li>Display the exit code after each command.</li>
<li>Handle multiple spaces and quoted arguments.</li>
</ol>
<p>Next, we’ll move into <strong>Chapter 8: Debugging, Testing, and Profiling</strong>, starting with <strong>gdb</strong>, your most powerful ally in understanding and fixing C programs.</p>
</section>
</section>
</section>
<section id="chapter-8.-debugging-testing-and-profiling" class="level1">
<h1>Chapter 8. Debugging, Testing and Profiling</h1>
<section id="debugging-with-gdb" class="level3">
<h3 class="anchored" data-anchor-id="debugging-with-gdb">71. Debugging with gdb</h3>
<p>Every C programmer eventually meets a segmentation fault, and that’s when you discover your most powerful companion: <strong>gdb</strong>, the GNU Debugger. Debugging isn’t about luck; it’s about learning to inspect a program as it runs, to pause time, and to see what the computer is really doing.</p>
<p>Let’s learn how to use gdb to <strong>find bugs, inspect memory, trace crashes</strong>, and truly understand your code.</p>
<section id="step-1.-compiling-with-debug-information" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-compiling-with-debug-information">Step 1. Compiling with Debug Information</h4>
<p>Before you can debug, you need to tell the compiler to include <strong>symbol information</strong> (variable names, line numbers, etc.). Use the <code>-g</code> flag:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb849"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb849-1"><a href="#cb849-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-g</span> main.c <span class="at">-o</span> main</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You can now open it in gdb:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb850"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb850-1"><a href="#cb850-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gdb</span> ./main</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-2.-starting-and-running-your-program" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-starting-and-running-your-program">Step 2. Starting and Running Your Program</h4>
<p>Inside gdb, you can run your program just like normal:</p>
<pre><code>(gdb) run</code></pre>
<p>If it crashes, you’ll get something like:</p>
<pre><code>Program received signal SIGSEGV, Segmentation fault.
0x000000000040114a in buggy_function () at main.c:12
12        *ptr = 42;</code></pre>
<p>You now know exactly where it failed.</p>
</section>
<section id="step-3.-setting-breakpoints" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-setting-breakpoints">Step 3. Setting Breakpoints</h4>
<p>A <strong>breakpoint</strong> tells gdb to pause before executing a specific line or function.</p>
<pre><code>(gdb) break main
Breakpoint 1 at 0x40113b: file main.c, line 5.
(gdb) run</code></pre>
<p>When the program stops, you can inspect state:</p>
<pre><code>(gdb) print variable_name
(gdb) next
(gdb) step</code></pre>
<ul>
<li><code>next</code> executes the next line (skipping function calls).</li>
<li><code>step</code> goes <em>into</em> a function call.</li>
</ul>
</section>
<section id="step-4.-example-a-simple-bug" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-example-a-simple-bug">Step 4. Example: A Simple Bug</h4>
<p>Here’s a program with a classic segmentation fault.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb855"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb855-1"><a href="#cb855-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb855-2"><a href="#cb855-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb855-3"><a href="#cb855-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> buggy<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb855-4"><a href="#cb855-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb855-5"><a href="#cb855-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>p <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb855-6"><a href="#cb855-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb855-7"><a href="#cb855-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb855-8"><a href="#cb855-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb855-9"><a href="#cb855-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Before crash</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb855-10"><a href="#cb855-10" aria-hidden="true" tabindex="-1"></a>    buggy<span class="op">();</span></span>
<span id="cb855-11"><a href="#cb855-11" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"After crash</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb855-12"><a href="#cb855-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and debug:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb856"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb856-1"><a href="#cb856-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-g</span> bug.c <span class="at">-o</span> bug</span>
<span id="cb856-2"><a href="#cb856-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gdb</span> ./bug</span>
<span id="cb856-3"><a href="#cb856-3" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">run</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Program received signal SIGSEGV, Segmentation fault.
0x0000555555555159 in buggy () at bug.c:5
5        *p = 10;</code></pre>
<p>Now inspect:</p>
<pre><code>(gdb) backtrace
#0 buggy () at bug.c:5
#1 main () at bug.c:10</code></pre>
<p>You’ve just <strong>traced the crash</strong> from main to the exact faulty line.</p>
</section>
<section id="step-5.-inspecting-variables" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-inspecting-variables">Step 5. Inspecting Variables</h4>
<p>You can view variable values anytime:</p>
<pre><code>(gdb) print x
(gdb) print *ptr</code></pre>
<p>You can also modify them:</p>
<pre><code>(gdb) set variable x = 100</code></pre>
<p>To list all local variables:</p>
<pre><code>(gdb) info locals</code></pre>
</section>
<section id="step-6.-navigating-execution" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-navigating-execution">Step 6. Navigating Execution</h4>
<p>Common gdb commands:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Command</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>run</code></td>
<td>Start the program</td>
</tr>
<tr class="even">
<td><code>break N</code></td>
<td>Stop at line N</td>
</tr>
<tr class="odd">
<td><code>next</code></td>
<td>Run next line</td>
</tr>
<tr class="even">
<td><code>step</code></td>
<td>Step into function</td>
</tr>
<tr class="odd">
<td><code>continue</code></td>
<td>Resume until next breakpoint</td>
</tr>
<tr class="even">
<td><code>finish</code></td>
<td>Run until function returns</td>
</tr>
<tr class="odd">
<td><code>backtrace</code></td>
<td>Show call stack</td>
</tr>
<tr class="even">
<td><code>info locals</code></td>
<td>List local vars</td>
</tr>
<tr class="odd">
<td><code>print VAR</code></td>
<td>Show value</td>
</tr>
<tr class="even">
<td><code>quit</code></td>
<td>Exit gdb</td>
</tr>
</tbody>
</table>
</section>
<section id="step-7.-watching-variables" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-watching-variables">Step 7. Watching Variables</h4>
<p>You can set <strong>watchpoints</strong>, gdb stops when a variable changes.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb862"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb862-1"><a href="#cb862-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> counter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb862-2"><a href="#cb862-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb862-3"><a href="#cb862-3" aria-hidden="true" tabindex="-1"></a>    counter <span class="op">+=</span> i<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>In gdb:</p>
<pre><code>(gdb) watch counter
(gdb) run</code></pre>
<p>Every time <code>counter</code> changes, the program pauses, showing where it happened.</p>
</section>
<section id="step-8.-conditional-breakpoints" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-conditional-breakpoints">Step 8. Conditional Breakpoints</h4>
<p>Sometimes you only want to stop under specific conditions:</p>
<pre><code>(gdb) break loop.c:25 if i &gt; 100</code></pre>
<p>This breakpoint triggers only when <code>i</code> exceeds 100.</p>
</section>
<section id="step-9.-inspecting-memory-and-registers" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-inspecting-memory-and-registers">Step 9. Inspecting Memory and Registers</h4>
<p>You can inspect raw memory:</p>
<pre><code>(gdb) x/10x &amp;array</code></pre>
<p>This prints 10 hexadecimal words starting at <code>&amp;array</code>.</p>
<p>Or view registers:</p>
<pre><code>(gdb) info registers</code></pre>
<p>This is useful for low-level debugging (e.g., compilers, OS kernels, embedded code).</p>
</section>
<section id="step-10.-tiny-code-debugging-a-logic-bug" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-debugging-a-logic-bug">Step 10. Tiny Code: Debugging a Logic Bug</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb867"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb867-1"><a href="#cb867-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb867-2"><a href="#cb867-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb867-3"><a href="#cb867-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb867-4"><a href="#cb867-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb867-5"><a href="#cb867-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb867-6"><a href="#cb867-6" aria-hidden="true" tabindex="-1"></a>        sum <span class="op">=</span> sum <span class="op">+</span> i<span class="op">;</span></span>
<span id="cb867-7"><a href="#cb867-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb867-8"><a href="#cb867-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Sum = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> sum<span class="op">);</span> <span class="co">// should be 15</span></span>
<span id="cb867-9"><a href="#cb867-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Introduce a bug:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb868"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb868-1"><a href="#cb868-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++);</span> <span class="co">// extra semicolon!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and debug:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb869"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb869-1"><a href="#cb869-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-g</span> bug.c <span class="at">-o</span> bug</span>
<span id="cb869-2"><a href="#cb869-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gdb</span> ./bug</span>
<span id="cb869-3"><a href="#cb869-3" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="cf">break</span> <span class="ex">main</span></span>
<span id="cb869-4"><a href="#cb869-4" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">run</span></span>
<span id="cb869-5"><a href="#cb869-5" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">print</span> sum</span>
<span id="cb869-6"><a href="#cb869-6" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">next</span></span>
<span id="cb869-7"><a href="#cb869-7" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">print</span> sum</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You’ll see that <code>sum</code> never changes, because the loop body was empty.</p>
</section>
<section id="why-it-matters-59" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-59">Why It Matters</h4>
<p>Debugging is how you <strong>learn to think like the machine</strong>:</p>
<ul>
<li>You can inspect what happens between lines.</li>
<li>You can see every variable’s value.</li>
<li>You can find segmentation faults in seconds.</li>
</ul>
<p>Learning gdb teaches you how C really runs, from stack frames to pointers.</p>
</section>
<section id="try-it-yourself-69" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-69">Try It Yourself</h4>
<ol type="1">
<li>Write a program that crashes (e.g., use a null pointer) and trace the cause with gdb.</li>
<li>Use <code>next</code> and <code>step</code> to trace a recursive function.</li>
<li>Set a watchpoint on a variable in a loop.</li>
<li>Add a conditional breakpoint that triggers only when a value exceeds a limit.</li>
<li>Explore <code>backtrace</code> and <code>info locals</code> after a crash.</li>
</ol>
<p>Next, you’ll learn how to <strong>detect hidden memory errors</strong>, leaks, invalid frees, and buffer overflows, using the indispensable <strong>Valgrind</strong> tool.</p>
</section>
</section>
<section id="using-valgrind-for-memory-checking" class="level3">
<h3 class="anchored" data-anchor-id="using-valgrind-for-memory-checking">72. Using Valgrind for Memory Checking</h3>
<p>If gdb helps you <em>see</em> how your program runs, <strong>Valgrind</strong> helps you <em>see where it leaks</em>. C gives you raw control over memory, and that means you’re responsible for every allocation, deallocation, and pointer access.</p>
<p>Valgrind is your best friend when you need to find:</p>
<ul>
<li>Memory leaks (forgotten <code>free()</code>)</li>
<li>Invalid reads/writes</li>
<li>Double frees</li>
<li>Use-after-free errors</li>
</ul>
<p>Let’s learn how to use it to make your programs solid and leak-free.</p>
<section id="step-1.-installing-valgrind" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-installing-valgrind">Step 1. Installing Valgrind</h4>
<p>On Linux:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb870"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb870-1"><a href="#cb870-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install valgrind</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>On macOS (with Homebrew):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb871"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb871-1"><a href="#cb871-1" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> install valgrind</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile your program <strong>with debug symbols</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb872"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb872-1"><a href="#cb872-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-g</span> memory.c <span class="at">-o</span> memory</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-2.-running-with-valgrind" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-running-with-valgrind">Step 2. Running with Valgrind</h4>
<p>Run your program under Valgrind:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb873"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb873-1"><a href="#cb873-1" aria-hidden="true" tabindex="-1"></a><span class="fu">valgrind</span> ./memory</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Valgrind runs your program inside a virtual CPU and monitors every memory operation. At the end, it prints a detailed report of allocations and leaks.</p>
</section>
<section id="step-3.-a-simple-example" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-a-simple-example">Step 3. A Simple Example</h4>
<p>Here’s a program with two common mistakes: a leak and an invalid free.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb874"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb874-1"><a href="#cb874-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb874-2"><a href="#cb874-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb874-3"><a href="#cb874-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb874-4"><a href="#cb874-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb874-5"><a href="#cb874-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> malloc<span class="op">(</span><span class="dv">10</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb874-6"><a href="#cb874-6" aria-hidden="true" tabindex="-1"></a>    p<span class="op">[</span><span class="dv">10</span><span class="op">]</span> <span class="op">=</span> <span class="dv">42</span><span class="op">;</span>  <span class="co">// invalid write (out of bounds)</span></span>
<span id="cb874-7"><a href="#cb874-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span>    <span class="co">// forgot to free(p)</span></span>
<span id="cb874-8"><a href="#cb874-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb875"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb875-1"><a href="#cb875-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-g</span> mem_bug.c <span class="at">-o</span> mem_bug</span>
<span id="cb875-2"><a href="#cb875-2" aria-hidden="true" tabindex="-1"></a><span class="fu">valgrind</span> ./mem_bug</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>==1234== Invalid write of size 4
==1234==    at 0x1091A: main (mem_bug.c:6)
==1234==  Address 0x5201048 is 0 bytes after a block of size 40 alloc'd
==1234==    at 0x484186F: malloc (vg_replace_malloc.c:380)
==1234==
==1234== HEAP SUMMARY:
==1234==    definitely lost: 40 bytes in 1 blocks
==1234== LEAK SUMMARY:
==1234==    definitely lost: 40 bytes in 1 blocks</code></pre>
<p>Valgrind caught both the invalid access <strong>and</strong> the leak.</p>
</section>
<section id="step-4.-fixing-the-errors" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-fixing-the-errors">Step 4. Fixing the Errors</h4>
<p>Correct version:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb877"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb877-1"><a href="#cb877-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb877-2"><a href="#cb877-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb877-3"><a href="#cb877-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb877-4"><a href="#cb877-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb877-5"><a href="#cb877-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> malloc<span class="op">(</span><span class="dv">10</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb877-6"><a href="#cb877-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>p<span class="op">)</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb877-7"><a href="#cb877-7" aria-hidden="true" tabindex="-1"></a>    p<span class="op">[</span><span class="dv">9</span><span class="op">]</span> <span class="op">=</span> <span class="dv">42</span><span class="op">;</span>   <span class="co">// valid index</span></span>
<span id="cb877-8"><a href="#cb877-8" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>p<span class="op">);</span></span>
<span id="cb877-9"><a href="#cb877-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run again:</p>
<pre><code>valgrind ./mem_bug</code></pre>
<p>Output:</p>
<pre><code>== All heap blocks were freed -- no leaks are possible
== ERROR SUMMARY: 0 errors from 0 contexts</code></pre>
<p>Clean and perfect.</p>
</section>
<section id="step-5.-detecting-use-after-free" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-detecting-use-after-free">Step 5. Detecting Use-After-Free</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb880"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb880-1"><a href="#cb880-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb880-2"><a href="#cb880-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb880-3"><a href="#cb880-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb880-4"><a href="#cb880-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb880-5"><a href="#cb880-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb880-6"><a href="#cb880-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>p <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb880-7"><a href="#cb880-7" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>p<span class="op">);</span></span>
<span id="cb880-8"><a href="#cb880-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span> <span class="co">// using freed memory</span></span>
<span id="cb880-9"><a href="#cb880-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Valgrind says:</p>
<pre><code>==1234== Invalid read of size 4
==1234==    at 0x1091A: main (use_after_free.c:7)
==1234==  Address 0x5201040 is 0 bytes inside a block of size 4 free'd</code></pre>
<p>It even shows <em>where</em> the block was freed.</p>
</section>
<section id="step-6.-detecting-double-free" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-detecting-double-free">Step 6. Detecting Double Free</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb882"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb882-1"><a href="#cb882-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb882-2"><a href="#cb882-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb882-3"><a href="#cb882-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb882-4"><a href="#cb882-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> malloc<span class="op">(</span><span class="dv">4</span><span class="op">);</span></span>
<span id="cb882-5"><a href="#cb882-5" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>p<span class="op">);</span></span>
<span id="cb882-6"><a href="#cb882-6" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>p<span class="op">);</span></span>
<span id="cb882-7"><a href="#cb882-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Valgrind output:</p>
<pre><code>==1234== Invalid free() / delete / delete[]
==1234==    at 0x4845DEF: free (vg_replace_malloc.c:872)
==1234==  Address 0x5201040 was freed previously</code></pre>
</section>
<section id="step-7.-memory-leak-categories" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-memory-leak-categories">Step 7. Memory Leak Categories</h4>
<p>Valgrind divides leaks into categories:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 73%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>definitely lost</strong></td>
<td>No pointer to the block remains, true leak</td>
</tr>
<tr class="even">
<td><strong>indirectly lost</strong></td>
<td>Referenced by a leaked block</td>
</tr>
<tr class="odd">
<td><strong>possibly lost</strong></td>
<td>Pointer may exist but Valgrind can’t confirm</td>
</tr>
<tr class="even">
<td><strong>still reachable</strong></td>
<td>Program ended but memory wasn’t freed (often harmless)</td>
</tr>
</tbody>
</table>
</section>
<section id="step-8.-getting-a-clean-report" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-getting-a-clean-report">Step 8. Getting a Clean Report</h4>
<p>To check for true leaks only:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb884"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb884-1"><a href="#cb884-1" aria-hidden="true" tabindex="-1"></a><span class="fu">valgrind</span> <span class="at">--leak-check</span><span class="op">=</span>full <span class="at">--show-leak-kinds</span><span class="op">=</span>definite ./program</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>For more verbose tracking:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb885"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb885-1"><a href="#cb885-1" aria-hidden="true" tabindex="-1"></a><span class="fu">valgrind</span> <span class="at">--track-origins</span><span class="op">=</span>yes ./program</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>That flag tells you <em>where</em> an uninitialized variable first appeared.</p>
</section>
<section id="step-9.-checking-for-stack-or-uninitialized-values" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-checking-for-stack-or-uninitialized-values">Step 9. Checking for Stack or Uninitialized Values</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb886"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb886-1"><a href="#cb886-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb886-2"><a href="#cb886-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb886-3"><a href="#cb886-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb886-4"><a href="#cb886-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">;</span></span>
<span id="cb886-5"><a href="#cb886-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span> <span class="co">// uninitialized read</span></span>
<span id="cb886-6"><a href="#cb886-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Valgrind output:</p>
<pre><code>==1234== Use of uninitialised value of size 4
==1234==    at 0x1091A: main (uninit.c:5)</code></pre>
<p>Always initialize your variables!</p>
</section>
<section id="step-10.-tiny-code-leak-detector" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-leak-detector">Step 10. Tiny Code: Leak Detector</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb888"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb888-1"><a href="#cb888-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb888-2"><a href="#cb888-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb888-3"><a href="#cb888-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> leak1<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span> malloc<span class="op">(</span><span class="dv">100</span><span class="op">);</span> <span class="op">}</span></span>
<span id="cb888-4"><a href="#cb888-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> leak2<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span> <span class="dt">char</span> <span class="op">*</span>p <span class="op">=</span> malloc<span class="op">(</span><span class="dv">50</span><span class="op">);</span> free<span class="op">(</span>p<span class="op">);</span> <span class="op">}</span></span>
<span id="cb888-5"><a href="#cb888-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb888-6"><a href="#cb888-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb888-7"><a href="#cb888-7" aria-hidden="true" tabindex="-1"></a>    leak1<span class="op">();</span></span>
<span id="cb888-8"><a href="#cb888-8" aria-hidden="true" tabindex="-1"></a>    leak2<span class="op">();</span></span>
<span id="cb888-9"><a href="#cb888-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb889"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb889-1"><a href="#cb889-1" aria-hidden="true" tabindex="-1"></a><span class="fu">valgrind</span> <span class="at">--leak-check</span><span class="op">=</span>full ./leaks</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>==1234== 100 bytes in 1 blocks are definitely lost in loss record 1 of 1
==1234== LEAK SUMMARY:
==1234==    definitely lost: 100 bytes in 1 blocks</code></pre>
<p>Only <code>leak1()</code> forgot to <code>free()</code>, Valgrind pinpointed it exactly.</p>
</section>
<section id="why-it-matters-60" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-60">Why It Matters</h4>
<p>Valgrind helps you:</p>
<ul>
<li>Find hidden memory leaks</li>
<li>Detect invalid pointer usage</li>
<li>Catch uninitialized values</li>
<li>Write safer, cleaner, more reliable C</li>
</ul>
<p>It’s an essential tool in your workflow, especially for long-running programs, servers, or systems software.</p>
</section>
<section id="try-it-yourself-70" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-70">Try It Yourself</h4>
<ol type="1">
<li><p>Write a program that allocates multiple blocks and forgets to free one.</p></li>
<li><p>Intentionally use <code>p[10]</code> on a <code>malloc(10)</code> block.</p></li>
<li><p>Trigger a use-after-free and find it in Valgrind.</p></li>
<li><p>Use <code>--track-origins=yes</code> to trace uninitialized data.</p></li>
<li><p>Refactor your code until Valgrind reports:</p>
<pre><code>All heap blocks were freed -- no leaks are possible</code></pre></li>
</ol>
<p>Next, you’ll explore <strong>Assertions and Defensive Programming</strong>, techniques to catch logic errors <em>before</em> they reach runtime crashes.</p>
</section>
</section>
<section id="assertions-and-defensive-programming" class="level3">
<h3 class="anchored" data-anchor-id="assertions-and-defensive-programming">73. Assertions and Defensive Programming</h3>
<p>Bugs are inevitable, but crashes don’t have to be. C gives you direct power over the machine, which means <strong>you must protect your own assumptions</strong>. That’s where <strong>assertions</strong> and <strong>defensive programming</strong> come in: they help you catch mistakes early, fail fast, and make your code predictable.</p>
<section id="step-1.-what-is-an-assertion" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-is-an-assertion">Step 1. What Is an Assertion?</h4>
<p>An <strong>assertion</strong> is a sanity check built into your code. It tests whether something you believe to be true <em>actually is</em>. If not, the program immediately stops with an error message, before things get worse.</p>
<p>Include the header:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb892"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb892-1"><a href="#cb892-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;assert.h&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb893"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb893-1"><a href="#cb893-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> divide<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb893-2"><a href="#cb893-2" aria-hidden="true" tabindex="-1"></a>    assert<span class="op">(</span>b <span class="op">!=</span> <span class="dv">0</span><span class="op">);</span>  <span class="co">// ensure no division by zero</span></span>
<span id="cb893-3"><a href="#cb893-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">/</span> b<span class="op">;</span></span>
<span id="cb893-4"><a href="#cb893-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If <code>b</code> is zero, the program aborts:</p>
<pre><code>Assertion failed: (b != 0), function divide, file main.c, line 3.</code></pre>
</section>
<section id="step-2.-how-assertions-work" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-how-assertions-work">Step 2. How Assertions Work</h4>
<p><code>assert(expression)</code> expands to something like:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb895"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb895-1"><a href="#cb895-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!(</span>expression<span class="op">))</span> <span class="op">{</span></span>
<span id="cb895-2"><a href="#cb895-2" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Assertion failed: </span><span class="sc">%s</span><span class="st">, file </span><span class="sc">%s</span><span class="st">, line </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span></span>
<span id="cb895-3"><a href="#cb895-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"expression"</span><span class="op">,</span> __FILE__<span class="op">,</span> __LINE__<span class="op">);</span></span>
<span id="cb895-4"><a href="#cb895-4" aria-hidden="true" tabindex="-1"></a>    abort<span class="op">();</span></span>
<span id="cb895-5"><a href="#cb895-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>When compiled normally, it checks the condition. When compiled with <code>-DNDEBUG</code>, assertions are disabled.</p>
</section>
<section id="step-3.-enabling-or-disabling-assertions" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-enabling-or-disabling-assertions">Step 3. Enabling or Disabling Assertions</h4>
<p>Default: assertions are active. To disable them (for production builds):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb896"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb896-1"><a href="#cb896-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-DNDEBUG</span> program.c <span class="at">-o</span> program</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>In that build, <code>assert()</code> statements are removed.</p>
<p>This lets you keep your debug checks without slowing down release binaries.</p>
</section>
<section id="step-4.-practical-example" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-practical-example">Step 4. Practical Example</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb897"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb897-1"><a href="#cb897-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;assert.h&gt;</span></span>
<span id="cb897-2"><a href="#cb897-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb897-3"><a href="#cb897-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb897-4"><a href="#cb897-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> find_max<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>arr<span class="op">,</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb897-5"><a href="#cb897-5" aria-hidden="true" tabindex="-1"></a>    assert<span class="op">(</span>arr <span class="op">!=</span> NULL<span class="op">);</span></span>
<span id="cb897-6"><a href="#cb897-6" aria-hidden="true" tabindex="-1"></a>    assert<span class="op">(</span>n <span class="op">&gt;</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb897-7"><a href="#cb897-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> max <span class="op">=</span> arr<span class="op">[</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb897-8"><a href="#cb897-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb897-9"><a href="#cb897-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>arr<span class="op">[</span>i<span class="op">]</span> <span class="op">&gt;</span> max<span class="op">)</span> max <span class="op">=</span> arr<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb897-10"><a href="#cb897-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> max<span class="op">;</span></span>
<span id="cb897-11"><a href="#cb897-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb897-12"><a href="#cb897-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb897-13"><a href="#cb897-13" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb897-14"><a href="#cb897-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> data<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">3</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">8</span><span class="op">};</span></span>
<span id="cb897-15"><a href="#cb897-15" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Max: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> find_max<span class="op">(</span>data<span class="op">,</span> <span class="dv">5</span><span class="op">));</span></span>
<span id="cb897-16"><a href="#cb897-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If you pass a <code>NULL</code> pointer or invalid length, the program fails immediately.</p>
</section>
<section id="step-5.-writing-good-assertions" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-writing-good-assertions">Step 5. Writing Good Assertions</h4>
<p>Assertions should test <em>internal assumptions</em>, not user input. Bad:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb898"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb898-1"><a href="#cb898-1" aria-hidden="true" tabindex="-1"></a>assert<span class="op">(</span>argc <span class="op">==</span> <span class="dv">3</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Good:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb899"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb899-1"><a href="#cb899-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>argc <span class="op">!=</span> <span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb899-2"><a href="#cb899-2" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Usage: </span><span class="sc">%s</span><span class="st"> input output</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb899-3"><a href="#cb899-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb899-4"><a href="#cb899-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Use assertions to check invariants inside your logic, things that <em>should never happen</em> unless there’s a bug.</p>
</section>
<section id="step-6.-defensive-programming-techniques" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-defensive-programming-techniques">Step 6. Defensive Programming Techniques</h4>
<p>Defensive programming goes beyond assertions, it’s about <strong>writing code that assumes mistakes will happen</strong>.</p>
<p><strong>Check every function return value:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb900"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb900-1"><a href="#cb900-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> <span class="op">*</span>f <span class="op">=</span> fopen<span class="op">(</span><span class="st">"file.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb900-2"><a href="#cb900-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span>f<span class="op">)</span> <span class="op">{</span></span>
<span id="cb900-3"><a href="#cb900-3" aria-hidden="true" tabindex="-1"></a>    perror<span class="op">(</span><span class="st">"fopen"</span><span class="op">);</span></span>
<span id="cb900-4"><a href="#cb900-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb900-5"><a href="#cb900-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Validate inputs:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb901"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb901-1"><a href="#cb901-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> divide<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb901-2"><a href="#cb901-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>b <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb901-3"><a href="#cb901-3" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Division by zero!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb901-4"><a href="#cb901-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb901-5"><a href="#cb901-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb901-6"><a href="#cb901-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">/</span> b<span class="op">;</span></span>
<span id="cb901-7"><a href="#cb901-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Avoid undefined behavior:</strong></p>
<ul>
<li>Initialize all variables.</li>
<li>Don’t access freed memory.</li>
<li>Check array bounds.</li>
<li>Always match <code>malloc()</code> with <code>free()</code>.</li>
</ul>
</section>
<section id="step-7.-assertions-in-complex-systems" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-assertions-in-complex-systems">Step 7. Assertions in Complex Systems</h4>
<p>In large programs, assertions act like <em>tripwires</em> to detect when state becomes inconsistent.</p>
<p>Example: a queue</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb902"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb902-1"><a href="#cb902-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;assert.h&gt;</span></span>
<span id="cb902-2"><a href="#cb902-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb902-3"><a href="#cb902-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> enqueue<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>queue<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>count<span class="op">,</span> <span class="dt">int</span> value<span class="op">,</span> <span class="dt">int</span> max<span class="op">)</span> <span class="op">{</span></span>
<span id="cb902-4"><a href="#cb902-4" aria-hidden="true" tabindex="-1"></a>    assert<span class="op">(*</span>count <span class="op">&lt;</span> max<span class="op">);</span></span>
<span id="cb902-5"><a href="#cb902-5" aria-hidden="true" tabindex="-1"></a>    queue<span class="op">[*</span>count<span class="op">]</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb902-6"><a href="#cb902-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">(*</span>count<span class="op">)++;</span></span>
<span id="cb902-7"><a href="#cb902-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If something goes wrong in your logic, the assertion will tell you immediately, before memory corruption happens.</p>
</section>
<section id="step-8.-logging-vs-assertions" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-logging-vs-assertions">Step 8. Logging vs Assertions</h4>
<ul>
<li><strong>Assertions</strong>: catch programming errors.</li>
<li><strong>Logging</strong>: record runtime information.</li>
</ul>
<p>Combine both:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb903"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb903-1"><a href="#cb903-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;assert.h&gt;</span></span>
<span id="cb903-2"><a href="#cb903-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb903-3"><a href="#cb903-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb903-4"><a href="#cb903-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> read_value<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>arr<span class="op">,</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> index<span class="op">)</span> <span class="op">{</span></span>
<span id="cb903-5"><a href="#cb903-5" aria-hidden="true" tabindex="-1"></a>    assert<span class="op">(</span>index <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> index <span class="op">&lt;</span> n<span class="op">);</span></span>
<span id="cb903-6"><a href="#cb903-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Reading arr[</span><span class="sc">%d</span><span class="st">] = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> index<span class="op">,</span> arr<span class="op">[</span>index<span class="op">]);</span></span>
<span id="cb903-7"><a href="#cb903-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> arr<span class="op">[</span>index<span class="op">];</span></span>
<span id="cb903-8"><a href="#cb903-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-9.-using-static_assert-for-compile-time-checks-c11" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-using-static_assert-for-compile-time-checks-c11">Step 9. Using <code>static_assert</code> for Compile-Time Checks (C11+)</h4>
<p>C11 introduced <code>_Static_assert</code>, which checks conditions <strong>during compilation</strong>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb904"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb904-1"><a href="#cb904-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;assert.h&gt;</span></span>
<span id="cb904-2"><a href="#cb904-2" aria-hidden="true" tabindex="-1"></a><span class="kw">_Static_assert</span><span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">)</span> <span class="op">==</span> <span class="dv">4</span><span class="op">,</span> <span class="st">"int must be 4 bytes"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If the condition fails, the compiler stops with:</p>
<pre><code>error: static assertion failed: "int must be 4 bytes"</code></pre>
<p>This is perfect for configuration or architecture assumptions.</p>
</section>
<section id="step-10.-tiny-code-safe-array-access" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-safe-array-access">Step 10. Tiny Code: Safe Array Access</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb906"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb906-1"><a href="#cb906-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;assert.h&gt;</span></span>
<span id="cb906-2"><a href="#cb906-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb906-3"><a href="#cb906-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb906-4"><a href="#cb906-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAX </span><span class="dv">5</span></span>
<span id="cb906-5"><a href="#cb906-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb906-6"><a href="#cb906-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> safe_get<span class="op">(</span><span class="dt">int</span> arr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb906-7"><a href="#cb906-7" aria-hidden="true" tabindex="-1"></a>    assert<span class="op">(</span>i <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> n<span class="op">);</span></span>
<span id="cb906-8"><a href="#cb906-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> arr<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb906-9"><a href="#cb906-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb906-10"><a href="#cb906-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb906-11"><a href="#cb906-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb906-12"><a href="#cb906-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> nums<span class="op">[</span>MAX<span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">};</span></span>
<span id="cb906-13"><a href="#cb906-13" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> safe_get<span class="op">(</span>nums<span class="op">,</span> MAX<span class="op">,</span> <span class="dv">2</span><span class="op">));</span>  <span class="co">// OK</span></span>
<span id="cb906-14"><a href="#cb906-14" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> safe_get<span class="op">(</span>nums<span class="op">,</span> MAX<span class="op">,</span> <span class="dv">10</span><span class="op">));</span> <span class="co">// triggers assertion</span></span>
<span id="cb906-15"><a href="#cb906-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Assertion failed: (i &gt;= 0 &amp;&amp; i &lt; n), function safe_get, file main.c, line 7.</code></pre>
</section>
<section id="why-it-matters-61" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-61">Why It Matters</h4>
<p>Assertions and defensive coding make your software:</p>
<ul>
<li><strong>Safer</strong>, catch bugs early.</li>
<li><strong>Easier to debug</strong>, fail at the source, not later.</li>
<li><strong>More maintainable</strong>, documents assumptions clearly.</li>
</ul>
<p>In C, a single bad pointer can crash your system. Assertions are your safety net.</p>
</section>
<section id="try-it-yourself-71" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-71">Try It Yourself</h4>
<ol type="1">
<li>Add assertions to your stack or linked list implementation.</li>
<li>Write a function that validates all arguments before proceeding.</li>
<li>Use <code>_Static_assert</code> to check type sizes in a cross-platform program.</li>
<li>Combine assertions with logging for detailed error reports.</li>
<li>Run your program with invalid input and see how quickly assertions detect issues.</li>
</ol>
<p>Next, you’ll move into <strong>unit testing in C</strong>, building small, automated tests to ensure every function works exactly as intended.</p>
</section>
</section>
<section id="unit-testing-in-c" class="level3">
<h3 class="anchored" data-anchor-id="unit-testing-in-c">74. Unit Testing in C</h3>
<p>Testing isn’t just something you do at the end, it’s how you <strong>build confidence</strong> in every line of code. Unit testing means checking small, isolated pieces (functions, modules) automatically, so you can change your code without fear.</p>
<p>C doesn’t come with a built-in testing framework, but it’s easy to build lightweight ones, and several excellent libraries exist if you want more power.</p>
<p>Let’s walk through how to design and run <strong>unit tests in plain C</strong>.</p>
<section id="step-1.-what-is-unit-testing" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-is-unit-testing">Step 1. What Is Unit Testing?</h4>
<p>A <em>unit test</em> verifies a single behavior:</p>
<blockquote class="blockquote">
<p>Given an input, does this function produce the correct output?</p>
</blockquote>
<p>For example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb908"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb908-1"><a href="#cb908-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb908-2"><a href="#cb908-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb908-3"><a href="#cb908-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> test_add<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb908-4"><a href="#cb908-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>add<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">)</span> <span class="op">!=</span> <span class="dv">5</span><span class="op">)</span> printf<span class="op">(</span><span class="st">"test_add failed!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb908-5"><a href="#cb908-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> printf<span class="op">(</span><span class="st">"test_add passed!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb908-6"><a href="#cb908-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run this test:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb909"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb909-1"><a href="#cb909-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb909-2"><a href="#cb909-2" aria-hidden="true" tabindex="-1"></a>    test_add<span class="op">();</span></span>
<span id="cb909-3"><a href="#cb909-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>test_add passed!</code></pre>
<p>Simple, but powerful.</p>
</section>
<section id="step-2.-organizing-tests" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-organizing-tests">Step 2. Organizing Tests</h4>
<p>Keep tests separate from production code. A typical layout:</p>
<pre><code>src/
  math.c
  math.h
tests/
  test_math.c
Makefile</code></pre>
<p>Your Makefile might build both:</p>
<pre class="make"><code>all:
    gcc -g -Wall -I../src ../src/math.c test_math.c -o test_math</code></pre>
</section>
<section id="step-3.-writing-reusable-test-helpers" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-writing-reusable-test-helpers">Step 3. Writing Reusable Test Helpers</h4>
<p>Define macros to simplify your checks.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb913"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb913-1"><a href="#cb913-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb913-2"><a href="#cb913-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb913-3"><a href="#cb913-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define ASSERT_EQ_INT</span><span class="op">(</span><span class="pp">expected</span><span class="op">,</span><span class="pp"> actual</span><span class="op">)</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb913-4"><a href="#cb913-4" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="cf">if</span><span class="pp"> </span><span class="op">((</span><span class="pp">expected</span><span class="op">)</span><span class="pp"> </span><span class="op">!=</span><span class="pp"> </span><span class="op">(</span><span class="pp">actual</span><span class="op">))</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb913-5"><a href="#cb913-5" aria-hidden="true" tabindex="-1"></a><span class="pp">        printf</span><span class="op">(</span><span class="st">"FAIL: </span><span class="sc">%s</span><span class="st">:</span><span class="sc">%d</span><span class="st">: expected </span><span class="sc">%d</span><span class="st">, got </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> __FILE__</span><span class="op">,</span><span class="pp"> __LINE__</span><span class="op">,</span><span class="pp"> </span><span class="op">(</span><span class="pp">expected</span><span class="op">),</span><span class="pp"> </span><span class="op">(</span><span class="pp">actual</span><span class="op">));</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb913-6"><a href="#cb913-6" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="cf">else</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb913-7"><a href="#cb913-7" aria-hidden="true" tabindex="-1"></a><span class="pp">        printf</span><span class="op">(</span><span class="st">"PASS: </span><span class="sc">%s</span><span class="st">:</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> __FILE__</span><span class="op">,</span><span class="pp"> __LINE__</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb914"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb914-1"><a href="#cb914-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb914-2"><a href="#cb914-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb914-3"><a href="#cb914-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> test_add<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb914-4"><a href="#cb914-4" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ_INT<span class="op">(</span><span class="dv">5</span><span class="op">,</span> add<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">));</span></span>
<span id="cb914-5"><a href="#cb914-5" aria-hidden="true" tabindex="-1"></a>    ASSERT_EQ_INT<span class="op">(</span><span class="dv">0</span><span class="op">,</span> add<span class="op">(-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb914-6"><a href="#cb914-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb914-7"><a href="#cb914-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb914-8"><a href="#cb914-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span> test_add<span class="op">();</span> <span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>PASS: test_math.c:10
PASS: test_math.c:11</code></pre>
</section>
<section id="step-4.-testing-multiple-functions" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-testing-multiple-functions">Step 4. Testing Multiple Functions</h4>
<p>Add more test functions and call them in sequence:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb916"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb916-1"><a href="#cb916-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> test_subtract<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span> ASSERT_EQ_INT<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span> <span class="op">-</span> <span class="dv">2</span><span class="op">);</span> <span class="op">}</span></span>
<span id="cb916-2"><a href="#cb916-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb916-3"><a href="#cb916-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb916-4"><a href="#cb916-4" aria-hidden="true" tabindex="-1"></a>    test_add<span class="op">();</span></span>
<span id="cb916-5"><a href="#cb916-5" aria-hidden="true" tabindex="-1"></a>    test_subtract<span class="op">();</span></span>
<span id="cb916-6"><a href="#cb916-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now your program automatically verifies both functions.</p>
</section>
<section id="step-5.-handling-floating-point-comparisons" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-handling-floating-point-comparisons">Step 5. Handling Floating-Point Comparisons</h4>
<p>Floating-point values rarely match exactly, use a tolerance.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb917"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb917-1"><a href="#cb917-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;math.h&gt;</span></span>
<span id="cb917-2"><a href="#cb917-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define ASSERT_EQ_FLOAT</span><span class="op">(</span><span class="pp">expected</span><span class="op">,</span><span class="pp"> actual</span><span class="op">,</span><span class="pp"> eps</span><span class="op">)</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb917-3"><a href="#cb917-3" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span><span class="pp">fabs</span><span class="op">((</span><span class="pp">expected</span><span class="op">)</span><span class="pp"> </span><span class="op">-</span><span class="pp"> </span><span class="op">(</span><span class="pp">actual</span><span class="op">))</span><span class="pp"> </span><span class="op">&gt;</span><span class="pp"> </span><span class="op">(</span><span class="pp">eps</span><span class="op">))</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb917-4"><a href="#cb917-4" aria-hidden="true" tabindex="-1"></a><span class="pp">        printf</span><span class="op">(</span><span class="st">"FAIL: expected </span><span class="sc">%.3f</span><span class="st">, got </span><span class="sc">%.3f\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> </span><span class="op">(</span><span class="pp">expected</span><span class="op">),</span><span class="pp"> </span><span class="op">(</span><span class="pp">actual</span><span class="op">));</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb917-5"><a href="#cb917-5" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="cf">else</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb917-6"><a href="#cb917-6" aria-hidden="true" tabindex="-1"></a><span class="pp">        printf</span><span class="op">(</span><span class="st">"PASS</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-6.-using-return-codes-to-mark-failures" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-using-return-codes-to-mark-failures">Step 6. Using Return Codes to Mark Failures</h4>
<p>Instead of just printing results, you can make the test binary return <code>EXIT_FAILURE</code> if any test fails.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb918"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb918-1"><a href="#cb918-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> fails <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb918-2"><a href="#cb918-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define TEST</span><span class="op">(</span><span class="pp">cond</span><span class="op">)</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb918-3"><a href="#cb918-3" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="cf">do</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="cf">if</span><span class="pp"> </span><span class="op">(!(</span><span class="pp">cond</span><span class="op">))</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb918-4"><a href="#cb918-4" aria-hidden="true" tabindex="-1"></a><span class="pp">        printf</span><span class="op">(</span><span class="st">"FAIL: </span><span class="sc">%s</span><span class="st">:</span><span class="sc">%d</span><span class="st">: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> __FILE__</span><span class="op">,</span><span class="pp"> __LINE__</span><span class="op">,</span><span class="pp"> </span><span class="op">#</span><span class="pp">cond</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb918-5"><a href="#cb918-5" aria-hidden="true" tabindex="-1"></a><span class="pp">        fails</span><span class="op">++;</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb918-6"><a href="#cb918-6" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb918-7"><a href="#cb918-7" aria-hidden="true" tabindex="-1"></a><span class="pp">        printf</span><span class="op">(</span><span class="st">"PASS: </span><span class="sc">%s</span><span class="st">:</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> __FILE__</span><span class="op">,</span><span class="pp"> __LINE__</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb918-8"><a href="#cb918-8" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span><span class="pp"> </span><span class="op">}</span><span class="pp"> </span><span class="cf">while</span><span class="pp"> </span><span class="op">(</span><span class="dv">0</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>At the end:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb919"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb919-1"><a href="#cb919-1" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> fails <span class="op">?</span> EXIT_FAILURE <span class="op">:</span> EXIT_SUCCESS<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now your CI or shell can detect test results via <code>$?</code>.</p>
</section>
<section id="step-7.-minimal-testing-framework-tinytest" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-minimal-testing-framework-tinytest">Step 7. Minimal Testing Framework: TinyTest</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb920"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb920-1"><a href="#cb920-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb920-2"><a href="#cb920-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb920-3"><a href="#cb920-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-4"><a href="#cb920-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> tests_run <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> tests_failed <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb920-5"><a href="#cb920-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-6"><a href="#cb920-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#define TEST</span><span class="op">(</span><span class="pp">name</span><span class="op">)</span><span class="pp"> </span><span class="dt">void</span><span class="pp"> name</span><span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb920-7"><a href="#cb920-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#define RUN</span><span class="op">(</span><span class="pp">test</span><span class="op">)</span><span class="pp"> </span><span class="cf">do</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb920-8"><a href="#cb920-8" aria-hidden="true" tabindex="-1"></a><span class="pp">    printf</span><span class="op">(</span><span class="st">"Running </span><span class="sc">%s</span><span class="st">... "</span><span class="op">,</span><span class="pp"> </span><span class="op">#</span><span class="pp">test</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb920-9"><a href="#cb920-9" aria-hidden="true" tabindex="-1"></a><span class="pp">    test</span><span class="op">();</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb920-10"><a href="#cb920-10" aria-hidden="true" tabindex="-1"></a><span class="pp">    tests_run</span><span class="op">++;</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb920-11"><a href="#cb920-11" aria-hidden="true" tabindex="-1"></a><span class="pp">    printf</span><span class="op">(</span><span class="st">"OK</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb920-12"><a href="#cb920-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span class="pp"> </span><span class="cf">while</span><span class="op">(</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb920-13"><a href="#cb920-13" aria-hidden="true" tabindex="-1"></a><span class="pp">#define ASSERT_TRUE</span><span class="op">(</span><span class="pp">cond</span><span class="op">)</span><span class="pp"> </span><span class="cf">if</span><span class="pp"> </span><span class="op">(!(</span><span class="pp">cond</span><span class="op">))</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb920-14"><a href="#cb920-14" aria-hidden="true" tabindex="-1"></a><span class="pp">    printf</span><span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">  Assertion failed: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> </span><span class="op">#</span><span class="pp">cond</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb920-15"><a href="#cb920-15" aria-hidden="true" tabindex="-1"></a><span class="pp">    tests_failed</span><span class="op">++;</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb920-16"><a href="#cb920-16" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="cf">return</span><span class="op">;</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb920-17"><a href="#cb920-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb920-18"><a href="#cb920-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-19"><a href="#cb920-19" aria-hidden="true" tabindex="-1"></a>TEST<span class="op">(</span>test_addition<span class="op">)</span> <span class="op">{</span></span>
<span id="cb920-20"><a href="#cb920-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> sum <span class="op">=</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb920-21"><a href="#cb920-21" aria-hidden="true" tabindex="-1"></a>    ASSERT_TRUE<span class="op">(</span>sum <span class="op">==</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb920-22"><a href="#cb920-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb920-23"><a href="#cb920-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb920-24"><a href="#cb920-24" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb920-25"><a href="#cb920-25" aria-hidden="true" tabindex="-1"></a>    RUN<span class="op">(</span>test_addition<span class="op">);</span></span>
<span id="cb920-26"><a href="#cb920-26" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Tests run: </span><span class="sc">%d</span><span class="st">, failed: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> tests_run<span class="op">,</span> tests_failed<span class="op">);</span></span>
<span id="cb920-27"><a href="#cb920-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tests_failed <span class="op">?</span> EXIT_FAILURE <span class="op">:</span> EXIT_SUCCESS<span class="op">;</span></span>
<span id="cb920-28"><a href="#cb920-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Running test_addition... OK

Tests run: 1, failed: 0</code></pre>
</section>
<section id="step-8.-using-real-testing-libraries" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-using-real-testing-libraries">Step 8. Using Real Testing Libraries</h4>
<p>When your project grows, you can use frameworks like:</p>
<ul>
<li><strong>Check</strong> (POSIX-compliant)</li>
<li><strong>Unity</strong> (embedded-friendly)</li>
<li><strong>CMocka</strong></li>
<li><strong>Criterion</strong></li>
</ul>
<p>Example with <em>Check</em>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb922"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb922-1"><a href="#cb922-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install check</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb923"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb923-1"><a href="#cb923-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;check.h&gt;</span></span>
<span id="cb923-2"><a href="#cb923-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb923-3"><a href="#cb923-3" aria-hidden="true" tabindex="-1"></a>START_TEST<span class="op">(</span>test_add<span class="op">)</span></span>
<span id="cb923-4"><a href="#cb923-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb923-5"><a href="#cb923-5" aria-hidden="true" tabindex="-1"></a>    ck_assert_int_eq<span class="op">(</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb923-6"><a href="#cb923-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb923-7"><a href="#cb923-7" aria-hidden="true" tabindex="-1"></a>END_TEST</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then compile with:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb924"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb924-1"><a href="#cb924-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> test.c <span class="at">-lcheck</span> <span class="at">-o</span> test</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-9.-automating-tests-with-makefile" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-automating-tests-with-makefile">Step 9. Automating Tests with Makefile</h4>
<p>Add a test target:</p>
<pre class="make"><code>test:
    gcc -Wall -g src/*.c tests/*.c -o tests/run_tests
    ./tests/run_tests</code></pre>
<p>Now you can just run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb926"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb926-1"><a href="#cb926-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> test</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>and see your full suite’s results.</p>
</section>
<section id="step-10.-tiny-code-testing-a-linked-list" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-testing-a-linked-list">Step 10. Tiny Code: Testing a Linked List</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb927"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb927-1"><a href="#cb927-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb927-2"><a href="#cb927-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb927-3"><a href="#cb927-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;assert.h&gt;</span></span>
<span id="cb927-4"><a href="#cb927-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb927-5"><a href="#cb927-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb927-6"><a href="#cb927-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> value<span class="op">;</span></span>
<span id="cb927-7"><a href="#cb927-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>next<span class="op">;</span></span>
<span id="cb927-8"><a href="#cb927-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb927-9"><a href="#cb927-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb927-10"><a href="#cb927-10" aria-hidden="true" tabindex="-1"></a>Node <span class="op">*</span>push<span class="op">(</span>Node <span class="op">*</span>head<span class="op">,</span> <span class="dt">int</span> val<span class="op">)</span> <span class="op">{</span></span>
<span id="cb927-11"><a href="#cb927-11" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>n <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb927-12"><a href="#cb927-12" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>value <span class="op">=</span> val<span class="op">;</span></span>
<span id="cb927-13"><a href="#cb927-13" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>next <span class="op">=</span> head<span class="op">;</span></span>
<span id="cb927-14"><a href="#cb927-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb927-15"><a href="#cb927-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb927-16"><a href="#cb927-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb927-17"><a href="#cb927-17" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> test_push<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb927-18"><a href="#cb927-18" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>head <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb927-19"><a href="#cb927-19" aria-hidden="true" tabindex="-1"></a>    head <span class="op">=</span> push<span class="op">(</span>head<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb927-20"><a href="#cb927-20" aria-hidden="true" tabindex="-1"></a>    head <span class="op">=</span> push<span class="op">(</span>head<span class="op">,</span> <span class="dv">20</span><span class="op">);</span></span>
<span id="cb927-21"><a href="#cb927-21" aria-hidden="true" tabindex="-1"></a>    assert<span class="op">(</span>head<span class="op">-&gt;</span>value <span class="op">==</span> <span class="dv">20</span><span class="op">);</span></span>
<span id="cb927-22"><a href="#cb927-22" aria-hidden="true" tabindex="-1"></a>    assert<span class="op">(</span>head<span class="op">-&gt;</span>next<span class="op">-&gt;</span>value <span class="op">==</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb927-23"><a href="#cb927-23" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"test_push passed</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb927-24"><a href="#cb927-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb927-25"><a href="#cb927-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb927-26"><a href="#cb927-26" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb927-27"><a href="#cb927-27" aria-hidden="true" tabindex="-1"></a>    test_push<span class="op">();</span></span>
<span id="cb927-28"><a href="#cb927-28" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"All tests passed.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb927-29"><a href="#cb927-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>test_push passed
All tests passed.</code></pre>
</section>
<section id="why-it-matters-62" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-62">Why It Matters</h4>
<p>Unit testing turns code into <strong>verifiable logic</strong>:</p>
<ul>
<li>Prevents regressions.</li>
<li>Encourages small, clean functions.</li>
<li>Makes debugging faster.</li>
<li>Builds confidence before refactoring.</li>
</ul>
<p>When you trust your tests, you can rewrite your code fearlessly.</p>
</section>
<section id="try-it-yourself-72" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-72">Try It Yourself</h4>
<ol type="1">
<li>Write a test suite for your dynamic array implementation.</li>
<li>Add <code>ASSERT_EQ_FLOAT</code> and <code>ASSERT_EQ_STR</code> macros.</li>
<li>Automate tests using <code>make test</code>.</li>
<li>Add a <code>fails</code> counter and colorize your results.</li>
<li>Use a testing library like <em>Criterion</em> or <em>Unity</em> and compare styles.</li>
</ol>
<p>Next, you’ll learn how to <strong>add logging systems</strong> to your C programs, to record what’s happening under the hood in a controlled, readable way.</p>
</section>
</section>
<section id="logging-systems" class="level3">
<h3 class="anchored" data-anchor-id="logging-systems">75. Logging Systems</h3>
<p>As your programs grow, <strong>printf debugging</strong> quickly becomes messy. You need a way to <em>see inside your program</em>, what it’s doing, what went wrong, and why, without flooding your terminal with random messages.</p>
<p>That’s where <strong>logging systems</strong> come in. A good log system helps you trace execution, record errors, and understand how your program behaves over time.</p>
<section id="step-1.-what-is-logging" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-is-logging">Step 1. What Is Logging?</h4>
<p>Logging is like keeping a diary for your program. Instead of printing everything to the screen, you log structured messages with <strong>levels</strong> (INFO, WARN, ERROR) and <strong>timestamps</strong>.</p>
<p>It’s essential for:</p>
<ul>
<li>Debugging complex flows.</li>
<li>Auditing events and errors.</li>
<li>Monitoring long-running services.</li>
<li>Diagnosing crashes and performance issues.</li>
</ul>
</section>
<section id="step-2.-the-simplest-logger-printf-with-context" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-the-simplest-logger-printf-with-context">Step 2. The Simplest Logger, printf with Context</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb929"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb929-1"><a href="#cb929-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb929-2"><a href="#cb929-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb929-3"><a href="#cb929-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb929-4"><a href="#cb929-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"[INFO] Starting program</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb929-5"><a href="#cb929-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"[WARN] Low memory</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb929-6"><a href="#cb929-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"[ERROR] Failed to open file</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb929-7"><a href="#cb929-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This works, but there’s no timestamp, file name, or severity control.</p>
</section>
<section id="step-3.-adding-log-levels-and-macros" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-adding-log-levels-and-macros">Step 3. Adding Log Levels and Macros</h4>
<p>We can make this structured and reusable using macros.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb930"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb930-1"><a href="#cb930-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb930-2"><a href="#cb930-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb930-3"><a href="#cb930-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb930-4"><a href="#cb930-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define LOG</span><span class="op">(</span><span class="pp">level</span><span class="op">,</span><span class="pp"> msg</span><span class="op">,</span><span class="pp"> </span><span class="op">...)</span><span class="pp"> </span><span class="cf">do</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb930-5"><a href="#cb930-5" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">time_t</span><span class="pp"> t </span><span class="op">=</span><span class="pp"> time</span><span class="op">(</span><span class="pp">NULL</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb930-6"><a href="#cb930-6" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="kw">struct</span><span class="pp"> tm </span><span class="op">*</span><span class="pp">tm_info </span><span class="op">=</span><span class="pp"> localtime</span><span class="op">(&amp;</span><span class="pp">t</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb930-7"><a href="#cb930-7" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">char</span><span class="pp"> buf</span><span class="op">[</span><span class="dv">20</span><span class="op">];</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb930-8"><a href="#cb930-8" aria-hidden="true" tabindex="-1"></a><span class="pp">    strftime</span><span class="op">(</span><span class="pp">buf</span><span class="op">,</span><span class="pp"> </span><span class="dv">20</span><span class="op">,</span><span class="pp"> </span><span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S"</span><span class="op">,</span><span class="pp"> tm_info</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb930-9"><a href="#cb930-9" aria-hidden="true" tabindex="-1"></a><span class="pp">    fprintf</span><span class="op">(</span><span class="pp">stderr</span><span class="op">,</span><span class="pp"> </span><span class="st">"[</span><span class="sc">%s</span><span class="st">] [</span><span class="sc">%s</span><span class="st">] "</span><span class="pp"> msg </span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> buf</span><span class="op">,</span><span class="pp"> level</span><span class="op">,</span><span class="pp"> </span><span class="op">##</span><span class="pp">__VA_ARGS__</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb930-10"><a href="#cb930-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span class="pp"> </span><span class="cf">while</span><span class="pp"> </span><span class="op">(</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb930-11"><a href="#cb930-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb930-12"><a href="#cb930-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#define LOG_INFO</span><span class="op">(</span><span class="pp">msg</span><span class="op">,</span><span class="pp"> </span><span class="op">...)</span><span class="pp">  </span>LOG<span class="op">(</span><span class="st">"INFO"</span><span class="op">,</span><span class="pp"> msg</span><span class="op">,</span><span class="pp"> </span><span class="op">##</span><span class="pp">__VA_ARGS__</span><span class="op">)</span></span>
<span id="cb930-13"><a href="#cb930-13" aria-hidden="true" tabindex="-1"></a><span class="pp">#define LOG_WARN</span><span class="op">(</span><span class="pp">msg</span><span class="op">,</span><span class="pp"> </span><span class="op">...)</span><span class="pp">  </span>LOG<span class="op">(</span><span class="st">"WARN"</span><span class="op">,</span><span class="pp"> msg</span><span class="op">,</span><span class="pp"> </span><span class="op">##</span><span class="pp">__VA_ARGS__</span><span class="op">)</span></span>
<span id="cb930-14"><a href="#cb930-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#define LOG_ERROR</span><span class="op">(</span><span class="pp">msg</span><span class="op">,</span><span class="pp"> </span><span class="op">...)</span><span class="pp"> </span>LOG<span class="op">(</span><span class="st">"ERROR"</span><span class="op">,</span><span class="pp"> msg</span><span class="op">,</span><span class="pp"> </span><span class="op">##</span><span class="pp">__VA_ARGS__</span><span class="op">)</span></span>
<span id="cb930-15"><a href="#cb930-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb930-16"><a href="#cb930-16" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb930-17"><a href="#cb930-17" aria-hidden="true" tabindex="-1"></a>    LOG_INFO<span class="op">(</span><span class="st">"Program started"</span><span class="op">);</span></span>
<span id="cb930-18"><a href="#cb930-18" aria-hidden="true" tabindex="-1"></a>    LOG_WARN<span class="op">(</span><span class="st">"Memory usage at </span><span class="sc">%d%%</span><span class="st">"</span><span class="op">,</span> <span class="dv">80</span><span class="op">);</span></span>
<span id="cb930-19"><a href="#cb930-19" aria-hidden="true" tabindex="-1"></a>    LOG_ERROR<span class="op">(</span><span class="st">"File </span><span class="sc">%s</span><span class="st"> not found"</span><span class="op">,</span> <span class="st">"data.txt"</span><span class="op">);</span></span>
<span id="cb930-20"><a href="#cb930-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>[2025-10-16 23:41:09] [INFO] Program started
[2025-10-16 23:41:09] [WARN] Memory usage at 80%
[2025-10-16 23:41:09] [ERROR] File data.txt not found</code></pre>
<p>Now your logs have consistent structure and useful context.</p>
</section>
<section id="step-4.-controlling-log-verbosity" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-controlling-log-verbosity">Step 4. Controlling Log Verbosity</h4>
<p>Add a global log level:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb932"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb932-1"><a href="#cb932-1" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> <span class="op">{</span> LOG_LEVEL_INFO<span class="op">,</span> LOG_LEVEL_WARN<span class="op">,</span> LOG_LEVEL_ERROR <span class="op">};</span></span>
<span id="cb932-2"><a href="#cb932-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> CURRENT_LOG_LEVEL <span class="op">=</span> LOG_LEVEL_INFO<span class="op">;</span></span>
<span id="cb932-3"><a href="#cb932-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb932-4"><a href="#cb932-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SHOULD_LOG</span><span class="op">(</span><span class="pp">level</span><span class="op">)</span><span class="pp"> </span><span class="op">((</span><span class="pp">level</span><span class="op">)</span><span class="pp"> </span><span class="op">&gt;=</span><span class="pp"> CURRENT_LOG_LEVEL</span><span class="op">)</span></span>
<span id="cb932-5"><a href="#cb932-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define LOGX</span><span class="op">(</span><span class="pp">level</span><span class="op">,</span><span class="pp"> tag</span><span class="op">,</span><span class="pp"> msg</span><span class="op">,</span><span class="pp"> </span><span class="op">...)</span><span class="pp"> </span><span class="cf">do</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb932-6"><a href="#cb932-6" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span><span class="pp">SHOULD_LOG</span><span class="op">(</span><span class="pp">level</span><span class="op">))</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb932-7"><a href="#cb932-7" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="dt">time_t</span><span class="pp"> t </span><span class="op">=</span><span class="pp"> time</span><span class="op">(</span><span class="pp">NULL</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb932-8"><a href="#cb932-8" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="kw">struct</span><span class="pp"> tm </span><span class="op">*</span><span class="pp">tm_info </span><span class="op">=</span><span class="pp"> localtime</span><span class="op">(&amp;</span><span class="pp">t</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb932-9"><a href="#cb932-9" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="dt">char</span><span class="pp"> buf</span><span class="op">[</span><span class="dv">20</span><span class="op">];</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb932-10"><a href="#cb932-10" aria-hidden="true" tabindex="-1"></a><span class="pp">        strftime</span><span class="op">(</span><span class="pp">buf</span><span class="op">,</span><span class="pp"> </span><span class="dv">20</span><span class="op">,</span><span class="pp"> </span><span class="st">"%H:%M:%S"</span><span class="op">,</span><span class="pp"> tm_info</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb932-11"><a href="#cb932-11" aria-hidden="true" tabindex="-1"></a><span class="pp">        fprintf</span><span class="op">(</span><span class="pp">stderr</span><span class="op">,</span><span class="pp"> </span><span class="st">"[</span><span class="sc">%s</span><span class="st">] [</span><span class="sc">%s</span><span class="st">] "</span><span class="pp"> msg </span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> buf</span><span class="op">,</span><span class="pp"> tag</span><span class="op">,</span><span class="pp"> </span><span class="op">##</span><span class="pp">__VA_ARGS__</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb932-12"><a href="#cb932-12" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb932-13"><a href="#cb932-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span class="pp"> </span><span class="cf">while</span><span class="pp"> </span><span class="op">(</span><span class="dv">0</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb933"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb933-1"><a href="#cb933-1" aria-hidden="true" tabindex="-1"></a>LOGX<span class="op">(</span>LOG_LEVEL_INFO<span class="op">,</span> <span class="st">"INFO"</span><span class="op">,</span> <span class="st">"Running"</span><span class="op">);</span></span>
<span id="cb933-2"><a href="#cb933-2" aria-hidden="true" tabindex="-1"></a>LOGX<span class="op">(</span>LOG_LEVEL_WARN<span class="op">,</span> <span class="st">"WARN"</span><span class="op">,</span> <span class="st">"Low disk space"</span><span class="op">);</span></span>
<span id="cb933-3"><a href="#cb933-3" aria-hidden="true" tabindex="-1"></a>LOGX<span class="op">(</span>LOG_LEVEL_ERROR<span class="op">,</span> <span class="st">"ERROR"</span><span class="op">,</span> <span class="st">"Crash at line </span><span class="sc">%d</span><span class="st">"</span><span class="op">,</span> __LINE__<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Change verbosity dynamically:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb934"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb934-1"><a href="#cb934-1" aria-hidden="true" tabindex="-1"></a>CURRENT_LOG_LEVEL <span class="op">=</span> LOG_LEVEL_WARN<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now INFO messages are skipped.</p>
</section>
<section id="step-5.-logging-to-a-file" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-logging-to-a-file">Step 5. Logging to a File</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb935"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb935-1"><a href="#cb935-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb935-2"><a href="#cb935-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb935-3"><a href="#cb935-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb935-4"><a href="#cb935-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> log_to_file<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>filename<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>msg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb935-5"><a href="#cb935-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>f <span class="op">=</span> fopen<span class="op">(</span>filename<span class="op">,</span> <span class="st">"a"</span><span class="op">);</span></span>
<span id="cb935-6"><a href="#cb935-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>f<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb935-7"><a href="#cb935-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">time_t</span> t <span class="op">=</span> time<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb935-8"><a href="#cb935-8" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>f<span class="op">,</span> <span class="st">"</span><span class="sc">%s</span><span class="st">: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> ctime<span class="op">(&amp;</span>t<span class="op">),</span> msg<span class="op">);</span></span>
<span id="cb935-9"><a href="#cb935-9" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>f<span class="op">);</span></span>
<span id="cb935-10"><a href="#cb935-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb935-11"><a href="#cb935-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb935-12"><a href="#cb935-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb935-13"><a href="#cb935-13" aria-hidden="true" tabindex="-1"></a>    log_to_file<span class="op">(</span><span class="st">"log.txt"</span><span class="op">,</span> <span class="st">"Program started"</span><span class="op">);</span></span>
<span id="cb935-14"><a href="#cb935-14" aria-hidden="true" tabindex="-1"></a>    log_to_file<span class="op">(</span><span class="st">"log.txt"</span><span class="op">,</span> <span class="st">"Action complete"</span><span class="op">);</span></span>
<span id="cb935-15"><a href="#cb935-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The log file will contain:</p>
<pre><code>Thu Oct 16 23:41:09 2025: Program started
Thu Oct 16 23:41:10 2025: Action complete</code></pre>
</section>
<section id="step-6.-including-file-and-line-information" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-including-file-and-line-information">Step 6. Including File and Line Information</h4>
<p>You can include source info automatically using <code>__FILE__</code> and <code>__LINE__</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb937"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb937-1"><a href="#cb937-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define LOG_DEBUG</span><span class="op">(</span><span class="pp">msg</span><span class="op">,</span><span class="pp"> </span><span class="op">...)</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb937-2"><a href="#cb937-2" aria-hidden="true" tabindex="-1"></a><span class="pp">    fprintf</span><span class="op">(</span><span class="pp">stderr</span><span class="op">,</span><span class="pp"> </span><span class="st">"[DEBUG] </span><span class="sc">%s</span><span class="st">:</span><span class="sc">%d</span><span class="st"> "</span><span class="pp"> msg </span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> __FILE__</span><span class="op">,</span><span class="pp"> __LINE__</span><span class="op">,</span><span class="pp"> </span><span class="op">##</span><span class="pp">__VA_ARGS__</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb938"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb938-1"><a href="#cb938-1" aria-hidden="true" tabindex="-1"></a>LOG_DEBUG<span class="op">(</span><span class="st">"x = </span><span class="sc">%d</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>[DEBUG] main.c:42 x = 10</code></pre>
</section>
<section id="step-7.-rotating-or-limiting-logs" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-rotating-or-limiting-logs">Step 7. Rotating or Limiting Logs</h4>
<p>For long-running programs, you don’t want logs to grow forever. You can:</p>
<ul>
<li>Truncate or rename old files.</li>
<li>Only keep N entries.</li>
<li>Write daily logs (<code>log_2025-10-16.txt</code>).</li>
</ul>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb940"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb940-1"><a href="#cb940-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> filename<span class="op">[</span><span class="dv">64</span><span class="op">];</span></span>
<span id="cb940-2"><a href="#cb940-2" aria-hidden="true" tabindex="-1"></a><span class="dt">time_t</span> now <span class="op">=</span> time<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb940-3"><a href="#cb940-3" aria-hidden="true" tabindex="-1"></a>strftime<span class="op">(</span>filename<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>filename<span class="op">),</span> <span class="st">"log_%Y-%m-</span><span class="sc">%d</span><span class="st">.txt"</span><span class="op">,</span> localtime<span class="op">(&amp;</span>now<span class="op">));</span></span>
<span id="cb940-4"><a href="#cb940-4" aria-hidden="true" tabindex="-1"></a>log_to_file<span class="op">(</span>filename<span class="op">,</span> <span class="st">"Daily entry"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-8.-adding-colors-optional" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-adding-colors-optional">Step 8. Adding Colors (Optional)</h4>
<p>Make console logs easier to read with ANSI color codes:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb941"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb941-1"><a href="#cb941-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define RED   </span><span class="st">"</span><span class="sc">\x1b</span><span class="st">[31m"</span></span>
<span id="cb941-2"><a href="#cb941-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define YEL   </span><span class="st">"</span><span class="sc">\x1b</span><span class="st">[33m"</span></span>
<span id="cb941-3"><a href="#cb941-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define GRN   </span><span class="st">"</span><span class="sc">\x1b</span><span class="st">[32m"</span></span>
<span id="cb941-4"><a href="#cb941-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define RST   </span><span class="st">"</span><span class="sc">\x1b</span><span class="st">[0m"</span></span>
<span id="cb941-5"><a href="#cb941-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb941-6"><a href="#cb941-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#define LOGC</span><span class="op">(</span><span class="pp">level</span><span class="op">,</span><span class="pp"> color</span><span class="op">,</span><span class="pp"> msg</span><span class="op">,</span><span class="pp"> </span><span class="op">...)</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb941-7"><a href="#cb941-7" aria-hidden="true" tabindex="-1"></a><span class="pp">    fprintf</span><span class="op">(</span><span class="pp">stderr</span><span class="op">,</span><span class="pp"> color </span><span class="st">"[</span><span class="sc">%s</span><span class="st">] "</span><span class="pp"> msg </span>RST<span class="pp"> </span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> level</span><span class="op">,</span><span class="pp"> </span><span class="op">##</span><span class="pp">__VA_ARGS__</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb942"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb942-1"><a href="#cb942-1" aria-hidden="true" tabindex="-1"></a>LOGC<span class="op">(</span><span class="st">"INFO"</span><span class="op">,</span> GRN<span class="op">,</span> <span class="st">"Server started"</span><span class="op">);</span></span>
<span id="cb942-2"><a href="#cb942-2" aria-hidden="true" tabindex="-1"></a>LOGC<span class="op">(</span><span class="st">"WARN"</span><span class="op">,</span> YEL<span class="op">,</span> <span class="st">"High CPU usage"</span><span class="op">);</span></span>
<span id="cb942-3"><a href="#cb942-3" aria-hidden="true" tabindex="-1"></a>LOGC<span class="op">(</span><span class="st">"ERROR"</span><span class="op">,</span> RED<span class="op">,</span> <span class="st">"Out of memory"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-9.-combining-logging-and-assertions" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-combining-logging-and-assertions">Step 9. Combining Logging and Assertions</h4>
<p>You can combine assertions with logs for extra safety:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb943"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb943-1"><a href="#cb943-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;assert.h&gt;</span></span>
<span id="cb943-2"><a href="#cb943-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb943-3"><a href="#cb943-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SAFE_LOG</span><span class="op">(</span><span class="pp">cond</span><span class="op">,</span><span class="pp"> msg</span><span class="op">,</span><span class="pp"> </span><span class="op">...)</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb943-4"><a href="#cb943-4" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="cf">if</span><span class="pp"> </span><span class="op">(!(</span><span class="pp">cond</span><span class="op">))</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb943-5"><a href="#cb943-5" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>LOG_ERROR<span class="op">(</span><span class="pp">msg</span><span class="op">,</span><span class="pp"> </span><span class="op">##</span><span class="pp">__VA_ARGS__</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb943-6"><a href="#cb943-6" aria-hidden="true" tabindex="-1"></a><span class="pp">        assert</span><span class="op">(</span><span class="pp">cond</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb943-7"><a href="#cb943-7" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If something fails, it both logs and triggers an assertion.</p>
</section>
<section id="step-10.-tiny-code-minimal-logger" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-minimal-logger">Step 10. Tiny Code: Minimal Logger</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb944"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb944-1"><a href="#cb944-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb944-2"><a href="#cb944-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb944-3"><a href="#cb944-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb944-4"><a href="#cb944-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define LOG</span><span class="op">(</span><span class="pp">fmt</span><span class="op">,</span><span class="pp"> </span><span class="op">...)</span><span class="pp"> </span><span class="cf">do</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb944-5"><a href="#cb944-5" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">time_t</span><span class="pp"> now </span><span class="op">=</span><span class="pp"> time</span><span class="op">(</span><span class="pp">NULL</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb944-6"><a href="#cb944-6" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">char</span><span class="pp"> buf</span><span class="op">[</span><span class="dv">20</span><span class="op">];</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb944-7"><a href="#cb944-7" aria-hidden="true" tabindex="-1"></a><span class="pp">    strftime</span><span class="op">(</span><span class="pp">buf</span><span class="op">,</span><span class="pp"> </span><span class="kw">sizeof</span><span class="op">(</span><span class="pp">buf</span><span class="op">),</span><span class="pp"> </span><span class="st">"%H:%M:%S"</span><span class="op">,</span><span class="pp"> localtime</span><span class="op">(&amp;</span><span class="pp">now</span><span class="op">));</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb944-8"><a href="#cb944-8" aria-hidden="true" tabindex="-1"></a><span class="pp">    fprintf</span><span class="op">(</span><span class="pp">stderr</span><span class="op">,</span><span class="pp"> </span><span class="st">"[</span><span class="sc">%s</span><span class="st">] "</span><span class="pp"> fmt </span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> buf</span><span class="op">,</span><span class="pp"> </span><span class="op">##</span><span class="pp">__VA_ARGS__</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb944-9"><a href="#cb944-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span class="pp"> </span><span class="cf">while</span><span class="pp"> </span><span class="op">(</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb944-10"><a href="#cb944-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb944-11"><a href="#cb944-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb944-12"><a href="#cb944-12" aria-hidden="true" tabindex="-1"></a>    LOG<span class="op">(</span><span class="st">"Starting program"</span><span class="op">);</span></span>
<span id="cb944-13"><a href="#cb944-13" aria-hidden="true" tabindex="-1"></a>    LOG<span class="op">(</span><span class="st">"Loading config"</span><span class="op">);</span></span>
<span id="cb944-14"><a href="#cb944-14" aria-hidden="true" tabindex="-1"></a>    LOG<span class="op">(</span><span class="st">"Finished setup"</span><span class="op">);</span></span>
<span id="cb944-15"><a href="#cb944-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>[23:42:00] Starting program
[23:42:01] Loading config
[23:42:02] Finished setup</code></pre>
</section>
<section id="why-it-matters-63" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-63">Why It Matters</h4>
<p>Logging makes invisible processes visible. It helps you:</p>
<ul>
<li>Trace execution flow.</li>
<li>Debug production code.</li>
<li>Audit errors and warnings.</li>
<li>Understand system performance over time.</li>
</ul>
<p>In real systems, servers, compilers, databases, <strong>logs are your lifeline</strong> when things go wrong.</p>
</section>
<section id="try-it-yourself-73" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-73">Try It Yourself</h4>
<ol type="1">
<li>Add <code>LOG_INFO</code>, <code>LOG_WARN</code>, and <code>LOG_ERROR</code> macros to one of your C projects.</li>
<li>Write logs to both <code>stderr</code> and a file.</li>
<li>Add timestamps and line numbers automatically.</li>
<li>Add colors for each level.</li>
<li>Implement a rotating file log system that keeps only today’s file active.</li>
</ol>
<p>Next, you’ll learn about <strong>profiling with gprof</strong>, how to measure where your program spends its time, and how to make it faster.</p>
</section>
</section>
<section id="profiling-with-gprof" class="level3">
<h3 class="anchored" data-anchor-id="profiling-with-gprof">76. Profiling with gprof</h3>
<p>When your program works but feels <em>slow</em>, guessing isn’t enough, you need to <strong>measure</strong>. Profiling shows you <em>where</em> your program spends its time, which functions are hot, and where optimization truly matters.</p>
<p>C gives you a lot of control, but performance tuning without profiling is like driving blindfolded. That’s why we use <strong>gprof</strong>, the GNU profiler, a tool that measures how long your code spends in each function.</p>
<section id="step-1.-what-is-profiling" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-is-profiling">Step 1. What Is Profiling?</h4>
<p><strong>Profiling</strong> is the process of recording runtime statistics such as:</p>
<ul>
<li>How many times each function runs.</li>
<li>How much CPU time each function uses.</li>
<li>Which functions call which others.</li>
</ul>
<p>It helps you find bottlenecks, functions that dominate runtime, and focus your optimization there.</p>
</section>
<section id="step-2.-enabling-profiling-with-gprof" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-enabling-profiling-with-gprof">Step 2. Enabling Profiling with gprof</h4>
<p>Compile your program with the <code>-pg</code> flag to enable profiling hooks:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb946"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb946-1"><a href="#cb946-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-pg</span> main.c <span class="at">-o</span> program</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run the program normally:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb947"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb947-1"><a href="#cb947-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./program</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>After it finishes, a file named <code>gmon.out</code> is created. This file contains execution data collected during runtime.</p>
<p>Generate a report:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb948"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb948-1"><a href="#cb948-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gprof</span> program gmon.out <span class="op">&gt;</span> analysis.txt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now open <code>analysis.txt</code> to see where your program spent its time.</p>
</section>
<section id="step-3.-example-program" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-example-program">Step 3. Example Program</h4>
<p>Here’s a small example to demonstrate profiling:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb949"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb949-1"><a href="#cb949-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb949-2"><a href="#cb949-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb949-3"><a href="#cb949-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> slow_function<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb949-4"><a href="#cb949-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">volatile</span> <span class="dt">long</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">50000000</span><span class="op">;</span> i<span class="op">++);</span></span>
<span id="cb949-5"><a href="#cb949-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb949-6"><a href="#cb949-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb949-7"><a href="#cb949-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> fast_function<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb949-8"><a href="#cb949-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">volatile</span> <span class="dt">long</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5000000</span><span class="op">;</span> i<span class="op">++);</span></span>
<span id="cb949-9"><a href="#cb949-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb949-10"><a href="#cb949-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb949-11"><a href="#cb949-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb949-12"><a href="#cb949-12" aria-hidden="true" tabindex="-1"></a>    slow_function<span class="op">();</span></span>
<span id="cb949-13"><a href="#cb949-13" aria-hidden="true" tabindex="-1"></a>    fast_function<span class="op">();</span></span>
<span id="cb949-14"><a href="#cb949-14" aria-hidden="true" tabindex="-1"></a>    slow_function<span class="op">();</span></span>
<span id="cb949-15"><a href="#cb949-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb949-16"><a href="#cb949-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb950"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb950-1"><a href="#cb950-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-pg</span> main.c <span class="at">-o</span> profile_me</span>
<span id="cb950-2"><a href="#cb950-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./profile_me</span></span>
<span id="cb950-3"><a href="#cb950-3" aria-hidden="true" tabindex="-1"></a><span class="ex">gprof</span> profile_me gmon.out <span class="op">&gt;</span> report.txt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-4.-reading-the-gprof-report" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-reading-the-gprof-report">Step 4. Reading the gprof Report</h4>
<p>The report has two key sections:</p>
<p><strong>1. Flat Profile</strong></p>
<pre><code>Flat profile:

Each sample counts as 0.01 seconds.
  %   cumulative   self              self     total
 time   seconds   seconds    calls   ms/call  ms/call  name
 66.7      0.20     0.20        2   100.00   100.00  slow_function
 33.3      0.30     0.10        1   100.00   100.00  fast_function</code></pre>
<p>This tells you:</p>
<ul>
<li><code>slow_function()</code> took 66% of total time.</li>
<li><code>fast_function()</code> took 33%.</li>
</ul>
<p><strong>2. Call Graph</strong></p>
<pre><code>index % time    self  children    called     name
                0.20    0.00       2/2       slow_function
                0.10    0.00       1/1       fast_function</code></pre>
<p>This shows relationships, which functions called which, and how time was distributed among them.</p>
</section>
<section id="step-5.-profiling-multi-file-programs" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-profiling-multi-file-programs">Step 5. Profiling Multi-File Programs</h4>
<p>When working on multiple <code>.c</code> files, just compile each with <code>-pg</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb953"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb953-1"><a href="#cb953-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-pg</span> <span class="at">-c</span> foo.c</span>
<span id="cb953-2"><a href="#cb953-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-pg</span> <span class="at">-c</span> bar.c</span>
<span id="cb953-3"><a href="#cb953-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-pg</span> foo.o bar.o <span class="at">-o</span> app</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then run and analyze as before.</p>
</section>
<section id="step-6.-ignoring-initialization-or-short-runs" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-ignoring-initialization-or-short-runs">Step 6. Ignoring Initialization or Short Runs</h4>
<p>Profiling works best for <em>real workloads</em>. Avoid profiling tiny runs, because initialization costs can dominate and distort results.</p>
<p>For example, a 10 ms startup delay might look huge if your program only runs 20 ms in total. Use representative input and real loops to get meaningful data.</p>
</section>
<section id="step-7.-focusing-on-hotspots" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-focusing-on-hotspots">Step 7. Focusing on Hotspots</h4>
<p>When you know which functions dominate runtime (often the top 5%), you can:</p>
<ul>
<li>Inline them manually.</li>
<li>Use better data structures.</li>
<li>Reduce allocations.</li>
<li>Simplify inner loops.</li>
</ul>
<p>Optimization is about precision, don’t guess where your code is slow; let the profiler prove it.</p>
</section>
<section id="step-8.-combining-gprof-with-compiler-optimizations" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-combining-gprof-with-compiler-optimizations">Step 8. Combining gprof with Compiler Optimizations</h4>
<p>Compare your performance before and after adding optimization flags:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb954"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb954-1"><a href="#cb954-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-pg</span> <span class="at">-O0</span> main.c <span class="at">-o</span> slow</span>
<span id="cb954-2"><a href="#cb954-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-pg</span> <span class="at">-O3</span> main.c <span class="at">-o</span> fast</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then run both and inspect the reports. You’ll see dramatic changes in timing distribution, sometimes even inlined functions disappear entirely from the profile.</p>
</section>
<section id="step-9.-visualizing-profiles" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-visualizing-profiles">Step 9. Visualizing Profiles</h4>
<p>You can visualize gprof results using <strong>gprof2dot</strong> and <strong>Graphviz</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb955"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb955-1"><a href="#cb955-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install gprof2dot</span>
<span id="cb955-2"><a href="#cb955-2" aria-hidden="true" tabindex="-1"></a><span class="ex">gprof</span> program gmon.out <span class="kw">|</span> <span class="ex">gprof2dot</span> <span class="kw">|</span> <span class="ex">dot</span> <span class="at">-Tpng</span> <span class="at">-o</span> profile.png</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This generates a <strong>call graph image</strong>, showing which functions dominate. The thicker the arrow, the more time is spent there.</p>
</section>
<section id="step-10.-tiny-code-measuring-a-sorting-algorithm" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-measuring-a-sorting-algorithm">Step 10. Tiny Code: Measuring a Sorting Algorithm</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb956"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb956-1"><a href="#cb956-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb956-2"><a href="#cb956-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb956-3"><a href="#cb956-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb956-4"><a href="#cb956-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb956-5"><a href="#cb956-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define N </span><span class="dv">100000</span></span>
<span id="cb956-6"><a href="#cb956-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb956-7"><a href="#cb956-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> bubble_sort<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>arr<span class="op">,</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb956-8"><a href="#cb956-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n <span class="op">-</span> <span class="dv">1</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb956-9"><a href="#cb956-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> n <span class="op">-</span> i <span class="op">-</span> <span class="dv">1</span><span class="op">;</span> j<span class="op">++)</span></span>
<span id="cb956-10"><a href="#cb956-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>arr<span class="op">[</span>j<span class="op">]</span> <span class="op">&gt;</span> arr<span class="op">[</span>j <span class="op">+</span> <span class="dv">1</span><span class="op">])</span> <span class="op">{</span></span>
<span id="cb956-11"><a href="#cb956-11" aria-hidden="true" tabindex="-1"></a>                <span class="dt">int</span> tmp <span class="op">=</span> arr<span class="op">[</span>j<span class="op">];</span></span>
<span id="cb956-12"><a href="#cb956-12" aria-hidden="true" tabindex="-1"></a>                arr<span class="op">[</span>j<span class="op">]</span> <span class="op">=</span> arr<span class="op">[</span>j <span class="op">+</span> <span class="dv">1</span><span class="op">];</span></span>
<span id="cb956-13"><a href="#cb956-13" aria-hidden="true" tabindex="-1"></a>                arr<span class="op">[</span>j <span class="op">+</span> <span class="dv">1</span><span class="op">]</span> <span class="op">=</span> tmp<span class="op">;</span></span>
<span id="cb956-14"><a href="#cb956-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb956-15"><a href="#cb956-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb956-16"><a href="#cb956-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb956-17"><a href="#cb956-17" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> fill_random<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>arr<span class="op">,</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb956-18"><a href="#cb956-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb956-19"><a href="#cb956-19" aria-hidden="true" tabindex="-1"></a>        arr<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> rand<span class="op">()</span> <span class="op">%</span> <span class="dv">100000</span><span class="op">;</span></span>
<span id="cb956-20"><a href="#cb956-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb956-21"><a href="#cb956-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb956-22"><a href="#cb956-22" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb956-23"><a href="#cb956-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>arr <span class="op">=</span> malloc<span class="op">(</span>N <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb956-24"><a href="#cb956-24" aria-hidden="true" tabindex="-1"></a>    fill_random<span class="op">(</span>arr<span class="op">,</span> N<span class="op">);</span></span>
<span id="cb956-25"><a href="#cb956-25" aria-hidden="true" tabindex="-1"></a>    bubble_sort<span class="op">(</span>arr<span class="op">,</span> N<span class="op">);</span></span>
<span id="cb956-26"><a href="#cb956-26" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>arr<span class="op">);</span></span>
<span id="cb956-27"><a href="#cb956-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb957"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb957-1"><a href="#cb957-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-pg</span> main.c <span class="at">-O0</span> <span class="at">-o</span> sort_profile</span>
<span id="cb957-2"><a href="#cb957-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./sort_profile</span></span>
<span id="cb957-3"><a href="#cb957-3" aria-hidden="true" tabindex="-1"></a><span class="ex">gprof</span> sort_profile gmon.out <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 20</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output (excerpt):</p>
<pre><code>  %   cumulative   self              self     total
 time   seconds   seconds    calls   ms/call  ms/call  name
 95.0      0.95     0.95        1   950.00   950.00  bubble_sort</code></pre>
<p>This tells you 95% of time is spent in <code>bubble_sort()</code>, confirming the algorithmic bottleneck.</p>
</section>
<section id="why-it-matters-64" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-64">Why It Matters</h4>
<p>Profiling bridges the gap between “feels slow” and <strong>knowing why</strong>. It helps you:</p>
<ul>
<li>Focus optimization effort where it matters most.</li>
<li>Verify improvements quantitatively.</li>
<li>Eliminate guesswork.</li>
</ul>
<p>In performance engineering, <strong>measurement beats intuition</strong> every time.</p>
</section>
<section id="try-it-yourself-74" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-74">Try It Yourself</h4>
<ol type="1">
<li>Profile your own sorting or search algorithm.</li>
<li>Compare results between <code>-O0</code>, <code>-O2</code>, and <code>-O3</code>.</li>
<li>Profile a multithreaded or I/O-bound program.</li>
<li>Visualize results with <code>gprof2dot</code>.</li>
<li>Identify one bottleneck and fix it, then re-profile to see the difference.</li>
</ol>
<p>Next, you’ll explore <strong>common undefined behaviors</strong> in C, the silent bugs that can make your perfectly profiled program crash unpredictably.</p>
</section>
</section>
<section id="common-undefined-behaviors" class="level3">
<h3 class="anchored" data-anchor-id="common-undefined-behaviors">77. Common Undefined Behaviors</h3>
<p>C gives you freedom, but also <strong>responsibility</strong>. Unlike higher-level languages, C doesn’t protect you from dangerous mistakes. Some actions cause <strong>undefined behavior (UB)</strong>: the compiler is allowed to do <em>anything</em> in response, crash, hang, or even appear to work fine until it doesn’t.</p>
<p>Undefined behavior is what makes C both powerful and perilous. Let’s explore what causes it, how to recognize it, and how to write code that never falls into its traps.</p>
<section id="step-1.-what-is-undefined-behavior" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-is-undefined-behavior">Step 1. What Is Undefined Behavior?</h4>
<p>In the C standard, <strong>undefined behavior</strong> means “no rules apply.” If your program does something the language doesn’t define, the compiler can assume it never happens and optimize freely.</p>
<p>This means your program might:</p>
<ul>
<li>Crash immediately.</li>
<li>Produce wrong results.</li>
<li>Behave differently each time.</li>
<li>Work fine on one compiler and fail on another.</li>
</ul>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb959"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb959-1"><a href="#cb959-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">5</span> <span class="op">/</span> <span class="dv">0</span><span class="op">;</span>  <span class="co">// UB: division by zero</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The compiler is <em>not required</em> to warn you or handle this safely.</p>
</section>
<section id="step-2.-common-sources-of-ub" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-common-sources-of-ub">Step 2. Common Sources of UB</h4>
<p>Here are the most frequent offenders every C programmer must know:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 46%">
<col style="width: 53%">
</colgroup>
<thead>
<tr class="header">
<th>Category</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Out-of-bounds access</strong></td>
<td><code>arr[10]</code> when the array has 10 elements</td>
</tr>
<tr class="even">
<td><strong>Use of uninitialized variable</strong></td>
<td><code>int x; printf("%d", x);</code></td>
</tr>
<tr class="odd">
<td><strong>Dangling pointer access</strong></td>
<td>Use memory after <code>free()</code></td>
</tr>
<tr class="even">
<td><strong>Invalid pointer arithmetic</strong></td>
<td><code>(p + 5)</code> when <code>p</code> doesn’t point into an array</td>
</tr>
<tr class="odd">
<td><strong>Signed integer overflow</strong></td>
<td><code>int x = INT_MAX + 1;</code></td>
</tr>
<tr class="even">
<td><strong>Modifying and reading same variable</strong></td>
<td><code>i = i++;</code> or <code>a[i] = i++;</code></td>
</tr>
<tr class="odd">
<td><strong>Null pointer dereference</strong></td>
<td><code>int *p = NULL; *p = 5;</code></td>
</tr>
<tr class="even">
<td><strong>Incorrect type punning</strong></td>
<td>Accessing a float as int through wrong pointer type</td>
</tr>
<tr class="odd">
<td><strong>Mismatched <code>malloc</code>/<code>free</code></strong></td>
<td><code>free()</code> memory not allocated by <code>malloc()</code></td>
</tr>
<tr class="even">
<td><strong>Violating <code>const</code> or <code>volatile</code> contracts</strong></td>
<td>Writing to a <code>const</code> variable</td>
</tr>
</tbody>
</table>
</section>
<section id="step-3.-out-of-bounds-access" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-out-of-bounds-access">Step 3. Out-of-Bounds Access</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb960"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb960-1"><a href="#cb960-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> arr<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">};</span></span>
<span id="cb960-2"><a href="#cb960-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> arr<span class="op">[</span><span class="dv">3</span><span class="op">]);</span>  <span class="co">// UB: index 3 is past the end</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>C doesn’t check bounds, you’re responsible for it. You might print garbage, crash, or accidentally overwrite another variable.</p>
<p>Always check:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb961"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb961-1"><a href="#cb961-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>index <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> index <span class="op">&lt;</span> size<span class="op">)</span></span>
<span id="cb961-2"><a href="#cb961-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> arr<span class="op">[</span>index<span class="op">]);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-4.-using-uninitialized-variables" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-using-uninitialized-variables">Step 4. Using Uninitialized Variables</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb962"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb962-1"><a href="#cb962-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x<span class="op">;</span></span>
<span id="cb962-2"><a href="#cb962-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span>  <span class="co">// UB: x is uninitialized</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Even if it prints <code>0</code>, that’s luck, not correctness. Always initialize your variables explicitly:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb963"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb963-1"><a href="#cb963-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-5.-dangling-pointers" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-dangling-pointers">Step 5. Dangling Pointers</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb964"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb964-1"><a href="#cb964-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb964-2"><a href="#cb964-2" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>p <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb964-3"><a href="#cb964-3" aria-hidden="true" tabindex="-1"></a>free<span class="op">(</span>p<span class="op">);</span></span>
<span id="cb964-4"><a href="#cb964-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span>  <span class="co">// UB: accessing freed memory</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>After <code>free()</code>, the pointer still <em>exists</em> but the memory doesn’t belong to you. Set it to <code>NULL</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb965"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb965-1"><a href="#cb965-1" aria-hidden="true" tabindex="-1"></a>free<span class="op">(</span>p<span class="op">);</span></span>
<span id="cb965-2"><a href="#cb965-2" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> NULL<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-6.-signed-integer-overflow" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-signed-integer-overflow">Step 6. Signed Integer Overflow</h4>
<p>In C, <strong>signed overflow is undefined</strong>, but unsigned overflow wraps around predictably.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb966"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb966-1"><a href="#cb966-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">2147483647</span><span class="op">;</span></span>
<span id="cb966-2"><a href="#cb966-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> x <span class="op">+</span> <span class="dv">1</span><span class="op">;</span>  <span class="co">// UB</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Unsigned version:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb967"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb967-1"><a href="#cb967-1" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> x <span class="op">=</span> <span class="dv">4294967295</span><span class="op">;</span></span>
<span id="cb967-2"><a href="#cb967-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> x <span class="op">+</span> <span class="dv">1</span><span class="op">;</span>  <span class="co">// wraps to 0 (defined)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>To check overflow safely:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb968"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb968-1"><a href="#cb968-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>a <span class="op">&gt;</span> INT_MAX <span class="op">-</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb968-2"><a href="#cb968-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"overflow</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb968-3"><a href="#cb968-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb968-4"><a href="#cb968-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb968-5"><a href="#cb968-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-7.-modifying-and-reading-in-one-expression" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-modifying-and-reading-in-one-expression">Step 7. Modifying and Reading in One Expression</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb969"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb969-1"><a href="#cb969-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb969-2"><a href="#cb969-2" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> i<span class="op">++</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span>  <span class="co">// UB: reading and writing i without sequence point</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Avoid combining side effects. Write clean code:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb970"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb970-1"><a href="#cb970-1" aria-hidden="true" tabindex="-1"></a>i<span class="op">++;</span></span>
<span id="cb970-2"><a href="#cb970-2" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-8.-null-pointer-dereference" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-null-pointer-dereference">Step 8. Null Pointer Dereference</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb971"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb971-1"><a href="#cb971-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb971-2"><a href="#cb971-2" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>p <span class="op">=</span> <span class="dv">10</span><span class="op">;</span>  <span class="co">// UB</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Always validate pointers:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb972"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb972-1"><a href="#cb972-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>p <span class="op">!=</span> NULL<span class="op">)</span> <span class="op">*</span>p <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-9.-type-punning-and-aliasing" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-type-punning-and-aliasing">Step 9. Type Punning and Aliasing</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb973"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb973-1"><a href="#cb973-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> f <span class="op">=</span> <span class="fl">3.14</span><span class="op">;</span></span>
<span id="cb973-2"><a href="#cb973-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>ip <span class="op">=</span> <span class="op">(</span><span class="dt">int</span> <span class="op">*)&amp;</span>f<span class="op">;</span>  <span class="co">// UB: violates strict aliasing</span></span>
<span id="cb973-3"><a href="#cb973-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>ip<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If you must reinterpret bytes, use <code>memcpy</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb974"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb974-1"><a href="#cb974-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb974-2"><a href="#cb974-2" aria-hidden="true" tabindex="-1"></a>memcpy<span class="op">(&amp;</span>i<span class="op">,</span> <span class="op">&amp;</span>f<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>i<span class="op">));</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This avoids aliasing violations and is safe across compilers.</p>
</section>
<section id="step-10.-tiny-code-detecting-ub-with-tools" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-detecting-ub-with-tools">Step 10. Tiny Code: Detecting UB with Tools</h4>
<p>Use <strong>compilers and runtime checkers</strong> to detect UB before it hits production.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb975"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb975-1"><a href="#cb975-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-fsanitize</span><span class="op">=</span>undefined <span class="at">-g</span> ub_example.c <span class="at">-o</span> ub_example</span>
<span id="cb975-2"><a href="#cb975-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./ub_example</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Sample program:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb976"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb976-1"><a href="#cb976-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb976-2"><a href="#cb976-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb976-3"><a href="#cb976-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb976-4"><a href="#cb976-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">2147483647</span><span class="op">;</span></span>
<span id="cb976-5"><a href="#cb976-5" aria-hidden="true" tabindex="-1"></a>    x<span class="op">++;</span></span>
<span id="cb976-6"><a href="#cb976-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb976-7"><a href="#cb976-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>runtime error: signed integer overflow: 2147483647 + 1 cannot be represented in type 'int'</code></pre>
<p>This is the <strong>Undefined Behavior Sanitizer (UBSan)</strong> in action, your best friend for finding invisible bugs.</p>
</section>
<section id="why-it-matters-65" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-65">Why It Matters</h4>
<p>Undefined behavior is silent corruption. It can:</p>
<ul>
<li>Work on your machine but fail elsewhere.</li>
<li>Break when you change compiler flags.</li>
<li>Cause subtle, unpredictable bugs.</li>
</ul>
<p>Avoiding UB is the foundation of reliable systems programming. In C, correctness comes from <em>discipline</em>.</p>
</section>
<section id="try-it-yourself-75" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-75">Try It Yourself</h4>
<ol type="1">
<li>Write a small program with deliberate UB (like using uninitialized variables).</li>
<li>Run it with <code>-fsanitize=undefined</code>.</li>
<li>Fix each issue until UBSan runs clean.</li>
<li>Check array access and pointer validity.</li>
<li>Refactor old C code to avoid UB, it’s a great debugging exercise.</li>
</ol>
<p>Next, you’ll learn how to perform <strong>crash analysis and read core dumps</strong>, so even when your program fails, you can find out <em>exactly why</em>.</p>
</section>
</section>
<section id="crash-analysis-and-core-dumps" class="level3">
<h3 class="anchored" data-anchor-id="crash-analysis-and-core-dumps">78. Crash Analysis and Core Dumps</h3>
<p>Even with careful coding and testing, programs crash. In C, a crash is your system’s way of saying <em>“you touched something you shouldn’t have.”</em> The good news is you can <strong>analyze crashes</strong> scientifically using <strong>core dumps</strong>, snapshots of your program’s memory at the moment of failure.</p>
<p>Learning how to read them is an essential skill for every systems programmer.</p>
<section id="step-1.-what-is-a-core-dump" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-is-a-core-dump">Step 1. What Is a Core Dump?</h4>
<p>A <strong>core dump</strong> is a file that captures your program’s state (stack, registers, memory) at the time it crashed. You can inspect it later using a debugger like <strong>gdb</strong> to see what went wrong.</p>
<p>Common crash signals that generate core dumps:</p>
<ul>
<li><strong>SIGSEGV</strong> – invalid memory access (segmentation fault)</li>
<li><strong>SIGABRT</strong> – failed assertion</li>
<li><strong>SIGFPE</strong> – arithmetic error (like division by zero)</li>
<li><strong>SIGILL</strong> – illegal instruction</li>
</ul>
</section>
<section id="step-2.-enabling-core-dumps" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-enabling-core-dumps">Step 2. Enabling Core Dumps</h4>
<p>By default, modern systems limit or disable them. Enable them using:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb978"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb978-1"><a href="#cb978-1" aria-hidden="true" tabindex="-1"></a><span class="bu">ulimit</span> <span class="at">-c</span> unlimited</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Check:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb979"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb979-1"><a href="#cb979-1" aria-hidden="true" tabindex="-1"></a><span class="bu">ulimit</span> <span class="at">-a</span> <span class="kw">|</span> <span class="fu">grep</span> core</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now when your program crashes, a file named <code>core</code> or <code>core.&lt;pid&gt;</code> will appear.</p>
</section>
<section id="step-3.-a-crashing-example" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-a-crashing-example">Step 3. A Crashing Example</h4>
<p>Let’s make a simple crash:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb980"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb980-1"><a href="#cb980-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb980-2"><a href="#cb980-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb980-3"><a href="#cb980-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb980-4"><a href="#cb980-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb980-5"><a href="#cb980-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>p <span class="op">=</span> <span class="dv">42</span><span class="op">;</span>  <span class="co">// crash: dereferencing null pointer</span></span>
<span id="cb980-6"><a href="#cb980-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb980-7"><a href="#cb980-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb981"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb981-1"><a href="#cb981-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> crash.c <span class="at">-g</span> <span class="at">-o</span> crash</span>
<span id="cb981-2"><a href="#cb981-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./crash</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Segmentation fault (core dumped)</code></pre>
<p>A <code>core</code> file is now created in your directory.</p>
</section>
<section id="step-4.-opening-the-core-dump-in-gdb" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-opening-the-core-dump-in-gdb">Step 4. Opening the Core Dump in gdb</h4>
<p>Use gdb to inspect what happened:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb983"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb983-1"><a href="#cb983-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gdb</span> ./crash core</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You’ll see:</p>
<pre><code>Core was generated by `./crash'.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  0x0000000000401136 in main () at crash.c:5
5       *p = 42;</code></pre>
<p>This tells you the <strong>exact line</strong> where the program crashed.</p>
</section>
<section id="step-5.-inspecting-variables-and-stack" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-inspecting-variables-and-stack">Step 5. Inspecting Variables and Stack</h4>
<p>Within gdb:</p>
<pre class="gdb"><code>(gdb) bt</code></pre>
<p>Shows the <strong>backtrace</strong>, the call stack at the moment of crash.</p>
<pre><code>#0  main () at crash.c:5</code></pre>
<p>You can inspect variables:</p>
<pre class="gdb"><code>(gdb) info locals
(gdb) print p</code></pre>
<p>Output:</p>
<pre><code>$1 = (int *) 0x0</code></pre>
</section>
<section id="step-6.-a-more-complex-example" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-a-more-complex-example">Step 6. A More Complex Example</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb989"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb989-1"><a href="#cb989-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb989-2"><a href="#cb989-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb989-3"><a href="#cb989-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> f3<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb989-4"><a href="#cb989-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>p <span class="op">=</span> <span class="dv">7</span><span class="op">;</span>  <span class="co">// likely crash here</span></span>
<span id="cb989-5"><a href="#cb989-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb989-6"><a href="#cb989-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb989-7"><a href="#cb989-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> f2<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb989-8"><a href="#cb989-8" aria-hidden="true" tabindex="-1"></a>    f3<span class="op">(</span>p<span class="op">);</span></span>
<span id="cb989-9"><a href="#cb989-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb989-10"><a href="#cb989-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb989-11"><a href="#cb989-11" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> f1<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb989-12"><a href="#cb989-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>x <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb989-13"><a href="#cb989-13" aria-hidden="true" tabindex="-1"></a>    f2<span class="op">(</span>x<span class="op">);</span></span>
<span id="cb989-14"><a href="#cb989-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb989-15"><a href="#cb989-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb989-16"><a href="#cb989-16" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb989-17"><a href="#cb989-17" aria-hidden="true" tabindex="-1"></a>    f1<span class="op">();</span></span>
<span id="cb989-18"><a href="#cb989-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run it, crash it, then:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb990"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb990-1"><a href="#cb990-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gdb</span> ./crash core</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Inside gdb:</p>
<pre><code>(gdb) bt
#0  f3 (p=0x0) at crash.c:4
#1  f2 (p=0x0) at crash.c:8
#2  f1 () at crash.c:12
#3  main () at crash.c:16</code></pre>
<p>You can see the entire call chain that led to the null dereference.</p>
</section>
<section id="step-7.-debugging-optimized-builds" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-debugging-optimized-builds">Step 7. Debugging Optimized Builds</h4>
<p>When you compile with <code>-O2</code> or <code>-O3</code>, the compiler may inline or reorder code, making debugging harder. For debugging, always use:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb992"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb992-1"><a href="#cb992-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-g</span> <span class="at">-O0</span> crash.c <span class="at">-o</span> crash</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The <code>-g</code> flag keeps symbol information (file names, line numbers). Without it, gdb can’t tell you much beyond addresses.</p>
</section>
<section id="step-8.-controlling-core-dump-location" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-controlling-core-dump-location">Step 8. Controlling Core Dump Location</h4>
<p>Change where dumps are stored:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb993"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb993-1"><a href="#cb993-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> sysctl <span class="at">-w</span> kernel.core_pattern=/tmp/core.%e.%p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This example saves them in <code>/tmp</code> with program name and process ID:</p>
<pre><code>/tmp/core.crash.1234</code></pre>
</section>
<section id="step-9.-crash-analysis-workflow" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-crash-analysis-workflow">Step 9. Crash Analysis Workflow</h4>
<ol type="1">
<li><p><strong>Enable dumps</strong>: <code>ulimit -c unlimited</code></p></li>
<li><p><strong>Run program until it crashes</strong></p></li>
<li><p><strong>Locate core file</strong></p></li>
<li><p><strong>Analyze with gdb</strong>:</p>
<ul>
<li><code>bt</code> for stack trace</li>
<li><code>info locals</code> for local vars</li>
<li><code>frame &lt;n&gt;</code> to inspect each stack frame</li>
<li><code>list</code> to see nearby code</li>
</ul></li>
</ol>
<p>This gives you a full picture of what happened just before failure.</p>
</section>
<section id="step-10.-tiny-code-assertion-failure-analysis" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-assertion-failure-analysis">Step 10. Tiny Code: Assertion Failure Analysis</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb995"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb995-1"><a href="#cb995-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;assert.h&gt;</span></span>
<span id="cb995-2"><a href="#cb995-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb995-3"><a href="#cb995-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb995-4"><a href="#cb995-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb995-5"><a href="#cb995-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb995-6"><a href="#cb995-6" aria-hidden="true" tabindex="-1"></a>    assert<span class="op">(</span>x <span class="op">==</span> <span class="dv">10</span><span class="op">);</span>  <span class="co">// fails</span></span>
<span id="cb995-7"><a href="#cb995-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Done</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb995-8"><a href="#cb995-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb996"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb996-1"><a href="#cb996-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-g</span> assert_fail.c <span class="at">-o</span> assert_fail</span>
<span id="cb996-2"><a href="#cb996-2" aria-hidden="true" tabindex="-1"></a><span class="bu">ulimit</span> <span class="at">-c</span> unlimited</span>
<span id="cb996-3"><a href="#cb996-3" aria-hidden="true" tabindex="-1"></a><span class="ex">./assert_fail</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>assert_fail: assert_fail.c:5: main: Assertion `x == 10' failed.
Aborted (core dumped)</code></pre>
<p>Now inspect:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb998"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb998-1"><a href="#cb998-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gdb</span> ./assert_fail core</span>
<span id="cb998-2"><a href="#cb998-2" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">bt</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>#0  0x00007f0a9a4b9187 in raise () from /lib64/libc.so.6
#1  0x00007f0a9a4c53e8 in abort () from /lib64/libc.so.6
#2  0x00007f0a9a4b0246 in __assert_fail_base () from /lib64/libc.so.6
#3  0x00007f0a9a4b02f2 in __assert_fail () from /lib64/libc.so.6
#4  0x0000000000401136 in main () at assert_fail.c:5</code></pre>
<p>You can trace exactly how the assertion caused the abort signal.</p>
</section>
<section id="why-it-matters-66" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-66">Why It Matters</h4>
<p>Crash analysis turns chaos into clarity. Instead of guessing, you can:</p>
<ul>
<li>See which line caused the crash.</li>
<li>Inspect all variables at that point.</li>
<li>Reproduce and fix the bug quickly.</li>
</ul>
<p>Every serious C programmer must master this, it’s how systems engineers debug everything from user tools to kernels.</p>
</section>
<section id="try-it-yourself-76" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-76">Try It Yourself</h4>
<ol type="1">
<li>Write a small program that dereferences a null pointer.</li>
<li>Enable core dumps (<code>ulimit -c unlimited</code>).</li>
<li>Crash it, then analyze the dump in gdb.</li>
<li>Add one more function layer and check the call chain.</li>
<li>Experiment with <code>SIGFPE</code> (divide by zero) and see how the core dump differs.</li>
</ol>
<p>Next, you’ll build a <strong>code review checklist for C projects</strong>, habits and principles that help prevent these crashes before they ever happen.</p>
</section>
</section>
<section id="code-review-checklist-for-c-projects" class="level3">
<h3 class="anchored" data-anchor-id="code-review-checklist-for-c-projects">79. Code Review Checklist for C Projects</h3>
<p>Before your C program ships to production (or even your homework submission), it should survive one last test, <strong>a code review</strong>. This is where you or your teammates look at the code not just for correctness, but for <em>clarity, safety, and maintainability</em>.</p>
<p>Think of this as your personal pilot checklist before takeoff. Every great C programmer has one.</p>
<section id="step-1.-readability-and-structure" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-readability-and-structure">Step 1. Readability and Structure</h4>
<ul>
<li>Are files organized logically (<code>src/</code>, <code>include/</code>, <code>tests/</code>)?</li>
<li>Are headers clean, with include guards?</li>
<li>Are functions short and focused (one purpose each)?</li>
<li>Are names meaningful (<code>count_users()</code> is better than <code>doit()</code>)?</li>
<li>Is indentation consistent and readable?</li>
<li>Are comments clear and relevant, not just noise?</li>
</ul>
<p><strong>Tiny Code Example:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1000"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1000-1"><a href="#cb1000-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Bad</span></span>
<span id="cb1000-2"><a href="#cb1000-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> d<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">+</span>b<span class="op">);</span> <span class="op">}</span></span>
<span id="cb1000-3"><a href="#cb1000-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1000-4"><a href="#cb1000-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Good</span></span>
<span id="cb1000-5"><a href="#cb1000-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_sum<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1000-6"><a href="#cb1000-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a <span class="op">+</span> b<span class="op">);</span></span>
<span id="cb1000-7"><a href="#cb1000-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Readable code <em>explains itself</em>.</p>
</section>
<section id="step-2.-header-hygiene" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-header-hygiene">Step 2. Header Hygiene</h4>
<ul>
<li>Each <code>.h</code> file must have an <strong>include guard</strong>:</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1001"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1001-1"><a href="#cb1001-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef MATH_UTILS_H</span></span>
<span id="cb1001-2"><a href="#cb1001-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MATH_UTILS_H</span></span>
<span id="cb1001-3"><a href="#cb1001-3" aria-hidden="true" tabindex="-1"></a><span class="co">// declarations</span></span>
<span id="cb1001-4"><a href="#cb1001-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>Headers should declare, not define.</li>
<li>No global variables unless justified.</li>
<li>Use <code>static inline</code> carefully (for small utilities only).</li>
</ul>
</section>
<section id="step-3.-memory-safety" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-memory-safety">Step 3. Memory Safety</h4>
<ul>
<li>Every <code>malloc</code> must have a corresponding <code>free</code>.</li>
<li>Check all allocation results:</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1002"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1002-1"><a href="#cb1002-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> malloc<span class="op">(</span>size<span class="op">);</span></span>
<span id="cb1002-2"><a href="#cb1002-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span>p<span class="op">)</span> <span class="op">{</span> perror<span class="op">(</span><span class="st">"malloc"</span><span class="op">);</span> exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span> <span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>Avoid dangling pointers:</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1003"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1003-1"><a href="#cb1003-1" aria-hidden="true" tabindex="-1"></a>free<span class="op">(</span>p<span class="op">);</span></span>
<span id="cb1003-2"><a href="#cb1003-2" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> NULL<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>Use Valgrind or AddressSanitizer to ensure no leaks.</li>
</ul>
</section>
<section id="step-4.-pointer-discipline" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-pointer-discipline">Step 4. Pointer Discipline</h4>
<ul>
<li>Check for null pointers before dereferencing.</li>
<li>Don’t return pointers to local variables:</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1004"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1004-1"><a href="#cb1004-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span><span class="op">*</span> bad<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1004-2"><a href="#cb1004-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb1004-3"><a href="#cb1004-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">&amp;</span>x<span class="op">;</span> <span class="co">// wrong: stack memory</span></span>
<span id="cb1004-4"><a href="#cb1004-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>Document ownership: who allocates, who frees.</li>
</ul>
</section>
<section id="step-5.-error-handling" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-error-handling">Step 5. Error Handling</h4>
<ul>
<li>Always check function return values:</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1005"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1005-1"><a href="#cb1005-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>fwrite<span class="op">(</span>buf<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> len<span class="op">,</span> file<span class="op">)</span> <span class="op">!=</span> len<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1005-2"><a href="#cb1005-2" aria-hidden="true" tabindex="-1"></a>    perror<span class="op">(</span><span class="st">"fwrite"</span><span class="op">);</span></span>
<span id="cb1005-3"><a href="#cb1005-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>Use meaningful error messages.</li>
<li>Prefer returning error codes over silently ignoring failures.</li>
<li>For libraries, use <code>errno</code> or your own error enums.</li>
</ul>
</section>
<section id="step-6.-undefined-behavior-prevention" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-undefined-behavior-prevention">Step 6. Undefined Behavior Prevention</h4>
<ul>
<li>No uninitialized variables.</li>
<li>No out-of-bounds array access.</li>
<li>No signed integer overflow.</li>
<li>No use-after-free.</li>
<li>Compile with:</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1006"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1006-1"><a href="#cb1006-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-Wall</span> <span class="at">-Wextra</span> <span class="at">-Wpedantic</span> <span class="at">-fsanitize</span><span class="op">=</span>undefined,address</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Fix all warnings, treat them as errors.</p>
</section>
<section id="step-7.-portability" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-portability">Step 7. Portability</h4>
<ul>
<li>Don’t assume <code>int</code> is 32 bits or <code>char</code> is signed.</li>
<li>Use <code>&lt;stdint.h&gt;</code> types (<code>int32_t</code>, <code>uint64_t</code>).</li>
<li>Use <code>size_t</code> for sizes and indexing.</li>
<li>Avoid platform-specific APIs unless wrapped.</li>
<li>Test on multiple compilers (<code>gcc</code>, <code>clang</code>, <code>tinycc</code>).</li>
</ul>
</section>
<section id="step-8.-testing-and-validation" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-testing-and-validation">Step 8. Testing and Validation</h4>
<ul>
<li>Every function that can fail must have at least one test.</li>
<li>Edge cases: empty input, zero values, large input.</li>
<li>Tests should run automatically:</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1007"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1007-1"><a href="#cb1007-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> test</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>Compare results with known-good output.</li>
<li>Document how to reproduce test results.</li>
</ul>
</section>
<section id="step-9.-documentation" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-documentation">Step 9. Documentation</h4>
<ul>
<li>Add a short header to every file:</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1008"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1008-1"><a href="#cb1008-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* math_utils.c</span></span>
<span id="cb1008-2"><a href="#cb1008-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * Simple math helpers.</span></span>
<span id="cb1008-3"><a href="#cb1008-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * Author: Your Name</span></span>
<span id="cb1008-4"><a href="#cb1008-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * License: MIT</span></span>
<span id="cb1008-5"><a href="#cb1008-5" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>Comment tricky code, but not the obvious.</li>
<li>Maintain a <code>README.md</code> explaining build and run steps.</li>
<li>Version your code (Git). Write meaningful commit messages.</li>
</ul>
</section>
<section id="step-10.-tiny-code-applying-the-checklist" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-applying-the-checklist">Step 10. Tiny Code: Applying the Checklist</h4>
<p>Let’s check a small example:</p>
<p><strong>Original:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1009"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1009-1"><a href="#cb1009-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>make_array<span class="op">(</span><span class="dt">int</span> n<span class="op">){</span></span>
<span id="cb1009-2"><a href="#cb1009-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> arr<span class="op">[</span>n<span class="op">];</span> <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>n<span class="op">;</span>i<span class="op">++)</span> arr<span class="op">[</span>i<span class="op">]=</span>i<span class="op">;</span> <span class="cf">return</span> arr<span class="op">;</span></span>
<span id="cb1009-3"><a href="#cb1009-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Review notes:</strong></p>
<ul>
<li>Returns pointer to local array → UB</li>
<li>Magic loop style → unreadable</li>
<li>Missing input validation</li>
</ul>
<p><strong>Fixed:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1010"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1010-1"><a href="#cb1010-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb1010-2"><a href="#cb1010-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1010-3"><a href="#cb1010-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1010-4"><a href="#cb1010-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>make_array<span class="op">(</span><span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1010-5"><a href="#cb1010-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1010-6"><a href="#cb1010-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>arr <span class="op">=</span> malloc<span class="op">(</span>n <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb1010-7"><a href="#cb1010-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>arr<span class="op">)</span> <span class="op">{</span> perror<span class="op">(</span><span class="st">"malloc"</span><span class="op">);</span> <span class="cf">return</span> NULL<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1010-8"><a href="#cb1010-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> arr<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb1010-9"><a href="#cb1010-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> arr<span class="op">;</span></span>
<span id="cb1010-10"><a href="#cb1010-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Passes checklist ✅</p>
<ul>
<li>Safe, clear, and portable.</li>
</ul>
</section>
<section id="why-it-matters-67" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-67">Why It Matters</h4>
<p>A checklist builds <strong>discipline and consistency</strong>. It ensures:</p>
<ul>
<li>Clean, maintainable code.</li>
<li>Fewer crashes and leaks.</li>
<li>Easier debugging and onboarding.</li>
<li>Long-term stability in complex systems.</li>
</ul>
<p>Every high-quality C project uses one, from open-source libraries to kernels.</p>
</section>
<section id="try-it-yourself-77" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-77">Try It Yourself</h4>
<ol type="1">
<li>Take one of your old C programs and review it using this checklist.</li>
<li>Fix memory leaks, add error checks, clean up naming.</li>
<li>Compile with all warnings on.</li>
<li>Run it through AddressSanitizer or Valgrind.</li>
<li>Document everything, then repeat for your next project.</li>
</ol>
<p>Next, you’ll wrap up this debugging chapter with a <strong>hands-on practice session</strong>: fixing real memory and logic bugs step by step.</p>
</section>
</section>
<section id="practice-fix-memory-and-logic-bugs" class="level3">
<h3 class="anchored" data-anchor-id="practice-fix-memory-and-logic-bugs">80. Practice: Fix Memory and Logic Bugs</h3>
<p>Now it’s time to apply everything you’ve learned, debugging, testing, assertions, logging, and analysis, to <em>real code that’s broken</em>. This section walks you through a handful of small, common C bugs that new programmers (and even experienced ones) run into, showing how to find, understand, and fix them.</p>
<section id="step-1.-bug-1-segmentation-fault-from-a-bad-pointer" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-bug-1-segmentation-fault-from-a-bad-pointer">Step 1. Bug #1, Segmentation Fault from a Bad Pointer</h4>
<p><strong>Buggy Code:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1011"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1011-1"><a href="#cb1011-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1011-2"><a href="#cb1011-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1011-3"><a href="#cb1011-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1011-4"><a href="#cb1011-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>p<span class="op">;</span></span>
<span id="cb1011-5"><a href="#cb1011-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>p <span class="op">=</span> <span class="dv">10</span><span class="op">;</span>  <span class="co">// writing to uninitialized pointer</span></span>
<span id="cb1011-6"><a href="#cb1011-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span></span>
<span id="cb1011-7"><a href="#cb1011-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Symptom:</strong></p>
<pre><code>Segmentation fault (core dumped)</code></pre>
<p><strong>Diagnosis:</strong></p>
<ul>
<li>The pointer <code>p</code> is never initialized.</li>
<li>It points to an undefined address.</li>
</ul>
<p><strong>Fix:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1013"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1013-1"><a href="#cb1013-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1013-2"><a href="#cb1013-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1013-3"><a href="#cb1013-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1013-4"><a href="#cb1013-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb1013-5"><a href="#cb1013-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span></span>
<span id="cb1013-6"><a href="#cb1013-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span></span>
<span id="cb1013-7"><a href="#cb1013-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Lesson:</strong> Always initialize pointers before use. If dynamic, allocate with <code>malloc()</code> and check for <code>NULL</code>.</p>
</section>
<section id="step-2.-bug-2-memory-leak" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-bug-2-memory-leak">Step 2. Bug #2, Memory Leak</h4>
<p><strong>Buggy Code:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1014"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1014-1"><a href="#cb1014-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb1014-2"><a href="#cb1014-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1014-3"><a href="#cb1014-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> leak<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1014-4"><a href="#cb1014-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>arr <span class="op">=</span> malloc<span class="op">(</span><span class="dv">10</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb1014-5"><a href="#cb1014-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span> arr<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb1014-6"><a href="#cb1014-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// forgot to free</span></span>
<span id="cb1014-7"><a href="#cb1014-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1014-8"><a href="#cb1014-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1014-9"><a href="#cb1014-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1014-10"><a href="#cb1014-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10000</span><span class="op">;</span> i<span class="op">++)</span> leak<span class="op">();</span></span>
<span id="cb1014-11"><a href="#cb1014-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Diagnosis:</strong> Each call to <code>leak()</code> allocates memory and never frees it. Use Valgrind to confirm:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1015"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1015-1"><a href="#cb1015-1" aria-hidden="true" tabindex="-1"></a><span class="fu">valgrind</span> ./a.out</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Fix:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1016"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1016-1"><a href="#cb1016-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> leak<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1016-2"><a href="#cb1016-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>arr <span class="op">=</span> malloc<span class="op">(</span><span class="dv">10</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb1016-3"><a href="#cb1016-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>arr<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb1016-4"><a href="#cb1016-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span> arr<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb1016-5"><a href="#cb1016-5" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>arr<span class="op">);</span></span>
<span id="cb1016-6"><a href="#cb1016-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Lesson:</strong> Every <code>malloc()</code> needs a matching <code>free()</code>, no exceptions.</p>
</section>
<section id="step-3.-bug-3-off-by-one-error" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-bug-3-off-by-one-error">Step 3. Bug #3, Off-by-One Error</h4>
<p><strong>Buggy Code:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1017"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1017-1"><a href="#cb1017-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1017-2"><a href="#cb1017-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1017-3"><a href="#cb1017-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1017-4"><a href="#cb1017-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> nums<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">};</span></span>
<span id="cb1017-5"><a href="#cb1017-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span>  <span class="co">// ❌ should be &lt; 5</span></span>
<span id="cb1017-6"><a href="#cb1017-6" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> nums<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb1017-7"><a href="#cb1017-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Symptom:</strong> Sometimes prints garbage or segfaults.</p>
<p><strong>Fix:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1018"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1018-1"><a href="#cb1018-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Lesson:</strong> Off-by-one errors are the most common bug in loops. Always check your boundary conditions carefully.</p>
</section>
<section id="step-4.-bug-4-use-after-free" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-bug-4-use-after-free">Step 4. Bug #4, Use-After-Free</h4>
<p><strong>Buggy Code:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1019"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1019-1"><a href="#cb1019-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1019-2"><a href="#cb1019-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb1019-3"><a href="#cb1019-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1019-4"><a href="#cb1019-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1019-5"><a href="#cb1019-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>x <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb1019-6"><a href="#cb1019-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>x <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb1019-7"><a href="#cb1019-7" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>x<span class="op">);</span></span>
<span id="cb1019-8"><a href="#cb1019-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>x<span class="op">);</span>  <span class="co">// ❌ accessing freed memory</span></span>
<span id="cb1019-9"><a href="#cb1019-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Fix:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1020"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1020-1"><a href="#cb1020-1" aria-hidden="true" tabindex="-1"></a>free<span class="op">(</span>x<span class="op">);</span></span>
<span id="cb1020-2"><a href="#cb1020-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> NULL<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1021"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1021-1"><a href="#cb1021-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>x<span class="op">)</span> printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>x<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Lesson:</strong> Once you free memory, it’s no longer yours, never touch it again.</p>
</section>
<section id="step-5.-bug-5-stack-variable-escaping-scope" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-bug-5-stack-variable-escaping-scope">Step 5. Bug #5, Stack Variable Escaping Scope</h4>
<p><strong>Buggy Code:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1022"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1022-1"><a href="#cb1022-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>make_ptr<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1022-2"><a href="#cb1022-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb1022-3"><a href="#cb1022-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">&amp;</span>x<span class="op">;</span>  <span class="co">// ❌ pointer to local variable</span></span>
<span id="cb1022-4"><a href="#cb1022-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1022-5"><a href="#cb1022-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1022-6"><a href="#cb1022-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1022-7"><a href="#cb1022-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> make_ptr<span class="op">();</span></span>
<span id="cb1022-8"><a href="#cb1022-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span>  <span class="co">// UB</span></span>
<span id="cb1022-9"><a href="#cb1022-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Fix:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1023"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1023-1"><a href="#cb1023-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>make_ptr<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1023-2"><a href="#cb1023-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>x <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb1023-3"><a href="#cb1023-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb1023-4"><a href="#cb1023-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x<span class="op">;</span></span>
<span id="cb1023-5"><a href="#cb1023-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>and remember to <code>free(p)</code> later.</p>
<p><strong>Lesson:</strong> Never return the address of a local variable, its lifetime ends when the function returns.</p>
</section>
<section id="step-6.-bug-6-missing-return-statement" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-bug-6-missing-return-statement">Step 6. Bug #6, Missing Return Statement</h4>
<p><strong>Buggy Code:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1024"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1024-1"><a href="#cb1024-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1024-2"><a href="#cb1024-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> c <span class="op">=</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb1024-3"><a href="#cb1024-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// forgot to return</span></span>
<span id="cb1024-4"><a href="#cb1024-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1024-5"><a href="#cb1024-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1024-6"><a href="#cb1024-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1024-7"><a href="#cb1024-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> add<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">));</span></span>
<span id="cb1024-8"><a href="#cb1024-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Fix:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1025"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1025-1"><a href="#cb1025-1" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> c<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Lesson:</strong> If the function’s return type is non-<code>void</code>, always return a value. Compile with <code>-Wall -Wextra</code> to catch this automatically.</p>
</section>
<section id="step-7.-bug-7-uninitialized-variable" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-bug-7-uninitialized-variable">Step 7. Bug #7, Uninitialized Variable</h4>
<p><strong>Buggy Code:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1026"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1026-1"><a href="#cb1026-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sum<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1026-2"><a href="#cb1026-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> s<span class="op">;</span></span>
<span id="cb1026-3"><a href="#cb1026-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> i<span class="op">++)</span> s <span class="op">+=</span> i<span class="op">;</span>  <span class="co">// s not initialized</span></span>
<span id="cb1026-4"><a href="#cb1026-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s<span class="op">;</span></span>
<span id="cb1026-5"><a href="#cb1026-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Fix:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1027"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1027-1"><a href="#cb1027-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> s <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Lesson:</strong> Initialize all variables before using them, especially accumulators.</p>
</section>
<section id="step-8.-bug-8-mixing-signed-and-unsigned" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-bug-8-mixing-signed-and-unsigned">Step 8. Bug #8, Mixing Signed and Unsigned</h4>
<p><strong>Buggy Code:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1028"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1028-1"><a href="#cb1028-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1028-2"><a href="#cb1028-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1028-3"><a href="#cb1028-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1028-4"><a href="#cb1028-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1028-5"><a href="#cb1028-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> b <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1028-6"><a href="#cb1028-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a <span class="op">&lt;</span> b<span class="op">)</span> printf<span class="op">(</span><span class="st">"less</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span> <span class="cf">else</span> printf<span class="op">(</span><span class="st">"greater</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1028-7"><a href="#cb1028-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Output:</strong></p>
<pre><code>greater</code></pre>
<p><strong>Explanation:</strong> <code>a</code> is converted to unsigned, so it becomes a large positive number.</p>
<p><strong>Fix:</strong> Avoid mixing signed and unsigned types. Use explicit casts or consistent types.</p>
</section>
<section id="step-9.-bug-9-buffer-overflow" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-bug-9-buffer-overflow">Step 9. Bug #9, Buffer Overflow</h4>
<p><strong>Buggy Code:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1030"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1030-1"><a href="#cb1030-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1030-2"><a href="#cb1030-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb1030-3"><a href="#cb1030-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1030-4"><a href="#cb1030-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1030-5"><a href="#cb1030-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">8</span><span class="op">];</span></span>
<span id="cb1030-6"><a href="#cb1030-6" aria-hidden="true" tabindex="-1"></a>    strcpy<span class="op">(</span>name<span class="op">,</span> <span class="st">"Superlongname"</span><span class="op">);</span>  <span class="co">// ❌ too big</span></span>
<span id="cb1030-7"><a href="#cb1030-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> name<span class="op">);</span></span>
<span id="cb1030-8"><a href="#cb1030-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Fix:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1031"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1031-1"><a href="#cb1031-1" aria-hidden="true" tabindex="-1"></a>strncpy<span class="op">(</span>name<span class="op">,</span> <span class="st">"Superlongname"</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>name<span class="op">)</span> <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb1031-2"><a href="#cb1031-2" aria-hidden="true" tabindex="-1"></a>name<span class="op">[</span><span class="dv">7</span><span class="op">]</span> <span class="op">=</span> <span class="ch">'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Lesson:</strong> Never trust input size, always use bounded functions.</p>
</section>
<section id="step-10.-bug-10-floating-point-comparison" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-bug-10-floating-point-comparison">Step 10. Bug #10, Floating-Point Comparison</h4>
<p><strong>Buggy Code:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1032"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1032-1"><a href="#cb1032-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1032-2"><a href="#cb1032-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1032-3"><a href="#cb1032-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1032-4"><a href="#cb1032-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> a <span class="op">=</span> <span class="fl">0.1</span><span class="bu">f</span> <span class="op">*</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb1032-5"><a href="#cb1032-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a <span class="op">==</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">)</span> printf<span class="op">(</span><span class="st">"Equal</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1032-6"><a href="#cb1032-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> printf<span class="op">(</span><span class="st">"Not equal</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1032-7"><a href="#cb1032-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Output:</strong></p>
<pre><code>Not equal</code></pre>
<p><strong>Fix:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1034"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1034-1"><a href="#cb1034-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>fabsf<span class="op">(</span>a <span class="op">-</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1e-6</span><span class="op">)</span> printf<span class="op">(</span><span class="st">"Equal</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Lesson:</strong> Floating-point math is approximate, always compare with a tolerance.</p>
</section>
<section id="putting-it-all-together" class="level4">
<h4 class="anchored" data-anchor-id="putting-it-all-together">Putting It All Together</h4>
<p>You can combine all these techniques:</p>
<ul>
<li>Use <strong>assertions</strong> to catch impossible states.</li>
<li>Use <strong>logging</strong> to trace events.</li>
<li>Run <strong>Valgrind</strong> or <strong>ASan</strong> to detect memory bugs.</li>
<li>Use <strong>unit tests</strong> to verify correctness.</li>
<li>And if it still crashes, <strong>analyze the core dump</strong>.</li>
</ul>
<p>Every debugging tool is a lens. Use them together to see clearly.</p>
</section>
<section id="why-it-matters-68" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-68">Why It Matters</h4>
<p>Debugging teaches you <em>how programs fail</em>. Each bug fixed makes you a more confident systems engineer. C doesn’t forgive mistakes, but it rewards precision.</p>
</section>
<section id="try-it-yourself-78" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-78">Try It Yourself</h4>
<ol type="1">
<li>Write a program containing at least 3 of these bugs.</li>
<li>Run it under AddressSanitizer (<code>-fsanitize=address</code>).</li>
<li>Fix each bug one by one.</li>
<li>Document what caused it and what fixed it.</li>
<li>Make this a personal debugging kata, practice until no bug survives longer than 10 minutes.</li>
</ol>
<p>Next, we’ll begin <strong>Chapter 9: Portable and Modern C</strong>, where you’ll learn how to write C that runs everywhere, from embedded chips to modern servers.</p>
</section>
</section>
</section>
<section id="chapter-9.-portable-and-modern-c" class="level1">
<h1>Chapter 9. Portable and Modern C</h1>
<section id="the-c-standard-timeline-c89-to-c23" class="level3">
<h3 class="anchored" data-anchor-id="the-c-standard-timeline-c89-to-c23">81. The C Standard Timeline (C89 to C23)</h3>
<p>C has been around for more than fifty years, and it has evolved slowly and carefully. Every version of the C standard improves the language while keeping backward compatibility with decades of existing code.</p>
<p>Understanding the <strong>timeline of C standards</strong> helps you write portable, modern code and know which features are safe to use in your target environments.</p>
<section id="step-1.-the-beginning-kr-c-19721989" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-the-beginning-kr-c-19721989">Step 1. The Beginning, K&amp;R C (1972–1989)</h4>
<p>C was born at Bell Labs in the early 1970s, developed by <strong>Dennis Ritchie</strong> as a systems programming language for <strong>Unix</strong>. The first book, <em>The C Programming Language</em> by Kernighan and Ritchie (1978), informally defined “K&amp;R C.”</p>
<p><strong>Key Traits:</strong></p>
<ul>
<li>No standardization yet.</li>
<li>Implicit function declarations.</li>
<li>No <code>void</code> type for functions without return.</li>
<li>No function prototypes (parameters not type-checked).</li>
<li>Header files were optional.</li>
</ul>
<p><strong>Example:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1035"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1035-1"><a href="#cb1035-1" aria-hidden="true" tabindex="-1"></a>main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb1035-2"><a href="#cb1035-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hello, world</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1035-3"><a href="#cb1035-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>It was simple, direct, and dangerous, but it worked.</p>
</section>
<section id="step-2.-ansi-c-c89-c90" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-ansi-c-c89-c90">Step 2. ANSI C (C89 / C90)</h4>
<p>In 1989, C became standardized by ANSI (and in 1990 by ISO). This version, <strong>C89/C90</strong>, unified compiler behavior and made C portable across systems.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li>Function prototypes (<code>int add(int, int);</code>)</li>
<li>Standard headers (<code>&lt;stdio.h&gt;</code>, <code>&lt;stdlib.h&gt;</code>, <code>&lt;string.h&gt;</code>)</li>
<li><code>void</code> keyword</li>
<li>Type qualifiers: <code>const</code>, <code>volatile</code></li>
<li>New library functions (<code>memcpy</code>, <code>qsort</code>, <code>assert</code>)</li>
<li>Formalized the standard library</li>
<li>Single-line comments were still not supported (use <code>/* */</code>)</li>
</ul>
<p><strong>Tiny Code:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1036"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1036-1"><a href="#cb1036-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1036-2"><a href="#cb1036-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1036-3"><a href="#cb1036-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1036-4"><a href="#cb1036-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1036-5"><a href="#cb1036-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1036-6"><a href="#cb1036-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> add<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">));</span></span>
<span id="cb1036-7"><a href="#cb1036-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-3.-c95-iso-amendment" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-c95-iso-amendment">Step 3. C95 (ISO Amendment)</h4>
<p>A minor update that refined C90, rarely mentioned but still significant.</p>
<p><strong>Added:</strong></p>
<ul>
<li>Wide character support (<code>&lt;wchar.h&gt;</code>)</li>
<li>Multibyte strings</li>
<li>More internationalization utilities</li>
<li>Macros like <code>__STDC_VERSION__</code></li>
</ul>
<p>It paved the way for Unicode support in later versions.</p>
</section>
<section id="step-4.-c99-modernization-begins" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-c99-modernization-begins">Step 4. C99, Modernization Begins</h4>
<p>C99 (published in 1999) was the biggest update since the beginning.</p>
<p><strong>Major Improvements:</strong></p>
<ul>
<li><code>//</code> single-line comments</li>
<li>Variable declarations anywhere</li>
<li>Inline functions</li>
<li><code>long long</code> (64-bit integer)</li>
<li><code>stdbool.h</code> for <code>bool</code>, <code>true</code>, <code>false</code></li>
<li><code>stdint.h</code> for fixed-width integers (<code>int32_t</code>, <code>uint64_t</code>)</li>
<li>Designated initializers and compound literals</li>
<li>Flexible array members</li>
<li><code>snprintf</code> safer string formatting</li>
<li>Variable-length arrays (VLAs)</li>
</ul>
<p><strong>Tiny Code:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1037"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1037-1"><a href="#cb1037-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdbool.h&gt;</span></span>
<span id="cb1037-2"><a href="#cb1037-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdint.h&gt;</span></span>
<span id="cb1037-3"><a href="#cb1037-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1037-4"><a href="#cb1037-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1037-5"><a href="#cb1037-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1037-6"><a href="#cb1037-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> done <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb1037-7"><a href="#cb1037-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint64_t</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1037-8"><a href="#cb1037-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb1037-9"><a href="#cb1037-9" aria-hidden="true" tabindex="-1"></a>        sum <span class="op">+=</span> i<span class="op">;</span></span>
<span id="cb1037-10"><a href="#cb1037-10" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%llu\n</span><span class="st">"</span><span class="op">,</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span><span class="op">)</span>sum<span class="op">);</span></span>
<span id="cb1037-11"><a href="#cb1037-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> done<span class="op">;</span></span>
<span id="cb1037-12"><a href="#cb1037-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>C99 made C feel modern, introducing safer and more expressive syntax.</p>
</section>
<section id="step-5.-c11-concurrency-and-safety" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-c11-concurrency-and-safety">Step 5. C11, Concurrency and Safety</h4>
<p>Released in 2011, <strong>C11</strong> added better threading and safety mechanisms.</p>
<p><strong>Key Additions:</strong></p>
<ul>
<li><code>_Thread_local</code> storage specifier</li>
<li><code>&lt;threads.h&gt;</code> for portable threads, mutexes, condition variables</li>
<li><code>_Atomic</code> for atomic operations</li>
<li><code>_Static_assert</code> for compile-time checks</li>
<li>Bounds-checked functions (<code>strcpy_s</code>, <code>memcpy_s</code>)</li>
<li>Optional Annex K for safer standard library functions</li>
<li>Improved Unicode and wide character support</li>
</ul>
<p><strong>Tiny Code:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1038"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1038-1"><a href="#cb1038-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;threads.h&gt;</span></span>
<span id="cb1038-2"><a href="#cb1038-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1038-3"><a href="#cb1038-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1038-4"><a href="#cb1038-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> run<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1038-5"><a href="#cb1038-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hello from thread </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*(</span><span class="dt">int</span> <span class="op">*)</span>arg<span class="op">);</span></span>
<span id="cb1038-6"><a href="#cb1038-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1038-7"><a href="#cb1038-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1038-8"><a href="#cb1038-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1038-9"><a href="#cb1038-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1038-10"><a href="#cb1038-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1038-11"><a href="#cb1038-11" aria-hidden="true" tabindex="-1"></a>    thrd_t t<span class="op">;</span></span>
<span id="cb1038-12"><a href="#cb1038-12" aria-hidden="true" tabindex="-1"></a>    thrd_create<span class="op">(&amp;</span>t<span class="op">,</span> run<span class="op">,</span> <span class="op">&amp;</span>id<span class="op">);</span></span>
<span id="cb1038-13"><a href="#cb1038-13" aria-hidden="true" tabindex="-1"></a>    thrd_join<span class="op">(</span>t<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1038-14"><a href="#cb1038-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>C11 made C safer and concurrency-aware, though not all compilers implemented <code>&lt;threads.h&gt;</code> fully.</p>
</section>
<section id="step-6.-c17-a.k.a.-c18-the-refinement" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-c17-a.k.a.-c18-the-refinement">Step 6. C17 (a.k.a. C18), The Refinement</h4>
<p>Officially ISO/IEC 9899:2018 (published in 2018), C17 fixed inconsistencies and bugs in C11 but didn’t add new features.</p>
<p><strong>Highlights:</strong></p>
<ul>
<li>Clarifications to atomics, macros, and UB rules.</li>
<li>Improved compatibility with C++ compilers.</li>
<li>Bug fixes in the standard library.</li>
<li><code>__STDC_VERSION__</code> is <code>201710L</code>.</li>
</ul>
<p>It’s the default “stable” standard for modern C codebases.</p>
</section>
<section id="step-7.-c23-the-latest-standard" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-c23-the-latest-standard">Step 7. C23, The Latest Standard</h4>
<p>C23 is the most recent (published in 2024), continuing modernization without breaking backward compatibility.</p>
<p><strong>Major Features:</strong></p>
<ul>
<li><code>typeof</code> (like in GCC)</li>
<li><code>nullptr</code> keyword</li>
<li><code>static_assert</code> (alias for <code>_Static_assert</code>)</li>
<li>UTF-8 string literals: <code>u8"Hello"</code></li>
<li>New standard attributes (<code>[[maybe_unused]]</code>, <code>[[nodiscard]]</code>)</li>
<li><code>constexpr</code>-like features (<code>constexpr</code> functions are planned)</li>
<li>Better Unicode and formatting APIs</li>
<li>Safer library extensions</li>
<li>Improved interoperability with C++</li>
</ul>
<p><strong>Tiny Code:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1039"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1039-1"><a href="#cb1039-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1039-2"><a href="#cb1039-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1039-3"><a href="#cb1039-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1039-4"><a href="#cb1039-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb1039-5"><a href="#cb1039-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">[[</span><span class="at">maybe_unused</span><span class="op">]]</span> <span class="dt">int</span> y <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb1039-6"><a href="#cb1039-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">)</span> <span class="op">==</span> <span class="dv">4</span><span class="op">,</span> <span class="st">"Expected 4-byte int"</span><span class="op">);</span></span>
<span id="cb1039-7"><a href="#cb1039-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb1039-8"><a href="#cb1039-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>C23 brings C closer to modern C++ and Rust-style safety while staying simple and lightweight.</p>
</section>
<section id="step-8.-checking-your-compilers-version" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-checking-your-compilers-version">Step 8. Checking Your Compiler’s Version</h4>
<p>You can check your compiler’s supported C standard using:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1040"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1040-1"><a href="#cb1040-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-dM</span> <span class="at">-E</span> <span class="at">-</span> <span class="op">&lt;</span> /dev/null <span class="kw">|</span> <span class="fu">grep</span> __STDC_VERSION__</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Common outputs:</p>
<pre><code>199901L  → C99  
201112L  → C11  
201710L  → C17  
202311L  → C23</code></pre>
<p>Or compile with:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1042"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1042-1"><a href="#cb1042-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-std</span><span class="op">=</span>c99 program.c</span>
<span id="cb1042-2"><a href="#cb1042-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-std</span><span class="op">=</span>c11 program.c</span>
<span id="cb1042-3"><a href="#cb1042-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-std</span><span class="op">=</span>c23 program.c</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-9.-compatibility-and-portability-tips" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-compatibility-and-portability-tips">Step 9. Compatibility and Portability Tips</h4>
<ul>
<li>Always declare the standard explicitly: <code>-std=c11</code> or <code>-std=c17</code>.</li>
<li>Avoid compiler-specific extensions unless guarded with <code>#ifdef __GNUC__</code>.</li>
<li>Use standard headers like <code>&lt;stdint.h&gt;</code> and <code>&lt;stdbool.h&gt;</code>.</li>
<li>When writing libraries, prefer the lowest standard that supports your needs.</li>
<li>Add <code>_Static_assert</code> or <code>#error</code> for unsupported standards.</li>
</ul>
</section>
<section id="step-10.-tiny-code-version-detector" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-version-detector">Step 10. Tiny Code: Version Detector</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1043"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1043-1"><a href="#cb1043-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1043-2"><a href="#cb1043-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1043-3"><a href="#cb1043-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1043-4"><a href="#cb1043-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#if __STDC_VERSION__ &gt;= 202311L</span></span>
<span id="cb1043-5"><a href="#cb1043-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"C23 or newer</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1043-6"><a href="#cb1043-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#elif __STDC_VERSION__ &gt;= 201710L</span></span>
<span id="cb1043-7"><a href="#cb1043-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"C17</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1043-8"><a href="#cb1043-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#elif __STDC_VERSION__ &gt;= 201112L</span></span>
<span id="cb1043-9"><a href="#cb1043-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"C11</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1043-10"><a href="#cb1043-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#elif __STDC_VERSION__ &gt;= 199901L</span></span>
<span id="cb1043-11"><a href="#cb1043-11" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"C99</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1043-12"><a href="#cb1043-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span>
<span id="cb1043-13"><a href="#cb1043-13" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"C90 or earlier</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1043-14"><a href="#cb1043-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb1043-15"><a href="#cb1043-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run to see what your compiler supports.</p>
</section>
<section id="why-it-matters-69" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-69">Why It Matters</h4>
<p>C’s evolution shows its unique philosophy: <strong>change slowly, but never break old code.</strong> Knowing which standard you target means you can use modern features confidently, without losing portability.</p>
</section>
<section id="try-it-yourself-79" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-79">Try It Yourself</h4>
<ol type="1">
<li>Write the version detector program above and run it with <code>-std=c99</code>, <code>-std=c11</code>, and <code>-std=c23</code>.</li>
<li>Experiment with <code>_Static_assert</code> and <code>_Thread_local</code>, see which standards support them.</li>
<li>Try compiling a small thread example using <code>&lt;threads.h&gt;</code>.</li>
<li>Look up your compiler’s documentation to see which features of C23 are implemented.</li>
<li>Pick one feature (like <code>[[nodiscard]]</code>) and use it in a tiny project.</li>
</ol>
<p>Next, you’ll explore <strong>portability and endianness</strong>, the invisible details that determine how your C programs behave across different machines and architectures.</p>
</section>
</section>
<section id="portability-and-endianness" class="level3">
<h3 class="anchored" data-anchor-id="portability-and-endianness">82. Portability and Endianness</h3>
<p>Portability means your C program behaves the same way everywhere, on Linux, Windows, ARM, x86, or even a tiny microcontroller. Writing portable code is one of the hardest and most important skills in systems programming.</p>
<p>This section helps you understand the biggest low-level trap of all: <strong>endianness</strong>, and how to write code that runs safely across architectures.</p>
<section id="step-1.-what-is-portability" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-is-portability">Step 1. What Is Portability?</h4>
<p>A <strong>portable C program</strong> is one that:</p>
<ul>
<li>Compiles cleanly with different compilers.</li>
<li>Runs correctly on 32-bit, 64-bit, and embedded systems.</li>
<li>Does not assume details of CPU, OS, or compiler behavior.</li>
</ul>
<p>Portability depends on respecting what the C standard guarantees, and avoiding assumptions that might be true only on <em>your</em> machine.</p>
</section>
<section id="step-2.-why-portability-matters" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-why-portability-matters">Step 2. Why Portability Matters</h4>
<p>You might write a C program on macOS (little-endian x86_64) and later need to run it on:</p>
<ul>
<li>A Raspberry Pi (ARM, also little-endian)</li>
<li>A big-endian PowerPC router</li>
<li>An embedded MIPS controller</li>
</ul>
<p>If your program reads or writes binary data, it must handle <strong>endianness</strong>, or the same file may be misread on another architecture.</p>
</section>
<section id="step-3.-understanding-endianness" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-understanding-endianness">Step 3. Understanding Endianness</h4>
<p>Endianness defines how bytes of multibyte values are stored in memory.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 36%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
<th>Memory (4-byte int = 0x12345678)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Little-endian</strong></td>
<td>Least significant byte first</td>
<td><code>78 56 34 12</code></td>
</tr>
<tr class="even">
<td><strong>Big-endian</strong></td>
<td>Most significant byte first</td>
<td><code>12 34 56 78</code></td>
</tr>
</tbody>
</table>
<p>Intel and ARM (in most modes) are <strong>little-endian</strong>. Many older CPUs (PowerPC, SPARC) are <strong>big-endian</strong>.</p>
<p>C does not define the byte order, it depends on the platform.</p>
</section>
<section id="step-4.-checking-endianness-at-runtime" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-checking-endianness-at-runtime">Step 4. Checking Endianness at Runtime</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1044"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1044-1"><a href="#cb1044-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1044-2"><a href="#cb1044-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1044-3"><a href="#cb1044-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1044-4"><a href="#cb1044-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> x <span class="op">=</span> <span class="bn">0x12345678</span><span class="op">;</span></span>
<span id="cb1044-5"><a href="#cb1044-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*)&amp;</span>x<span class="op">;</span></span>
<span id="cb1044-6"><a href="#cb1044-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1044-7"><a href="#cb1044-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(*</span>p <span class="op">==</span> <span class="bn">0x78</span><span class="op">)</span></span>
<span id="cb1044-8"><a href="#cb1044-8" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Little-endian</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1044-9"><a href="#cb1044-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb1044-10"><a href="#cb1044-10" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Big-endian</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1044-11"><a href="#cb1044-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Explanation:</strong> The pointer <code>p</code> reads the lowest memory byte. If it contains the least significant byte (<code>0x78</code>), it’s little-endian.</p>
</section>
<section id="step-5.-converting-between-endiannesses" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-converting-between-endiannesses">Step 5. Converting Between Endiannesses</h4>
<p>Use standard POSIX functions to handle conversions safely:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1045"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1045-1"><a href="#cb1045-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;arpa/inet.h&gt;</span><span class="pp">  </span><span class="co">// or &lt;winsock2.h&gt; on Windows</span></span>
<span id="cb1045-2"><a href="#cb1045-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdint.h&gt;</span></span>
<span id="cb1045-3"><a href="#cb1045-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1045-4"><a href="#cb1045-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1045-5"><a href="#cb1045-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1045-6"><a href="#cb1045-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> x <span class="op">=</span> <span class="bn">0x12345678</span><span class="op">;</span></span>
<span id="cb1045-7"><a href="#cb1045-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> y <span class="op">=</span> htonl<span class="op">(</span>x<span class="op">);</span> <span class="co">// Host to Network Long (big-endian)</span></span>
<span id="cb1045-8"><a href="#cb1045-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"0x</span><span class="sc">%x</span><span class="st"> -&gt; 0x</span><span class="sc">%x\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">,</span> y<span class="op">);</span></span>
<span id="cb1045-9"><a href="#cb1045-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Functions:</strong></p>
<ul>
<li><code>htons</code> – host to network short (16-bit)</li>
<li><code>htonl</code> – host to network long (32-bit)</li>
<li><code>ntohs</code> – network to host short</li>
<li><code>ntohl</code> – network to host long</li>
</ul>
<p>Network byte order is always <strong>big-endian</strong>.</p>
</section>
<section id="step-6.-handling-portability-in-file-formats" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-handling-portability-in-file-formats">Step 6. Handling Portability in File Formats</h4>
<p>If you serialize structs directly to disk:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1046"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1046-1"><a href="#cb1046-1" aria-hidden="true" tabindex="-1"></a>fwrite<span class="op">(&amp;</span>header<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>header<span class="op">),</span> <span class="dv">1</span><span class="op">,</span> file<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>you’re likely writing machine-dependent data:</p>
<ul>
<li>Endianness may differ.</li>
<li>Padding and alignment may differ.</li>
<li>Structure layout can vary by compiler.</li>
</ul>
<p><strong>Better approach:</strong> Write each field individually in a well-defined order:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1047"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1047-1"><a href="#cb1047-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> size_net <span class="op">=</span> htonl<span class="op">(</span>header<span class="op">.</span>size<span class="op">);</span></span>
<span id="cb1047-2"><a href="#cb1047-2" aria-hidden="true" tabindex="-1"></a>fwrite<span class="op">(&amp;</span>size_net<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>size_net<span class="op">),</span> <span class="dv">1</span><span class="op">,</span> file<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now, any machine can read your file by reversing the conversion (<code>ntohl</code>).</p>
</section>
<section id="step-7.-data-type-size-differences" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-data-type-size-differences">Step 7. Data Type Size Differences</h4>
<p>Type sizes vary across systems:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Typical 32-bit</th>
<th>Typical 64-bit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>char</code></td>
<td>1 byte</td>
<td>1 byte</td>
</tr>
<tr class="even">
<td><code>short</code></td>
<td>2 bytes</td>
<td>2 bytes</td>
</tr>
<tr class="odd">
<td><code>int</code></td>
<td>4 bytes</td>
<td>4 bytes</td>
</tr>
<tr class="even">
<td><code>long</code></td>
<td>4 bytes</td>
<td>8 bytes</td>
</tr>
<tr class="odd">
<td><code>long long</code></td>
<td>8 bytes</td>
<td>8 bytes</td>
</tr>
<tr class="even">
<td><code>void*</code></td>
<td>4 bytes</td>
<td>8 bytes</td>
</tr>
</tbody>
</table>
<p>Use <code>&lt;stdint.h&gt;</code> types (<code>int32_t</code>, <code>uint64_t</code>, etc.) for predictable sizes.</p>
</section>
<section id="step-8.-alignment-and-padding" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-alignment-and-padding">Step 8. Alignment and Padding</h4>
<p>The compiler may insert padding between structure fields for speed or alignment.</p>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1048"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1048-1"><a href="#cb1048-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Example <span class="op">{</span></span>
<span id="cb1048-2"><a href="#cb1048-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> a<span class="op">;</span></span>
<span id="cb1048-3"><a href="#cb1048-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> b<span class="op">;</span></span>
<span id="cb1048-4"><a href="#cb1048-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>On most systems:</p>
<ul>
<li><code>sizeof(struct Example)</code> = 8, not 5 (3 bytes of padding).</li>
</ul>
<p>To make portable formats:</p>
<ul>
<li>Use <code>#pragma pack(1)</code> (non-standard) or serialize field-by-field.</li>
<li>Never assume <code>sizeof(struct)</code> is the same across systems.</li>
</ul>
</section>
<section id="step-9.-compiler-and-os-differences" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-compiler-and-os-differences">Step 9. Compiler and OS Differences</h4>
<p><strong>Be careful with:</strong></p>
<ul>
<li>Path separators (<code>/</code> vs <code>\\</code>)</li>
<li>Newline conventions (<code>\n</code> vs <code>\r\n</code>)</li>
<li><code>#include &lt;unistd.h&gt;</code> (POSIX only)</li>
<li><code>system()</code> commands (OS-specific)</li>
<li>Thread APIs (<code>pthread</code> vs Windows threads)</li>
<li>Socket APIs (<code>&lt;arpa/inet.h&gt;</code> vs <code>&lt;winsock2.h&gt;</code>)</li>
</ul>
<p>Use conditional compilation:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1049"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1049-1"><a href="#cb1049-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef _WIN32</span></span>
<span id="cb1049-2"><a href="#cb1049-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;winsock2.h&gt;</span></span>
<span id="cb1049-3"><a href="#cb1049-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span>
<span id="cb1049-4"><a href="#cb1049-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;arpa/inet.h&gt;</span></span>
<span id="cb1049-5"><a href="#cb1049-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-10.-tiny-code-writing-portable-binary-io" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-writing-portable-binary-io">Step 10. Tiny Code: Writing Portable Binary I/O</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1050"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1050-1"><a href="#cb1050-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1050-2"><a href="#cb1050-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdint.h&gt;</span></span>
<span id="cb1050-3"><a href="#cb1050-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;arpa/inet.h&gt;</span></span>
<span id="cb1050-4"><a href="#cb1050-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1050-5"><a href="#cb1050-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1050-6"><a href="#cb1050-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>f <span class="op">=</span> fopen<span class="op">(</span><span class="st">"num.bin"</span><span class="op">,</span> <span class="st">"wb"</span><span class="op">);</span></span>
<span id="cb1050-7"><a href="#cb1050-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> n <span class="op">=</span> <span class="bn">0x12345678</span><span class="op">;</span></span>
<span id="cb1050-8"><a href="#cb1050-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> net <span class="op">=</span> htonl<span class="op">(</span>n<span class="op">);</span></span>
<span id="cb1050-9"><a href="#cb1050-9" aria-hidden="true" tabindex="-1"></a>    fwrite<span class="op">(&amp;</span>net<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>net<span class="op">),</span> <span class="dv">1</span><span class="op">,</span> f<span class="op">);</span></span>
<span id="cb1050-10"><a href="#cb1050-10" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>f<span class="op">);</span></span>
<span id="cb1050-11"><a href="#cb1050-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1050-12"><a href="#cb1050-12" aria-hidden="true" tabindex="-1"></a>    f <span class="op">=</span> fopen<span class="op">(</span><span class="st">"num.bin"</span><span class="op">,</span> <span class="st">"rb"</span><span class="op">);</span></span>
<span id="cb1050-13"><a href="#cb1050-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> read_net<span class="op">;</span></span>
<span id="cb1050-14"><a href="#cb1050-14" aria-hidden="true" tabindex="-1"></a>    fread<span class="op">(&amp;</span>read_net<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>read_net<span class="op">),</span> <span class="dv">1</span><span class="op">,</span> f<span class="op">);</span></span>
<span id="cb1050-15"><a href="#cb1050-15" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>f<span class="op">);</span></span>
<span id="cb1050-16"><a href="#cb1050-16" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Read back: 0x</span><span class="sc">%x\n</span><span class="st">"</span><span class="op">,</span> ntohl<span class="op">(</span>read_net<span class="op">));</span></span>
<span id="cb1050-17"><a href="#cb1050-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This program writes and reads a 32-bit integer in <strong>portable big-endian form</strong>, the same bytes on any machine.</p>
</section>
<section id="why-it-matters-70" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-70">Why It Matters</h4>
<p>Portability ensures your software lives longer than your hardware. A portable program:</p>
<ul>
<li>Runs on different CPUs and OSes.</li>
<li>Shares data safely across architectures.</li>
<li>Builds trust in your code across teams and systems.</li>
</ul>
<p>Portability is a kind of professionalism, future-proofing your code.</p>
</section>
<section id="try-it-yourself-80" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-80">Try It Yourself</h4>
<ol type="1">
<li>Write a program that detects and prints system endianness.</li>
<li>Serialize a struct to a binary file, then deserialize it on another system.</li>
<li>Use <code>htonl</code> and <code>ntohl</code> to ensure data stays consistent.</li>
<li>Compile your code with both GCC and Clang.</li>
<li>Test it on both 32-bit and 64-bit architectures.</li>
</ol>
<p>Next, you’ll explore <strong>inline assembly and hardware access</strong>, the bridge between pure C and the underlying CPU instructions.</p>
</section>
</section>
<section id="inline-assembly-and-hardware-access" class="level3">
<h3 class="anchored" data-anchor-id="inline-assembly-and-hardware-access">83. Inline Assembly and Hardware Access</h3>
<p>C gives you precise control over memory and performance, but sometimes you need to go one level deeper, directly to the <strong>CPU</strong>. That’s where <strong>inline assembly</strong> comes in: embedding assembly language inside your C code to optimize performance or access hardware-level features.</p>
<p>This chapter will show how to mix C and assembly safely, portably, and meaningfully.</p>
<section id="step-1.-what-is-inline-assembly" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-is-inline-assembly">Step 1. What Is Inline Assembly?</h4>
<p><strong>Inline assembly</strong> lets you insert small snippets of machine instructions into your C program. You can use it to:</p>
<ul>
<li>Access CPU instructions not exposed by C.</li>
<li>Optimize performance-critical paths.</li>
<li>Implement hardware drivers or low-level routines.</li>
</ul>
<p>However, it’s also <strong>non-portable</strong> and compiler-specific, so use it sparingly and isolate it behind clean C interfaces.</p>
</section>
<section id="step-2.-two-common-flavors" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-two-common-flavors">Step 2. Two Common Flavors</h4>
<ol type="1">
<li><p><strong>GCC / Clang syntax (AT&amp;T or Intel style)</strong> Uses the <code>asm</code> or <code>__asm__</code> keyword.</p></li>
<li><p><strong>MSVC syntax</strong> Uses <code>__asm { ... }</code> inside functions.</p></li>
</ol>
<p>We’ll focus on GCC/Clang syntax, since it’s used in most systems programming contexts.</p>
</section>
<section id="step-3.-basic-inline-assembly-example" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-basic-inline-assembly-example">Step 3. Basic Inline Assembly Example</h4>
<p><strong>Tiny Code:</strong> Print CPU ID register (x86 only)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1051"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1051-1"><a href="#cb1051-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1051-2"><a href="#cb1051-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1051-3"><a href="#cb1051-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1051-4"><a href="#cb1051-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> eax<span class="op">,</span> ebx<span class="op">,</span> ecx<span class="op">,</span> edx<span class="op">;</span></span>
<span id="cb1051-5"><a href="#cb1051-5" aria-hidden="true" tabindex="-1"></a>    eax <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1051-6"><a href="#cb1051-6" aria-hidden="true" tabindex="-1"></a>    __asm__ __volatile__<span class="op">(</span></span>
<span id="cb1051-7"><a href="#cb1051-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cpuid"</span></span>
<span id="cb1051-8"><a href="#cb1051-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span> <span class="st">"=a"</span><span class="op">(</span>eax<span class="op">),</span> <span class="st">"=b"</span><span class="op">(</span>ebx<span class="op">),</span> <span class="st">"=c"</span><span class="op">(</span>ecx<span class="op">),</span> <span class="st">"=d"</span><span class="op">(</span>edx<span class="op">)</span></span>
<span id="cb1051-9"><a href="#cb1051-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span> <span class="st">"a"</span><span class="op">(</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb1051-10"><a href="#cb1051-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb1051-11"><a href="#cb1051-11" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"CPU Vendor: </span><span class="sc">%.4s%.4s%.4s\n</span><span class="st">"</span><span class="op">,</span></span>
<span id="cb1051-12"><a href="#cb1051-12" aria-hidden="true" tabindex="-1"></a>           <span class="op">(</span><span class="dt">char</span><span class="op">*)&amp;</span>ebx<span class="op">,</span> <span class="op">(</span><span class="dt">char</span><span class="op">*)&amp;</span>edx<span class="op">,</span> <span class="op">(</span><span class="dt">char</span><span class="op">*)&amp;</span>ecx<span class="op">);</span></span>
<span id="cb1051-13"><a href="#cb1051-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Explanation:</strong></p>
<ul>
<li><code>cpuid</code> is a CPU instruction that fills registers with information.</li>
<li><code>"=a"(eax)</code> means “store the output of register <code>eax</code> into variable <code>eax</code>.”</li>
<li><code>: "a"(0)</code> means “put 0 into <code>eax</code> before running the instruction.”</li>
<li>The <code>__volatile__</code> keyword tells the compiler not to optimize it away.</li>
</ul>
</section>
<section id="step-4.-gcc-inline-assembly-syntax" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-gcc-inline-assembly-syntax">Step 4. GCC Inline Assembly Syntax</h4>
<p>General form:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1052"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1052-1"><a href="#cb1052-1" aria-hidden="true" tabindex="-1"></a>asm <span class="dt">volatile</span> <span class="op">(</span><span class="st">"instruction list"</span></span>
<span id="cb1052-2"><a href="#cb1052-2" aria-hidden="true" tabindex="-1"></a>              <span class="op">:</span> output_operands</span>
<span id="cb1052-3"><a href="#cb1052-3" aria-hidden="true" tabindex="-1"></a>              <span class="op">:</span> input_operands</span>
<span id="cb1052-4"><a href="#cb1052-4" aria-hidden="true" tabindex="-1"></a>              <span class="op">:</span> clobbered_registers<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1053"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1053-1"><a href="#cb1053-1" aria-hidden="true" tabindex="-1"></a>asm <span class="dt">volatile</span> <span class="op">(</span><span class="st">"addl </span><span class="sc">%%</span><span class="st">ebx, </span><span class="sc">%%</span><span class="st">eax"</span></span>
<span id="cb1053-2"><a href="#cb1053-2" aria-hidden="true" tabindex="-1"></a>              <span class="op">:</span> <span class="st">"=a"</span><span class="op">(</span>result<span class="op">)</span></span>
<span id="cb1053-3"><a href="#cb1053-3" aria-hidden="true" tabindex="-1"></a>              <span class="op">:</span> <span class="st">"a"</span><span class="op">(</span>x<span class="op">),</span> <span class="st">"b"</span><span class="op">(</span>y<span class="op">));</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Explanation:</strong></p>
<ul>
<li><code>"addl %%ebx, %%eax"</code>, assembly instruction</li>
<li><code>"=a"(result)</code>, output in <code>eax</code> goes to <code>result</code></li>
<li><code>"a"(x), "b"(y)</code>, inputs: put <code>x</code> in <code>eax</code>, <code>y</code> in <code>ebx</code></li>
</ul>
</section>
<section id="step-5.-reading-cpu-cycle-counters" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-reading-cpu-cycle-counters">Step 5. Reading CPU Cycle Counters</h4>
<p><strong>Tiny Code: Measure CPU cycles between operations</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1054"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1054-1"><a href="#cb1054-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1054-2"><a href="#cb1054-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1054-3"><a href="#cb1054-3" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> rdtsc<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1054-4"><a href="#cb1054-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> lo<span class="op">,</span> hi<span class="op">;</span></span>
<span id="cb1054-5"><a href="#cb1054-5" aria-hidden="true" tabindex="-1"></a>    __asm__ __volatile__<span class="op">(</span><span class="st">"rdtsc"</span> <span class="op">:</span> <span class="st">"=a"</span><span class="op">(</span>lo<span class="op">),</span> <span class="st">"=d"</span><span class="op">(</span>hi<span class="op">));</span></span>
<span id="cb1054-6"><a href="#cb1054-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">((</span><span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span><span class="op">)</span>hi <span class="op">&lt;&lt;</span> <span class="dv">32</span><span class="op">)</span> <span class="op">|</span> lo<span class="op">;</span></span>
<span id="cb1054-7"><a href="#cb1054-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1054-8"><a href="#cb1054-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1054-9"><a href="#cb1054-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1054-10"><a href="#cb1054-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> start <span class="op">=</span> rdtsc<span class="op">();</span></span>
<span id="cb1054-11"><a href="#cb1054-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">volatile</span> <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">1000000</span><span class="op">;</span> i<span class="op">++);</span></span>
<span id="cb1054-12"><a href="#cb1054-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> end <span class="op">=</span> rdtsc<span class="op">();</span></span>
<span id="cb1054-13"><a href="#cb1054-13" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Cycles: </span><span class="sc">%llu\n</span><span class="st">"</span><span class="op">,</span> end <span class="op">-</span> start<span class="op">);</span></span>
<span id="cb1054-14"><a href="#cb1054-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Explanation:</strong></p>
<ul>
<li><code>rdtsc</code> reads the CPU’s timestamp counter.</li>
<li>It’s a precise measure of time in CPU cycles, great for microbenchmarking.</li>
</ul>
</section>
<section id="step-6.-writing-to-io-ports-embedded-or-kernel-context" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-writing-to-io-ports-embedded-or-kernel-context">Step 6. Writing to I/O Ports (Embedded or Kernel Context)</h4>
<p>If you’re writing embedded code or OS kernels, you often interact with hardware registers directly.</p>
<p>Example (x86, privileged mode only):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1055"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1055-1"><a href="#cb1055-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="kw">inline</span> <span class="dt">void</span> outb<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">short</span> port<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">char</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1055-2"><a href="#cb1055-2" aria-hidden="true" tabindex="-1"></a>    __asm__ __volatile__<span class="op">(</span><span class="st">"outb %0, %1"</span> <span class="op">:</span> <span class="op">:</span> <span class="st">"a"</span><span class="op">(</span>value<span class="op">),</span> <span class="st">"Nd"</span><span class="op">(</span>port<span class="op">));</span></span>
<span id="cb1055-3"><a href="#cb1055-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This writes a byte to an I/O port, used for devices like serial ports, timers, or PIC controllers.</p>
<p>In user-space, you generally can’t do this (needs kernel privileges).</p>
</section>
<section id="step-7.-memory-barriers-and-cpu-fences" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-memory-barriers-and-cpu-fences">Step 7. Memory Barriers and CPU Fences</h4>
<p>When working with concurrency or hardware, you may need to control instruction ordering.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1056"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1056-1"><a href="#cb1056-1" aria-hidden="true" tabindex="-1"></a>__asm__ __volatile__<span class="op">(</span><span class="st">"mfence"</span> <span class="op">:::</span> <span class="st">"memory"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This tells the CPU and compiler not to reorder memory operations, essential for writing thread-safe or device-control code at the hardware level.</p>
</section>
<section id="step-8.-register-constraints" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-register-constraints">Step 8. Register Constraints</h4>
<p>GCC lets you specify which registers to use.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Constraint</th>
<th>Register</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>"a"</code></td>
<td><code>eax</code></td>
<td>accumulator</td>
</tr>
<tr class="even">
<td><code>"b"</code></td>
<td><code>ebx</code></td>
<td>base</td>
</tr>
<tr class="odd">
<td><code>"c"</code></td>
<td><code>ecx</code></td>
<td>counter</td>
</tr>
<tr class="even">
<td><code>"d"</code></td>
<td><code>edx</code></td>
<td>data</td>
</tr>
<tr class="odd">
<td><code>"S"</code></td>
<td><code>esi</code></td>
<td>source index</td>
</tr>
<tr class="even">
<td><code>"D"</code></td>
<td><code>edi</code></td>
<td>destination index</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1057"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1057-1"><a href="#cb1057-1" aria-hidden="true" tabindex="-1"></a>asm<span class="op">(</span><span class="st">"mul %1"</span> <span class="op">:</span> <span class="st">"=a"</span><span class="op">(</span>res<span class="op">)</span> <span class="op">:</span> <span class="st">"r"</span><span class="op">(</span>x<span class="op">));</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The <code>"r"</code> constraint lets the compiler choose any register.</p>
</section>
<section id="step-9.-mixing-assembly-and-c-functions" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-mixing-assembly-and-c-functions">Step 9. Mixing Assembly and C Functions</h4>
<p>You can write small routines in separate <code>.S</code> files (pure assembly) and call them from C:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1058"><pre class="sourceCode asm code-with-copy"><code class="sourceCode fasm"><span id="cb1058-1"><a href="#cb1058-1" aria-hidden="true" tabindex="-1"></a># <span class="dt">file</span><span class="op">:</span> add<span class="op">.</span>S</span>
<span id="cb1058-2"><a href="#cb1058-2" aria-hidden="true" tabindex="-1"></a>.global add_two</span>
<span id="cb1058-3"><a href="#cb1058-3" aria-hidden="true" tabindex="-1"></a><span class="fu">add_two:</span></span>
<span id="cb1058-4"><a href="#cb1058-4" aria-hidden="true" tabindex="-1"></a>    addl <span class="op">%</span><span class="kw">esi</span><span class="op">,</span> <span class="op">%</span><span class="kw">edi</span></span>
<span id="cb1058-5"><a href="#cb1058-5" aria-hidden="true" tabindex="-1"></a>    movl <span class="op">%</span><span class="kw">edi</span><span class="op">,</span> <span class="op">%</span><span class="kw">eax</span></span>
<span id="cb1058-6"><a href="#cb1058-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">ret</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then in C:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1059"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1059-1"><a href="#cb1059-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add_two<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">);</span></span>
<span id="cb1059-2"><a href="#cb1059-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1059-3"><a href="#cb1059-3" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> add_two<span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="dv">7</span><span class="op">));</span></span>
<span id="cb1059-4"><a href="#cb1059-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This hybrid style is used in OS kernels, bootloaders, and math libraries.</p>
</section>
<section id="step-10.-tiny-code-inline-assembly-add-function" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-inline-assembly-add-function">Step 10. Tiny Code: Inline Assembly Add Function</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1060"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1060-1"><a href="#cb1060-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1060-2"><a href="#cb1060-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1060-3"><a href="#cb1060-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add_fast<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1060-4"><a href="#cb1060-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> result<span class="op">;</span></span>
<span id="cb1060-5"><a href="#cb1060-5" aria-hidden="true" tabindex="-1"></a>    __asm__ <span class="op">(</span><span class="st">"addl %1, %0"</span> <span class="op">:</span> <span class="st">"=r"</span><span class="op">(</span>result<span class="op">)</span> <span class="op">:</span> <span class="st">"r"</span><span class="op">(</span>b<span class="op">),</span> <span class="st">"0"</span><span class="op">(</span>a<span class="op">));</span></span>
<span id="cb1060-6"><a href="#cb1060-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb1060-7"><a href="#cb1060-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1060-8"><a href="#cb1060-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1060-9"><a href="#cb1060-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1060-10"><a href="#cb1060-10" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> add_fast<span class="op">(</span><span class="dv">3</span><span class="op">,</span> <span class="dv">5</span><span class="op">));</span></span>
<span id="cb1060-11"><a href="#cb1060-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The <code>"0"(a)</code> constraint tells the compiler to use the same register for input and output.</p>
</section>
<section id="why-it-matters-71" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-71">Why It Matters</h4>
<p>Inline assembly teaches you what really happens beneath your C code. Even if you rarely use it, understanding it helps you:</p>
<ul>
<li>Read compiler-generated assembly (<code>gcc -S</code>)</li>
<li>Optimize performance-critical code</li>
<li>Understand how system calls, context switches, and kernel traps work</li>
</ul>
<p>It’s where software meets hardware, the true metal of computing.</p>
</section>
<section id="try-it-yourself-81" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-81">Try It Yourself</h4>
<ol type="1">
<li>Write a small inline assembly snippet that swaps two integers.</li>
<li>Print the CPU vendor string with <code>cpuid</code>.</li>
<li>Use <code>rdtsc()</code> to benchmark your function.</li>
<li>Inspect compiler-generated assembly using <code>gcc -S</code>.</li>
<li>Try to reimplement a basic math operation in assembly and compare performance.</li>
</ol>
<p>Next, you’ll learn <strong>cross-compilation</strong>, how to build your C programs for <em>other architectures and systems</em>, from your own machine.</p>
</section>
</section>
<section id="cross-compilation" class="level3">
<h3 class="anchored" data-anchor-id="cross-compilation">84. Cross-Compilation</h3>
<p>Cross-compilation means <strong>building a program on one machine so it runs on another</strong>. If you’ve ever compiled a C program on your laptop and deployed it to a Raspberry Pi, an ESP32 board, or even a custom Linux image, you’ve done cross-compilation.</p>
<p>This is an essential skill for systems programmers, embedded developers, and anyone who builds for multiple architectures or operating systems.</p>
<section id="step-1.-what-is-a-cross-compiler" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-is-a-cross-compiler">Step 1. What Is a Cross-Compiler?</h4>
<p>A <strong>cross-compiler</strong> is a compiler that produces executables for a <em>target platform</em> different from the <em>host platform</em>.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 87%">
</colgroup>
<thead>
<tr class="header">
<th>Term</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Host</strong></td>
<td>The system where you build the code</td>
</tr>
<tr class="even">
<td><strong>Target</strong></td>
<td>The system where the program will run</td>
</tr>
<tr class="odd">
<td><strong>Build</strong></td>
<td>The system where the compiler itself was built (often same as host)</td>
</tr>
</tbody>
</table>
<p>Example: You’re on macOS (x86_64) and want to compile for a Raspberry Pi (ARM). Your toolchain must translate x86 instructions into ARM ones.</p>
</section>
<section id="step-2.-why-cross-compile" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-why-cross-compile">Step 2. Why Cross-Compile?</h4>
<ul>
<li>Deploy software to embedded devices without compiling directly on them.</li>
<li>Build for multiple architectures from one workstation.</li>
<li>Generate portable binaries (for ARM, MIPS, RISC-V, etc.).</li>
<li>Prepare static binaries for minimal systems or containers.</li>
</ul>
<p>Cross-compilation is the foundation of <strong>embedded Linux</strong>, <strong>IoT</strong>, and <strong>firmware development</strong>.</p>
</section>
<section id="step-3.-installing-a-cross-compiler" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-installing-a-cross-compiler">Step 3. Installing a Cross-Compiler</h4>
<p>On Linux, install a toolchain package for your target architecture. Examples:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1061"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1061-1"><a href="#cb1061-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install gcc-arm-linux-gnueabihf</span>
<span id="cb1061-2"><a href="#cb1061-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install gcc-aarch64-linux-gnu</span>
<span id="cb1061-3"><a href="#cb1061-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install gcc-riscv64-linux-gnu</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Each toolchain contains:</p>
<ul>
<li><code>gcc</code> or <code>clang</code> cross-compiler</li>
<li><code>as</code> (assembler)</li>
<li><code>ld</code> (linker)</li>
<li>target system headers and libraries</li>
</ul>
</section>
<section id="step-4.-verifying-the-target" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-verifying-the-target">Step 4. Verifying the Target</h4>
<p>Check your compiler’s target triple:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1062"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1062-1"><a href="#cb1062-1" aria-hidden="true" tabindex="-1"></a><span class="ex">arm-linux-gnueabihf-gcc</span> <span class="at">-v</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output example:</p>
<pre><code>Target: arm-linux-gnueabihf</code></pre>
<p>The <strong>triple</strong> encodes:</p>
<pre><code>&lt;architecture&gt;-&lt;vendor&gt;-&lt;OS&gt;-&lt;ABI&gt;</code></pre>
<p>For instance:</p>
<ul>
<li><code>x86_64-pc-linux-gnu</code></li>
<li><code>arm-none-eabi</code> (bare-metal, no OS)</li>
<li><code>aarch64-linux-gnu</code></li>
</ul>
</section>
<section id="step-5.-compiling-for-another-platform" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-compiling-for-another-platform">Step 5. Compiling for Another Platform</h4>
<p><strong>Tiny Code:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1065"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1065-1"><a href="#cb1065-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1065-2"><a href="#cb1065-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1065-3"><a href="#cb1065-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1065-4"><a href="#cb1065-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hello from cross-compiled C!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1065-5"><a href="#cb1065-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile for ARM:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1066"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1066-1"><a href="#cb1066-1" aria-hidden="true" tabindex="-1"></a><span class="ex">arm-linux-gnueabihf-gcc</span> hello.c <span class="at">-o</span> hello_arm</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Transfer it to your ARM device:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1067"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1067-1"><a href="#cb1067-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> hello_arm user@raspberrypi.local:/home/user/</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then run on the Pi:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1068"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1068-1"><a href="#cb1068-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./hello_arm</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If everything’s configured correctly, you’ll see:</p>
<pre><code>Hello from cross-compiled C!</code></pre>
</section>
<section id="step-6.-static-vs-dynamic-linking" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-static-vs-dynamic-linking">Step 6. Static vs Dynamic Linking</h4>
<p>When cross-compiling, your target system might not have the same libraries. You can link everything into one binary:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1070"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1070-1"><a href="#cb1070-1" aria-hidden="true" tabindex="-1"></a><span class="ex">arm-linux-gnueabihf-gcc</span> <span class="at">-static</span> hello.c <span class="at">-o</span> hello_static</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Static linking</strong> ensures the binary runs even if the target lacks shared libraries, useful for minimal or embedded systems.</p>
</section>
<section id="step-7.-using-clang-for-cross-compilation" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-using-clang-for-cross-compilation">Step 7. Using Clang for Cross-Compilation</h4>
<p>Clang simplifies multi-target builds through <code>--target</code> and <code>--sysroot</code> options:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1071"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1071-1"><a href="#cb1071-1" aria-hidden="true" tabindex="-1"></a><span class="fu">clang</span> <span class="at">--target</span><span class="op">=</span>aarch64-linux-gnu <span class="at">--sysroot</span><span class="op">=</span>/path/to/sysroot hello.c <span class="at">-o</span> hello_arm64</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><code>--sysroot</code> points to a directory that mimics the target’s filesystem, containing its headers and libraries.</p>
</section>
<section id="step-8.-building-for-windows-or-macos-from-linux" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-building-for-windows-or-macos-from-linux">Step 8. Building for Windows or macOS from Linux</h4>
<p>You can also cross-compile across operating systems:</p>
<p><strong>Linux → Windows:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1072"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1072-1"><a href="#cb1072-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install mingw-w64</span>
<span id="cb1072-2"><a href="#cb1072-2" aria-hidden="true" tabindex="-1"></a><span class="ex">x86_64-w64-mingw32-gcc</span> hello.c <span class="at">-o</span> hello.exe</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Linux → macOS:</strong> More complex, usually requires Clang with Apple SDKs or <code>osxcross</code>.</p>
</section>
<section id="step-9.-automating-with-cmake-or-makefiles" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-automating-with-cmake-or-makefiles">Step 9. Automating with CMake or Makefiles</h4>
<p>CMake makes multi-platform builds easy.</p>
<p><code>toolchain-arm.cmake</code></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1073"><pre class="sourceCode cmake code-with-copy"><code class="sourceCode cmake"><span id="cb1073-1"><a href="#cb1073-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span>(<span class="dv">CMAKE_SYSTEM_NAME</span> Linux)</span>
<span id="cb1073-2"><a href="#cb1073-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span>(<span class="dv">CMAKE_SYSTEM_PROCESSOR</span> arm)</span>
<span id="cb1073-3"><a href="#cb1073-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span>(<span class="dv">CMAKE_C_COMPILER</span> arm-linux-gnueabihf-gcc)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1074"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1074-1"><a href="#cb1074-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cmake</span> <span class="at">-DCMAKE_TOOLCHAIN_FILE</span><span class="op">=</span>toolchain-arm.cmake ..</span>
<span id="cb1074-2"><a href="#cb1074-2" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Your build system now knows it’s cross-compiling for ARM.</p>
</section>
<section id="step-10.-tiny-code-detect-and-print-target-architecture" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-detect-and-print-target-architecture">Step 10. Tiny Code: Detect and Print Target Architecture</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1075"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1075-1"><a href="#cb1075-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1075-2"><a href="#cb1075-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1075-3"><a href="#cb1075-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1075-4"><a href="#cb1075-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#if defined(__x86_64__)</span></span>
<span id="cb1075-5"><a href="#cb1075-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"x86_64</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1075-6"><a href="#cb1075-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#elif defined(__aarch64__)</span></span>
<span id="cb1075-7"><a href="#cb1075-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"ARM64</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1075-8"><a href="#cb1075-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#elif defined(__arm__)</span></span>
<span id="cb1075-9"><a href="#cb1075-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"ARM 32-bit</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1075-10"><a href="#cb1075-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#elif defined(__riscv)</span></span>
<span id="cb1075-11"><a href="#cb1075-11" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"RISC-V</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1075-12"><a href="#cb1075-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span>
<span id="cb1075-13"><a href="#cb1075-13" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Unknown architecture</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1075-14"><a href="#cb1075-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb1075-15"><a href="#cb1075-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile for different targets and observe the output.</p>
</section>
<section id="why-it-matters-72" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-72">Why It Matters</h4>
<p>Cross-compilation connects your laptop to every other device you’ll ever program. It’s how kernel modules, embedded systems, and even Android apps are built. Once you learn it, you can build <strong>anywhere, for anything</strong>.</p>
</section>
<section id="try-it-yourself-82" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-82">Try It Yourself</h4>
<ol type="1">
<li>Install an ARM or RISC-V cross-compiler on your host system.</li>
<li>Cross-compile and run a simple “Hello” binary on an emulator (<code>qemu-arm</code>).</li>
<li>Use the <code>-static</code> flag to make it self-contained.</li>
<li>Add a Makefile with variables <code>CC</code>, <code>CFLAGS</code>, and <code>LDFLAGS</code> for easy reuse.</li>
<li>Try building both for Linux and Windows from the same source.</li>
</ol>
<p>Next, you’ll explore <strong>threading with pthreads</strong>, how to run multiple parts of your program at the same time using standard C threads.</p>
</section>
</section>
<section id="threading-with-pthreads" class="level3">
<h3 class="anchored" data-anchor-id="threading-with-pthreads">85. Threading with pthreads</h3>
<p>Modern computers run many things at once. Your web browser, text editor, and compiler all share CPU time through <strong>threads</strong>. In C, the most widely used threading API is <strong>POSIX threads</strong>, or <strong>pthreads</strong>. It’s low-level, portable, and gives you fine-grained control over parallel execution.</p>
<p>This section will teach you how to create, manage, and synchronize threads safely.</p>
<section id="step-1.-what-is-a-thread" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-is-a-thread">Step 1. What Is a Thread?</h4>
<p>A <strong>thread</strong> is a lightweight execution unit that shares the same memory space as other threads in a process.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 54%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th>Process</th>
<th>Thread</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Has its own memory (stack, heap, code)</td>
<td>Shares memory with other threads</td>
</tr>
<tr class="even">
<td>Created by OS</td>
<td>Created by process</td>
</tr>
<tr class="odd">
<td>Expensive to start</td>
<td>Cheap and fast to start</td>
</tr>
<tr class="even">
<td>Communicates via IPC</td>
<td>Communicates via shared memory</td>
</tr>
</tbody>
</table>
<p>Threads are ideal for tasks like handling multiple network requests, performing parallel computation, or keeping a UI responsive.</p>
</section>
<section id="step-2.-including-pthreads" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-including-pthreads">Step 2. Including pthreads</h4>
<p>To use pthreads, include the header:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1076"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1076-1"><a href="#cb1076-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>When compiling, link with the pthread library:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1077"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1077-1"><a href="#cb1077-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> program.c <span class="at">-o</span> program <span class="at">-lpthread</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-3.-creating-threads" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-creating-threads">Step 3. Creating Threads</h4>
<p>Each thread runs a separate function. The function must take and return <code>void *</code>.</p>
<p><strong>Tiny Code: Basic Thread Creation</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1078"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1078-1"><a href="#cb1078-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span>
<span id="cb1078-2"><a href="#cb1078-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1078-3"><a href="#cb1078-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1078-4"><a href="#cb1078-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span><span class="op">*</span> task<span class="op">(</span><span class="dt">void</span><span class="op">*</span> arg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1078-5"><a href="#cb1078-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hello from thread! Arg = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*(</span><span class="dt">int</span><span class="op">*)</span>arg<span class="op">);</span></span>
<span id="cb1078-6"><a href="#cb1078-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1078-7"><a href="#cb1078-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1078-8"><a href="#cb1078-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1078-9"><a href="#cb1078-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1078-10"><a href="#cb1078-10" aria-hidden="true" tabindex="-1"></a>    pthread_t thread<span class="op">;</span></span>
<span id="cb1078-11"><a href="#cb1078-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> value <span class="op">=</span> <span class="dv">42</span><span class="op">;</span></span>
<span id="cb1078-12"><a href="#cb1078-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1078-13"><a href="#cb1078-13" aria-hidden="true" tabindex="-1"></a>    pthread_create<span class="op">(&amp;</span>thread<span class="op">,</span> NULL<span class="op">,</span> task<span class="op">,</span> <span class="op">&amp;</span>value<span class="op">);</span></span>
<span id="cb1078-14"><a href="#cb1078-14" aria-hidden="true" tabindex="-1"></a>    pthread_join<span class="op">(</span>thread<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1078-15"><a href="#cb1078-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1078-16"><a href="#cb1078-16" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Main thread finished.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1078-17"><a href="#cb1078-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1078-18"><a href="#cb1078-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Hello from thread! Arg = 42
Main thread finished.</code></pre>
<p><strong>Explanation:</strong></p>
<ul>
<li><code>pthread_create</code> starts a new thread.</li>
<li><code>pthread_join</code> waits for it to finish.</li>
</ul>
</section>
<section id="step-4.-multiple-threads" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-multiple-threads">Step 4. Multiple Threads</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1080"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1080-1"><a href="#cb1080-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span>
<span id="cb1080-2"><a href="#cb1080-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1080-3"><a href="#cb1080-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1080-4"><a href="#cb1080-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span><span class="op">*</span> work<span class="op">(</span><span class="dt">void</span><span class="op">*</span> arg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1080-5"><a href="#cb1080-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id <span class="op">=</span> <span class="op">*(</span><span class="dt">int</span><span class="op">*)</span>arg<span class="op">;</span></span>
<span id="cb1080-6"><a href="#cb1080-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Thread </span><span class="sc">%d</span><span class="st"> running</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> id<span class="op">);</span></span>
<span id="cb1080-7"><a href="#cb1080-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1080-8"><a href="#cb1080-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1080-9"><a href="#cb1080-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1080-10"><a href="#cb1080-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1080-11"><a href="#cb1080-11" aria-hidden="true" tabindex="-1"></a>    pthread_t threads<span class="op">[</span><span class="dv">3</span><span class="op">];</span></span>
<span id="cb1080-12"><a href="#cb1080-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> ids<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">};</span></span>
<span id="cb1080-13"><a href="#cb1080-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1080-14"><a href="#cb1080-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb1080-15"><a href="#cb1080-15" aria-hidden="true" tabindex="-1"></a>        pthread_create<span class="op">(&amp;</span>threads<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">,</span> work<span class="op">,</span> <span class="op">&amp;</span>ids<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb1080-16"><a href="#cb1080-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1080-17"><a href="#cb1080-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb1080-18"><a href="#cb1080-18" aria-hidden="true" tabindex="-1"></a>        pthread_join<span class="op">(</span>threads<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">);</span></span>
<span id="cb1080-19"><a href="#cb1080-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1080-20"><a href="#cb1080-20" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"All threads done.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1080-21"><a href="#cb1080-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output order may vary, threads run concurrently.</p>
</section>
<section id="step-5.-race-conditions" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-race-conditions">Step 5. Race Conditions</h4>
<p>When two threads modify the same variable at the same time, bad things happen. This is called a <strong>race condition</strong>.</p>
<p>Example (unsafe):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1081"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1081-1"><a href="#cb1081-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span>
<span id="cb1081-2"><a href="#cb1081-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1081-3"><a href="#cb1081-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1081-4"><a href="#cb1081-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> counter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1081-5"><a href="#cb1081-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1081-6"><a href="#cb1081-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span><span class="op">*</span> increment<span class="op">(</span><span class="dt">void</span><span class="op">*</span> arg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1081-7"><a href="#cb1081-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">100000</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb1081-8"><a href="#cb1081-8" aria-hidden="true" tabindex="-1"></a>        counter<span class="op">++;</span></span>
<span id="cb1081-9"><a href="#cb1081-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1081-10"><a href="#cb1081-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1081-11"><a href="#cb1081-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1081-12"><a href="#cb1081-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1081-13"><a href="#cb1081-13" aria-hidden="true" tabindex="-1"></a>    pthread_t t1<span class="op">,</span> t2<span class="op">;</span></span>
<span id="cb1081-14"><a href="#cb1081-14" aria-hidden="true" tabindex="-1"></a>    pthread_create<span class="op">(&amp;</span>t1<span class="op">,</span> NULL<span class="op">,</span> increment<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1081-15"><a href="#cb1081-15" aria-hidden="true" tabindex="-1"></a>    pthread_create<span class="op">(&amp;</span>t2<span class="op">,</span> NULL<span class="op">,</span> increment<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1081-16"><a href="#cb1081-16" aria-hidden="true" tabindex="-1"></a>    pthread_join<span class="op">(</span>t1<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1081-17"><a href="#cb1081-17" aria-hidden="true" tabindex="-1"></a>    pthread_join<span class="op">(</span>t2<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1081-18"><a href="#cb1081-18" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Counter = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> counter<span class="op">);</span></span>
<span id="cb1081-19"><a href="#cb1081-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Expected: <code>200000</code> Actual: unpredictable (e.g.&nbsp;<code>137421</code>), because increments overlap.</p>
</section>
<section id="step-6.-using-mutexes-mutual-exclusion-locks" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-using-mutexes-mutual-exclusion-locks">Step 6. Using Mutexes (Mutual Exclusion Locks)</h4>
<p>A <strong>mutex</strong> ensures that only one thread modifies shared data at a time.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1082"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1082-1"><a href="#cb1082-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span>
<span id="cb1082-2"><a href="#cb1082-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1082-3"><a href="#cb1082-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1082-4"><a href="#cb1082-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> counter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1082-5"><a href="#cb1082-5" aria-hidden="true" tabindex="-1"></a>pthread_mutex_t lock<span class="op">;</span></span>
<span id="cb1082-6"><a href="#cb1082-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1082-7"><a href="#cb1082-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span><span class="op">*</span> increment<span class="op">(</span><span class="dt">void</span><span class="op">*</span> arg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1082-8"><a href="#cb1082-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">100000</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb1082-9"><a href="#cb1082-9" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_lock<span class="op">(&amp;</span>lock<span class="op">);</span></span>
<span id="cb1082-10"><a href="#cb1082-10" aria-hidden="true" tabindex="-1"></a>        counter<span class="op">++;</span></span>
<span id="cb1082-11"><a href="#cb1082-11" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_unlock<span class="op">(&amp;</span>lock<span class="op">);</span></span>
<span id="cb1082-12"><a href="#cb1082-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1082-13"><a href="#cb1082-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1082-14"><a href="#cb1082-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1082-15"><a href="#cb1082-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1082-16"><a href="#cb1082-16" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1082-17"><a href="#cb1082-17" aria-hidden="true" tabindex="-1"></a>    pthread_t t1<span class="op">,</span> t2<span class="op">;</span></span>
<span id="cb1082-18"><a href="#cb1082-18" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_init<span class="op">(&amp;</span>lock<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1082-19"><a href="#cb1082-19" aria-hidden="true" tabindex="-1"></a>    pthread_create<span class="op">(&amp;</span>t1<span class="op">,</span> NULL<span class="op">,</span> increment<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1082-20"><a href="#cb1082-20" aria-hidden="true" tabindex="-1"></a>    pthread_create<span class="op">(&amp;</span>t2<span class="op">,</span> NULL<span class="op">,</span> increment<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1082-21"><a href="#cb1082-21" aria-hidden="true" tabindex="-1"></a>    pthread_join<span class="op">(</span>t1<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1082-22"><a href="#cb1082-22" aria-hidden="true" tabindex="-1"></a>    pthread_join<span class="op">(</span>t2<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1082-23"><a href="#cb1082-23" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_destroy<span class="op">(&amp;</span>lock<span class="op">);</span></span>
<span id="cb1082-24"><a href="#cb1082-24" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Counter = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> counter<span class="op">);</span></span>
<span id="cb1082-25"><a href="#cb1082-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now the output will consistently be <code>200000</code>.</p>
</section>
<section id="step-7.-condition-variables" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-condition-variables">Step 7. Condition Variables</h4>
<p>Condition variables let threads wait for a signal. They’re used to coordinate producer–consumer models.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1083"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1083-1"><a href="#cb1083-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span>
<span id="cb1083-2"><a href="#cb1083-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1083-3"><a href="#cb1083-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1083-4"><a href="#cb1083-4" aria-hidden="true" tabindex="-1"></a>pthread_mutex_t lock<span class="op">;</span></span>
<span id="cb1083-5"><a href="#cb1083-5" aria-hidden="true" tabindex="-1"></a>pthread_cond_t cond<span class="op">;</span></span>
<span id="cb1083-6"><a href="#cb1083-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ready <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1083-7"><a href="#cb1083-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1083-8"><a href="#cb1083-8" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span><span class="op">*</span> worker<span class="op">(</span><span class="dt">void</span><span class="op">*</span> arg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1083-9"><a href="#cb1083-9" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_lock<span class="op">(&amp;</span>lock<span class="op">);</span></span>
<span id="cb1083-10"><a href="#cb1083-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!</span>ready<span class="op">)</span></span>
<span id="cb1083-11"><a href="#cb1083-11" aria-hidden="true" tabindex="-1"></a>        pthread_cond_wait<span class="op">(&amp;</span>cond<span class="op">,</span> <span class="op">&amp;</span>lock<span class="op">);</span></span>
<span id="cb1083-12"><a href="#cb1083-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Worker got the signal!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1083-13"><a href="#cb1083-13" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_unlock<span class="op">(&amp;</span>lock<span class="op">);</span></span>
<span id="cb1083-14"><a href="#cb1083-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1083-15"><a href="#cb1083-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1083-16"><a href="#cb1083-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1083-17"><a href="#cb1083-17" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1083-18"><a href="#cb1083-18" aria-hidden="true" tabindex="-1"></a>    pthread_t t<span class="op">;</span></span>
<span id="cb1083-19"><a href="#cb1083-19" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_init<span class="op">(&amp;</span>lock<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1083-20"><a href="#cb1083-20" aria-hidden="true" tabindex="-1"></a>    pthread_cond_init<span class="op">(&amp;</span>cond<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1083-21"><a href="#cb1083-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1083-22"><a href="#cb1083-22" aria-hidden="true" tabindex="-1"></a>    pthread_create<span class="op">(&amp;</span>t<span class="op">,</span> NULL<span class="op">,</span> worker<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1083-23"><a href="#cb1083-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1083-24"><a href="#cb1083-24" aria-hidden="true" tabindex="-1"></a>    sleep<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb1083-25"><a href="#cb1083-25" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_lock<span class="op">(&amp;</span>lock<span class="op">);</span></span>
<span id="cb1083-26"><a href="#cb1083-26" aria-hidden="true" tabindex="-1"></a>    ready <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1083-27"><a href="#cb1083-27" aria-hidden="true" tabindex="-1"></a>    pthread_cond_signal<span class="op">(&amp;</span>cond<span class="op">);</span></span>
<span id="cb1083-28"><a href="#cb1083-28" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_unlock<span class="op">(&amp;</span>lock<span class="op">);</span></span>
<span id="cb1083-29"><a href="#cb1083-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1083-30"><a href="#cb1083-30" aria-hidden="true" tabindex="-1"></a>    pthread_join<span class="op">(</span>t<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1083-31"><a href="#cb1083-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-8.-thread-attributes" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-thread-attributes">Step 8. Thread Attributes</h4>
<p>You can control thread behavior using <code>pthread_attr_t</code>:</p>
<ul>
<li>Stack size</li>
<li>Detach state (joinable or detached)</li>
<li>Scheduling policy</li>
</ul>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1084"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1084-1"><a href="#cb1084-1" aria-hidden="true" tabindex="-1"></a>pthread_attr_t attr<span class="op">;</span></span>
<span id="cb1084-2"><a href="#cb1084-2" aria-hidden="true" tabindex="-1"></a>pthread_attr_init<span class="op">(&amp;</span>attr<span class="op">);</span></span>
<span id="cb1084-3"><a href="#cb1084-3" aria-hidden="true" tabindex="-1"></a>pthread_attr_setdetachstate<span class="op">(&amp;</span>attr<span class="op">,</span> PTHREAD_CREATE_DETACHED<span class="op">);</span></span>
<span id="cb1084-4"><a href="#cb1084-4" aria-hidden="true" tabindex="-1"></a>pthread_create<span class="op">(&amp;</span>thread<span class="op">,</span> <span class="op">&amp;</span>attr<span class="op">,</span> task<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1084-5"><a href="#cb1084-5" aria-hidden="true" tabindex="-1"></a>pthread_attr_destroy<span class="op">(&amp;</span>attr<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Detached threads free resources automatically when done.</p>
</section>
<section id="step-9.-thread-safety-and-best-practices" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-thread-safety-and-best-practices">Step 9. Thread Safety and Best Practices</h4>
<ul>
<li>Protect all shared data with mutexes.</li>
<li>Avoid global variables when possible.</li>
<li>Use thread-safe functions (<code>strtok_r</code> instead of <code>strtok</code>).</li>
<li>Keep critical sections short.</li>
<li>Join or detach all threads before program exit.</li>
</ul>
</section>
<section id="step-10.-tiny-code-parallel-sum" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-parallel-sum">Step 10. Tiny Code: Parallel Sum</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1085"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1085-1"><a href="#cb1085-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span>
<span id="cb1085-2"><a href="#cb1085-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1085-3"><a href="#cb1085-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1085-4"><a href="#cb1085-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define N </span><span class="dv">4</span></span>
<span id="cb1085-5"><a href="#cb1085-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1085-6"><a href="#cb1085-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> partial<span class="op">[</span><span class="dv">4</span><span class="op">];</span></span>
<span id="cb1085-7"><a href="#cb1085-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1085-8"><a href="#cb1085-8" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span><span class="op">*</span> compute<span class="op">(</span><span class="dt">void</span><span class="op">*</span> arg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1085-9"><a href="#cb1085-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id <span class="op">=</span> <span class="op">*(</span><span class="dt">int</span><span class="op">*)</span>arg<span class="op">;</span></span>
<span id="cb1085-10"><a href="#cb1085-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> start <span class="op">=</span> id <span class="op">*</span> <span class="dv">25</span><span class="op">;</span></span>
<span id="cb1085-11"><a href="#cb1085-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1085-12"><a href="#cb1085-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> start<span class="op">;</span> i <span class="op">&lt;</span> start <span class="op">+</span> <span class="dv">25</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb1085-13"><a href="#cb1085-13" aria-hidden="true" tabindex="-1"></a>        sum <span class="op">+=</span> i<span class="op">;</span></span>
<span id="cb1085-14"><a href="#cb1085-14" aria-hidden="true" tabindex="-1"></a>    partial<span class="op">[</span>id<span class="op">]</span> <span class="op">=</span> sum<span class="op">;</span></span>
<span id="cb1085-15"><a href="#cb1085-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1085-16"><a href="#cb1085-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1085-17"><a href="#cb1085-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1085-18"><a href="#cb1085-18" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1085-19"><a href="#cb1085-19" aria-hidden="true" tabindex="-1"></a>    pthread_t threads<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb1085-20"><a href="#cb1085-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> ids<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb1085-21"><a href="#cb1085-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> N<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb1085-22"><a href="#cb1085-22" aria-hidden="true" tabindex="-1"></a>        ids<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb1085-23"><a href="#cb1085-23" aria-hidden="true" tabindex="-1"></a>        pthread_create<span class="op">(&amp;</span>threads<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">,</span> compute<span class="op">,</span> <span class="op">&amp;</span>ids<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb1085-24"><a href="#cb1085-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1085-25"><a href="#cb1085-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1085-26"><a href="#cb1085-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> total <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1085-27"><a href="#cb1085-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> N<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb1085-28"><a href="#cb1085-28" aria-hidden="true" tabindex="-1"></a>        pthread_join<span class="op">(</span>threads<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">);</span></span>
<span id="cb1085-29"><a href="#cb1085-29" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> partial<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb1085-30"><a href="#cb1085-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1085-31"><a href="#cb1085-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1085-32"><a href="#cb1085-32" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Total sum = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> total<span class="op">);</span></span>
<span id="cb1085-33"><a href="#cb1085-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This program splits a task across multiple threads and combines results.</p>
</section>
<section id="why-it-matters-73" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-73">Why It Matters</h4>
<p>Threads make your programs faster, more responsive, and scalable. They allow C to fully exploit modern multi-core CPUs, from servers to embedded systems. Learning pthreads means learning how real systems multitask efficiently and safely.</p>
</section>
<section id="try-it-yourself-83" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-83">Try It Yourself</h4>
<ol type="1">
<li>Write a program that starts 5 threads, each printing its ID.</li>
<li>Add a shared counter and protect it with a mutex.</li>
<li>Implement a producer–consumer queue using condition variables.</li>
<li>Use <code>pthread_attr_t</code> to create detached worker threads.</li>
<li>Profile your program’s performance as you increase the thread count.</li>
</ol>
<p>Next, you’ll explore <strong>atomic operations and memory models</strong>, how modern CPUs ensure consistency when multiple threads share data without locks.</p>
</section>
</section>
<section id="atomic-operations-and-memory-models" class="level3">
<h3 class="anchored" data-anchor-id="atomic-operations-and-memory-models">86. Atomic Operations and Memory Models</h3>
<p>When multiple threads share data, you usually protect that data with <strong>locks</strong> like <code>pthread_mutex_t</code>. But sometimes, you need something faster, a way to perform an update that can’t be interrupted, even across threads. That’s where <strong>atomic operations</strong> come in.</p>
<p>This section introduces atomic operations in C and how the <strong>memory model</strong> ensures your program behaves predictably across cores.</p>
<section id="step-1.-what-does-atomic-mean" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-does-atomic-mean">Step 1. What Does “Atomic” Mean?</h4>
<p>An <strong>atomic operation</strong> is one that happens all at once, it can’t be divided or interrupted.</p>
<p>Example idea: If two threads both run <code>counter++</code> at the same time:</p>
<ul>
<li>Without atomicity → race condition.</li>
<li>With atomicity → one thread’s update completes fully before the other starts.</li>
</ul>
<p>Atomic operations are essential in lock-free algorithms, concurrent queues, and reference counters.</p>
</section>
<section id="step-2.-the-problem-with-counter" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-the-problem-with-counter">Step 2. The Problem with <code>counter++</code></h4>
<p>This line looks simple:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1086"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1086-1"><a href="#cb1086-1" aria-hidden="true" tabindex="-1"></a>counter<span class="op">++;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>But under the hood, it’s three separate steps:</p>
<ol type="1">
<li>Load <code>counter</code> from memory.</li>
<li>Increment it.</li>
<li>Store it back.</li>
</ol>
<p>Two threads doing this at once can lose updates:</p>
<pre><code>Thread A: load(5)
Thread B: load(5)
Thread A: store(6)
Thread B: store(6)</code></pre>
<p>Result: one increment lost, final value should be 7 but ends up 6.</p>
</section>
<section id="step-3.-using-atomic-types" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-using-atomic-types">Step 3. Using Atomic Types</h4>
<p>C11 introduced <code>&lt;stdatomic.h&gt;</code>, a portable way to use atomic operations.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1088"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1088-1"><a href="#cb1088-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb1088-2"><a href="#cb1088-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1088-3"><a href="#cb1088-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1088-4"><a href="#cb1088-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1088-5"><a href="#cb1088-5" aria-hidden="true" tabindex="-1"></a>    atomic_int counter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1088-6"><a href="#cb1088-6" aria-hidden="true" tabindex="-1"></a>    atomic_fetch_add<span class="op">(&amp;</span>counter<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb1088-7"><a href="#cb1088-7" aria-hidden="true" tabindex="-1"></a>    atomic_fetch_add<span class="op">(&amp;</span>counter<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb1088-8"><a href="#cb1088-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> counter<span class="op">);</span> <span class="co">// 2</span></span>
<span id="cb1088-9"><a href="#cb1088-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>No locks. No race conditions. The <code>atomic_*</code> functions guarantee the operations are atomic at the hardware level.</p>
</section>
<section id="step-4.-common-atomic-functions" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-common-atomic-functions">Step 4. Common Atomic Functions</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>atomic_load</code></td>
<td>Read atomically</td>
</tr>
<tr class="even">
<td><code>atomic_store</code></td>
<td>Write atomically</td>
</tr>
<tr class="odd">
<td><code>atomic_fetch_add</code></td>
<td>Add and return old value</td>
</tr>
<tr class="even">
<td><code>atomic_fetch_sub</code></td>
<td>Subtract and return old value</td>
</tr>
<tr class="odd">
<td><code>atomic_exchange</code></td>
<td>Replace and return old value</td>
</tr>
<tr class="even">
<td><code>atomic_compare_exchange_strong</code></td>
<td>Compare-and-swap</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1089"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1089-1"><a href="#cb1089-1" aria-hidden="true" tabindex="-1"></a>atomic_compare_exchange_strong<span class="op">(&amp;</span>counter<span class="op">,</span> <span class="op">&amp;</span>expected<span class="op">,</span> desired<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If <code>counter == expected</code>, replace it with <code>desired</code>. Otherwise, update <code>expected</code> with the current value.</p>
</section>
<section id="step-5.-tiny-code-atomic-counter-with-threads" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-tiny-code-atomic-counter-with-threads">Step 5. Tiny Code: Atomic Counter with Threads</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1090"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1090-1"><a href="#cb1090-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1090-2"><a href="#cb1090-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span>
<span id="cb1090-3"><a href="#cb1090-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb1090-4"><a href="#cb1090-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1090-5"><a href="#cb1090-5" aria-hidden="true" tabindex="-1"></a>atomic_int counter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1090-6"><a href="#cb1090-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1090-7"><a href="#cb1090-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span><span class="op">*</span> work<span class="op">(</span><span class="dt">void</span><span class="op">*</span> arg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1090-8"><a href="#cb1090-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">100000</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb1090-9"><a href="#cb1090-9" aria-hidden="true" tabindex="-1"></a>        atomic_fetch_add<span class="op">(&amp;</span>counter<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb1090-10"><a href="#cb1090-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1090-11"><a href="#cb1090-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1090-12"><a href="#cb1090-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1090-13"><a href="#cb1090-13" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1090-14"><a href="#cb1090-14" aria-hidden="true" tabindex="-1"></a>    pthread_t t1<span class="op">,</span> t2<span class="op">;</span></span>
<span id="cb1090-15"><a href="#cb1090-15" aria-hidden="true" tabindex="-1"></a>    pthread_create<span class="op">(&amp;</span>t1<span class="op">,</span> NULL<span class="op">,</span> work<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1090-16"><a href="#cb1090-16" aria-hidden="true" tabindex="-1"></a>    pthread_create<span class="op">(&amp;</span>t2<span class="op">,</span> NULL<span class="op">,</span> work<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1090-17"><a href="#cb1090-17" aria-hidden="true" tabindex="-1"></a>    pthread_join<span class="op">(</span>t1<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1090-18"><a href="#cb1090-18" aria-hidden="true" tabindex="-1"></a>    pthread_join<span class="op">(</span>t2<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1090-19"><a href="#cb1090-19" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Counter = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> counter<span class="op">);</span></span>
<span id="cb1090-20"><a href="#cb1090-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output is always <code>200000</code>, with no mutexes and no data races.</p>
</section>
<section id="step-6.-relaxed-vs-sequential-consistency" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-relaxed-vs-sequential-consistency">Step 6. Relaxed vs Sequential Consistency</h4>
<p>Atomic operations can have <strong>different memory orders</strong>. By default, they’re <em>sequentially consistent</em>, the strongest and safest ordering.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Memory Order</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>memory_order_seq_cst</code></td>
<td>Global consistent order (default)</td>
</tr>
<tr class="even">
<td><code>memory_order_relaxed</code></td>
<td>Only atomicity guaranteed</td>
</tr>
<tr class="odd">
<td><code>memory_order_acquire</code></td>
<td>Prevent reordering before load</td>
</tr>
<tr class="even">
<td><code>memory_order_release</code></td>
<td>Prevent reordering after store</td>
</tr>
<tr class="odd">
<td><code>memory_order_acq_rel</code></td>
<td>Acquire + Release combo</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1091"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1091-1"><a href="#cb1091-1" aria-hidden="true" tabindex="-1"></a>atomic_fetch_add_explicit<span class="op">(&amp;</span>counter<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> memory_order_relaxed<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This is faster but weaker, use only when you understand your memory model.</p>
</section>
<section id="step-7.-memory-barriers-and-visibility" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-memory-barriers-and-visibility">Step 7. Memory Barriers and Visibility</h4>
<p>Modern CPUs reorder reads/writes for performance. Atomics, fences, and locks control <em>when</em> updates become visible to other threads.</p>
<p><strong>Example:</strong> Thread A writes <code>ready = 1</code>. Thread B waits until it sees <code>ready == 1</code>. If the compiler reorders memory operations, Thread B might not see the change.</p>
<p>Use:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1092"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1092-1"><a href="#cb1092-1" aria-hidden="true" tabindex="-1"></a>atomic_thread_fence<span class="op">(</span>memory_order_seq_cst<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>to prevent reordering across the fence.</p>
</section>
<section id="step-8.-compare-and-swap-cas" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-compare-and-swap-cas">Step 8. Compare-and-Swap (CAS)</h4>
<p>CAS is the backbone of lock-free data structures.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1093"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1093-1"><a href="#cb1093-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> expected <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1093-2"><a href="#cb1093-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> desired <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1093-3"><a href="#cb1093-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>atomic_compare_exchange_strong<span class="op">(&amp;</span>counter<span class="op">,</span> <span class="op">&amp;</span>expected<span class="op">,</span> desired<span class="op">))</span> <span class="op">{</span></span>
<span id="cb1093-4"><a href="#cb1093-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Swapped!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1093-5"><a href="#cb1093-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>It atomically checks if <code>counter == expected</code> and updates it, all in one instruction. This is used to build things like spinlocks, queues, and reference counters.</p>
</section>
<section id="step-9.-spinlocks-with-atomics" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-spinlocks-with-atomics">Step 9. Spinlocks with Atomics</h4>
<p>A <strong>spinlock</strong> keeps checking until it can acquire the lock.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1094"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1094-1"><a href="#cb1094-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb1094-2"><a href="#cb1094-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb1094-3"><a href="#cb1094-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1094-4"><a href="#cb1094-4" aria-hidden="true" tabindex="-1"></a>atomic_flag lock <span class="op">=</span> ATOMIC_FLAG_INIT<span class="op">;</span></span>
<span id="cb1094-5"><a href="#cb1094-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1094-6"><a href="#cb1094-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> lock_spin<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1094-7"><a href="#cb1094-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>atomic_flag_test_and_set<span class="op">(&amp;</span>lock<span class="op">))</span></span>
<span id="cb1094-8"><a href="#cb1094-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">;</span> <span class="co">// busy wait</span></span>
<span id="cb1094-9"><a href="#cb1094-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1094-10"><a href="#cb1094-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1094-11"><a href="#cb1094-11" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> unlock_spin<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1094-12"><a href="#cb1094-12" aria-hidden="true" tabindex="-1"></a>    atomic_flag_clear<span class="op">(&amp;</span>lock<span class="op">);</span></span>
<span id="cb1094-13"><a href="#cb1094-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This is efficient when the lock is held for a very short time. For longer waits, use <code>pthread_mutex_t</code> instead.</p>
</section>
<section id="step-10.-tiny-code-atomic-reference-counter" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-atomic-reference-counter">Step 10. Tiny Code: Atomic Reference Counter</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1095"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1095-1"><a href="#cb1095-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb1095-2"><a href="#cb1095-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1095-3"><a href="#cb1095-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1095-4"><a href="#cb1095-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb1095-5"><a href="#cb1095-5" aria-hidden="true" tabindex="-1"></a>    atomic_int refcount<span class="op">;</span></span>
<span id="cb1095-6"><a href="#cb1095-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Object<span class="op">;</span></span>
<span id="cb1095-7"><a href="#cb1095-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1095-8"><a href="#cb1095-8" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> retain<span class="op">(</span>Object<span class="op">*</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1095-9"><a href="#cb1095-9" aria-hidden="true" tabindex="-1"></a>    atomic_fetch_add<span class="op">(&amp;</span>obj<span class="op">-&gt;</span>refcount<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb1095-10"><a href="#cb1095-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1095-11"><a href="#cb1095-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1095-12"><a href="#cb1095-12" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> release<span class="op">(</span>Object<span class="op">*</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1095-13"><a href="#cb1095-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>atomic_fetch_sub<span class="op">(&amp;</span>obj<span class="op">-&gt;</span>refcount<span class="op">,</span> <span class="dv">1</span><span class="op">)</span> <span class="op">==</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb1095-14"><a href="#cb1095-14" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Object freed</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1095-15"><a href="#cb1095-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1095-16"><a href="#cb1095-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1095-17"><a href="#cb1095-17" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1095-18"><a href="#cb1095-18" aria-hidden="true" tabindex="-1"></a>    Object obj <span class="op">=</span> <span class="op">{</span> <span class="op">.</span>refcount <span class="op">=</span> <span class="dv">1</span> <span class="op">};</span></span>
<span id="cb1095-19"><a href="#cb1095-19" aria-hidden="true" tabindex="-1"></a>    retain<span class="op">(&amp;</span>obj<span class="op">);</span></span>
<span id="cb1095-20"><a href="#cb1095-20" aria-hidden="true" tabindex="-1"></a>    release<span class="op">(&amp;</span>obj<span class="op">);</span></span>
<span id="cb1095-21"><a href="#cb1095-21" aria-hidden="true" tabindex="-1"></a>    release<span class="op">(&amp;</span>obj<span class="op">);</span></span>
<span id="cb1095-22"><a href="#cb1095-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Object freed</code></pre>
<p>This is how many real-world systems (e.g.&nbsp;file handles, shared memory) track usage.</p>
</section>
<section id="why-it-matters-74" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-74">Why It Matters</h4>
<p>Atomic operations are the building blocks of lock-free programming. They allow you to write high-performance concurrent code without blocking other threads. The C memory model gives you guarantees to reason about correctness even across multiple CPU cores.</p>
</section>
<section id="try-it-yourself-84" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-84">Try It Yourself</h4>
<ol type="1">
<li>Replace a mutex counter with an atomic counter.</li>
<li>Implement a spinlock using <code>atomic_flag</code>.</li>
<li>Use <code>atomic_compare_exchange_strong</code> to build a simple CAS loop.</li>
<li>Test the difference between <code>memory_order_relaxed</code> and <code>seq_cst</code>.</li>
<li>Build a reference-counted structure using atomics.</li>
</ol>
<p>Next, you’ll explore <strong>using C with other languages (FFI)</strong>, how to make C libraries callable from Python, Rust, and Go.</p>
</section>
</section>
<section id="using-c-with-other-languages-ffi" class="level3">
<h3 class="anchored" data-anchor-id="using-c-with-other-languages-ffi">87. Using C with Other Languages (FFI)</h3>
<p>C is often called the <em>universal assembly language</em>, nearly every modern language can call into it. This is made possible through the <strong>Foreign Function Interface (FFI)</strong>, which defines how different languages talk to C code.</p>
<p>In this section, you’ll learn how to expose your C functions to Python, Rust, and Go, and how to call functions from those languages <em>inside</em> C.</p>
<section id="step-1.-what-is-an-ffi" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-is-an-ffi">Step 1. What Is an FFI?</h4>
<p>An <strong>FFI (Foreign Function Interface)</strong> is a bridge that lets programs written in one language use code written in another.</p>
<p>Why FFI matters:</p>
<ul>
<li>Reuse fast, low-level C libraries (e.g., OpenSSL, SQLite).</li>
<li>Integrate C modules into higher-level languages like Python or Go.</li>
<li>Extend existing programs without rewriting everything.</li>
<li>Combine system-level control with productivity.</li>
</ul>
</section>
<section id="step-2.-the-foundation-c-abi" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-the-foundation-c-abi">Step 2. The Foundation: C ABI</h4>
<p>The <strong>ABI (Application Binary Interface)</strong> defines how function calls, parameters, and data structures are represented in memory. The FFI works because C has a stable and simple ABI.</p>
<p>Rules include:</p>
<ul>
<li>How arguments are passed (registers or stack).</li>
<li>How return values are handled.</li>
<li>How data types are aligned in memory.</li>
</ul>
<p>That’s why almost every language provides a way to “speak” the C ABI.</p>
</section>
<section id="step-3.-exposing-c-functions-to-other-languages" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-exposing-c-functions-to-other-languages">Step 3. Exposing C Functions to Other Languages</h4>
<p>You can make your C functions callable by other languages by marking them with <code>extern "C"</code> (if compiling as C++) or just regular C functions otherwise.</p>
<p><strong>Tiny Code: Shared C Library</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1097"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1097-1"><a href="#cb1097-1" aria-hidden="true" tabindex="-1"></a><span class="co">// file: mathlib.c</span></span>
<span id="cb1097-2"><a href="#cb1097-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1097-3"><a href="#cb1097-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1097-4"><a href="#cb1097-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1097-5"><a href="#cb1097-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb1097-6"><a href="#cb1097-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1097-7"><a href="#cb1097-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1097-8"><a href="#cb1097-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> multiply<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1097-9"><a href="#cb1097-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">*</span> b<span class="op">;</span></span>
<span id="cb1097-10"><a href="#cb1097-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile it into a shared library:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1098"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1098-1"><a href="#cb1098-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-shared</span> <span class="at">-fPIC</span> <span class="at">-o</span> libmathlib.so mathlib.c</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This creates a <code>.so</code> (Linux) or <code>.dll</code> (Windows) or <code>.dylib</code> (macOS) file you can load in other languages.</p>
</section>
<section id="step-4.-using-c-in-python-ctypes" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-using-c-in-python-ctypes">Step 4. Using C in Python (ctypes)</h4>
<p>Python can call C functions directly using the <code>ctypes</code> module.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1099"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1099-1"><a href="#cb1099-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ctypes</span>
<span id="cb1099-2"><a href="#cb1099-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1099-3"><a href="#cb1099-3" aria-hidden="true" tabindex="-1"></a>lib <span class="op">=</span> ctypes.CDLL(<span class="st">"./libmathlib.so"</span>)</span>
<span id="cb1099-4"><a href="#cb1099-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lib.add(<span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb1099-5"><a href="#cb1099-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lib.multiply(<span class="dv">4</span>, <span class="dv">5</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>5
20</code></pre>
<p>Python automatically converts standard types (<code>int</code>, <code>float</code>, <code>char *</code>) to C equivalents.</p>
<p>For more complex types, you can define <code>ctypes.Structure</code> classes matching your C structs.</p>
</section>
<section id="step-5.-using-c-in-rust" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-using-c-in-rust">Step 5. Using C in Rust</h4>
<p>Rust has a built-in <code>extern "C"</code> block for FFI.</p>
<p><strong>Rust Example:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1101"><pre class="sourceCode rust code-with-copy"><code class="sourceCode rust"><span id="cb1101-1"><a href="#cb1101-1" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>link<span class="at">(</span>name <span class="op">=</span> <span class="st">"mathlib"</span><span class="at">)]</span></span>
<span id="cb1101-2"><a href="#cb1101-2" aria-hidden="true" tabindex="-1"></a><span class="kw">extern</span> <span class="st">"C"</span> <span class="op">{</span></span>
<span id="cb1101-3"><a href="#cb1101-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> add(a<span class="op">:</span> <span class="dt">i32</span><span class="op">,</span> b<span class="op">:</span> <span class="dt">i32</span>) <span class="op">-&gt;</span> <span class="dt">i32</span><span class="op">;</span></span>
<span id="cb1101-4"><a href="#cb1101-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1101-5"><a href="#cb1101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1101-6"><a href="#cb1101-6" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb1101-7"><a href="#cb1101-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">unsafe</span> <span class="op">{</span></span>
<span id="cb1101-8"><a href="#cb1101-8" aria-hidden="true" tabindex="-1"></a>        <span class="pp">println!</span>(<span class="st">"{}"</span><span class="op">,</span> add(<span class="dv">2</span><span class="op">,</span> <span class="dv">3</span>))<span class="op">;</span></span>
<span id="cb1101-9"><a href="#cb1101-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1101-10"><a href="#cb1101-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile with:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1102"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1102-1"><a href="#cb1102-1" aria-hidden="true" tabindex="-1"></a><span class="ex">rustc</span> main.rs <span class="at">-L</span> .</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Rust enforces <code>unsafe</code> because it can’t verify what happens inside the C function.</p>
</section>
<section id="step-6.-using-c-in-go" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-using-c-in-go">Step 6. Using C in Go</h4>
<p>Go uses the <code>import "C"</code> directive for seamless C integration.</p>
<p><strong>Go Example:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1103"><pre class="sourceCode go code-with-copy"><code class="sourceCode go"><span id="cb1103-1"><a href="#cb1103-1" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb1103-2"><a href="#cb1103-2" aria-hidden="true" tabindex="-1"></a><span class="co">#include "mathlib.c"</span></span>
<span id="cb1103-3"><a href="#cb1103-3" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb1103-4"><a href="#cb1103-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="st">"C"</span></span>
<span id="cb1103-5"><a href="#cb1103-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="st">"fmt"</span></span>
<span id="cb1103-6"><a href="#cb1103-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1103-7"><a href="#cb1103-7" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb1103-8"><a href="#cb1103-8" aria-hidden="true" tabindex="-1"></a>    fmt<span class="op">.</span>Println<span class="op">(</span>C<span class="op">.</span>add<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">))</span></span>
<span id="cb1103-9"><a href="#cb1103-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1104"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1104-1"><a href="#cb1104-1" aria-hidden="true" tabindex="-1"></a><span class="ex">go</span> run main.go</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Go will compile your C code behind the scenes and link it automatically.</p>
</section>
<section id="step-7.-calling-foreign-code-from-c" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-calling-foreign-code-from-c">Step 7. Calling Foreign Code from C</h4>
<p>You can also go the other way, call functions from another language <em>inside C</em>.</p>
<p><strong>Example: C calling Python</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1105"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1105-1"><a href="#cb1105-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Python.h&gt;</span></span>
<span id="cb1105-2"><a href="#cb1105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1105-3"><a href="#cb1105-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1105-4"><a href="#cb1105-4" aria-hidden="true" tabindex="-1"></a>    Py_Initialize<span class="op">();</span></span>
<span id="cb1105-5"><a href="#cb1105-5" aria-hidden="true" tabindex="-1"></a>    PyRun_SimpleString<span class="op">(</span><span class="st">"print('Hello from Python in C!')"</span><span class="op">);</span></span>
<span id="cb1105-6"><a href="#cb1105-6" aria-hidden="true" tabindex="-1"></a>    Py_Finalize<span class="op">();</span></span>
<span id="cb1105-7"><a href="#cb1105-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile with:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1106"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1106-1"><a href="#cb1106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.c <span class="at">-o</span> main <span class="va">$(</span><span class="ex">python3-config</span> <span class="at">--cflags</span> <span class="at">--ldflags</span><span class="va">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This embeds a Python interpreter in your C program, powerful for scripting or AI integration.</p>
</section>
<section id="step-8.-data-structures-across-languages" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-data-structures-across-languages">Step 8. Data Structures Across Languages</h4>
<p>FFI works best with <strong>simple, C-compatible types</strong>:</p>
<ul>
<li><code>int</code>, <code>double</code>, <code>char *</code>, and flat structs. Avoid C++ classes, pointers to complex structs, or variable-length arrays, they often don’t translate cleanly.</li>
</ul>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1107"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1107-1"><a href="#cb1107-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb1107-2"><a href="#cb1107-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb1107-3"><a href="#cb1107-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> score<span class="op">;</span></span>
<span id="cb1107-4"><a href="#cb1107-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Record<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You can use this struct easily from Python (<code>ctypes.Structure</code>) or Rust (<code>#[repr(C)] struct</code>).</p>
</section>
<section id="step-9.-memory-ownership-rules" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-memory-ownership-rules">Step 9. Memory Ownership Rules</h4>
<p>Always define <em>who allocates and who frees memory</em>.</p>
<p>If C allocates something:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1108"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1108-1"><a href="#cb1108-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span><span class="op">*</span> greet<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1108-2"><a href="#cb1108-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span><span class="op">*</span> s <span class="op">=</span> malloc<span class="op">(</span><span class="dv">32</span><span class="op">);</span></span>
<span id="cb1108-3"><a href="#cb1108-3" aria-hidden="true" tabindex="-1"></a>    sprintf<span class="op">(</span>s<span class="op">,</span> <span class="st">"Hello from C!"</span><span class="op">);</span></span>
<span id="cb1108-4"><a href="#cb1108-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s<span class="op">;</span></span>
<span id="cb1108-5"><a href="#cb1108-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then the caller (e.g., Python) must call <code>free()</code> via FFI to avoid leaks. Never assume the garbage collector of another language will clean up C memory.</p>
</section>
<section id="step-10.-tiny-code-c-shared-library-python" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-c-shared-library-python">Step 10. Tiny Code: C Shared Library + Python</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1109"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1109-1"><a href="#cb1109-1" aria-hidden="true" tabindex="-1"></a><span class="co">// greet.c</span></span>
<span id="cb1109-2"><a href="#cb1109-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1109-3"><a href="#cb1109-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb1109-4"><a href="#cb1109-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1109-5"><a href="#cb1109-5" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span><span class="op">*</span> greet<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span><span class="op">*</span> name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1109-6"><a href="#cb1109-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> <span class="dt">char</span> buf<span class="op">[</span><span class="dv">64</span><span class="op">];</span></span>
<span id="cb1109-7"><a href="#cb1109-7" aria-hidden="true" tabindex="-1"></a>    snprintf<span class="op">(</span>buf<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buf<span class="op">),</span> <span class="st">"Hello, </span><span class="sc">%s</span><span class="st">!"</span><span class="op">,</span> name<span class="op">);</span></span>
<span id="cb1109-8"><a href="#cb1109-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> buf<span class="op">;</span></span>
<span id="cb1109-9"><a href="#cb1109-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1110"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1110-1"><a href="#cb1110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-shared</span> <span class="at">-fPIC</span> <span class="at">-o</span> libgreet.so greet.c</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Python:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1111-1"><a href="#cb1111-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ctypes</span>
<span id="cb1111-2"><a href="#cb1111-2" aria-hidden="true" tabindex="-1"></a>lib <span class="op">=</span> ctypes.CDLL(<span class="st">"./libgreet.so"</span>)</span>
<span id="cb1111-3"><a href="#cb1111-3" aria-hidden="true" tabindex="-1"></a>lib.greet.restype <span class="op">=</span> ctypes.c_char_p</span>
<span id="cb1111-4"><a href="#cb1111-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lib.greet(<span class="st">b"World"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Hello, World!</code></pre>
</section>
<section id="why-it-matters-75" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-75">Why It Matters</h4>
<p>FFI turns C into the foundation of the software world, your C code can power systems written in any language. This is how databases, OS kernels, and AI frameworks expose APIs across ecosystems. Understanding FFI means you can build <em>language bridges</em>, not just programs.</p>
</section>
<section id="try-it-yourself-85" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-85">Try It Yourself</h4>
<ol type="1">
<li>Write a simple C library (math, strings, or sorting).</li>
<li>Load it in Python using <code>ctypes</code> and call its functions.</li>
<li>Reuse the same library from Rust using <code>extern "C"</code>.</li>
<li>Embed Python in C for a scripting layer.</li>
<li>Think about which side should own and free memory.</li>
</ol>
<p>Next, you’ll explore <strong>safer alternatives and modern C features</strong>, bounds checking, static assertions, and ways to make C code more reliable.</p>
</section>
</section>
<section id="safer-alternatives-bounds-checking-_static_assert-and-modern-c-safety-tools" class="level3">
<h3 class="anchored" data-anchor-id="safer-alternatives-bounds-checking-_static_assert-and-modern-c-safety-tools">88. Safer Alternatives (Bounds Checking, <code>_Static_assert</code>, and Modern C Safety Tools)</h3>
<p>C gives you power and control, but also responsibility. Because C does not automatically protect you from memory errors, buffer overflows, or type misuse, you must add safety at the language and tool level.</p>
<p>This section explores modern safety features in <strong>C11 to C23</strong>, including <strong>bounds checking</strong>, <strong>static assertions</strong>, and practical habits for writing safer C.</p>
<section id="step-1.-why-safety-matters-in-c" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-why-safety-matters-in-c">Step 1. Why Safety Matters in C</h4>
<p>C is fast because it trusts the programmer. That means:</p>
<ul>
<li>It doesn’t check array bounds.</li>
<li>It doesn’t initialize memory automatically.</li>
<li>It doesn’t manage memory for you.</li>
</ul>
<p>That trust is both the reason C is used for kernels and the reason it causes so many bugs. The goal is not to make C “safe by default,” but to make your <em>use of C safe by design</em>.</p>
</section>
<section id="step-2.-safer-bounds-handling" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-safer-bounds-handling">Step 2. Safer Bounds Handling</h4>
<p>A classic error in C:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1113"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1113-1"><a href="#cb1113-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> name<span class="op">[</span><span class="dv">8</span><span class="op">];</span></span>
<span id="cb1113-2"><a href="#cb1113-2" aria-hidden="true" tabindex="-1"></a>strcpy<span class="op">(</span>name<span class="op">,</span> <span class="st">"HelloWorld"</span><span class="op">);</span> <span class="co">// buffer overflow</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This overwrites memory past <code>name</code> and causes undefined behavior.</p>
<p><strong>Fix 1:</strong> Use bounded versions of functions</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1114"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1114-1"><a href="#cb1114-1" aria-hidden="true" tabindex="-1"></a>strncpy<span class="op">(</span>name<span class="op">,</span> <span class="st">"HelloWorld"</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>name<span class="op">)</span> <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb1114-2"><a href="#cb1114-2" aria-hidden="true" tabindex="-1"></a>name<span class="op">[</span><span class="kw">sizeof</span><span class="op">(</span>name<span class="op">)</span> <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="ch">'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Fix 2:</strong> Use safer alternatives introduced in C11 Annex K (if your compiler supports them):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1115"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1115-1"><a href="#cb1115-1" aria-hidden="true" tabindex="-1"></a>strcpy_s<span class="op">(</span>name<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>name<span class="op">),</span> <span class="st">"Hello"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>They automatically check bounds and return error codes. However, Annex K is <em>optional</em>, so not all compilers implement it.</p>
</section>
<section id="step-3.-tiny-code-safe-string-copy" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-tiny-code-safe-string-copy">Step 3. Tiny Code: Safe String Copy</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1116"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1116-1"><a href="#cb1116-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1116-2"><a href="#cb1116-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb1116-3"><a href="#cb1116-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1116-4"><a href="#cb1116-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1116-5"><a href="#cb1116-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> dst<span class="op">[</span><span class="dv">8</span><span class="op">];</span></span>
<span id="cb1116-6"><a href="#cb1116-6" aria-hidden="true" tabindex="-1"></a>    strncpy<span class="op">(</span>dst<span class="op">,</span> <span class="st">"Example"</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>dst<span class="op">)</span> <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb1116-7"><a href="#cb1116-7" aria-hidden="true" tabindex="-1"></a>    dst<span class="op">[</span><span class="kw">sizeof</span><span class="op">(</span>dst<span class="op">)</span> <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="ch">'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">;</span></span>
<span id="cb1116-8"><a href="#cb1116-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Safe copy: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> dst<span class="op">);</span></span>
<span id="cb1116-9"><a href="#cb1116-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile with:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1117"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1117-1"><a href="#cb1117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> safe_copy.c <span class="at">-o</span> safe_copy <span class="at">-Wall</span> <span class="at">-Wextra</span> <span class="at">-O2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The <code>-Wall -Wextra</code> flags warn about suspicious behavior early, one of your best “safety tools.”</p>
</section>
<section id="step-4.-_static_assert-compile-time-checking" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-_static_assert-compile-time-checking">Step 4. <code>_Static_assert</code>: Compile-Time Checking</h4>
<p>Introduced in <strong>C11</strong>, <code>_Static_assert</code> lets you validate conditions <em>before</em> the program even compiles.</p>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1118"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1118-1"><a href="#cb1118-1" aria-hidden="true" tabindex="-1"></a><span class="kw">_Static_assert</span><span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">)</span> <span class="op">==</span> <span class="dv">4</span><span class="op">,</span> <span class="st">"This code requires 32-bit int"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If the condition fails, compilation stops with a clear message.</p>
<p>You can use it for:</p>
<ul>
<li>Checking structure layout</li>
<li>Ensuring type sizes</li>
<li>Verifying array lengths</li>
<li>Enforcing invariants</li>
</ul>
</section>
<section id="step-5.-safer-integer-operations" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-safer-integer-operations">Step 5. Safer Integer Operations</h4>
<p>Integer overflow is undefined behavior in C. Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1119"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1119-1"><a href="#cb1119-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">2147483647</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> <span class="co">// overflow</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Safer options:</p>
<ul>
<li><p>Use <code>unsigned</code> types when wrapping is intentional.</p></li>
<li><p>Use compiler flags:</p>
<ul>
<li><code>-ftrapv</code> (GCC/Clang): trap on overflow.</li>
<li><code>-fsanitize=undefined</code>: detect overflow at runtime.</li>
</ul></li>
</ul>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1120"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1120-1"><a href="#cb1120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-fsanitize</span><span class="op">=</span>undefined <span class="at">-O2</span> <span class="at">-g</span> check.c <span class="at">-o</span> check</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This will abort your program the moment an overflow occurs.</p>
</section>
<section id="step-6.-null-pointer-and-resource-safety" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-null-pointer-and-resource-safety">Step 6. Null Pointer and Resource Safety</h4>
<p>Always check return values:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1121"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1121-1"><a href="#cb1121-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> <span class="op">*</span>f <span class="op">=</span> fopen<span class="op">(</span><span class="st">"data.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb1121-2"><a href="#cb1121-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span>f<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1121-3"><a href="#cb1121-3" aria-hidden="true" tabindex="-1"></a>    perror<span class="op">(</span><span class="st">"Failed to open file"</span><span class="op">);</span></span>
<span id="cb1121-4"><a href="#cb1121-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1121-5"><a href="#cb1121-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>For dynamic memory:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1122"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1122-1"><a href="#cb1122-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>p <span class="op">=</span> malloc<span class="op">(</span><span class="dv">100</span><span class="op">);</span></span>
<span id="cb1122-2"><a href="#cb1122-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span>p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1122-3"><a href="#cb1122-3" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Out of memory</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1122-4"><a href="#cb1122-4" aria-hidden="true" tabindex="-1"></a>    exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb1122-5"><a href="#cb1122-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>And always <code>free()</code> when done.</p>
</section>
<section id="step-7.-tools-for-safety" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-tools-for-safety">Step 7. Tools for Safety</h4>
<p>Modern compilers and tools help you detect bugs early:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 55%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th>Tool</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>AddressSanitizer (<code>-fsanitize=address</code>)</strong></td>
<td>Detects buffer overflows, use-after-free</td>
</tr>
<tr class="even">
<td><strong>UndefinedBehaviorSanitizer (<code>-fsanitize=undefined</code>)</strong></td>
<td>Detects integer and type errors</td>
</tr>
<tr class="odd">
<td><strong>Valgrind</strong></td>
<td>Checks for memory leaks and invalid accesses</td>
</tr>
<tr class="even">
<td><strong>clang-tidy</strong></td>
<td>Static analysis and style checking</td>
</tr>
<tr class="odd">
<td><strong>cppcheck</strong></td>
<td>Portable static analyzer for C/C++</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1123"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1123-1"><a href="#cb1123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">clang</span> <span class="at">-fsanitize</span><span class="op">=</span>address safe.c <span class="at">-o</span> safe</span>
<span id="cb1123-2"><a href="#cb1123-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./safe</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If there’s a bug, you’ll get a detailed memory trace.</p>
</section>
<section id="step-8.-struct-and-alignment-checks" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-struct-and-alignment-checks">Step 8. Struct and Alignment Checks</h4>
<p>Unintended padding can cause issues when serializing or working with hardware. You can assert layout at compile time:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1124"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1124-1"><a href="#cb1124-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stddef.h&gt;</span></span>
<span id="cb1124-2"><a href="#cb1124-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1124-3"><a href="#cb1124-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1124-4"><a href="#cb1124-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Packet <span class="op">{</span></span>
<span id="cb1124-5"><a href="#cb1124-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> type<span class="op">;</span></span>
<span id="cb1124-6"><a href="#cb1124-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb1124-7"><a href="#cb1124-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb1124-8"><a href="#cb1124-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1124-9"><a href="#cb1124-9" aria-hidden="true" tabindex="-1"></a><span class="kw">_Static_assert</span><span class="op">(</span>offsetof<span class="op">(</span><span class="kw">struct</span> Packet<span class="op">,</span> id<span class="op">)</span> <span class="op">==</span> <span class="dv">4</span><span class="op">,</span> <span class="st">"Alignment mismatch"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This ensures your assumptions about memory layout are correct.</p>
</section>
<section id="step-9.-defensive-macros-and-compile-flags" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-defensive-macros-and-compile-flags">Step 9. Defensive Macros and Compile Flags</h4>
<p>Protect yourself with compile-time options:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 36%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th>Flag</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>-Wall -Wextra</code></td>
<td>Enable important warnings</td>
</tr>
<tr class="even">
<td><code>-Werror</code></td>
<td>Treat warnings as errors</td>
</tr>
<tr class="odd">
<td><code>-Wconversion</code></td>
<td>Warn on implicit type conversions</td>
</tr>
<tr class="even">
<td><code>-fsanitize=address</code></td>
<td>Detect memory safety issues</td>
</tr>
<tr class="odd">
<td><code>-D_FORTIFY_SOURCE=2</code></td>
<td>Add runtime buffer checks (glibc)</td>
</tr>
<tr class="even">
<td><code>-fstack-protector-strong</code></td>
<td>Detect stack corruption</td>
</tr>
<tr class="odd">
<td><code>-O2</code></td>
<td>Optimize safely without risky transformations</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1125"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1125-1"><a href="#cb1125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-Wall</span> <span class="at">-Wextra</span> <span class="at">-Werror</span> <span class="at">-O2</span> <span class="at">-fstack-protector-strong</span> <span class="at">-D_FORTIFY_SOURCE</span><span class="op">=</span>2 main.c <span class="at">-o</span> main</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-10.-tiny-code-using-static-assertions-and-sanitizers" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-using-static-assertions-and-sanitizers">Step 10. Tiny Code: Using Static Assertions and Sanitizers</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1126"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1126-1"><a href="#cb1126-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1126-2"><a href="#cb1126-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb1126-3"><a href="#cb1126-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb1126-4"><a href="#cb1126-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1126-5"><a href="#cb1126-5" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Data <span class="op">{</span></span>
<span id="cb1126-6"><a href="#cb1126-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb1126-7"><a href="#cb1126-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">16</span><span class="op">];</span></span>
<span id="cb1126-8"><a href="#cb1126-8" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb1126-9"><a href="#cb1126-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1126-10"><a href="#cb1126-10" aria-hidden="true" tabindex="-1"></a><span class="kw">_Static_assert</span><span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="kw">struct</span> Data<span class="op">)</span> <span class="op">&lt;=</span> <span class="dv">32</span><span class="op">,</span> <span class="st">"Struct too large"</span><span class="op">);</span></span>
<span id="cb1126-11"><a href="#cb1126-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1126-12"><a href="#cb1126-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1126-13"><a href="#cb1126-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Data d <span class="op">=</span> <span class="op">{</span><span class="dv">42</span><span class="op">,</span> <span class="st">"C Safety"</span><span class="op">};</span></span>
<span id="cb1126-14"><a href="#cb1126-14" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> d<span class="op">.</span>id<span class="op">,</span> d<span class="op">.</span>name<span class="op">);</span></span>
<span id="cb1126-15"><a href="#cb1126-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1126-16"><a href="#cb1126-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buf<span class="op">[</span><span class="dv">8</span><span class="op">];</span></span>
<span id="cb1126-17"><a href="#cb1126-17" aria-hidden="true" tabindex="-1"></a>    strncpy<span class="op">(</span>buf<span class="op">,</span> <span class="st">"Safe"</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buf<span class="op">)</span> <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb1126-18"><a href="#cb1126-18" aria-hidden="true" tabindex="-1"></a>    buf<span class="op">[</span><span class="kw">sizeof</span><span class="op">(</span>buf<span class="op">)</span> <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="ch">'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">;</span></span>
<span id="cb1126-19"><a href="#cb1126-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1126-20"><a href="#cb1126-20" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Buffer: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> buf<span class="op">);</span></span>
<span id="cb1126-21"><a href="#cb1126-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile with:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1127"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1127-1"><a href="#cb1127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-Wall</span> <span class="at">-Wextra</span> <span class="at">-fsanitize</span><span class="op">=</span>address <span class="at">-O2</span> safe_program.c <span class="at">-o</span> safe_program</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This program will abort if memory safety is violated, giving you immediate feedback during testing.</p>
</section>
<section id="why-it-matters-76" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-76">Why It Matters</h4>
<p>Safety doesn’t make your code slower, it makes your software <em>trustworthy</em>. Even though C gives you sharp tools, the combination of static checks, compiler warnings, and runtime sanitizers can make your programs robust enough for production systems.</p>
</section>
<section id="try-it-yourself-86" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-86">Try It Yourself</h4>
<ol type="1">
<li>Add <code>_Static_assert</code> checks in your structs and constants.</li>
<li>Compile with <code>-Wall -Wextra -Werror</code> and fix all warnings.</li>
<li>Use AddressSanitizer to catch out-of-bounds bugs.</li>
<li>Test your program under Valgrind for leaks.</li>
<li>Try writing the same buggy code twice, once raw, once safe, and compare behavior.</li>
</ol>
<p>Next, you’ll explore <strong>modern C style</strong>, how to write clear, maintainable, and idiomatic code in the C23 era.</p>
</section>
</section>
<section id="modern-style-clean-and-readable-c" class="level3">
<h3 class="anchored" data-anchor-id="modern-style-clean-and-readable-c">89. Modern Style: Clean and Readable C</h3>
<p>C has been around for over 50 years, and yet it keeps evolving. Modern C (C11–C23) combines the power of low-level programming with safer syntax, cleaner idioms, and new features that make code easier to reason about.</p>
<p>This section will help you write <strong>modern, readable, and maintainable C</strong>, the kind of C that feels timeless.</p>
<section id="step-1.-think-clarity-over-cleverness" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-think-clarity-over-cleverness">Step 1. Think “Clarity Over Cleverness”</h4>
<p>The golden rule of modern C is:</p>
<blockquote class="blockquote">
<p>Write for humans, not compilers.</p>
</blockquote>
<p>Compilers can handle complexity, your teammates (and future you) can’t.</p>
<p>Bad:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1128"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1128-1"><a href="#cb1128-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> n<span class="op">;</span> i<span class="op">--;</span> <span class="op">)</span> a<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Good:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1129"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1129-1"><a href="#cb1129-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb1129-2"><a href="#cb1129-2" aria-hidden="true" tabindex="-1"></a>    a<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Readability and simplicity always win.</p>
</section>
<section id="step-2.-prefer-explicit-initialization" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-prefer-explicit-initialization">Step 2. Prefer Explicit Initialization</h4>
<p>Always initialize your variables. Uninitialized memory is one of the biggest sources of bugs.</p>
<p>Bad:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1130"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1130-1"><a href="#cb1130-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x<span class="op">;</span></span>
<span id="cb1130-2"><a href="#cb1130-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Good:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1131"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1131-1"><a href="#cb1131-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1131-2"><a href="#cb1131-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Also initialize arrays and structs explicitly:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1132"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1132-1"><a href="#cb1132-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> arr<span class="op">[</span><span class="dv">10</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb1132-2"><a href="#cb1132-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Point p <span class="op">=</span> <span class="op">{</span> <span class="op">.</span>x <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> <span class="op">.</span>y <span class="op">=</span> <span class="dv">20</span> <span class="op">};</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-3.-use-const-generously" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-use-const-generously">Step 3. Use <code>const</code> Generously</h4>
<p><code>const</code> communicates intent, “this value shouldn’t change.”</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1133"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1133-1"><a href="#cb1133-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">double</span> PI <span class="op">=</span> <span class="fl">3.14159</span><span class="op">;</span></span>
<span id="cb1133-2"><a href="#cb1133-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span><span class="op">*</span> message<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This helps the compiler optimize, prevents accidental modification, and improves clarity.</p>
</section>
<section id="step-4.-prefer-modern-standard-headers" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-prefer-modern-standard-headers">Step 4. Prefer Modern Standard Headers</h4>
<p>Use standard headers like <code>&lt;stdint.h&gt;</code>, <code>&lt;stdbool.h&gt;</code>, and <code>&lt;stddef.h&gt;</code> for clear, portable code.</p>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1134"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1134-1"><a href="#cb1134-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdint.h&gt;</span></span>
<span id="cb1134-2"><a href="#cb1134-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdbool.h&gt;</span></span>
<span id="cb1134-3"><a href="#cb1134-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1134-4"><a href="#cb1134-4" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> is_even<span class="op">(</span><span class="dt">uint32_t</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1134-5"><a href="#cb1134-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>n <span class="op">%</span> <span class="dv">2</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1134-6"><a href="#cb1134-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Avoid using old-style typedefs like <code>typedef unsigned long ulong;</code> unless it improves meaning.</p>
</section>
<section id="step-5.-use-bool-instead-of-int-for-logic" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-use-bool-instead-of-int-for-logic">Step 5. Use <code>bool</code> Instead of <code>int</code> for Logic</h4>
<p>In old C, people used <code>int</code> for true/false. Modern C gives you <code>_Bool</code> via <code>&lt;stdbool.h&gt;</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1135"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1135-1"><a href="#cb1135-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdbool.h&gt;</span></span>
<span id="cb1135-2"><a href="#cb1135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1135-3"><a href="#cb1135-3" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> done <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb1135-4"><a href="#cb1135-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span>done<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1135-5"><a href="#cb1135-5" aria-hidden="true" tabindex="-1"></a>    done <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb1135-6"><a href="#cb1135-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This improves clarity and makes your code self-documenting.</p>
</section>
<section id="step-6.-write-small-focused-functions" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-write-small-focused-functions">Step 6. Write Small, Focused Functions</h4>
<p>Keep functions short, ideally one purpose per function.</p>
<p>Bad:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1136"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1136-1"><a href="#cb1136-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> handle_all<span class="op">()</span> <span class="op">{</span> <span class="co">/* does 10 things */</span> <span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Good:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1137"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1137-1"><a href="#cb1137-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> read_input<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span>
<span id="cb1137-2"><a href="#cb1137-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> process_data<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span>
<span id="cb1137-3"><a href="#cb1137-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> write_output<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This makes testing and debugging far easier.</p>
</section>
<section id="step-7.-avoid-macros-for-everything" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-avoid-macros-for-everything">Step 7. Avoid Macros for Everything</h4>
<p>In early C, macros were overused for constants and functions. Today, prefer inline functions and <code>const</code> instead.</p>
<p>Bad:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1138"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1138-1"><a href="#cb1138-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SQUARE</span><span class="op">(</span><span class="pp">x</span><span class="op">)</span><span class="pp"> </span><span class="op">((</span><span class="pp">x</span><span class="op">)</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">x</span><span class="op">))</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Good:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1139"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1139-1"><a href="#cb1139-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="kw">inline</span> <span class="dt">int</span> square<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> x <span class="op">*</span> x<span class="op">;</span> <span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Inline functions are type-safe and debug-friendly.</p>
</section>
<section id="step-8.-use-scoped-variables-and-declarations" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-use-scoped-variables-and-declarations">Step 8. Use Scoped Variables and Declarations</h4>
<p>Since C99, you can declare variables close to where they’re used:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1140"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1140-1"><a href="#cb1140-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb1140-2"><a href="#cb1140-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb1140-3"><a href="#cb1140-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Avoid keeping variables alive longer than necessary, this reduces bugs and clarifies scope.</p>
</section>
<section id="step-9.-embrace-c23-features" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-embrace-c23-features">Step 9. Embrace C23 Features</h4>
<p>C23 modernizes syntax and makes C safer and more expressive.</p>
<p>Highlights:</p>
<ul>
<li><code>typeof</code>, reuse variable types automatically</li>
<li><code>nullptr</code>, replaces <code>NULL</code></li>
<li><code>[[nodiscard]]</code>, warn if function return is ignored</li>
<li><code>auto</code>, type inference for local variables</li>
<li>UTF-8 character support and string literals</li>
<li><code>alignof</code> / <code>alignas</code> for precise memory layout</li>
</ul>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1141"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1141-1"><a href="#cb1141-1" aria-hidden="true" tabindex="-1"></a><span class="op">[[</span><span class="at">nodiscard</span><span class="op">]]</span> <span class="dt">int</span> divide<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1141-2"><a href="#cb1141-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>b <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1141-3"><a href="#cb1141-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">/</span> b<span class="op">;</span></span>
<span id="cb1141-4"><a href="#cb1141-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-10.-tiny-code-modern-c23-example" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-tiny-code-modern-c23-example">Step 10. Tiny Code: Modern C23 Example</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1142"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1142-1"><a href="#cb1142-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1142-2"><a href="#cb1142-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdbool.h&gt;</span></span>
<span id="cb1142-3"><a href="#cb1142-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdint.h&gt;</span></span>
<span id="cb1142-4"><a href="#cb1142-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1142-5"><a href="#cb1142-5" aria-hidden="true" tabindex="-1"></a><span class="op">[[</span><span class="at">nodiscard</span><span class="op">]]</span> <span class="dt">static</span> <span class="kw">inline</span> <span class="dt">uint32_t</span> add<span class="op">(</span><span class="dt">uint32_t</span> a<span class="op">,</span> <span class="dt">uint32_t</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1142-6"><a href="#cb1142-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb1142-7"><a href="#cb1142-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1142-8"><a href="#cb1142-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1142-9"><a href="#cb1142-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1142-10"><a href="#cb1142-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">uint32_t</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> y <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb1142-11"><a href="#cb1142-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> sum <span class="op">=</span> add<span class="op">(</span>x<span class="op">,</span> y<span class="op">);</span></span>
<span id="cb1142-12"><a href="#cb1142-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1142-13"><a href="#cb1142-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> valid <span class="op">=</span> <span class="op">(</span>sum <span class="op">&gt;</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb1142-14"><a href="#cb1142-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>valid<span class="op">)</span></span>
<span id="cb1142-15"><a href="#cb1142-15" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Sum = </span><span class="sc">%u\n</span><span class="st">"</span><span class="op">,</span> sum<span class="op">);</span></span>
<span id="cb1142-16"><a href="#cb1142-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1142-17"><a href="#cb1142-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1142-18"><a href="#cb1142-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile with a modern compiler (GCC 13+ or Clang 17+):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1143"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1143-1"><a href="#cb1143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-std</span><span class="op">=</span>c23 modern.c <span class="at">-o</span> modern</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Sum = 30</code></pre>
<p>This code uses <code>[[nodiscard]]</code>, <code>bool</code>, and <code>const</code>, small touches that improve both style and safety.</p>
</section>
<section id="why-it-matters-77" class="level4">
<h4 class="anchored" data-anchor-id="why-it-matters-77">Why It Matters</h4>
<p>Readable C code lasts for decades. The best systems code, in kernels, compilers, and libraries, looks simple because it follows clear patterns:</p>
<ul>
<li><strong>Small, pure functions.</strong></li>
<li><strong>Explicit types.</strong></li>
<li><strong>No surprises in memory handling.</strong></li>
</ul>
<p>Modern C doesn’t mean rewriting everything. It means writing <em>intentional C</em>, clear, correct, and expressive.</p>
</section>
<section id="try-it-yourself-87" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-87">Try It Yourself</h4>
<ol type="1">
<li>Refactor one of your old programs to use <code>&lt;stdint.h&gt;</code> and <code>&lt;stdbool.h&gt;</code>.</li>
<li>Replace macros with inline functions.</li>
<li>Add <code>const</code> wherever possible.</li>
<li>Try compiling with <code>-std=c23</code> and explore new warnings.</li>
<li>Make your functions pure and side-effect free where possible.</li>
</ol>
<p>Next, you’ll conclude this journey with <strong>Practice: Portable Multithreaded Program (90)</strong>, a hands-on project that combines everything from memory management to threading and portability.</p>
</section>
</section>
<section id="practice-portable-multithreaded-program" class="level3">
<h3 class="anchored" data-anchor-id="practice-portable-multithreaded-program">90. Practice: Portable Multithreaded Program</h3>
<p>It’s time to bring together everything you’ve learned, memory management, threads, synchronization, and portability, into one cohesive program.</p>
<p>In this final section of <strong>Chapter 9</strong>, you’ll build a <strong>portable multithreaded counter</strong> that runs correctly across architectures, compilers, and systems, demonstrating clean, safe, and modern C in practice.</p>
<section id="step-1.-the-goal" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-the-goal">Step 1. The Goal</h4>
<p>We’ll write a program that:</p>
<ul>
<li>Spawns multiple threads using <code>pthread</code> (POSIX standard).</li>
<li>Uses atomic operations for safe concurrent updates.</li>
<li>Prints consistent results regardless of CPU or endianness.</li>
<li>Compiles cleanly across Linux, macOS, and Windows (via MinGW).</li>
<li>Uses modern, readable C11–C23 style.</li>
</ul>
</section>
<section id="step-2.-plan-the-design" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-plan-the-design">Step 2. Plan the Design</h4>
<ol type="1">
<li><strong>Shared Counter:</strong> <code>atomic_int</code> for thread-safe increments.</li>
<li><strong>Thread Function:</strong> Each thread performs a loop of increments.</li>
<li><strong>Timing:</strong> Measure elapsed time for performance insight.</li>
<li><strong>Portability:</strong> Use <code>#ifdef</code> for cross-platform compatibility.</li>
<li><strong>Final Validation:</strong> Ensure result equals total increments.</li>
</ol>
</section>
<section id="step-3.-full-tiny-code" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-full-tiny-code">Step 3. Full Tiny Code</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1145"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1145-1"><a href="#cb1145-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1145-2"><a href="#cb1145-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb1145-3"><a href="#cb1145-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb1145-4"><a href="#cb1145-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span>
<span id="cb1145-5"><a href="#cb1145-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdint.h&gt;</span></span>
<span id="cb1145-6"><a href="#cb1145-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb1145-7"><a href="#cb1145-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1145-8"><a href="#cb1145-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef _WIN32</span></span>
<span id="cb1145-9"><a href="#cb1145-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;windows.h&gt;</span></span>
<span id="cb1145-10"><a href="#cb1145-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SLEEP</span><span class="op">(</span><span class="pp">ms</span><span class="op">)</span><span class="pp"> Sleep</span><span class="op">(</span><span class="pp">ms</span><span class="op">)</span></span>
<span id="cb1145-11"><a href="#cb1145-11" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span>
<span id="cb1145-12"><a href="#cb1145-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb1145-13"><a href="#cb1145-13" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SLEEP</span><span class="op">(</span><span class="pp">ms</span><span class="op">)</span><span class="pp"> </span>usleep<span class="op">((</span><span class="pp">ms</span><span class="op">)</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="dv">1000</span><span class="op">)</span></span>
<span id="cb1145-14"><a href="#cb1145-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb1145-15"><a href="#cb1145-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1145-16"><a href="#cb1145-16" aria-hidden="true" tabindex="-1"></a><span class="pp">#define THREADS </span><span class="dv">4</span></span>
<span id="cb1145-17"><a href="#cb1145-17" aria-hidden="true" tabindex="-1"></a><span class="pp">#define ITERATIONS </span><span class="dv">250000</span></span>
<span id="cb1145-18"><a href="#cb1145-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1145-19"><a href="#cb1145-19" aria-hidden="true" tabindex="-1"></a>atomic_int counter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1145-20"><a href="#cb1145-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1145-21"><a href="#cb1145-21" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span><span class="op">*</span> worker<span class="op">(</span><span class="dt">void</span><span class="op">*</span> arg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1145-22"><a href="#cb1145-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id <span class="op">=</span> <span class="op">*(</span><span class="dt">int</span><span class="op">*)</span>arg<span class="op">;</span></span>
<span id="cb1145-23"><a href="#cb1145-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> ITERATIONS<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb1145-24"><a href="#cb1145-24" aria-hidden="true" tabindex="-1"></a>        atomic_fetch_add<span class="op">(&amp;</span>counter<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb1145-25"><a href="#cb1145-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>i <span class="op">%</span> <span class="dv">100000</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> id <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb1145-26"><a href="#cb1145-26" aria-hidden="true" tabindex="-1"></a>            SLEEP<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb1145-27"><a href="#cb1145-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1145-28"><a href="#cb1145-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1145-29"><a href="#cb1145-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1145-30"><a href="#cb1145-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1145-31"><a href="#cb1145-31" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> now<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1145-32"><a href="#cb1145-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> timespec ts<span class="op">;</span></span>
<span id="cb1145-33"><a href="#cb1145-33" aria-hidden="true" tabindex="-1"></a>    clock_gettime<span class="op">(</span>CLOCK_MONOTONIC<span class="op">,</span> <span class="op">&amp;</span>ts<span class="op">);</span></span>
<span id="cb1145-34"><a href="#cb1145-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ts<span class="op">.</span>tv_sec <span class="op">+</span> ts<span class="op">.</span>tv_nsec <span class="op">/</span> <span class="fl">1e9</span><span class="op">;</span></span>
<span id="cb1145-35"><a href="#cb1145-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1145-36"><a href="#cb1145-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1145-37"><a href="#cb1145-37" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1145-38"><a href="#cb1145-38" aria-hidden="true" tabindex="-1"></a>    pthread_t threads<span class="op">[</span>THREADS<span class="op">];</span></span>
<span id="cb1145-39"><a href="#cb1145-39" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> ids<span class="op">[</span>THREADS<span class="op">];</span></span>
<span id="cb1145-40"><a href="#cb1145-40" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> start <span class="op">=</span> now<span class="op">();</span></span>
<span id="cb1145-41"><a href="#cb1145-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1145-42"><a href="#cb1145-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> THREADS<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb1145-43"><a href="#cb1145-43" aria-hidden="true" tabindex="-1"></a>        ids<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb1145-44"><a href="#cb1145-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>pthread_create<span class="op">(&amp;</span>threads<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">,</span> worker<span class="op">,</span> <span class="op">&amp;</span>ids<span class="op">[</span>i<span class="op">])</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1145-45"><a href="#cb1145-45" aria-hidden="true" tabindex="-1"></a>            perror<span class="op">(</span><span class="st">"pthread_create failed"</span><span class="op">);</span></span>
<span id="cb1145-46"><a href="#cb1145-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1145-47"><a href="#cb1145-47" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1145-48"><a href="#cb1145-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1145-49"><a href="#cb1145-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1145-50"><a href="#cb1145-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> THREADS<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb1145-51"><a href="#cb1145-51" aria-hidden="true" tabindex="-1"></a>        pthread_join<span class="op">(</span>threads<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">);</span></span>
<span id="cb1145-52"><a href="#cb1145-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1145-53"><a href="#cb1145-53" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> end <span class="op">=</span> now<span class="op">();</span></span>
<span id="cb1145-54"><a href="#cb1145-54" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Counter = </span><span class="sc">%d</span><span class="st"> (expected </span><span class="sc">%d</span><span class="st">)</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> counter<span class="op">,</span> THREADS <span class="op">*</span> ITERATIONS<span class="op">);</span></span>
<span id="cb1145-55"><a href="#cb1145-55" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Elapsed time: </span><span class="sc">%.3f</span><span class="st"> seconds</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> end <span class="op">-</span> start<span class="op">);</span></span>
<span id="cb1145-56"><a href="#cb1145-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1145-57"><a href="#cb1145-57" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-4.-how-it-works" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-how-it-works">Step 4. How It Works</h4>
<ul>
<li><p><strong>Atomic Counter:</strong> <code>atomic_fetch_add</code> ensures that increments are atomic and race-free without using a mutex.</p></li>
<li><p><strong>Thread Creation:</strong> Each thread runs the <code>worker()</code> function independently.</p></li>
<li><p><strong>Synchronization:</strong> <code>pthread_join</code> ensures all threads finish before printing results.</p></li>
<li><p><strong>Timing:</strong> Uses <code>clock_gettime()</code> for precise cross-platform timing.</p></li>
<li><p><strong>Sleep Macro:</strong> <code>SLEEP(ms)</code> abstracts away platform differences between Windows and POSIX.</p></li>
</ul>
</section>
<section id="step-5.-compile-and-run" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-compile-and-run">Step 5. Compile and Run</h4>
<p>On Linux or macOS:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1146"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1146-1"><a href="#cb1146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-std</span><span class="op">=</span>c23 <span class="at">-pthread</span> <span class="at">-O2</span> <span class="at">-Wall</span> <span class="at">-Wextra</span> portable_threads.c <span class="at">-o</span> portable_threads</span>
<span id="cb1146-2"><a href="#cb1146-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./portable_threads</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>On Windows (MinGW):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1147"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1147-1"><a href="#cb1147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-std</span><span class="op">=</span>c23 <span class="at">-O2</span> <span class="at">-Wall</span> <span class="at">-Wextra</span> portable_threads.c <span class="at">-o</span> portable_threads.exe <span class="at">-lws2_32</span></span>
<span id="cb1147-2"><a href="#cb1147-2" aria-hidden="true" tabindex="-1"></a><span class="ex">portable_threads.exe</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Expected output:</p>
<pre><code>Counter = 1000000 (expected 1000000)
Elapsed time: 0.134 seconds</code></pre>
<p>The program finishes with perfect accuracy, no race conditions, and works across platforms.</p>
</section>
<section id="step-6.-improving-portability" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-improving-portability">Step 6. Improving Portability</h4>
<ul>
<li><p><strong>Replace pthreads with C11 <code>&lt;threads.h&gt;</code></strong> if you want standard-only C:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1149"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1149-1"><a href="#cb1149-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;threads.h&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Use <code>thrd_create</code> and <code>thrd_join</code> instead of <code>pthread_create</code> and <code>pthread_join</code>.</p></li>
<li><p><strong>Use static assertions for validation:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1150"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1150-1"><a href="#cb1150-1" aria-hidden="true" tabindex="-1"></a><span class="kw">_Static_assert</span><span class="op">(</span>THREADS <span class="op">&gt;</span> <span class="dv">0</span><span class="op">,</span> <span class="st">"Must have at least one thread"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><strong>Use conditional macros</strong> for system differences (<code>_WIN32</code>, <code>__linux__</code>, <code>__APPLE__</code>).</p></li>
</ul>
</section>
<section id="step-7.-safety-and-clarity-checklist" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-safety-and-clarity-checklist">Step 7. Safety and Clarity Checklist</h4>
<p>✅ No raw pointers shared unsafely ✅ Atomic operations prevent races ✅ Sleep and timing are cross-platform ✅ Clean, modern syntax with C23 support ✅ Easy to modify (e.g., change thread count or workload)</p>
</section>
<section id="step-8.-why-its-portable" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-why-its-portable">Step 8. Why It’s Portable</h4>
<ul>
<li>Uses only standard C and POSIX APIs.</li>
<li>Avoids endian-dependent or undefined behavior.</li>
<li>Has clear abstractions for platform-specific code.</li>
<li>Relies on atomic types, not CPU-specific intrinsics.</li>
<li>Runs on x86, ARM, RISC-V, and others without changes.</li>
</ul>
</section>
<section id="step-9.-why-it-matters" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-why-it-matters">Step 9. Why It Matters</h4>
<p>This tiny program embodies what C is best at:</p>
<ul>
<li><strong>Speed:</strong> Threaded performance close to hardware.</li>
<li><strong>Control:</strong> Explicit memory and concurrency.</li>
<li><strong>Clarity:</strong> Modern C syntax keeps it readable.</li>
<li><strong>Portability:</strong> Runs everywhere a compiler exists.</li>
</ul>
<p>This is the C of today, minimal, precise, and reliable.</p>
</section>
<section id="step-10.-try-it-yourself" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-try-it-yourself">Step 10. Try It Yourself</h4>
<ol type="1">
<li>Change <code>THREADS</code> and observe performance scaling.</li>
<li>Replace the atomic counter with a mutex, compare speed.</li>
<li>Port it to Windows and verify output.</li>
<li>Add timing to measure each thread’s duration.</li>
<li>Experiment with C11 <code>&lt;threads.h&gt;</code> API for pure standard C.</li>
</ol>
<p>You’ve completed <strong>Chapter 9, Portable and Modern C</strong>. Next comes <strong>Chapter 10: Building Real Projects</strong>, where you’ll apply these foundations to construct real-world systems, libraries, servers, and interpreters, all in clean, idiomatic C.</p>
</section>
</section>
</section>
<section id="chapter-10.-building-real-projects" class="level1">
<h1>Chapter 10. Building Real Projects</h1>
<section id="designing-small-c-libraries" class="level3">
<h3 class="anchored" data-anchor-id="designing-small-c-libraries">91. Designing Small C Libraries</h3>
<p>Writing libraries is how you make your C code reusable, modular, and easy to maintain. In this section, you’ll learn how to design and structure a <strong>small, portable, and well-documented C library</strong>, the kind used in real systems for decades.</p>
<section id="step-1.-what-is-a-library-in-c" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-what-is-a-library-in-c">Step 1. What Is a Library in C?</h4>
<p>A library in C is a <strong>collection of functions and data types</strong> that can be used by multiple programs.</p>
<p>There are two kinds of libraries:</p>
<ul>
<li><strong>Static libraries</strong> (<code>.a</code> or <code>.lib</code>) – compiled into the final program at build time.</li>
<li><strong>Shared libraries</strong> (<code>.so</code> or <code>.dll</code>) – loaded dynamically at runtime.</li>
</ul>
<p>You’ll start by building a small <strong>static library</strong> that provides reusable math utilities.</p>
</section>
<section id="step-2.-plan-the-library" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-plan-the-library">Step 2. Plan the Library</h4>
<p>Let’s design a library called <strong>simplemath</strong>, which provides:</p>
<ul>
<li><code>add</code>, <code>subtract</code>, <code>multiply</code>, <code>divide</code></li>
<li>Error handling for divide-by-zero</li>
<li>Clean, consistent naming</li>
</ul>
<p>Structure:</p>
<pre><code>simplemath/
 ├── include/
 │    └── simplemath.h
 ├── src/
 │    └── simplemath.c
 └── Makefile</code></pre>
</section>
<section id="step-3.-the-header-file-simplemath.h" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-the-header-file-simplemath.h">Step 3. The Header File (<code>simplemath.h</code>)</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1152"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1152-1"><a href="#cb1152-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef SIMPLEMATH_H</span></span>
<span id="cb1152-2"><a href="#cb1152-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SIMPLEMATH_H</span></span>
<span id="cb1152-3"><a href="#cb1152-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1152-4"><a href="#cb1152-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef __cplusplus</span></span>
<span id="cb1152-5"><a href="#cb1152-5" aria-hidden="true" tabindex="-1"></a><span class="kw">extern</span> <span class="st">"C"</span> <span class="op">{</span></span>
<span id="cb1152-6"><a href="#cb1152-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb1152-7"><a href="#cb1152-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1152-8"><a href="#cb1152-8" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> sm_add<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">);</span></span>
<span id="cb1152-9"><a href="#cb1152-9" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> sm_sub<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">);</span></span>
<span id="cb1152-10"><a href="#cb1152-10" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> sm_mul<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">);</span></span>
<span id="cb1152-11"><a href="#cb1152-11" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> sm_div<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>error<span class="op">);</span></span>
<span id="cb1152-12"><a href="#cb1152-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1152-13"><a href="#cb1152-13" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef __cplusplus</span></span>
<span id="cb1152-14"><a href="#cb1152-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1152-15"><a href="#cb1152-15" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb1152-16"><a href="#cb1152-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1152-17"><a href="#cb1152-17" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Notes:</strong></p>
<ul>
<li>Include guards prevent double inclusion.</li>
<li><code>extern "C"</code> allows usage in C++ projects.</li>
<li>Prefix (<code>sm_</code>) prevents naming conflicts.</li>
</ul>
</section>
<section id="step-4.-the-implementation-file-simplemath.c" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-the-implementation-file-simplemath.c">Step 4. The Implementation File (<code>simplemath.c</code>)</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1153"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1153-1"><a href="#cb1153-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"simplemath.h"</span></span>
<span id="cb1153-2"><a href="#cb1153-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1153-3"><a href="#cb1153-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1153-4"><a href="#cb1153-4" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> sm_add<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1153-5"><a href="#cb1153-5" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> sm_sub<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">-</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1153-6"><a href="#cb1153-6" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> sm_mul<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">*</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1153-7"><a href="#cb1153-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1153-8"><a href="#cb1153-8" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> sm_div<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>error<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1153-9"><a href="#cb1153-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>b <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1153-10"><a href="#cb1153-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>error<span class="op">)</span> <span class="op">*</span>error <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1153-11"><a href="#cb1153-11" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Division by zero</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1153-12"><a href="#cb1153-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb1153-13"><a href="#cb1153-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1153-14"><a href="#cb1153-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>error<span class="op">)</span> <span class="op">*</span>error <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1153-15"><a href="#cb1153-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">/</span> b<span class="op">;</span></span>
<span id="cb1153-16"><a href="#cb1153-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-5.-tiny-code-example-program-using-the-library" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-tiny-code-example-program-using-the-library">Step 5. Tiny Code: Example Program Using the Library</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1154"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1154-1"><a href="#cb1154-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1154-2"><a href="#cb1154-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"simplemath.h"</span></span>
<span id="cb1154-3"><a href="#cb1154-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1154-4"><a href="#cb1154-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1154-5"><a href="#cb1154-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> err<span class="op">;</span></span>
<span id="cb1154-6"><a href="#cb1154-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> x <span class="op">=</span> sm_div<span class="op">(</span><span class="dv">10</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="op">&amp;</span>err<span class="op">);</span></span>
<span id="cb1154-7"><a href="#cb1154-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"10 / 2 = </span><span class="sc">%.2f\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb1154-8"><a href="#cb1154-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1154-9"><a href="#cb1154-9" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> sm_div<span class="op">(</span><span class="dv">10</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="op">&amp;</span>err<span class="op">);</span></span>
<span id="cb1154-10"><a href="#cb1154-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>err<span class="op">)</span> printf<span class="op">(</span><span class="st">"Error detected during division.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1154-11"><a href="#cb1154-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1154-12"><a href="#cb1154-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-6.-makefile-to-build-the-library" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-makefile-to-build-the-library">Step 6. Makefile to Build the Library</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1155"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb1155-1"><a href="#cb1155-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span> <span class="ch">=</span><span class="st"> gcc</span></span>
<span id="cb1155-2"><a href="#cb1155-2" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span> <span class="ch">=</span><span class="st"> -std=c23 -O2 -Wall -Wextra -Iinclude</span></span>
<span id="cb1155-3"><a href="#cb1155-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1155-4"><a href="#cb1155-4" aria-hidden="true" tabindex="-1"></a><span class="dv">all:</span><span class="dt"> libsimplemath.a test</span></span>
<span id="cb1155-5"><a href="#cb1155-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1155-6"><a href="#cb1155-6" aria-hidden="true" tabindex="-1"></a><span class="dv">libsimplemath.a:</span><span class="dt"> src/simplemath.o</span></span>
<span id="cb1155-7"><a href="#cb1155-7" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>ar rcs libsimplemath.a src/simplemath.o</span>
<span id="cb1155-8"><a href="#cb1155-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1155-9"><a href="#cb1155-9" aria-hidden="true" tabindex="-1"></a><span class="dv">src/simplemath.o:</span><span class="dt"> src/simplemath.c include/simplemath.h</span></span>
<span id="cb1155-10"><a href="#cb1155-10" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> -c src/simplemath.c -o src/simplemath.o</span>
<span id="cb1155-11"><a href="#cb1155-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1155-12"><a href="#cb1155-12" aria-hidden="true" tabindex="-1"></a><span class="dv">test:</span><span class="dt"> test.c libsimplemath.a</span></span>
<span id="cb1155-13"><a href="#cb1155-13" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> test.c -L. -lsimplemath -o test</span>
<span id="cb1155-14"><a href="#cb1155-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1155-15"><a href="#cb1155-15" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb1155-16"><a href="#cb1155-16" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f src/*.o *.a test</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Build it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1156"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1156-1"><a href="#cb1156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1157"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1157-1"><a href="#cb1157-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./test</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>10 / 2 = 5.00
Division by zero
Error detected during division.</code></pre>
</section>
<section id="step-7.-design-guidelines-for-clean-c-libraries" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-design-guidelines-for-clean-c-libraries">Step 7. Design Guidelines for Clean C Libraries</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 38%">
<col style="width: 61%">
</colgroup>
<thead>
<tr class="header">
<th>Principle</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Prefix all symbols</strong></td>
<td>Avoid global name clashes (e.g., <code>sm_add</code>)</td>
</tr>
<tr class="even">
<td><strong>Single responsibility</strong></td>
<td>Each function should do one clear thing</td>
</tr>
<tr class="odd">
<td><strong>Minimal dependencies</strong></td>
<td>Don’t rely on non-standard headers</td>
</tr>
<tr class="even">
<td><strong>Use header guards</strong></td>
<td>Prevent duplicate inclusion</td>
</tr>
<tr class="odd">
<td><strong>Provide error handling</strong></td>
<td>Return codes, <code>errno</code>, or out parameters</td>
</tr>
<tr class="even">
<td><strong>Write documentation</strong></td>
<td>Use Doxygen or simple comment blocks</td>
</tr>
<tr class="odd">
<td><strong>Version your API</strong></td>
<td>Track breaking changes cleanly</td>
</tr>
</tbody>
</table>
</section>
<section id="step-8.-adding-versioning-and-metadata" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-adding-versioning-and-metadata">Step 8. Adding Versioning and Metadata</h4>
<p>Add this to your header:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1159"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1159-1"><a href="#cb1159-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SIMPLEMATH_VERSION </span><span class="st">"1.0.0"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>In your CMake or Makefile build scripts, you can propagate this version into your packaging system or documentation.</p>
</section>
<section id="step-9.-why-it-matters-1" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-why-it-matters-1">Step 9. Why It Matters</h4>
<p>Writing a library transforms you from a script author into a systems builder. It teaches <strong>API design, separation of interface and implementation, and long-term maintenance</strong>, the same principles used in real-world software like glibc, SQLite, and curl.</p>
</section>
<section id="step-10.-try-it-yourself-1" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-try-it-yourself-1">Step 10. Try It Yourself</h4>
<ol type="1">
<li>Add new functions (<code>sm_pow</code>, <code>sm_mod</code>, <code>sm_avg</code>).</li>
<li>Create a shared version of the library (<code>libsimplemath.so</code>).</li>
<li>Document your API using Doxygen-style comments.</li>
<li>Write a header-only version (<code>static inline</code> functions).</li>
<li>Package your library with versioning and examples.</li>
</ol>
<p>Next, you’ll learn how to <strong>build a full command-line tool in C (92)</strong>, connecting your reusable libraries to practical, user-facing applications.</p>
</section>
</section>
<section id="building-a-command-line-tool" class="level3">
<h3 class="anchored" data-anchor-id="building-a-command-line-tool">92. Building a Command-Line Tool</h3>
<p>Command-line tools are where most C programmers begin building <em>real software</em>. They are fast, portable, and integrate naturally with Unix-like environments. In this section, you’ll build a <strong>small, self-contained CLI tool</strong> that processes input arguments, reads files, and outputs results, the same pattern used by tools like <code>grep</code>, <code>cat</code>, and <code>wc</code>.</p>
<section id="step-1.-the-goal-1" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-the-goal-1">Step 1. The Goal</h4>
<p>We’ll build a simple command-line tool called <strong>linestat</strong> that:</p>
<ul>
<li>Counts lines, words, and characters in a text file (like a mini <code>wc</code>).</li>
<li>Takes input from a file or standard input.</li>
<li>Accepts flags like <code>-l</code>, <code>-w</code>, <code>-c</code>.</li>
<li>Uses clean error handling and modular functions.</li>
</ul>
</section>
<section id="step-2.-project-layout" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-project-layout">Step 2. Project Layout</h4>
<pre><code>linestat/
 ├── linestat.c
 ├── Makefile
 └── README.md</code></pre>
</section>
<section id="step-3.-core-concepts" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-core-concepts">Step 3. Core Concepts</h4>
<p>Command-line programs follow a few timeless patterns:</p>
<ol type="1">
<li><strong>Read arguments</strong> with <code>argc</code> and <code>argv</code>.</li>
<li><strong>Validate inputs</strong> before processing.</li>
<li><strong>Open files</strong> safely with <code>fopen</code> or use <code>stdin</code>.</li>
<li><strong>Process data line-by-line</strong>.</li>
<li><strong>Report results</strong> clearly and consistently.</li>
</ol>
</section>
<section id="step-4.-tiny-code-linestat.c" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-tiny-code-linestat.c">Step 4. Tiny Code: linestat.c</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1161"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1161-1"><a href="#cb1161-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1161-2"><a href="#cb1161-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb1161-3"><a href="#cb1161-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb1161-4"><a href="#cb1161-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1161-5"><a href="#cb1161-5" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> print_usage<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>prog<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1161-6"><a href="#cb1161-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Usage: </span><span class="sc">%s</span><span class="st"> [-l] [-w] [-c] [file]</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> prog<span class="op">);</span></span>
<span id="cb1161-7"><a href="#cb1161-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Options:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1161-8"><a href="#cb1161-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"  -l   count lines</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1161-9"><a href="#cb1161-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"  -w   count words</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1161-10"><a href="#cb1161-10" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"  -c   count characters</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1161-11"><a href="#cb1161-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1161-12"><a href="#cb1161-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1161-13"><a href="#cb1161-13" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span> <span class="op">{</span></span>
<span id="cb1161-14"><a href="#cb1161-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> count_lines <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> count_words <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> count_chars <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1161-15"><a href="#cb1161-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>filename <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb1161-16"><a href="#cb1161-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1161-17"><a href="#cb1161-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Parse arguments</span></span>
<span id="cb1161-18"><a href="#cb1161-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> argc<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb1161-19"><a href="#cb1161-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>argv<span class="op">[</span>i<span class="op">],</span> <span class="st">"-l"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> count_lines <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1161-20"><a href="#cb1161-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>argv<span class="op">[</span>i<span class="op">],</span> <span class="st">"-w"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> count_words <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1161-21"><a href="#cb1161-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>argv<span class="op">[</span>i<span class="op">],</span> <span class="st">"-c"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> count_chars <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1161-22"><a href="#cb1161-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>argv<span class="op">[</span>i<span class="op">][</span><span class="dv">0</span><span class="op">]</span> <span class="op">!=</span> <span class="ch">'-'</span><span class="op">)</span> filename <span class="op">=</span> argv<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb1161-23"><a href="#cb1161-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb1161-24"><a href="#cb1161-24" aria-hidden="true" tabindex="-1"></a>            print_usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb1161-25"><a href="#cb1161-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1161-26"><a href="#cb1161-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1161-27"><a href="#cb1161-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1161-28"><a href="#cb1161-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1161-29"><a href="#cb1161-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> filename <span class="op">?</span> fopen<span class="op">(</span>filename<span class="op">,</span> <span class="st">"r"</span><span class="op">)</span> <span class="op">:</span> stdin<span class="op">;</span></span>
<span id="cb1161-30"><a href="#cb1161-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>fp<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1161-31"><a href="#cb1161-31" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"Error opening file"</span><span class="op">);</span></span>
<span id="cb1161-32"><a href="#cb1161-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1161-33"><a href="#cb1161-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1161-34"><a href="#cb1161-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1161-35"><a href="#cb1161-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> lines <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> words <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> chars <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1161-36"><a href="#cb1161-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> in_word <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1161-37"><a href="#cb1161-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> ch<span class="op">;</span></span>
<span id="cb1161-38"><a href="#cb1161-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1161-39"><a href="#cb1161-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">((</span>ch <span class="op">=</span> fgetc<span class="op">(</span>fp<span class="op">))</span> <span class="op">!=</span> EOF<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1161-40"><a href="#cb1161-40" aria-hidden="true" tabindex="-1"></a>        chars<span class="op">++;</span></span>
<span id="cb1161-41"><a href="#cb1161-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ch <span class="op">==</span> <span class="ch">'</span><span class="sc">\n</span><span class="ch">'</span><span class="op">)</span> lines<span class="op">++;</span></span>
<span id="cb1161-42"><a href="#cb1161-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ch <span class="op">==</span> <span class="ch">' '</span> <span class="op">||</span> ch <span class="op">==</span> <span class="ch">'</span><span class="sc">\n</span><span class="ch">'</span> <span class="op">||</span> ch <span class="op">==</span> <span class="ch">'</span><span class="sc">\t</span><span class="ch">'</span><span class="op">)</span> in_word <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1161-43"><a href="#cb1161-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(!</span>in_word<span class="op">)</span> <span class="op">{</span> words<span class="op">++;</span> in_word <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1161-44"><a href="#cb1161-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1161-45"><a href="#cb1161-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1161-46"><a href="#cb1161-46" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb1161-47"><a href="#cb1161-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1161-48"><a href="#cb1161-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>count_lines <span class="op">&amp;&amp;</span> <span class="op">!</span>count_words <span class="op">&amp;&amp;</span> <span class="op">!</span>count_chars<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1161-49"><a href="#cb1161-49" aria-hidden="true" tabindex="-1"></a>        count_lines <span class="op">=</span> count_words <span class="op">=</span> count_chars <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> <span class="co">// Default all</span></span>
<span id="cb1161-50"><a href="#cb1161-50" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1161-51"><a href="#cb1161-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1161-52"><a href="#cb1161-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>count_lines<span class="op">)</span> printf<span class="op">(</span><span class="st">"Lines: </span><span class="sc">%ld\n</span><span class="st">"</span><span class="op">,</span> lines<span class="op">);</span></span>
<span id="cb1161-53"><a href="#cb1161-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>count_words<span class="op">)</span> printf<span class="op">(</span><span class="st">"Words: </span><span class="sc">%ld\n</span><span class="st">"</span><span class="op">,</span> words<span class="op">);</span></span>
<span id="cb1161-54"><a href="#cb1161-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>count_chars<span class="op">)</span> printf<span class="op">(</span><span class="st">"Chars: </span><span class="sc">%ld\n</span><span class="st">"</span><span class="op">,</span> chars<span class="op">);</span></span>
<span id="cb1161-55"><a href="#cb1161-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1161-56"><a href="#cb1161-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1161-57"><a href="#cb1161-57" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-5.-build-and-run" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-build-and-run">Step 5. Build and Run</h4>
<p><strong>Makefile</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1162"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb1162-1"><a href="#cb1162-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span> <span class="ch">=</span><span class="st"> gcc</span></span>
<span id="cb1162-2"><a href="#cb1162-2" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span> <span class="ch">=</span><span class="st"> -std=c23 -O2 -Wall -Wextra</span></span>
<span id="cb1162-3"><a href="#cb1162-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1162-4"><a href="#cb1162-4" aria-hidden="true" tabindex="-1"></a><span class="dv">linestat:</span><span class="dt"> linestat.c</span></span>
<span id="cb1162-5"><a href="#cb1162-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> linestat.c -o linestat</span>
<span id="cb1162-6"><a href="#cb1162-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1162-7"><a href="#cb1162-7" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb1162-8"><a href="#cb1162-8" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f linestat</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Build it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1163"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1163-1"><a href="#cb1163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1164"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1164-1"><a href="#cb1164-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./linestat</span> <span class="at">-l</span> <span class="at">-w</span> <span class="at">-c</span> example.txt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Or from a pipeline:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1165"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1165-1"><a href="#cb1165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> example.txt <span class="kw">|</span> <span class="ex">./linestat</span> <span class="at">-w</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example output:</p>
<pre><code>Lines: 12
Words: 85
Chars: 430</code></pre>
</section>
<section id="step-6.-breaking-down-the-code" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-breaking-down-the-code">Step 6. Breaking Down the Code</h4>
<ul>
<li><strong>Argument Parsing:</strong> Loops through <code>argv</code> to detect flags.</li>
<li><strong>Input Handling:</strong> Reads from <code>stdin</code> when no file is given.</li>
<li><strong>Counting Logic:</strong> Tracks transitions between spaces and characters to count words.</li>
<li><strong>Graceful Exit:</strong> Uses <code>fclose</code> and <code>perror</code> for error reporting.</li>
<li><strong>Default Behavior:</strong> When no flags are passed, all counts are printed.</li>
</ul>
</section>
<section id="step-7.-making-it-more-robust" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-making-it-more-robust">Step 7. Making It More Robust</h4>
<p>You can extend this program easily:</p>
<ul>
<li><p>Add <code>-q</code> for quiet mode (only print totals).</p></li>
<li><p>Add <code>--help</code> for extended usage info.</p></li>
<li><p>Use <code>getline()</code> for reading full lines (C POSIX).</p></li>
<li><p>Print counts side by side in a single line:</p>
<pre><code>12  85  430  example.txt</code></pre></li>
</ul>
</section>
<section id="step-8.-cross-platform-considerations" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-cross-platform-considerations">Step 8. Cross-Platform Considerations</h4>
<ul>
<li>Use <code>#ifdef _WIN32</code> to handle file paths and newline differences.</li>
<li>Always open files in text mode: <code>fopen(filename, "r")</code>.</li>
<li>Use <code>size_t</code> instead of <code>long</code> for portability.</li>
</ul>
</section>
<section id="step-9.-why-it-matters-2" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-why-it-matters-2">Step 9. Why It Matters</h4>
<p>Writing a CLI teaches key systems skills:</p>
<ul>
<li>Argument parsing and I/O</li>
<li>File handling and error checking</li>
<li>Performance thinking (streaming, buffering)</li>
<li>Modular design for future features</li>
</ul>
<p>Every developer who writes in C eventually writes a CLI, it’s how tools like Git, Curl, and GCC were born.</p>
</section>
<section id="step-10.-try-it-yourself-2" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-try-it-yourself-2">Step 10. Try It Yourself</h4>
<ol type="1">
<li>Add a <code>-v</code> flag that shows program version.</li>
<li>Support reading multiple files.</li>
<li>Add timing (use <code>clock()</code> to measure runtime).</li>
<li>Print totals across all files.</li>
<li>Integrate your <strong>simplemath</strong> library to compute average words per line.</li>
</ol>
<p>Next, you’ll move to <strong>93. Tiny HTTP Server (Sockets and Threads)</strong>, where your command-line skills evolve into network programming: accepting connections, handling requests, and serving content in pure C.</p>
</section>
</section>
<section id="tiny-http-server-sockets-and-threads" class="level3">
<h3 class="anchored" data-anchor-id="tiny-http-server-sockets-and-threads">93. Tiny HTTP Server (Sockets and Threads)</h3>
<p>Now that you know how to build command-line tools, it’s time to make your program talk to the network. In this section, you’ll build a <strong>tiny multithreaded HTTP server</strong>, a small, minimal clone of what powers the web.</p>
<p>You’ll learn sockets, threading, request parsing, and response generation, all from first principles.</p>
<section id="step-1.-the-goal-2" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-the-goal-2">Step 1. The Goal</h4>
<p>We’ll create a simple HTTP server that:</p>
<ul>
<li>Listens on port <code>8080</code></li>
<li>Accepts multiple connections (one per thread)</li>
<li>Parses a minimal HTTP request</li>
<li>Responds with a static HTML page</li>
</ul>
<p>This project combines file I/O, networking, and concurrency, three of C’s most powerful capabilities.</p>
</section>
<section id="step-2.-project-layout-1" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-project-layout-1">Step 2. Project Layout</h4>
<pre><code>tinyhttp/
 ├── server.c
 ├── Makefile
 └── index.html</code></pre>
</section>
<section id="step-3.-the-core-idea" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-the-core-idea">Step 3. The Core Idea</h4>
<p>The server will:</p>
<ol type="1">
<li><strong>Create a socket</strong> and bind it to port 8080.</li>
<li><strong>Listen</strong> for connections.</li>
<li><strong>Accept</strong> a client.</li>
<li><strong>Handle</strong> the request in a new thread.</li>
<li><strong>Send</strong> an HTTP response.</li>
<li><strong>Close</strong> the socket and repeat.</li>
</ol>
</section>
<section id="step-4.-tiny-code-server.c" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-tiny-code-server.c">Step 4. Tiny Code: server.c</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1169"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1169-1"><a href="#cb1169-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1169-2"><a href="#cb1169-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb1169-3"><a href="#cb1169-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb1169-4"><a href="#cb1169-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb1169-5"><a href="#cb1169-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;arpa/inet.h&gt;</span></span>
<span id="cb1169-6"><a href="#cb1169-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span>
<span id="cb1169-7"><a href="#cb1169-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1169-8"><a href="#cb1169-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PORT </span><span class="dv">8080</span></span>
<span id="cb1169-9"><a href="#cb1169-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#define BUF_SIZE </span><span class="dv">4096</span></span>
<span id="cb1169-10"><a href="#cb1169-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1169-11"><a href="#cb1169-11" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>handle_client<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1169-12"><a href="#cb1169-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> client_fd <span class="op">=</span> <span class="op">*(</span><span class="dt">int</span> <span class="op">*)</span>arg<span class="op">;</span></span>
<span id="cb1169-13"><a href="#cb1169-13" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>arg<span class="op">);</span></span>
<span id="cb1169-14"><a href="#cb1169-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1169-15"><a href="#cb1169-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buffer<span class="op">[</span>BUF_SIZE<span class="op">];</span></span>
<span id="cb1169-16"><a href="#cb1169-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> bytes <span class="op">=</span> read<span class="op">(</span>client_fd<span class="op">,</span> buffer<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buffer<span class="op">)</span> <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb1169-17"><a href="#cb1169-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>bytes <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1169-18"><a href="#cb1169-18" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>client_fd<span class="op">);</span></span>
<span id="cb1169-19"><a href="#cb1169-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1169-20"><a href="#cb1169-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1169-21"><a href="#cb1169-21" aria-hidden="true" tabindex="-1"></a>    buffer<span class="op">[</span>bytes<span class="op">]</span> <span class="op">=</span> <span class="ch">'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">;</span></span>
<span id="cb1169-22"><a href="#cb1169-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1169-23"><a href="#cb1169-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Basic HTTP response</span></span>
<span id="cb1169-24"><a href="#cb1169-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>body <span class="op">=</span> <span class="st">"&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello from TinyHTTP!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"</span><span class="op">;</span></span>
<span id="cb1169-25"><a href="#cb1169-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> response<span class="op">[</span>BUF_SIZE<span class="op">];</span></span>
<span id="cb1169-26"><a href="#cb1169-26" aria-hidden="true" tabindex="-1"></a>    snprintf<span class="op">(</span>response<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>response<span class="op">),</span></span>
<span id="cb1169-27"><a href="#cb1169-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"HTTP/1.1 200 OK</span><span class="sc">\r\n</span><span class="st">"</span></span>
<span id="cb1169-28"><a href="#cb1169-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Content-Type: text/html</span><span class="sc">\r\n</span><span class="st">"</span></span>
<span id="cb1169-29"><a href="#cb1169-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Content-Length: </span><span class="sc">%zu\r\n</span><span class="st">"</span></span>
<span id="cb1169-30"><a href="#cb1169-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Connection: close</span><span class="sc">\r\n\r\n</span><span class="st">"</span></span>
<span id="cb1169-31"><a href="#cb1169-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"</span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> strlen<span class="op">(</span>body<span class="op">),</span> body<span class="op">);</span></span>
<span id="cb1169-32"><a href="#cb1169-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1169-33"><a href="#cb1169-33" aria-hidden="true" tabindex="-1"></a>    write<span class="op">(</span>client_fd<span class="op">,</span> response<span class="op">,</span> strlen<span class="op">(</span>response<span class="op">));</span></span>
<span id="cb1169-34"><a href="#cb1169-34" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>client_fd<span class="op">);</span></span>
<span id="cb1169-35"><a href="#cb1169-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1169-36"><a href="#cb1169-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1169-37"><a href="#cb1169-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1169-38"><a href="#cb1169-38" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1169-39"><a href="#cb1169-39" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> server_fd <span class="op">=</span> socket<span class="op">(</span>AF_INET<span class="op">,</span> SOCK_STREAM<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb1169-40"><a href="#cb1169-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>server_fd <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1169-41"><a href="#cb1169-41" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"socket failed"</span><span class="op">);</span></span>
<span id="cb1169-42"><a href="#cb1169-42" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
<span id="cb1169-43"><a href="#cb1169-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1169-44"><a href="#cb1169-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1169-45"><a href="#cb1169-45" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> opt <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1169-46"><a href="#cb1169-46" aria-hidden="true" tabindex="-1"></a>    setsockopt<span class="op">(</span>server_fd<span class="op">,</span> SOL_SOCKET<span class="op">,</span> SO_REUSEADDR<span class="op">,</span> <span class="op">&amp;</span>opt<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>opt<span class="op">));</span></span>
<span id="cb1169-47"><a href="#cb1169-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1169-48"><a href="#cb1169-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> sockaddr_in addr <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb1169-49"><a href="#cb1169-49" aria-hidden="true" tabindex="-1"></a>    addr<span class="op">.</span>sin_family <span class="op">=</span> AF_INET<span class="op">;</span></span>
<span id="cb1169-50"><a href="#cb1169-50" aria-hidden="true" tabindex="-1"></a>    addr<span class="op">.</span>sin_addr<span class="op">.</span>s_addr <span class="op">=</span> INADDR_ANY<span class="op">;</span></span>
<span id="cb1169-51"><a href="#cb1169-51" aria-hidden="true" tabindex="-1"></a>    addr<span class="op">.</span>sin_port <span class="op">=</span> htons<span class="op">(</span>PORT<span class="op">);</span></span>
<span id="cb1169-52"><a href="#cb1169-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1169-53"><a href="#cb1169-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>bind<span class="op">(</span>server_fd<span class="op">,</span> <span class="op">(</span><span class="kw">struct</span> sockaddr <span class="op">*)&amp;</span>addr<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>addr<span class="op">))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1169-54"><a href="#cb1169-54" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"bind failed"</span><span class="op">);</span></span>
<span id="cb1169-55"><a href="#cb1169-55" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>server_fd<span class="op">);</span></span>
<span id="cb1169-56"><a href="#cb1169-56" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
<span id="cb1169-57"><a href="#cb1169-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1169-58"><a href="#cb1169-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1169-59"><a href="#cb1169-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>listen<span class="op">(</span>server_fd<span class="op">,</span> <span class="dv">10</span><span class="op">)</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1169-60"><a href="#cb1169-60" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">"listen failed"</span><span class="op">);</span></span>
<span id="cb1169-61"><a href="#cb1169-61" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>server_fd<span class="op">);</span></span>
<span id="cb1169-62"><a href="#cb1169-62" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
<span id="cb1169-63"><a href="#cb1169-63" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1169-64"><a href="#cb1169-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1169-65"><a href="#cb1169-65" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"TinyHTTP running on http://localhost:</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> PORT<span class="op">);</span></span>
<span id="cb1169-66"><a href="#cb1169-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1169-67"><a href="#cb1169-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1169-68"><a href="#cb1169-68" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> client_fd<span class="op">;</span></span>
<span id="cb1169-69"><a href="#cb1169-69" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> sockaddr_in client<span class="op">;</span></span>
<span id="cb1169-70"><a href="#cb1169-70" aria-hidden="true" tabindex="-1"></a>        socklen_t len <span class="op">=</span> <span class="kw">sizeof</span><span class="op">(</span>client<span class="op">);</span></span>
<span id="cb1169-71"><a href="#cb1169-71" aria-hidden="true" tabindex="-1"></a>        client_fd <span class="op">=</span> accept<span class="op">(</span>server_fd<span class="op">,</span> <span class="op">(</span><span class="kw">struct</span> sockaddr <span class="op">*)&amp;</span>client<span class="op">,</span> <span class="op">&amp;</span>len<span class="op">);</span></span>
<span id="cb1169-72"><a href="#cb1169-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>client_fd <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1169-73"><a href="#cb1169-73" aria-hidden="true" tabindex="-1"></a>            perror<span class="op">(</span><span class="st">"accept failed"</span><span class="op">);</span></span>
<span id="cb1169-74"><a href="#cb1169-74" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb1169-75"><a href="#cb1169-75" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1169-76"><a href="#cb1169-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1169-77"><a href="#cb1169-77" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> <span class="op">*</span>pclient <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb1169-78"><a href="#cb1169-78" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>pclient <span class="op">=</span> client_fd<span class="op">;</span></span>
<span id="cb1169-79"><a href="#cb1169-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1169-80"><a href="#cb1169-80" aria-hidden="true" tabindex="-1"></a>        pthread_t tid<span class="op">;</span></span>
<span id="cb1169-81"><a href="#cb1169-81" aria-hidden="true" tabindex="-1"></a>        pthread_create<span class="op">(&amp;</span>tid<span class="op">,</span> NULL<span class="op">,</span> handle_client<span class="op">,</span> pclient<span class="op">);</span></span>
<span id="cb1169-82"><a href="#cb1169-82" aria-hidden="true" tabindex="-1"></a>        pthread_detach<span class="op">(</span>tid<span class="op">);</span></span>
<span id="cb1169-83"><a href="#cb1169-83" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1169-84"><a href="#cb1169-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1169-85"><a href="#cb1169-85" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>server_fd<span class="op">);</span></span>
<span id="cb1169-86"><a href="#cb1169-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1169-87"><a href="#cb1169-87" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-5.-build-and-run-1" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-build-and-run-1">Step 5. Build and Run</h4>
<p><strong>Makefile</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1170"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb1170-1"><a href="#cb1170-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span> <span class="ch">=</span><span class="st"> gcc</span></span>
<span id="cb1170-2"><a href="#cb1170-2" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span> <span class="ch">=</span><span class="st"> -std=c23 -pthread -O2 -Wall -Wextra</span></span>
<span id="cb1170-3"><a href="#cb1170-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1170-4"><a href="#cb1170-4" aria-hidden="true" tabindex="-1"></a><span class="dv">all:</span><span class="dt"> server</span></span>
<span id="cb1170-5"><a href="#cb1170-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1170-6"><a href="#cb1170-6" aria-hidden="true" tabindex="-1"></a><span class="dv">server:</span><span class="dt"> server.c</span></span>
<span id="cb1170-7"><a href="#cb1170-7" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> server.c -o server</span>
<span id="cb1170-8"><a href="#cb1170-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1170-9"><a href="#cb1170-9" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb1170-10"><a href="#cb1170-10" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f server</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Build and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1171"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1171-1"><a href="#cb1171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span>
<span id="cb1171-2"><a href="#cb1171-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./server</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Open your browser and visit:</p>
<pre><code>http://localhost:8080</code></pre>
<p>You should see:</p>
<pre><code>Hello from TinyHTTP!</code></pre>
</section>
<section id="step-6.-how-it-works" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-how-it-works">Step 6. How It Works</h4>
<ol type="1">
<li><p><strong>Socket setup:</strong> The server creates a TCP socket (<code>socket()</code>), binds it to port 8080, and listens.</p></li>
<li><p><strong>Accept loop:</strong> The main thread waits for connections.</p></li>
<li><p><strong>Threading:</strong> Each connection is handled by a new thread (<code>pthread_create</code>), allowing multiple clients at once.</p></li>
<li><p><strong>HTTP parsing:</strong> Minimal, just reads the request header and ignores the rest for now.</p></li>
<li><p><strong>Response:</strong> A static HTML body is written to the socket.</p></li>
<li><p><strong>Cleanup:</strong> Each thread closes its client socket after responding.</p></li>
</ol>
</section>
<section id="step-7.-extend-it" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-extend-it">Step 7. Extend It</h4>
<p>To make it more realistic, add:</p>
<ul>
<li><p>Serve static files:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1174"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1174-1"><a href="#cb1174-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> <span class="op">*</span>f <span class="op">=</span> fopen<span class="op">(</span><span class="st">"index.html"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Parse the first line of the request to get the path.</p></li>
<li><p>Return 404 if the file doesn’t exist.</p></li>
<li><p>Add MIME types for <code>.html</code>, <code>.css</code>, <code>.js</code>, <code>.png</code>.</p></li>
<li><p>Add logging with timestamps.</p></li>
</ul>
</section>
<section id="step-8.-cross-platform-notes" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-cross-platform-notes">Step 8. Cross-Platform Notes</h4>
<ul>
<li>Use <code>#ifdef _WIN32</code> to include <code>&lt;winsock2.h&gt;</code> and initialize with <code>WSAStartup()</code>.</li>
<li>Replace <code>close()</code> with <code>closesocket()</code> on Windows.</li>
<li>Use threads from <code>&lt;threads.h&gt;</code> for C11-only builds.</li>
</ul>
</section>
<section id="step-9.-why-it-matters-3" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-why-it-matters-3">Step 9. Why It Matters</h4>
<p>Building an HTTP server from scratch teaches you how the web really works:</p>
<ul>
<li><strong>Sockets:</strong> the foundation of all network software.</li>
<li><strong>Concurrency:</strong> how to handle many users at once.</li>
<li><strong>Protocols:</strong> understanding request/response formats.</li>
<li><strong>Systems thinking:</strong> combining multiple low-level C features cleanly.</li>
</ul>
<p>You’re no longer just writing programs, you’re shaping communication between machines.</p>
</section>
<section id="step-10.-try-it-yourself-3" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-try-it-yourself-3">Step 10. Try It Yourself</h4>
<ol type="1">
<li>Add logging for each client connection.</li>
<li>Serve static files (<code>index.html</code>, <code>style.css</code>).</li>
<li>Implement a <code>/time</code> endpoint returning the system time.</li>
<li>Benchmark with <code>curl</code> or <code>ab</code>.</li>
<li>Extend to HTTP/1.1 persistent connections.</li>
</ol>
<p>Next, you’ll build <strong>94. A Simple Key-Value Store</strong>, where you’ll learn file-based persistence, indexing, and serialization, the first step toward writing databases in pure C.</p>
</section>
</section>
<section id="simple-key-value-store" class="level3">
<h3 class="anchored" data-anchor-id="simple-key-value-store">94. Simple Key-Value Store</h3>
<p>Databases look scary until you build one yourself. In this section you will write a tiny <strong>append only key value store</strong> that persists data to disk, loads an in memory index on startup, and supports <code>get</code> and <code>set</code> from a simple CLI.</p>
<p>You will learn files, serialization, indexing, and crash safety basics.</p>
<section id="step-1.-design-the-file-format" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-design-the-file-format">Step 1. Design the file format</h4>
<p>Keep it simple and binary. Each record is append only:</p>
<pre><code>[ u32 key_len ][ u32 val_len ][ key bytes ][ value bytes ]</code></pre>
<ul>
<li>All integers are stored as big endian so the file is portable.</li>
<li>No in place updates. Setting the same key again appends a new record.</li>
</ul>
</section>
<section id="step-2.-endianness-helpers" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-endianness-helpers">Step 2. Endianness helpers</h4>
<p>We will use <code>htonl</code> and <code>ntohl</code> to encode and decode 32 bit lengths.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1176"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1176-1"><a href="#cb1176-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;arpa/inet.h&gt;</span><span class="pp">   </span><span class="co">// Windows: winsock2.h</span></span>
<span id="cb1176-2"><a href="#cb1176-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1176-3"><a href="#cb1176-3" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="kw">inline</span> <span class="dt">uint32_t</span> be32<span class="op">(</span><span class="dt">uint32_t</span> x<span class="op">)</span>  <span class="op">{</span> <span class="cf">return</span> htonl<span class="op">(</span>x<span class="op">);</span>  <span class="op">}</span></span>
<span id="cb1176-4"><a href="#cb1176-4" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="kw">inline</span> <span class="dt">uint32_t</span> from_be32<span class="op">(</span><span class="dt">uint32_t</span> x<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> ntohl<span class="op">(</span>x<span class="op">);</span> <span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-3.-the-in-memory-index" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-the-in-memory-index">Step 3. The in memory index</h4>
<p>On startup, scan the log file once and build a hash map of key -&gt; file offset of the newest record. We will implement a simple open addressing hash table for clarity.</p>
<p>Index entry:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1177"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1177-1"><a href="#cb1177-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb1177-2"><a href="#cb1177-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint64_t</span> offset<span class="op">;</span>   <span class="co">// file position of record start</span></span>
<span id="cb1177-3"><a href="#cb1177-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> key_hash<span class="op">;</span> <span class="co">// cached hash for quick probing</span></span>
<span id="cb1177-4"><a href="#cb1177-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> key_len<span class="op">;</span>  <span class="co">// used to confirm match</span></span>
<span id="cb1177-5"><a href="#cb1177-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> kv_slot<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-4.-hashing" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-hashing">Step 4. Hashing</h4>
<p>Use a compact 32 bit FNV-1a hash for strings.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1178"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1178-1"><a href="#cb1178-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">uint32_t</span> fnv1a<span class="op">(</span><span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>s<span class="op">,</span> <span class="dt">size_t</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1178-2"><a href="#cb1178-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> h <span class="op">=</span> <span class="dv">2166136261</span><span class="bu">u</span><span class="op">;</span></span>
<span id="cb1178-3"><a href="#cb1178-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb1178-4"><a href="#cb1178-4" aria-hidden="true" tabindex="-1"></a>        h <span class="op">^=</span> s<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb1178-5"><a href="#cb1178-5" aria-hidden="true" tabindex="-1"></a>        h <span class="op">*=</span> <span class="dv">16777619</span><span class="bu">u</span><span class="op">;</span></span>
<span id="cb1178-6"><a href="#cb1178-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1178-7"><a href="#cb1178-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> h<span class="op">;</span></span>
<span id="cb1178-8"><a href="#cb1178-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-5.-tiny-code-core-implementation" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-tiny-code-core-implementation">Step 5. Tiny Code: core implementation</h4>
<p>A single file version to keep things approachable.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1179"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1179-1"><a href="#cb1179-1" aria-hidden="true" tabindex="-1"></a><span class="co">// file: kv.c</span></span>
<span id="cb1179-2"><a href="#cb1179-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define _POSIX_C_SOURCE </span><span class="dv">200809</span><span class="bu">L</span></span>
<span id="cb1179-3"><a href="#cb1179-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1179-4"><a href="#cb1179-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdint.h&gt;</span></span>
<span id="cb1179-5"><a href="#cb1179-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb1179-6"><a href="#cb1179-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb1179-7"><a href="#cb1179-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;arpa/inet.h&gt;</span><span class="pp">   </span><span class="co">// Windows: include &lt;winsock2.h&gt; and link Ws2_32</span></span>
<span id="cb1179-8"><a href="#cb1179-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;errno.h&gt;</span></span>
<span id="cb1179-9"><a href="#cb1179-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1179-10"><a href="#cb1179-10" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb1179-11"><a href="#cb1179-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>f<span class="op">;</span></span>
<span id="cb1179-12"><a href="#cb1179-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>path<span class="op">;</span></span>
<span id="cb1179-13"><a href="#cb1179-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// simple hash table index</span></span>
<span id="cb1179-14"><a href="#cb1179-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> slot <span class="op">{</span> <span class="dt">uint64_t</span> off<span class="op">;</span> <span class="dt">uint32_t</span> h<span class="op">,</span> klen<span class="op">;</span> <span class="op">}</span> <span class="op">*</span>tab<span class="op">;</span></span>
<span id="cb1179-15"><a href="#cb1179-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> cap<span class="op">,</span> used<span class="op">;</span></span>
<span id="cb1179-16"><a href="#cb1179-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> kv_db<span class="op">;</span></span>
<span id="cb1179-17"><a href="#cb1179-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1179-18"><a href="#cb1179-18" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">uint32_t</span> fnv1a<span class="op">(</span><span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>s<span class="op">,</span> <span class="dt">size_t</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1179-19"><a href="#cb1179-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> h <span class="op">=</span> <span class="dv">2166136261</span><span class="bu">u</span><span class="op">;</span></span>
<span id="cb1179-20"><a href="#cb1179-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span> h <span class="op">^=</span> s<span class="op">[</span>i<span class="op">];</span> h <span class="op">*=</span> <span class="dv">16777619</span><span class="bu">u</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1179-21"><a href="#cb1179-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> h<span class="op">;</span></span>
<span id="cb1179-22"><a href="#cb1179-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1179-23"><a href="#cb1179-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1179-24"><a href="#cb1179-24" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">size_t</span> next_pow2<span class="op">(</span><span class="dt">size_t</span> n<span class="op">)</span> <span class="op">{</span> <span class="dt">size_t</span> p <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> <span class="cf">while</span> <span class="op">(</span>p <span class="op">&lt;</span> n<span class="op">)</span> p <span class="op">&lt;&lt;=</span> <span class="dv">1</span><span class="op">;</span> <span class="cf">return</span> p<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1179-25"><a href="#cb1179-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1179-26"><a href="#cb1179-26" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">int</span> kv_index_put<span class="op">(</span>kv_db <span class="op">*</span>db<span class="op">,</span> <span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>key<span class="op">,</span> <span class="dt">uint32_t</span> klen<span class="op">,</span> <span class="dt">uint64_t</span> off<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1179-27"><a href="#cb1179-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>db<span class="op">-&gt;</span>used <span class="op">*</span> <span class="dv">2</span> <span class="op">&gt;=</span> db<span class="op">-&gt;</span>cap<span class="op">)</span> <span class="op">{</span> <span class="co">// grow</span></span>
<span id="cb1179-28"><a href="#cb1179-28" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> ncap <span class="op">=</span> db<span class="op">-&gt;</span>cap <span class="op">?</span> db<span class="op">-&gt;</span>cap <span class="op">*</span> <span class="dv">2</span> <span class="op">:</span> <span class="dv">1024</span><span class="op">;</span></span>
<span id="cb1179-29"><a href="#cb1179-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> slot <span class="op">*</span>old <span class="op">=</span> db<span class="op">-&gt;</span>tab<span class="op">;</span></span>
<span id="cb1179-30"><a href="#cb1179-30" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> oldcap <span class="op">=</span> db<span class="op">-&gt;</span>cap<span class="op">;</span></span>
<span id="cb1179-31"><a href="#cb1179-31" aria-hidden="true" tabindex="-1"></a>        db<span class="op">-&gt;</span>tab <span class="op">=</span> calloc<span class="op">(</span>ncap<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(*</span>db<span class="op">-&gt;</span>tab<span class="op">));</span></span>
<span id="cb1179-32"><a href="#cb1179-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>db<span class="op">-&gt;</span>tab<span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1179-33"><a href="#cb1179-33" aria-hidden="true" tabindex="-1"></a>        db<span class="op">-&gt;</span>cap <span class="op">=</span> ncap<span class="op">;</span> db<span class="op">-&gt;</span>used <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1179-34"><a href="#cb1179-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> oldcap<span class="op">;</span> i<span class="op">++)</span> <span class="cf">if</span> <span class="op">(</span>old<span class="op">[</span>i<span class="op">].</span>off<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1179-35"><a href="#cb1179-35" aria-hidden="true" tabindex="-1"></a>            <span class="co">// reinsert based on stored key hash and key length</span></span>
<span id="cb1179-36"><a href="#cb1179-36" aria-hidden="true" tabindex="-1"></a>            <span class="dt">size_t</span> m <span class="op">=</span> ncap <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> j <span class="op">=</span> old<span class="op">[</span>i<span class="op">].</span>h <span class="op">&amp;</span> m<span class="op">;</span></span>
<span id="cb1179-37"><a href="#cb1179-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(</span>db<span class="op">-&gt;</span>tab<span class="op">[</span>j<span class="op">].</span>off<span class="op">)</span> j <span class="op">=</span> <span class="op">(</span>j <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">&amp;</span> m<span class="op">;</span></span>
<span id="cb1179-38"><a href="#cb1179-38" aria-hidden="true" tabindex="-1"></a>            db<span class="op">-&gt;</span>tab<span class="op">[</span>j<span class="op">]</span> <span class="op">=</span> old<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb1179-39"><a href="#cb1179-39" aria-hidden="true" tabindex="-1"></a>            db<span class="op">-&gt;</span>used<span class="op">++;</span></span>
<span id="cb1179-40"><a href="#cb1179-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1179-41"><a href="#cb1179-41" aria-hidden="true" tabindex="-1"></a>        free<span class="op">(</span>old<span class="op">);</span></span>
<span id="cb1179-42"><a href="#cb1179-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1179-43"><a href="#cb1179-43" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> h <span class="op">=</span> fnv1a<span class="op">(</span>key<span class="op">,</span> klen<span class="op">);</span></span>
<span id="cb1179-44"><a href="#cb1179-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> m <span class="op">=</span> db<span class="op">-&gt;</span>cap <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> i <span class="op">=</span> h <span class="op">&amp;</span> m<span class="op">;</span></span>
<span id="cb1179-45"><a href="#cb1179-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>db<span class="op">-&gt;</span>tab<span class="op">[</span>i<span class="op">].</span>off<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1179-46"><a href="#cb1179-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>db<span class="op">-&gt;</span>tab<span class="op">[</span>i<span class="op">].</span>h <span class="op">==</span> h <span class="op">&amp;&amp;</span> db<span class="op">-&gt;</span>tab<span class="op">[</span>i<span class="op">].</span>klen <span class="op">==</span> klen<span class="op">)</span> <span class="op">{</span> db<span class="op">-&gt;</span>tab<span class="op">[</span>i<span class="op">].</span>off <span class="op">=</span> off<span class="op">;</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1179-47"><a href="#cb1179-47" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="op">(</span>i <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">&amp;</span> m<span class="op">;</span></span>
<span id="cb1179-48"><a href="#cb1179-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1179-49"><a href="#cb1179-49" aria-hidden="true" tabindex="-1"></a>    db<span class="op">-&gt;</span>tab<span class="op">[</span>i<span class="op">].</span>off <span class="op">=</span> off<span class="op">;</span> db<span class="op">-&gt;</span>tab<span class="op">[</span>i<span class="op">].</span>h <span class="op">=</span> h<span class="op">;</span> db<span class="op">-&gt;</span>tab<span class="op">[</span>i<span class="op">].</span>klen <span class="op">=</span> klen<span class="op">;</span> db<span class="op">-&gt;</span>used<span class="op">++;</span></span>
<span id="cb1179-50"><a href="#cb1179-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1179-51"><a href="#cb1179-51" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1179-52"><a href="#cb1179-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1179-53"><a href="#cb1179-53" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">long</span> kv_index_find_slot<span class="op">(</span>kv_db <span class="op">*</span>db<span class="op">,</span> <span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>key<span class="op">,</span> <span class="dt">uint32_t</span> klen<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1179-54"><a href="#cb1179-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>db<span class="op">-&gt;</span>cap <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1179-55"><a href="#cb1179-55" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> h <span class="op">=</span> fnv1a<span class="op">(</span>key<span class="op">,</span> klen<span class="op">);</span></span>
<span id="cb1179-56"><a href="#cb1179-56" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> m <span class="op">=</span> db<span class="op">-&gt;</span>cap <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> i <span class="op">=</span> h <span class="op">&amp;</span> m<span class="op">,</span> steps <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1179-57"><a href="#cb1179-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>db<span class="op">-&gt;</span>tab<span class="op">[</span>i<span class="op">].</span>off <span class="op">&amp;&amp;</span> steps <span class="op">&lt;=</span> db<span class="op">-&gt;</span>cap<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1179-58"><a href="#cb1179-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>db<span class="op">-&gt;</span>tab<span class="op">[</span>i<span class="op">].</span>h <span class="op">==</span> h <span class="op">&amp;&amp;</span> db<span class="op">-&gt;</span>tab<span class="op">[</span>i<span class="op">].</span>klen <span class="op">==</span> klen<span class="op">)</span> <span class="cf">return</span> <span class="op">(</span><span class="dt">long</span><span class="op">)</span>i<span class="op">;</span></span>
<span id="cb1179-59"><a href="#cb1179-59" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="op">(</span>i <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">&amp;</span> m<span class="op">;</span> steps<span class="op">++;</span></span>
<span id="cb1179-60"><a href="#cb1179-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1179-61"><a href="#cb1179-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1179-62"><a href="#cb1179-62" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1179-63"><a href="#cb1179-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1179-64"><a href="#cb1179-64" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">int</span> kv_open<span class="op">(</span>kv_db <span class="op">*</span>db<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>path<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1179-65"><a href="#cb1179-65" aria-hidden="true" tabindex="-1"></a>    memset<span class="op">(</span>db<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(*</span>db<span class="op">));</span></span>
<span id="cb1179-66"><a href="#cb1179-66" aria-hidden="true" tabindex="-1"></a>    db<span class="op">-&gt;</span>path <span class="op">=</span> strdup<span class="op">(</span>path<span class="op">);</span></span>
<span id="cb1179-67"><a href="#cb1179-67" aria-hidden="true" tabindex="-1"></a>    db<span class="op">-&gt;</span>f <span class="op">=</span> fopen<span class="op">(</span>path<span class="op">,</span> <span class="st">"ab+"</span><span class="op">);</span></span>
<span id="cb1179-68"><a href="#cb1179-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>db<span class="op">-&gt;</span>f<span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1179-69"><a href="#cb1179-69" aria-hidden="true" tabindex="-1"></a>    fflush<span class="op">(</span>db<span class="op">-&gt;</span>f<span class="op">);</span></span>
<span id="cb1179-70"><a href="#cb1179-70" aria-hidden="true" tabindex="-1"></a>    <span class="co">// build index by scanning from start</span></span>
<span id="cb1179-71"><a href="#cb1179-71" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>r <span class="op">=</span> fopen<span class="op">(</span>path<span class="op">,</span> <span class="st">"rb"</span><span class="op">);</span></span>
<span id="cb1179-72"><a href="#cb1179-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>r<span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1179-73"><a href="#cb1179-73" aria-hidden="true" tabindex="-1"></a>    <span class="co">// start with some capacity</span></span>
<span id="cb1179-74"><a href="#cb1179-74" aria-hidden="true" tabindex="-1"></a>    db<span class="op">-&gt;</span>cap <span class="op">=</span> <span class="dv">1024</span><span class="op">;</span> db<span class="op">-&gt;</span>tab <span class="op">=</span> calloc<span class="op">(</span>db<span class="op">-&gt;</span>cap<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(*</span>db<span class="op">-&gt;</span>tab<span class="op">));</span></span>
<span id="cb1179-75"><a href="#cb1179-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>db<span class="op">-&gt;</span>tab<span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1179-76"><a href="#cb1179-76" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint64_t</span> off <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1179-77"><a href="#cb1179-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(;;)</span> <span class="op">{</span></span>
<span id="cb1179-78"><a href="#cb1179-78" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> klen_be<span class="op">,</span> vlen_be<span class="op">;</span></span>
<span id="cb1179-79"><a href="#cb1179-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>fread<span class="op">(&amp;</span>klen_be<span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> r<span class="op">)</span> <span class="op">!=</span> <span class="dv">1</span><span class="op">)</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1179-80"><a href="#cb1179-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>fread<span class="op">(&amp;</span>vlen_be<span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> r<span class="op">)</span> <span class="op">!=</span> <span class="dv">1</span><span class="op">)</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1179-81"><a href="#cb1179-81" aria-hidden="true" tabindex="-1"></a>        <span class="dt">uint32_t</span> klen <span class="op">=</span> ntohl<span class="op">(</span>klen_be<span class="op">),</span> vlen <span class="op">=</span> ntohl<span class="op">(</span>vlen_be<span class="op">);</span></span>
<span id="cb1179-82"><a href="#cb1179-82" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>k <span class="op">=</span> malloc<span class="op">(</span>klen<span class="op">);</span></span>
<span id="cb1179-83"><a href="#cb1179-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>k<span class="op">)</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1179-84"><a href="#cb1179-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>fread<span class="op">(</span>k<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> klen<span class="op">,</span> r<span class="op">)</span> <span class="op">!=</span> klen<span class="op">)</span> <span class="op">{</span> free<span class="op">(</span>k<span class="op">);</span> <span class="cf">break</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1179-85"><a href="#cb1179-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>fseek<span class="op">(</span>r<span class="op">,</span> vlen<span class="op">,</span> SEEK_CUR<span class="op">)</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span> free<span class="op">(</span>k<span class="op">);</span> <span class="cf">break</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1179-86"><a href="#cb1179-86" aria-hidden="true" tabindex="-1"></a>        kv_index_put<span class="op">(</span>db<span class="op">,</span> k<span class="op">,</span> klen<span class="op">,</span> off<span class="op">);</span></span>
<span id="cb1179-87"><a href="#cb1179-87" aria-hidden="true" tabindex="-1"></a>        free<span class="op">(</span>k<span class="op">);</span></span>
<span id="cb1179-88"><a href="#cb1179-88" aria-hidden="true" tabindex="-1"></a>        off <span class="op">+=</span> <span class="dv">8</span><span class="bu">u</span> <span class="op">+</span> klen <span class="op">+</span> vlen<span class="op">;</span></span>
<span id="cb1179-89"><a href="#cb1179-89" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1179-90"><a href="#cb1179-90" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>r<span class="op">);</span></span>
<span id="cb1179-91"><a href="#cb1179-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1179-92"><a href="#cb1179-92" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1179-93"><a href="#cb1179-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1179-94"><a href="#cb1179-94" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">int</span> kv_set<span class="op">(</span>kv_db <span class="op">*</span>db<span class="op">,</span> <span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>key<span class="op">,</span> <span class="dt">uint32_t</span> klen<span class="op">,</span></span>
<span id="cb1179-95"><a href="#cb1179-95" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>val<span class="op">,</span> <span class="dt">uint32_t</span> vlen<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1179-96"><a href="#cb1179-96" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> klen_be <span class="op">=</span> htonl<span class="op">(</span>klen<span class="op">),</span> vlen_be <span class="op">=</span> htonl<span class="op">(</span>vlen<span class="op">);</span></span>
<span id="cb1179-97"><a href="#cb1179-97" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fwrite<span class="op">(&amp;</span>klen_be<span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> db<span class="op">-&gt;</span>f<span class="op">)</span> <span class="op">!=</span> <span class="dv">1</span><span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1179-98"><a href="#cb1179-98" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fwrite<span class="op">(&amp;</span>vlen_be<span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> db<span class="op">-&gt;</span>f<span class="op">)</span> <span class="op">!=</span> <span class="dv">1</span><span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1179-99"><a href="#cb1179-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fwrite<span class="op">(</span>key<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> klen<span class="op">,</span> db<span class="op">-&gt;</span>f<span class="op">)</span> <span class="op">!=</span> klen<span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1179-100"><a href="#cb1179-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fwrite<span class="op">(</span>val<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> vlen<span class="op">,</span> db<span class="op">-&gt;</span>f<span class="op">)</span> <span class="op">!=</span> vlen<span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1179-101"><a href="#cb1179-101" aria-hidden="true" tabindex="-1"></a>    fflush<span class="op">(</span>db<span class="op">-&gt;</span>f<span class="op">);</span> <span class="co">// durability: fsync would be stronger</span></span>
<span id="cb1179-102"><a href="#cb1179-102" aria-hidden="true" tabindex="-1"></a>    <span class="co">// compute offset of the record we just wrote</span></span>
<span id="cb1179-103"><a href="#cb1179-103" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> end <span class="op">=</span> ftell<span class="op">(</span>db<span class="op">-&gt;</span>f<span class="op">);</span></span>
<span id="cb1179-104"><a href="#cb1179-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>end <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1179-105"><a href="#cb1179-105" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint64_t</span> off <span class="op">=</span> <span class="op">(</span><span class="dt">uint64_t</span><span class="op">)</span>end <span class="op">-</span> <span class="op">(</span><span class="dv">8</span><span class="bu">u</span> <span class="op">+</span> klen <span class="op">+</span> vlen<span class="op">);</span></span>
<span id="cb1179-106"><a href="#cb1179-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> kv_index_put<span class="op">(</span>db<span class="op">,</span> key<span class="op">,</span> klen<span class="op">,</span> off<span class="op">);</span></span>
<span id="cb1179-107"><a href="#cb1179-107" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1179-108"><a href="#cb1179-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1179-109"><a href="#cb1179-109" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">int</span> kv_get<span class="op">(</span>kv_db <span class="op">*</span>db<span class="op">,</span> <span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>key<span class="op">,</span> <span class="dt">uint32_t</span> klen<span class="op">,</span></span>
<span id="cb1179-110"><a href="#cb1179-110" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">**</span>out<span class="op">,</span> <span class="dt">uint32_t</span> <span class="op">*</span>outlen<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1179-111"><a href="#cb1179-111" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> s <span class="op">=</span> kv_index_find_slot<span class="op">(</span>db<span class="op">,</span> key<span class="op">,</span> klen<span class="op">);</span></span>
<span id="cb1179-112"><a href="#cb1179-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>s <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1179-113"><a href="#cb1179-113" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint64_t</span> off <span class="op">=</span> db<span class="op">-&gt;</span>tab<span class="op">[</span>s<span class="op">].</span>off<span class="op">;</span></span>
<span id="cb1179-114"><a href="#cb1179-114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fseek<span class="op">(</span>db<span class="op">-&gt;</span>f<span class="op">,</span> <span class="op">(</span><span class="dt">long</span><span class="op">)</span>off<span class="op">,</span> SEEK_SET<span class="op">)</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1179-115"><a href="#cb1179-115" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> klen_be<span class="op">,</span> vlen_be<span class="op">;</span></span>
<span id="cb1179-116"><a href="#cb1179-116" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fread<span class="op">(&amp;</span>klen_be<span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> db<span class="op">-&gt;</span>f<span class="op">)</span> <span class="op">!=</span> <span class="dv">1</span><span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1179-117"><a href="#cb1179-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fread<span class="op">(&amp;</span>vlen_be<span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> db<span class="op">-&gt;</span>f<span class="op">)</span> <span class="op">!=</span> <span class="dv">1</span><span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1179-118"><a href="#cb1179-118" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> kL <span class="op">=</span> ntohl<span class="op">(</span>klen_be<span class="op">),</span> vL <span class="op">=</span> ntohl<span class="op">(</span>vlen_be<span class="op">);</span></span>
<span id="cb1179-119"><a href="#cb1179-119" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>kbuf <span class="op">=</span> malloc<span class="op">(</span>kL<span class="op">);</span></span>
<span id="cb1179-120"><a href="#cb1179-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>kbuf<span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1179-121"><a href="#cb1179-121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fread<span class="op">(</span>kbuf<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> kL<span class="op">,</span> db<span class="op">-&gt;</span>f<span class="op">)</span> <span class="op">!=</span> kL<span class="op">)</span> <span class="op">{</span> free<span class="op">(</span>kbuf<span class="op">);</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1179-122"><a href="#cb1179-122" aria-hidden="true" tabindex="-1"></a>    <span class="co">// confirm key match to be safe</span></span>
<span id="cb1179-123"><a href="#cb1179-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>kL <span class="op">!=</span> klen <span class="op">||</span> memcmp<span class="op">(</span>kbuf<span class="op">,</span> key<span class="op">,</span> klen<span class="op">)</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span> free<span class="op">(</span>kbuf<span class="op">);</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1179-124"><a href="#cb1179-124" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>kbuf<span class="op">);</span></span>
<span id="cb1179-125"><a href="#cb1179-125" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>v <span class="op">=</span> malloc<span class="op">(</span>vL <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb1179-126"><a href="#cb1179-126" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>v<span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1179-127"><a href="#cb1179-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fread<span class="op">(</span>v<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> vL<span class="op">,</span> db<span class="op">-&gt;</span>f<span class="op">)</span> <span class="op">!=</span> vL<span class="op">)</span> <span class="op">{</span> free<span class="op">(</span>v<span class="op">);</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1179-128"><a href="#cb1179-128" aria-hidden="true" tabindex="-1"></a>    v<span class="op">[</span>vL<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// NUL terminate for convenience</span></span>
<span id="cb1179-129"><a href="#cb1179-129" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>out <span class="op">=</span> v<span class="op">;</span> <span class="op">*</span>outlen <span class="op">=</span> vL<span class="op">;</span></span>
<span id="cb1179-130"><a href="#cb1179-130" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1179-131"><a href="#cb1179-131" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1179-132"><a href="#cb1179-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1179-133"><a href="#cb1179-133" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> kv_close<span class="op">(</span>kv_db <span class="op">*</span>db<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1179-134"><a href="#cb1179-134" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>db<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb1179-135"><a href="#cb1179-135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>db<span class="op">-&gt;</span>f<span class="op">)</span> fclose<span class="op">(</span>db<span class="op">-&gt;</span>f<span class="op">);</span></span>
<span id="cb1179-136"><a href="#cb1179-136" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>db<span class="op">-&gt;</span>tab<span class="op">);</span></span>
<span id="cb1179-137"><a href="#cb1179-137" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>db<span class="op">-&gt;</span>path<span class="op">);</span></span>
<span id="cb1179-138"><a href="#cb1179-138" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1179-139"><a href="#cb1179-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1179-140"><a href="#cb1179-140" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> usage<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1179-141"><a href="#cb1179-141" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Usage: </span><span class="sc">%s</span><span class="st"> &lt;file&gt; get &lt;key&gt;</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> p<span class="op">);</span></span>
<span id="cb1179-142"><a href="#cb1179-142" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"       </span><span class="sc">%s</span><span class="st"> &lt;file&gt; set &lt;key&gt; &lt;value&gt;</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> p<span class="op">);</span></span>
<span id="cb1179-143"><a href="#cb1179-143" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1179-144"><a href="#cb1179-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1179-145"><a href="#cb1179-145" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1179-146"><a href="#cb1179-146" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>argc <span class="op">&lt;</span> <span class="dv">4</span><span class="op">)</span> <span class="op">{</span> usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1179-147"><a href="#cb1179-147" aria-hidden="true" tabindex="-1"></a>    kv_db db<span class="op">;</span></span>
<span id="cb1179-148"><a href="#cb1179-148" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>kv_open<span class="op">(&amp;</span>db<span class="op">,</span> argv<span class="op">[</span><span class="dv">1</span><span class="op">])</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span> perror<span class="op">(</span><span class="st">"open"</span><span class="op">);</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1179-149"><a href="#cb1179-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1179-150"><a href="#cb1179-150" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>cmd <span class="op">=</span> argv<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb1179-151"><a href="#cb1179-151" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>cmd<span class="op">,</span> <span class="st">"set"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1179-152"><a href="#cb1179-152" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>argc <span class="op">&lt;</span> <span class="dv">5</span><span class="op">)</span> <span class="op">{</span> usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span> kv_close<span class="op">(&amp;</span>db<span class="op">);</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1179-153"><a href="#cb1179-153" aria-hidden="true" tabindex="-1"></a>        <span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>k <span class="op">=</span> <span class="op">(</span><span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*)</span>argv<span class="op">[</span><span class="dv">3</span><span class="op">];</span></span>
<span id="cb1179-154"><a href="#cb1179-154" aria-hidden="true" tabindex="-1"></a>        <span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>v <span class="op">=</span> <span class="op">(</span><span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*)</span>argv<span class="op">[</span><span class="dv">4</span><span class="op">];</span></span>
<span id="cb1179-155"><a href="#cb1179-155" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>kv_set<span class="op">(&amp;</span>db<span class="op">,</span> k<span class="op">,</span> <span class="op">(</span><span class="dt">uint32_t</span><span class="op">)</span>strlen<span class="op">((</span><span class="dt">char</span><span class="op">*)</span>k<span class="op">),</span> v<span class="op">,</span> <span class="op">(</span><span class="dt">uint32_t</span><span class="op">)</span>strlen<span class="op">((</span><span class="dt">char</span><span class="op">*)</span>v<span class="op">))</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb1179-156"><a href="#cb1179-156" aria-hidden="true" tabindex="-1"></a>            perror<span class="op">(</span><span class="st">"set"</span><span class="op">);</span></span>
<span id="cb1179-157"><a href="#cb1179-157" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>cmd<span class="op">,</span> <span class="st">"get"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1179-158"><a href="#cb1179-158" aria-hidden="true" tabindex="-1"></a>        <span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>k <span class="op">=</span> <span class="op">(</span><span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*)</span>argv<span class="op">[</span><span class="dv">3</span><span class="op">];</span></span>
<span id="cb1179-159"><a href="#cb1179-159" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>out <span class="op">=</span> NULL<span class="op">;</span> <span class="dt">uint32_t</span> n <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1179-160"><a href="#cb1179-160" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>kv_get<span class="op">(&amp;</span>db<span class="op">,</span> k<span class="op">,</span> <span class="op">(</span><span class="dt">uint32_t</span><span class="op">)</span>strlen<span class="op">((</span><span class="dt">char</span><span class="op">*)</span>k<span class="op">),</span> <span class="op">&amp;</span>out<span class="op">,</span> <span class="op">&amp;</span>n<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1179-161"><a href="#cb1179-161" aria-hidden="true" tabindex="-1"></a>            fwrite<span class="op">(</span>out<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> n<span class="op">,</span> stdout<span class="op">);</span></span>
<span id="cb1179-162"><a href="#cb1179-162" aria-hidden="true" tabindex="-1"></a>            fputc<span class="op">(</span><span class="ch">'</span><span class="sc">\n</span><span class="ch">'</span><span class="op">,</span> stdout<span class="op">);</span></span>
<span id="cb1179-163"><a href="#cb1179-163" aria-hidden="true" tabindex="-1"></a>            free<span class="op">(</span>out<span class="op">);</span></span>
<span id="cb1179-164"><a href="#cb1179-164" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb1179-165"><a href="#cb1179-165" aria-hidden="true" tabindex="-1"></a>            fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"not found</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1179-166"><a href="#cb1179-166" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1179-167"><a href="#cb1179-167" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb1179-168"><a href="#cb1179-168" aria-hidden="true" tabindex="-1"></a>        usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb1179-169"><a href="#cb1179-169" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1179-170"><a href="#cb1179-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1179-171"><a href="#cb1179-171" aria-hidden="true" tabindex="-1"></a>    kv_close<span class="op">(&amp;</span>db<span class="op">);</span></span>
<span id="cb1179-172"><a href="#cb1179-172" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1179-173"><a href="#cb1179-173" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Build:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1180"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1180-1"><a href="#cb1180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-std</span><span class="op">=</span>c23 <span class="at">-O2</span> <span class="at">-Wall</span> <span class="at">-Wextra</span> kv.c <span class="at">-o</span> kv</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1181"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1181-1"><a href="#cb1181-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./kv</span> store.log set color blue</span>
<span id="cb1181-2"><a href="#cb1181-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./kv</span> store.log get color</span>
<span id="cb1181-3"><a href="#cb1181-3" aria-hidden="true" tabindex="-1"></a><span class="co"># prints: blue</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-6.-compaction" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-compaction">Step 6. Compaction</h4>
<p>Because we append forever, the log grows. Implement a simple <strong>compact</strong> command that rewrites only the latest version of each key to a new file, then swaps files.</p>
<p>Idea:</p>
<ol type="1">
<li>Iterate index</li>
<li>Read the newest record for each key</li>
<li>Append it to <code>store.log.new</code></li>
<li>Replace the old file</li>
</ol>
<p>This keeps disk usage under control and speeds up startup scanning.</p>
</section>
<section id="step-7.-crash-safety-basics" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-crash-safety-basics">Step 7. Crash safety basics</h4>
<ul>
<li>Always <code>fflush</code> after appending a record.</li>
<li>For stronger durability call <code>fsync(fileno(db-&gt;f))</code> on POSIX after <code>fflush</code>.</li>
<li>Write whole records or none. Length headers first, then key, then value.</li>
<li>Consider a checksum per record to detect torn writes.</li>
</ul>
</section>
<section id="step-8.-cli-improvements" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-cli-improvements">Step 8. CLI improvements</h4>
<p>Add subcommands:</p>
<pre><code>kv &lt;file&gt; set &lt;k&gt; &lt;v&gt;
kv &lt;file&gt; get &lt;k&gt;
kv &lt;file&gt; compact
kv &lt;file&gt; stats</code></pre>
<p><code>stats</code> can print number of keys, file size, load factor, and index capacity.</p>
</section>
<section id="step-9.-testing" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-testing">Step 9. Testing</h4>
<ul>
<li><p>Insert 10k keys, then get a random 100 keys and verify values.</p></li>
<li><p>Overwrite the same key many times and ensure <code>get</code> returns the latest one.</p></li>
<li><p>Kill the program during writes and ensure the log is still readable.</p></li>
<li><p>Run with AddressSanitizer to catch memory bugs:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1183"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1183-1"><a href="#cb1183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">clang</span> <span class="at">-std</span><span class="op">=</span>c23 <span class="at">-O1</span> <span class="at">-g</span> <span class="at">-fsanitize</span><span class="op">=</span>address,undefined kv.c <span class="at">-o</span> kv_asan</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ul>
</section>
<section id="step-10.-why-it-matters-9" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-why-it-matters-9">Step 10. Why it matters</h4>
<p>This tiny store teaches the core database loop:</p>
<ul>
<li><strong>Log structured storage</strong> for durability</li>
<li><strong>In memory index</strong> for speed</li>
<li><strong>Compaction</strong> for space and locality</li>
<li><strong>Portable encoding</strong> for cross platform reads</li>
</ul>
<p>You just built the foundation that many production systems use at larger scale.</p>
</section>
<section id="try-it-yourself-88" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-88">Try it yourself</h4>
<ol type="1">
<li>Add a delete tombstone record type and have <code>get</code> respect it.</li>
<li>Store expiration timestamps and implement a <code>purge</code> command.</li>
<li>Use memory mapped I O for reads to speed up lookups.</li>
<li>Replace the linear probing table with a chained hash or hopscotch hashing.</li>
<li>Add a simple checksum per record and verify on read.</li>
</ol>
<p>Next you will implement <strong>95. Implementing a Custom Allocator</strong> where you will learn how <code>malloc</code> like systems manage the heap, and write a tiny arena allocator you can drop into small C projects.</p>
</section>
</section>
<section id="implementing-a-custom-allocator" class="level3">
<h3 class="anchored" data-anchor-id="implementing-a-custom-allocator">95. Implementing a Custom Allocator</h3>
<p>Every C program eventually asks the operating system for memory, but <code>malloc</code> and <code>free</code> are not magic—they are layers above system calls like <code>brk</code> and <code>mmap</code>. In this section, you will build your own <strong>custom memory allocator</strong>—a simple arena allocator that grabs a large block of memory once and doles it out efficiently.</p>
<p>You’ll see how real allocators work inside kernels, games, and embedded systems.</p>
<section id="step-1.-the-goal-3" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-the-goal-3">Step 1. The Goal</h4>
<p>We’ll implement a minimal <strong>arena allocator</strong> that:</p>
<ul>
<li>Allocates from a preallocated block</li>
<li>Never frees individual objects</li>
<li>Resets all memory at once when the arena is cleared</li>
</ul>
<p>This model is perfect for short-lived data structures, parsing, and high-performance applications.</p>
</section>
<section id="step-2.-design" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-design">Step 2. Design</h4>
<p>An arena allocator tracks:</p>
<ul>
<li>The <strong>base pointer</strong> (start of memory)</li>
<li>The <strong>current pointer</strong> (next free position)</li>
<li>The <strong>capacity</strong> (total size of the arena)</li>
</ul>
<p>When you allocate, it simply bumps the pointer forward.</p>
<p>Structure:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1184"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1184-1"><a href="#cb1184-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb1184-2"><a href="#cb1184-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>base<span class="op">;</span></span>
<span id="cb1184-3"><a href="#cb1184-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> capacity<span class="op">;</span></span>
<span id="cb1184-4"><a href="#cb1184-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> offset<span class="op">;</span></span>
<span id="cb1184-5"><a href="#cb1184-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Arena<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-3.-tiny-code-minimal-arena" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-tiny-code-minimal-arena">Step 3. Tiny Code: Minimal Arena</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1185"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1185-1"><a href="#cb1185-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1185-2"><a href="#cb1185-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb1185-3"><a href="#cb1185-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb1185-4"><a href="#cb1185-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdint.h&gt;</span></span>
<span id="cb1185-5"><a href="#cb1185-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1185-6"><a href="#cb1185-6" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb1185-7"><a href="#cb1185-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>base<span class="op">;</span></span>
<span id="cb1185-8"><a href="#cb1185-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> capacity<span class="op">;</span></span>
<span id="cb1185-9"><a href="#cb1185-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> offset<span class="op">;</span></span>
<span id="cb1185-10"><a href="#cb1185-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Arena<span class="op">;</span></span>
<span id="cb1185-11"><a href="#cb1185-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1185-12"><a href="#cb1185-12" aria-hidden="true" tabindex="-1"></a>Arena <span class="op">*</span>arena_create<span class="op">(</span><span class="dt">size_t</span> capacity<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1185-13"><a href="#cb1185-13" aria-hidden="true" tabindex="-1"></a>    Arena <span class="op">*</span>a <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span>Arena<span class="op">));</span></span>
<span id="cb1185-14"><a href="#cb1185-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>a<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1185-15"><a href="#cb1185-15" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>base <span class="op">=</span> malloc<span class="op">(</span>capacity<span class="op">);</span></span>
<span id="cb1185-16"><a href="#cb1185-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>a<span class="op">-&gt;</span>base<span class="op">)</span> <span class="op">{</span> free<span class="op">(</span>a<span class="op">);</span> <span class="cf">return</span> NULL<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1185-17"><a href="#cb1185-17" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>capacity <span class="op">=</span> capacity<span class="op">;</span></span>
<span id="cb1185-18"><a href="#cb1185-18" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>offset <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1185-19"><a href="#cb1185-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a<span class="op">;</span></span>
<span id="cb1185-20"><a href="#cb1185-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1185-21"><a href="#cb1185-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1185-22"><a href="#cb1185-22" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>arena_alloc<span class="op">(</span>Arena <span class="op">*</span>a<span class="op">,</span> <span class="dt">size_t</span> size<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1185-23"><a href="#cb1185-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a<span class="op">-&gt;</span>offset <span class="op">+</span> size <span class="op">&gt;</span> a<span class="op">-&gt;</span>capacity<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1185-24"><a href="#cb1185-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">*</span>ptr <span class="op">=</span> a<span class="op">-&gt;</span>base <span class="op">+</span> a<span class="op">-&gt;</span>offset<span class="op">;</span></span>
<span id="cb1185-25"><a href="#cb1185-25" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>offset <span class="op">+=</span> size<span class="op">;</span></span>
<span id="cb1185-26"><a href="#cb1185-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ptr<span class="op">;</span></span>
<span id="cb1185-27"><a href="#cb1185-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1185-28"><a href="#cb1185-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1185-29"><a href="#cb1185-29" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> arena_reset<span class="op">(</span>Arena <span class="op">*</span>a<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1185-30"><a href="#cb1185-30" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>offset <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1185-31"><a href="#cb1185-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1185-32"><a href="#cb1185-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1185-33"><a href="#cb1185-33" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> arena_free<span class="op">(</span>Arena <span class="op">*</span>a<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1185-34"><a href="#cb1185-34" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>a<span class="op">-&gt;</span>base<span class="op">);</span></span>
<span id="cb1185-35"><a href="#cb1185-35" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>a<span class="op">);</span></span>
<span id="cb1185-36"><a href="#cb1185-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-4.-example-use" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-example-use">Step 4. Example Use</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1186"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1186-1"><a href="#cb1186-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1186-2"><a href="#cb1186-2" aria-hidden="true" tabindex="-1"></a>    Arena <span class="op">*</span>arena <span class="op">=</span> arena_create<span class="op">(</span><span class="dv">1024</span><span class="op">);</span></span>
<span id="cb1186-3"><a href="#cb1186-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>arena<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1186-4"><a href="#cb1186-4" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Failed to create arena</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1186-5"><a href="#cb1186-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1186-6"><a href="#cb1186-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1186-7"><a href="#cb1186-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1186-8"><a href="#cb1186-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>arr <span class="op">=</span> arena_alloc<span class="op">(</span>arena<span class="op">,</span> <span class="dv">10</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb1186-9"><a href="#cb1186-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>arr<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1186-10"><a href="#cb1186-10" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Allocation failed</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1186-11"><a href="#cb1186-11" aria-hidden="true" tabindex="-1"></a>        arena_free<span class="op">(</span>arena<span class="op">);</span></span>
<span id="cb1186-12"><a href="#cb1186-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1186-13"><a href="#cb1186-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1186-14"><a href="#cb1186-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1186-15"><a href="#cb1186-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span> arr<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i <span class="op">*</span> i<span class="op">;</span></span>
<span id="cb1186-16"><a href="#cb1186-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1186-17"><a href="#cb1186-17" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Squares: "</span><span class="op">);</span></span>
<span id="cb1186-18"><a href="#cb1186-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span> printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> arr<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb1186-19"><a href="#cb1186-19" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1186-20"><a href="#cb1186-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1186-21"><a href="#cb1186-21" aria-hidden="true" tabindex="-1"></a>    arena_reset<span class="op">(</span>arena<span class="op">);</span>  <span class="co">// all memory reused</span></span>
<span id="cb1186-22"><a href="#cb1186-22" aria-hidden="true" tabindex="-1"></a>    arena_free<span class="op">(</span>arena<span class="op">);</span></span>
<span id="cb1186-23"><a href="#cb1186-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1186-24"><a href="#cb1186-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-5.-how-it-works" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-how-it-works">Step 5. How It Works</h4>
<ol type="1">
<li><code>arena_create</code> grabs one large block from <code>malloc</code>.</li>
<li><code>arena_alloc</code> hands out memory by increasing an offset—no per-object metadata.</li>
<li><code>arena_reset</code> rewinds the arena to reuse the memory instantly.</li>
<li><code>arena_free</code> releases the entire block in one call.</li>
</ol>
<p>This is <em>O(1)</em> for every allocation, with zero fragmentation.</p>
</section>
<section id="step-6.-adding-alignment" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-adding-alignment">Step 6. Adding Alignment</h4>
<p>Sometimes allocations must be aligned (for example, 16-byte alignment for SIMD). We can round up the offset to the nearest alignment boundary.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1187"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1187-1"><a href="#cb1187-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">size_t</span> align_up<span class="op">(</span><span class="dt">size_t</span> n<span class="op">,</span> <span class="dt">size_t</span> align<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1187-2"><a href="#cb1187-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>n <span class="op">+</span> <span class="op">(</span>align <span class="op">-</span> <span class="dv">1</span><span class="op">))</span> <span class="op">&amp;</span> <span class="op">~(</span>align <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb1187-3"><a href="#cb1187-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1187-4"><a href="#cb1187-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1187-5"><a href="#cb1187-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>arena_alloc_aligned<span class="op">(</span>Arena <span class="op">*</span>a<span class="op">,</span> <span class="dt">size_t</span> size<span class="op">,</span> <span class="dt">size_t</span> align<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1187-6"><a href="#cb1187-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> new_offset <span class="op">=</span> align_up<span class="op">(</span>a<span class="op">-&gt;</span>offset<span class="op">,</span> align<span class="op">);</span></span>
<span id="cb1187-7"><a href="#cb1187-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>new_offset <span class="op">+</span> size <span class="op">&gt;</span> a<span class="op">-&gt;</span>capacity<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1187-8"><a href="#cb1187-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">*</span>ptr <span class="op">=</span> a<span class="op">-&gt;</span>base <span class="op">+</span> new_offset<span class="op">;</span></span>
<span id="cb1187-9"><a href="#cb1187-9" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>offset <span class="op">=</span> new_offset <span class="op">+</span> size<span class="op">;</span></span>
<span id="cb1187-10"><a href="#cb1187-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ptr<span class="op">;</span></span>
<span id="cb1187-11"><a href="#cb1187-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-7.-debugging-helpers" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-debugging-helpers">Step 7. Debugging Helpers</h4>
<p>Add diagnostic printing to understand usage:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1188"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1188-1"><a href="#cb1188-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> arena_stats<span class="op">(</span>Arena <span class="op">*</span>a<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1188-2"><a href="#cb1188-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Arena used: </span><span class="sc">%zu</span><span class="st"> / </span><span class="sc">%zu</span><span class="st"> bytes (</span><span class="sc">%.1f%%</span><span class="st">)</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span></span>
<span id="cb1188-3"><a href="#cb1188-3" aria-hidden="true" tabindex="-1"></a>           a<span class="op">-&gt;</span>offset<span class="op">,</span> a<span class="op">-&gt;</span>capacity<span class="op">,</span></span>
<span id="cb1188-4"><a href="#cb1188-4" aria-hidden="true" tabindex="-1"></a>           <span class="op">(</span>a<span class="op">-&gt;</span>offset <span class="op">*</span> <span class="fl">100.0</span><span class="op">)</span> <span class="op">/</span> a<span class="op">-&gt;</span>capacity<span class="op">);</span></span>
<span id="cb1188-5"><a href="#cb1188-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-8.-advanced-idea-nested-arenas" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-advanced-idea-nested-arenas">Step 8. Advanced Idea: Nested Arenas</h4>
<p>You can make <strong>sub-arenas</strong> for scoped memory:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1189"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1189-1"><a href="#cb1189-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb1189-2"><a href="#cb1189-2" aria-hidden="true" tabindex="-1"></a>    Arena <span class="op">*</span>parent<span class="op">;</span></span>
<span id="cb1189-3"><a href="#cb1189-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> start<span class="op">;</span></span>
<span id="cb1189-4"><a href="#cb1189-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> ArenaScope<span class="op">;</span></span>
<span id="cb1189-5"><a href="#cb1189-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1189-6"><a href="#cb1189-6" aria-hidden="true" tabindex="-1"></a>ArenaScope arena_push<span class="op">(</span>Arena <span class="op">*</span>a<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1189-7"><a href="#cb1189-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>ArenaScope<span class="op">){</span> <span class="op">.</span>parent <span class="op">=</span> a<span class="op">,</span> <span class="op">.</span>start <span class="op">=</span> a<span class="op">-&gt;</span>offset <span class="op">};</span></span>
<span id="cb1189-8"><a href="#cb1189-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1189-9"><a href="#cb1189-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1189-10"><a href="#cb1189-10" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> arena_pop<span class="op">(</span>ArenaScope s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1189-11"><a href="#cb1189-11" aria-hidden="true" tabindex="-1"></a>    s<span class="op">.</span>parent<span class="op">-&gt;</span>offset <span class="op">=</span> s<span class="op">.</span>start<span class="op">;</span></span>
<span id="cb1189-12"><a href="#cb1189-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This lets you “temporarily allocate” for a function or block and reset automatically.</p>
</section>
<section id="step-9.-why-it-matters-4" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-why-it-matters-4">Step 9. Why It Matters</h4>
<p>Allocators define how performance feels in large systems. By writing one, you understand:</p>
<ul>
<li>How <code>malloc</code> and <code>free</code> manage metadata</li>
<li>How fragmentation occurs</li>
<li>How specialized allocators (arenas, pools, slabs) achieve speed and predictability</li>
</ul>
<p>Games, web servers, and compilers all use custom allocators to control lifetime and avoid overhead.</p>
</section>
<section id="step-10.-try-it-yourself-4" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-try-it-yourself-4">Step 10. Try It Yourself</h4>
<ol type="1">
<li>Add bounds checking that prints errors when overrun.</li>
<li>Implement a <strong>pool allocator</strong> for fixed-size objects (e.g., <code>struct Node</code>).</li>
<li>Use <code>mmap</code> to request anonymous memory directly from the OS.</li>
<li>Add a leak detector that reports unfreed bytes at shutdown.</li>
<li>Combine multiple arenas into a hierarchical allocator.</li>
</ol>
<p>Next you’ll build <strong>96. Writing a Text Parser</strong>, using your allocator to manage short-lived strings and tokens as you build a mini lexer and parser in pure C.</p>
</section>
</section>
<section id="writing-a-text-parser" class="level3">
<h3 class="anchored" data-anchor-id="writing-a-text-parser">96. Writing a Text Parser</h3>
<p>Time to turn raw text into structure. In this section you will write a <strong>tiny expression parser</strong> that converts strings like <code>3 + 4*2 - (1 + 5)</code> into an <strong>AST</strong> (abstract syntax tree). We will build a simple tokenizer, a recursive descent parser with precedence, and a pretty printer to check the result. In the next section you can add an evaluator to run it.</p>
<section id="step-1.-goal-and-scope" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-goal-and-scope">Step 1. Goal and scope</h4>
<p>We will parse integer arithmetic with these features:</p>
<ul>
<li>Integers: <code>0</code>, <code>42</code>, <code>1234</code></li>
<li>Operators: <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code></li>
<li>Parentheses: <code>( ... )</code></li>
<li>Whitespace ignored</li>
</ul>
<p>Output: an AST you can traverse or evaluate later.</p>
</section>
<section id="step-2.-grammar-informal" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-grammar-informal">Step 2. Grammar (informal)</h4>
<p>We will use the classic precedence rules:</p>
<pre><code>expr   -&gt; term (('+' | '-') term)*
term   -&gt; factor (('*' | '/') factor)*
factor -&gt; INT | '(' expr ')'</code></pre>
<p>Parsing follows these functions in order: <code>parse_expr</code>, <code>parse_term</code>, <code>parse_factor</code>.</p>
</section>
<section id="step-3.-tokens" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-tokens">Step 3. Tokens</h4>
<p>We first scan characters into tokens:</p>
<ul>
<li><code>TOK_INT</code> with a numeric value</li>
<li><code>TOK_PLUS</code>, <code>TOK_MINUS</code>, <code>TOK_STAR</code>, <code>TOK_SLASH</code></li>
<li><code>TOK_LPAREN</code>, <code>TOK_RPAREN</code></li>
<li><code>TOK_EOF</code> to mark the end</li>
</ul>
</section>
<section id="step-4.-ast-nodes" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-ast-nodes">Step 4. AST nodes</h4>
<p>Use a compact node type:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1191"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1191-1"><a href="#cb1191-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">enum</span> <span class="op">{</span> N_INT<span class="op">,</span> N_ADD<span class="op">,</span> N_SUB<span class="op">,</span> N_MUL<span class="op">,</span> N_DIV <span class="op">}</span> NodeKind<span class="op">;</span></span>
<span id="cb1191-2"><a href="#cb1191-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1191-3"><a href="#cb1191-3" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb1191-4"><a href="#cb1191-4" aria-hidden="true" tabindex="-1"></a>    NodeKind kind<span class="op">;</span></span>
<span id="cb1191-5"><a href="#cb1191-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>left<span class="op">,</span> <span class="op">*</span>right<span class="op">;</span>  <span class="co">// for binary ops</span></span>
<span id="cb1191-6"><a href="#cb1191-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> value<span class="op">;</span>                  <span class="co">// for integers</span></span>
<span id="cb1191-7"><a href="#cb1191-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Binary nodes use <code>left</code> and <code>right</code>. Integer nodes use <code>value</code>.</p>
</section>
<section id="step-5.-a-tiny-arena-for-nodes" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-a-tiny-arena-for-nodes">Step 5. A tiny arena for nodes</h4>
<p>Allocating nodes frequently with <code>malloc</code> is noisy. Use a tiny arena so each node is just a bump allocation and everything frees at once when you are done.</p>
</section>
<section id="step-6.-error-handling-strategy" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-error-handling-strategy">Step 6. Error handling strategy</h4>
<p>Keep it simple:</p>
<ul>
<li>If an unexpected token appears, print a message with the position.</li>
<li>Stop parsing and return <code>NULL</code>.</li>
<li>The pretty printer will only run if the tree is not <code>NULL</code>.</li>
</ul>
</section>
<section id="step-7.-pretty-printing-the-ast" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-pretty-printing-the-ast">Step 7. Pretty printing the AST</h4>
<p>To verify parsing, print with minimal parentheses:</p>
<ul>
<li>For binary nodes, print <code>(left op right)</code>.</li>
<li>For integers, print the number. This is enough to confirm shape and precedence.</li>
</ul>
</section>
<section id="step-8.-tiny-code-self-contained-lexer-parser-printer" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-tiny-code-self-contained-lexer-parser-printer">Step 8. Tiny Code: self contained lexer + parser + printer</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1192"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1192-1"><a href="#cb1192-1" aria-hidden="true" tabindex="-1"></a><span class="co">// file: expr_parser.c</span></span>
<span id="cb1192-2"><a href="#cb1192-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define _POSIX_C_SOURCE </span><span class="dv">200809</span><span class="bu">L</span></span>
<span id="cb1192-3"><a href="#cb1192-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1192-4"><a href="#cb1192-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb1192-5"><a href="#cb1192-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;ctype.h&gt;</span></span>
<span id="cb1192-6"><a href="#cb1192-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb1192-7"><a href="#cb1192-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-8"><a href="#cb1192-8" aria-hidden="true" tabindex="-1"></a><span class="co">/* ---------- tiny arena ---------- */</span></span>
<span id="cb1192-9"><a href="#cb1192-9" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb1192-10"><a href="#cb1192-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>base<span class="op">;</span></span>
<span id="cb1192-11"><a href="#cb1192-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> cap<span class="op">,</span> off<span class="op">;</span></span>
<span id="cb1192-12"><a href="#cb1192-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Arena<span class="op">;</span></span>
<span id="cb1192-13"><a href="#cb1192-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-14"><a href="#cb1192-14" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Arena <span class="op">*</span>arena_new<span class="op">(</span><span class="dt">size_t</span> cap<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-15"><a href="#cb1192-15" aria-hidden="true" tabindex="-1"></a>    Arena <span class="op">*</span>a <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(*</span>a<span class="op">));</span></span>
<span id="cb1192-16"><a href="#cb1192-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>a<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1192-17"><a href="#cb1192-17" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>base <span class="op">=</span> malloc<span class="op">(</span>cap<span class="op">);</span></span>
<span id="cb1192-18"><a href="#cb1192-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>a<span class="op">-&gt;</span>base<span class="op">)</span> <span class="op">{</span> free<span class="op">(</span>a<span class="op">);</span> <span class="cf">return</span> NULL<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1192-19"><a href="#cb1192-19" aria-hidden="true" tabindex="-1"></a>    a<span class="op">-&gt;</span>cap <span class="op">=</span> cap<span class="op">;</span> a<span class="op">-&gt;</span>off <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1192-20"><a href="#cb1192-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a<span class="op">;</span></span>
<span id="cb1192-21"><a href="#cb1192-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1192-22"><a href="#cb1192-22" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> <span class="op">*</span>arena_alloc<span class="op">(</span>Arena <span class="op">*</span>a<span class="op">,</span> <span class="dt">size_t</span> n<span class="op">,</span> <span class="dt">size_t</span> align<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-23"><a href="#cb1192-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> p <span class="op">=</span> <span class="op">(</span>a<span class="op">-&gt;</span>off <span class="op">+</span> <span class="op">(</span>align <span class="op">-</span> <span class="dv">1</span><span class="op">))</span> <span class="op">&amp;</span> <span class="op">~(</span>align <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb1192-24"><a href="#cb1192-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>p <span class="op">+</span> n <span class="op">&gt;</span> a<span class="op">-&gt;</span>cap<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1192-25"><a href="#cb1192-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">*</span>ptr <span class="op">=</span> a<span class="op">-&gt;</span>base <span class="op">+</span> p<span class="op">;</span> a<span class="op">-&gt;</span>off <span class="op">=</span> p <span class="op">+</span> n<span class="op">;</span> <span class="cf">return</span> ptr<span class="op">;</span></span>
<span id="cb1192-26"><a href="#cb1192-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1192-27"><a href="#cb1192-27" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> arena_free<span class="op">(</span>Arena <span class="op">*</span>a<span class="op">)</span> <span class="op">{</span> <span class="cf">if</span> <span class="op">(!</span>a<span class="op">)</span> <span class="cf">return</span><span class="op">;</span> free<span class="op">(</span>a<span class="op">-&gt;</span>base<span class="op">);</span> free<span class="op">(</span>a<span class="op">);</span> <span class="op">}</span></span>
<span id="cb1192-28"><a href="#cb1192-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-29"><a href="#cb1192-29" aria-hidden="true" tabindex="-1"></a><span class="co">/* ---------- tokens ---------- */</span></span>
<span id="cb1192-30"><a href="#cb1192-30" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">enum</span> <span class="op">{</span></span>
<span id="cb1192-31"><a href="#cb1192-31" aria-hidden="true" tabindex="-1"></a>    TOK_INT<span class="op">,</span> TOK_PLUS<span class="op">,</span> TOK_MINUS<span class="op">,</span> TOK_STAR<span class="op">,</span> TOK_SLASH<span class="op">,</span></span>
<span id="cb1192-32"><a href="#cb1192-32" aria-hidden="true" tabindex="-1"></a>    TOK_LPAREN<span class="op">,</span> TOK_RPAREN<span class="op">,</span> TOK_EOF<span class="op">,</span> TOK_ERR</span>
<span id="cb1192-33"><a href="#cb1192-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> TokKind<span class="op">;</span></span>
<span id="cb1192-34"><a href="#cb1192-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-35"><a href="#cb1192-35" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb1192-36"><a href="#cb1192-36" aria-hidden="true" tabindex="-1"></a>    TokKind kind<span class="op">;</span></span>
<span id="cb1192-37"><a href="#cb1192-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span>    ival<span class="op">;</span></span>
<span id="cb1192-38"><a href="#cb1192-38" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>start<span class="op">;</span>  <span class="co">// for error messages</span></span>
<span id="cb1192-39"><a href="#cb1192-39" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>end<span class="op">;</span></span>
<span id="cb1192-40"><a href="#cb1192-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Token<span class="op">;</span></span>
<span id="cb1192-41"><a href="#cb1192-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-42"><a href="#cb1192-42" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb1192-43"><a href="#cb1192-43" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>src<span class="op">;</span></span>
<span id="cb1192-44"><a href="#cb1192-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>cur<span class="op">;</span></span>
<span id="cb1192-45"><a href="#cb1192-45" aria-hidden="true" tabindex="-1"></a>    Token       look<span class="op">;</span>   <span class="co">// one-token lookahead</span></span>
<span id="cb1192-46"><a href="#cb1192-46" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Lexer<span class="op">;</span></span>
<span id="cb1192-47"><a href="#cb1192-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-48"><a href="#cb1192-48" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> skip_ws<span class="op">(</span>Lexer <span class="op">*</span>L<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-49"><a href="#cb1192-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>isspace<span class="op">((</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)*</span>L<span class="op">-&gt;</span>cur<span class="op">))</span> L<span class="op">-&gt;</span>cur<span class="op">++;</span></span>
<span id="cb1192-50"><a href="#cb1192-50" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1192-51"><a href="#cb1192-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-52"><a href="#cb1192-52" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Token make<span class="op">(</span>Lexer <span class="op">*</span>L<span class="op">,</span> TokKind k<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>s<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>e<span class="op">,</span> <span class="dt">long</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-53"><a href="#cb1192-53" aria-hidden="true" tabindex="-1"></a>    Token t <span class="op">=</span> <span class="op">{</span>k<span class="op">,</span> v<span class="op">,</span> s<span class="op">,</span> e<span class="op">};</span></span>
<span id="cb1192-54"><a href="#cb1192-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> t<span class="op">;</span></span>
<span id="cb1192-55"><a href="#cb1192-55" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1192-56"><a href="#cb1192-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-57"><a href="#cb1192-57" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Token next_token_raw<span class="op">(</span>Lexer <span class="op">*</span>L<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-58"><a href="#cb1192-58" aria-hidden="true" tabindex="-1"></a>    skip_ws<span class="op">(</span>L<span class="op">);</span></span>
<span id="cb1192-59"><a href="#cb1192-59" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> L<span class="op">-&gt;</span>cur<span class="op">;</span></span>
<span id="cb1192-60"><a href="#cb1192-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(*</span>L<span class="op">-&gt;</span>cur <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> make<span class="op">(</span>L<span class="op">,</span> TOK_EOF<span class="op">,</span> s<span class="op">,</span> s<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb1192-61"><a href="#cb1192-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-62"><a href="#cb1192-62" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> c <span class="op">=</span> <span class="op">*</span>L<span class="op">-&gt;</span>cur<span class="op">++;</span></span>
<span id="cb1192-63"><a href="#cb1192-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-64"><a href="#cb1192-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="ch">'+'</span><span class="op">:</span> <span class="cf">return</span> make<span class="op">(</span>L<span class="op">,</span> TOK_PLUS<span class="op">,</span>   s<span class="op">,</span> L<span class="op">-&gt;</span>cur<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb1192-65"><a href="#cb1192-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="ch">'-'</span><span class="op">:</span> <span class="cf">return</span> make<span class="op">(</span>L<span class="op">,</span> TOK_MINUS<span class="op">,</span>  s<span class="op">,</span> L<span class="op">-&gt;</span>cur<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb1192-66"><a href="#cb1192-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="ch">'*'</span><span class="op">:</span> <span class="cf">return</span> make<span class="op">(</span>L<span class="op">,</span> TOK_STAR<span class="op">,</span>   s<span class="op">,</span> L<span class="op">-&gt;</span>cur<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb1192-67"><a href="#cb1192-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="ch">'/'</span><span class="op">:</span> <span class="cf">return</span> make<span class="op">(</span>L<span class="op">,</span> TOK_SLASH<span class="op">,</span>  s<span class="op">,</span> L<span class="op">-&gt;</span>cur<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb1192-68"><a href="#cb1192-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="ch">'('</span><span class="op">:</span> <span class="cf">return</span> make<span class="op">(</span>L<span class="op">,</span> TOK_LPAREN<span class="op">,</span> s<span class="op">,</span> L<span class="op">-&gt;</span>cur<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb1192-69"><a href="#cb1192-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="ch">')'</span><span class="op">:</span> <span class="cf">return</span> make<span class="op">(</span>L<span class="op">,</span> TOK_RPAREN<span class="op">,</span> s<span class="op">,</span> L<span class="op">-&gt;</span>cur<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb1192-70"><a href="#cb1192-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">default</span><span class="op">:</span></span>
<span id="cb1192-71"><a href="#cb1192-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>isdigit<span class="op">((</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)</span>c<span class="op">))</span> <span class="op">{</span></span>
<span id="cb1192-72"><a href="#cb1192-72" aria-hidden="true" tabindex="-1"></a>                <span class="dt">long</span> v <span class="op">=</span> c <span class="op">-</span> <span class="ch">'0'</span><span class="op">;</span></span>
<span id="cb1192-73"><a href="#cb1192-73" aria-hidden="true" tabindex="-1"></a>                <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>p <span class="op">=</span> L<span class="op">-&gt;</span>cur<span class="op">;</span></span>
<span id="cb1192-74"><a href="#cb1192-74" aria-hidden="true" tabindex="-1"></a>                <span class="cf">while</span> <span class="op">(</span>isdigit<span class="op">((</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)*</span>p<span class="op">))</span> <span class="op">{</span></span>
<span id="cb1192-75"><a href="#cb1192-75" aria-hidden="true" tabindex="-1"></a>                    v <span class="op">=</span> v <span class="op">*</span> <span class="dv">10</span> <span class="op">+</span> <span class="op">(*</span>p <span class="op">-</span> <span class="ch">'0'</span><span class="op">);</span></span>
<span id="cb1192-76"><a href="#cb1192-76" aria-hidden="true" tabindex="-1"></a>                    p<span class="op">++;</span></span>
<span id="cb1192-77"><a href="#cb1192-77" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb1192-78"><a href="#cb1192-78" aria-hidden="true" tabindex="-1"></a>                Token t <span class="op">=</span> make<span class="op">(</span>L<span class="op">,</span> TOK_INT<span class="op">,</span> s<span class="op">,</span> p<span class="op">,</span> v<span class="op">);</span></span>
<span id="cb1192-79"><a href="#cb1192-79" aria-hidden="true" tabindex="-1"></a>                L<span class="op">-&gt;</span>cur <span class="op">=</span> p<span class="op">;</span></span>
<span id="cb1192-80"><a href="#cb1192-80" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> t<span class="op">;</span></span>
<span id="cb1192-81"><a href="#cb1192-81" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1192-82"><a href="#cb1192-82" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> make<span class="op">(</span>L<span class="op">,</span> TOK_ERR<span class="op">,</span> s<span class="op">,</span> L<span class="op">-&gt;</span>cur<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb1192-83"><a href="#cb1192-83" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1192-84"><a href="#cb1192-84" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1192-85"><a href="#cb1192-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-86"><a href="#cb1192-86" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> lexer_init<span class="op">(</span>Lexer <span class="op">*</span>L<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>src<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-87"><a href="#cb1192-87" aria-hidden="true" tabindex="-1"></a>    L<span class="op">-&gt;</span>src <span class="op">=</span> src<span class="op">;</span> L<span class="op">-&gt;</span>cur <span class="op">=</span> src<span class="op">;</span> L<span class="op">-&gt;</span>look <span class="op">=</span> next_token_raw<span class="op">(</span>L<span class="op">);</span></span>
<span id="cb1192-88"><a href="#cb1192-88" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1192-89"><a href="#cb1192-89" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Token peek<span class="op">(</span>Lexer <span class="op">*</span>L<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> L<span class="op">-&gt;</span>look<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1192-90"><a href="#cb1192-90" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Token take<span class="op">(</span>Lexer <span class="op">*</span>L<span class="op">)</span> <span class="op">{</span> Token t <span class="op">=</span> L<span class="op">-&gt;</span>look<span class="op">;</span> L<span class="op">-&gt;</span>look <span class="op">=</span> next_token_raw<span class="op">(</span>L<span class="op">);</span> <span class="cf">return</span> t<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1192-91"><a href="#cb1192-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-92"><a href="#cb1192-92" aria-hidden="true" tabindex="-1"></a><span class="co">/* ---------- AST ---------- */</span></span>
<span id="cb1192-93"><a href="#cb1192-93" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">enum</span> <span class="op">{</span> N_INT<span class="op">,</span> N_ADD<span class="op">,</span> N_SUB<span class="op">,</span> N_MUL<span class="op">,</span> N_DIV <span class="op">}</span> NodeKind<span class="op">;</span></span>
<span id="cb1192-94"><a href="#cb1192-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-95"><a href="#cb1192-95" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb1192-96"><a href="#cb1192-96" aria-hidden="true" tabindex="-1"></a>    NodeKind kind<span class="op">;</span></span>
<span id="cb1192-97"><a href="#cb1192-97" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>l<span class="op">,</span> <span class="op">*</span>r<span class="op">;</span></span>
<span id="cb1192-98"><a href="#cb1192-98" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> value<span class="op">;</span></span>
<span id="cb1192-99"><a href="#cb1192-99" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb1192-100"><a href="#cb1192-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-101"><a href="#cb1192-101" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Node <span class="op">*</span>node_new_int<span class="op">(</span>Arena <span class="op">*</span>A<span class="op">,</span> <span class="dt">long</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-102"><a href="#cb1192-102" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>n <span class="op">=</span> arena_alloc<span class="op">(</span>A<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(*</span>n<span class="op">),</span> <span class="kw">_Alignof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb1192-103"><a href="#cb1192-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>n<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1192-104"><a href="#cb1192-104" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>kind <span class="op">=</span> N_INT<span class="op">;</span> n<span class="op">-&gt;</span>l <span class="op">=</span> n<span class="op">-&gt;</span>r <span class="op">=</span> NULL<span class="op">;</span> n<span class="op">-&gt;</span>value <span class="op">=</span> v<span class="op">;</span> <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb1192-105"><a href="#cb1192-105" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1192-106"><a href="#cb1192-106" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Node <span class="op">*</span>node_new_bin<span class="op">(</span>Arena <span class="op">*</span>A<span class="op">,</span> NodeKind k<span class="op">,</span> Node <span class="op">*</span>l<span class="op">,</span> Node <span class="op">*</span>r<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-107"><a href="#cb1192-107" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>n <span class="op">=</span> arena_alloc<span class="op">(</span>A<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(*</span>n<span class="op">),</span> <span class="kw">_Alignof</span><span class="op">(</span>Node<span class="op">));</span></span>
<span id="cb1192-108"><a href="#cb1192-108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>n<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1192-109"><a href="#cb1192-109" aria-hidden="true" tabindex="-1"></a>    n<span class="op">-&gt;</span>kind <span class="op">=</span> k<span class="op">;</span> n<span class="op">-&gt;</span>l <span class="op">=</span> l<span class="op">;</span> n<span class="op">-&gt;</span>r <span class="op">=</span> r<span class="op">;</span> n<span class="op">-&gt;</span>value <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb1192-110"><a href="#cb1192-110" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1192-111"><a href="#cb1192-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-112"><a href="#cb1192-112" aria-hidden="true" tabindex="-1"></a><span class="co">/* ---------- parser: expr -&gt; term -&gt; factor ---------- */</span></span>
<span id="cb1192-113"><a href="#cb1192-113" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span> Lexer <span class="op">*</span>L<span class="op">;</span> Arena <span class="op">*</span>A<span class="op">;</span> <span class="dt">int</span> ok<span class="op">;</span> <span class="op">}</span> Parser<span class="op">;</span></span>
<span id="cb1192-114"><a href="#cb1192-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-115"><a href="#cb1192-115" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> fail<span class="op">(</span>Parser <span class="op">*</span>P<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>msg<span class="op">,</span> Token t<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-116"><a href="#cb1192-116" aria-hidden="true" tabindex="-1"></a>    P<span class="op">-&gt;</span>ok <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1192-117"><a href="#cb1192-117" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> pos <span class="op">=</span> <span class="op">(</span><span class="dt">size_t</span><span class="op">)(</span>t<span class="op">.</span>start <span class="op">-</span> P<span class="op">-&gt;</span>L<span class="op">-&gt;</span>src<span class="op">);</span></span>
<span id="cb1192-118"><a href="#cb1192-118" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Parse error at pos </span><span class="sc">%zu</span><span class="st">: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> pos<span class="op">,</span> msg<span class="op">);</span></span>
<span id="cb1192-119"><a href="#cb1192-119" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1192-120"><a href="#cb1192-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-121"><a href="#cb1192-121" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Node <span class="op">*</span>parse_expr<span class="op">(</span>Parser <span class="op">*</span>P<span class="op">);</span> <span class="co">// forward</span></span>
<span id="cb1192-122"><a href="#cb1192-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-123"><a href="#cb1192-123" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Node <span class="op">*</span>parse_factor<span class="op">(</span>Parser <span class="op">*</span>P<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-124"><a href="#cb1192-124" aria-hidden="true" tabindex="-1"></a>    Token t <span class="op">=</span> peek<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">);</span></span>
<span id="cb1192-125"><a href="#cb1192-125" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>t<span class="op">.</span>kind <span class="op">==</span> TOK_INT<span class="op">)</span> <span class="op">{</span> take<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">);</span> <span class="cf">return</span> node_new_int<span class="op">(</span>P<span class="op">-&gt;</span>A<span class="op">,</span> t<span class="op">.</span>ival<span class="op">);</span> <span class="op">}</span></span>
<span id="cb1192-126"><a href="#cb1192-126" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>t<span class="op">.</span>kind <span class="op">==</span> TOK_LPAREN<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-127"><a href="#cb1192-127" aria-hidden="true" tabindex="-1"></a>        take<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">);</span></span>
<span id="cb1192-128"><a href="#cb1192-128" aria-hidden="true" tabindex="-1"></a>        Node <span class="op">*</span>inside <span class="op">=</span> parse_expr<span class="op">(</span>P<span class="op">);</span></span>
<span id="cb1192-129"><a href="#cb1192-129" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>P<span class="op">-&gt;</span>ok<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1192-130"><a href="#cb1192-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>peek<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">).</span>kind <span class="op">!=</span> TOK_RPAREN<span class="op">)</span> <span class="op">{</span> fail<span class="op">(</span>P<span class="op">,</span> <span class="st">"expected ')'"</span><span class="op">,</span> peek<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">));</span> <span class="cf">return</span> NULL<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1192-131"><a href="#cb1192-131" aria-hidden="true" tabindex="-1"></a>        take<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">);</span></span>
<span id="cb1192-132"><a href="#cb1192-132" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> inside<span class="op">;</span></span>
<span id="cb1192-133"><a href="#cb1192-133" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1192-134"><a href="#cb1192-134" aria-hidden="true" tabindex="-1"></a>    fail<span class="op">(</span>P<span class="op">,</span> <span class="st">"expected number or '('"</span><span class="op">,</span> t<span class="op">);</span></span>
<span id="cb1192-135"><a href="#cb1192-135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1192-136"><a href="#cb1192-136" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1192-137"><a href="#cb1192-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-138"><a href="#cb1192-138" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Node <span class="op">*</span>parse_term<span class="op">(</span>Parser <span class="op">*</span>P<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-139"><a href="#cb1192-139" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>n <span class="op">=</span> parse_factor<span class="op">(</span>P<span class="op">);</span></span>
<span id="cb1192-140"><a href="#cb1192-140" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>P<span class="op">-&gt;</span>ok<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-141"><a href="#cb1192-141" aria-hidden="true" tabindex="-1"></a>        TokKind k <span class="op">=</span> peek<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">).</span>kind<span class="op">;</span></span>
<span id="cb1192-142"><a href="#cb1192-142" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>k <span class="op">!=</span> TOK_STAR <span class="op">&amp;&amp;</span> k <span class="op">!=</span> TOK_SLASH<span class="op">)</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1192-143"><a href="#cb1192-143" aria-hidden="true" tabindex="-1"></a>        take<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">);</span></span>
<span id="cb1192-144"><a href="#cb1192-144" aria-hidden="true" tabindex="-1"></a>        Node <span class="op">*</span>r <span class="op">=</span> parse_factor<span class="op">(</span>P<span class="op">);</span></span>
<span id="cb1192-145"><a href="#cb1192-145" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>r<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1192-146"><a href="#cb1192-146" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> node_new_bin<span class="op">(</span>P<span class="op">-&gt;</span>A<span class="op">,</span> k <span class="op">==</span> TOK_STAR <span class="op">?</span> N_MUL <span class="op">:</span> N_DIV<span class="op">,</span> n<span class="op">,</span> r<span class="op">);</span></span>
<span id="cb1192-147"><a href="#cb1192-147" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>n<span class="op">)</span> <span class="op">{</span> P<span class="op">-&gt;</span>ok <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="cf">return</span> NULL<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1192-148"><a href="#cb1192-148" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1192-149"><a href="#cb1192-149" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb1192-150"><a href="#cb1192-150" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1192-151"><a href="#cb1192-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-152"><a href="#cb1192-152" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Node <span class="op">*</span>parse_expr<span class="op">(</span>Parser <span class="op">*</span>P<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-153"><a href="#cb1192-153" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>n <span class="op">=</span> parse_term<span class="op">(</span>P<span class="op">);</span></span>
<span id="cb1192-154"><a href="#cb1192-154" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>P<span class="op">-&gt;</span>ok<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-155"><a href="#cb1192-155" aria-hidden="true" tabindex="-1"></a>        TokKind k <span class="op">=</span> peek<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">).</span>kind<span class="op">;</span></span>
<span id="cb1192-156"><a href="#cb1192-156" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>k <span class="op">!=</span> TOK_PLUS <span class="op">&amp;&amp;</span> k <span class="op">!=</span> TOK_MINUS<span class="op">)</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1192-157"><a href="#cb1192-157" aria-hidden="true" tabindex="-1"></a>        take<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">);</span></span>
<span id="cb1192-158"><a href="#cb1192-158" aria-hidden="true" tabindex="-1"></a>        Node <span class="op">*</span>r <span class="op">=</span> parse_term<span class="op">(</span>P<span class="op">);</span></span>
<span id="cb1192-159"><a href="#cb1192-159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>r<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1192-160"><a href="#cb1192-160" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> node_new_bin<span class="op">(</span>P<span class="op">-&gt;</span>A<span class="op">,</span> k <span class="op">==</span> TOK_PLUS <span class="op">?</span> N_ADD <span class="op">:</span> N_SUB<span class="op">,</span> n<span class="op">,</span> r<span class="op">);</span></span>
<span id="cb1192-161"><a href="#cb1192-161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>n<span class="op">)</span> <span class="op">{</span> P<span class="op">-&gt;</span>ok <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="cf">return</span> NULL<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1192-162"><a href="#cb1192-162" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1192-163"><a href="#cb1192-163" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb1192-164"><a href="#cb1192-164" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1192-165"><a href="#cb1192-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-166"><a href="#cb1192-166" aria-hidden="true" tabindex="-1"></a><span class="co">/* ---------- printer ---------- */</span></span>
<span id="cb1192-167"><a href="#cb1192-167" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> print_ast<span class="op">(</span>Node <span class="op">*</span>n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-168"><a href="#cb1192-168" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>n<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb1192-169"><a href="#cb1192-169" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>n<span class="op">-&gt;</span>kind<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-170"><a href="#cb1192-170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> N_INT<span class="op">:</span> printf<span class="op">(</span><span class="st">"</span><span class="sc">%ld</span><span class="st">"</span><span class="op">,</span> n<span class="op">-&gt;</span>value<span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1192-171"><a href="#cb1192-171" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> N_ADD<span class="op">:</span> printf<span class="op">(</span><span class="st">"("</span><span class="op">);</span> print_ast<span class="op">(</span>n<span class="op">-&gt;</span>l<span class="op">);</span> printf<span class="op">(</span><span class="st">" + "</span><span class="op">);</span> print_ast<span class="op">(</span>n<span class="op">-&gt;</span>r<span class="op">);</span> printf<span class="op">(</span><span class="st">")"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1192-172"><a href="#cb1192-172" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> N_SUB<span class="op">:</span> printf<span class="op">(</span><span class="st">"("</span><span class="op">);</span> print_ast<span class="op">(</span>n<span class="op">-&gt;</span>l<span class="op">);</span> printf<span class="op">(</span><span class="st">" - "</span><span class="op">);</span> print_ast<span class="op">(</span>n<span class="op">-&gt;</span>r<span class="op">);</span> printf<span class="op">(</span><span class="st">")"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1192-173"><a href="#cb1192-173" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> N_MUL<span class="op">:</span> printf<span class="op">(</span><span class="st">"("</span><span class="op">);</span> print_ast<span class="op">(</span>n<span class="op">-&gt;</span>l<span class="op">);</span> printf<span class="op">(</span><span class="st">" * "</span><span class="op">);</span> print_ast<span class="op">(</span>n<span class="op">-&gt;</span>r<span class="op">);</span> printf<span class="op">(</span><span class="st">")"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1192-174"><a href="#cb1192-174" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> N_DIV<span class="op">:</span> printf<span class="op">(</span><span class="st">"("</span><span class="op">);</span> print_ast<span class="op">(</span>n<span class="op">-&gt;</span>l<span class="op">);</span> printf<span class="op">(</span><span class="st">" / "</span><span class="op">);</span> print_ast<span class="op">(</span>n<span class="op">-&gt;</span>r<span class="op">);</span> printf<span class="op">(</span><span class="st">")"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1192-175"><a href="#cb1192-175" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1192-176"><a href="#cb1192-176" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1192-177"><a href="#cb1192-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-178"><a href="#cb1192-178" aria-hidden="true" tabindex="-1"></a><span class="co">/* ---------- main for quick testing ---------- */</span></span>
<span id="cb1192-179"><a href="#cb1192-179" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-180"><a href="#cb1192-180" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>src <span class="op">=</span> <span class="op">(</span>argc <span class="op">&gt;</span> <span class="dv">1</span><span class="op">)</span> <span class="op">?</span> argv<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">:</span> <span class="st">"3 + 4*2 - (1 + 5)"</span><span class="op">;</span></span>
<span id="cb1192-181"><a href="#cb1192-181" aria-hidden="true" tabindex="-1"></a>    Lexer L<span class="op">;</span> lexer_init<span class="op">(&amp;</span>L<span class="op">,</span> src<span class="op">);</span></span>
<span id="cb1192-182"><a href="#cb1192-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-183"><a href="#cb1192-183" aria-hidden="true" tabindex="-1"></a>    Arena <span class="op">*</span>A <span class="op">=</span> arena_new<span class="op">(</span><span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">16</span><span class="op">);</span></span>
<span id="cb1192-184"><a href="#cb1192-184" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>A<span class="op">)</span> <span class="op">{</span> fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"arena alloc failed</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1192-185"><a href="#cb1192-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-186"><a href="#cb1192-186" aria-hidden="true" tabindex="-1"></a>    Parser P <span class="op">=</span> <span class="op">{</span> <span class="op">.</span>L <span class="op">=</span> <span class="op">&amp;</span>L<span class="op">,</span> <span class="op">.</span>A <span class="op">=</span> A<span class="op">,</span> <span class="op">.</span>ok <span class="op">=</span> <span class="dv">1</span> <span class="op">};</span></span>
<span id="cb1192-187"><a href="#cb1192-187" aria-hidden="true" tabindex="-1"></a>    Node <span class="op">*</span>root <span class="op">=</span> parse_expr<span class="op">(&amp;</span>P<span class="op">);</span></span>
<span id="cb1192-188"><a href="#cb1192-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-189"><a href="#cb1192-189" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>P<span class="op">.</span>ok <span class="op">&amp;&amp;</span> peek<span class="op">(&amp;</span>L<span class="op">).</span>kind <span class="op">==</span> TOK_EOF <span class="op">&amp;&amp;</span> root<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1192-190"><a href="#cb1192-190" aria-hidden="true" tabindex="-1"></a>        print_ast<span class="op">(</span>root<span class="op">);</span></span>
<span id="cb1192-191"><a href="#cb1192-191" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1192-192"><a href="#cb1192-192" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb1192-193"><a href="#cb1192-193" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"Failed to parse input.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1192-194"><a href="#cb1192-194" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1192-195"><a href="#cb1192-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-196"><a href="#cb1192-196" aria-hidden="true" tabindex="-1"></a>    arena_free<span class="op">(</span>A<span class="op">);</span></span>
<span id="cb1192-197"><a href="#cb1192-197" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> P<span class="op">.</span>ok <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1192-198"><a href="#cb1192-198" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Build and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1193"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1193-1"><a href="#cb1193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-std</span><span class="op">=</span>c23 <span class="at">-O2</span> <span class="at">-Wall</span> <span class="at">-Wextra</span> expr_parser.c <span class="at">-o</span> expr_parser</span>
<span id="cb1193-2"><a href="#cb1193-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./expr_parser</span> <span class="st">"3 + 4*2 - (1 + 5)"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example output:</p>
<pre><code>((3 + (4 * 2)) - (1 + 5))</code></pre>
<p>This shows correct precedence and grouping.</p>
</section>
<section id="step-9.-how-to-extend-it" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-how-to-extend-it">Step 9. How to extend it</h4>
<ul>
<li>Add unary <code>+</code> and unary <code>-</code> in <code>parse_factor</code>.</li>
<li>Support integers in hex and underscores like <code>1_000</code>.</li>
<li>Add power operator <code>^</code> with higher precedence.</li>
<li>Record source spans on each node for better error messages.</li>
<li>Swap the pretty printer for a JSON dump of the AST.</li>
</ul>
</section>
<section id="step-10.-why-this-matters" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-why-this-matters">Step 10. Why this matters</h4>
<p>Parsing transforms bytes into meaning. With a tokenizer, a clean grammar, and a small AST, you can build:</p>
<ul>
<li>Expression evaluators</li>
<li>Config file readers</li>
<li>Query languages</li>
<li>Full interpreters</li>
</ul>
<p>In the next section you will use this AST to build a <strong>tiny interpreter</strong> that evaluates expressions at runtime.</p>
</section>
</section>
<section id="tiny-interpreter-for-an-expression-language" class="level3">
<h3 class="anchored" data-anchor-id="tiny-interpreter-for-an-expression-language">97. Tiny Interpreter for an Expression Language</h3>
<p>You already built a tokenizer, parser, and AST. Now you will <strong>evaluate</strong> that AST so <code>3 + 4*2 - (1 + 5)</code> produces <code>5</code> at runtime. We will add a tiny environment for variables, a few built in functions, and a simple REPL.</p>
<section id="step-1.-evaluation-model" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-evaluation-model">Step 1. Evaluation model</h4>
<p>We will walk the AST recursively:</p>
<ul>
<li><code>N_INT</code> returns its value</li>
<li><code>N_ADD</code> returns <code>eval(left) + eval(right)</code></li>
<li><code>N_SUB</code>, <code>N_MUL</code>, <code>N_DIV</code> similar, with divide by zero checks</li>
</ul>
<p>Keep everything in <code>long</code> for now. You can switch to <code>double</code> later if you want decimals.</p>
</section>
<section id="step-2.-variables-and-assignments" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-variables-and-assignments">Step 2. Variables and assignments</h4>
<p>Extend the grammar slightly:</p>
<pre><code>stmt   -&gt; IDENT '=' expr | expr
expr   -&gt; term (('+' | '-') term)*
term   -&gt; factor (('*' | '/') factor)*
factor -&gt; INT | IDENT | '(' expr ')'</code></pre>
<ul>
<li>If input contains <code>x = 10</code>, store <code>x -&gt; 10</code> in the environment</li>
<li>If input contains <code>x + 2</code>, look up <code>x</code> then evaluate</li>
</ul>
</section>
<section id="step-3.-environment" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-environment">Step 3. Environment</h4>
<p>Use a tiny linear table for clarity:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1196"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1196-1"><a href="#cb1196-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span> <span class="dt">long</span> value<span class="op">;</span> <span class="op">}</span> Binding<span class="op">;</span></span>
<span id="cb1196-2"><a href="#cb1196-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1196-3"><a href="#cb1196-3" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb1196-4"><a href="#cb1196-4" aria-hidden="true" tabindex="-1"></a>    Binding <span class="op">*</span>items<span class="op">;</span></span>
<span id="cb1196-5"><a href="#cb1196-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span>   count<span class="op">,</span> cap<span class="op">;</span></span>
<span id="cb1196-6"><a href="#cb1196-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Env<span class="op">;</span></span>
<span id="cb1196-7"><a href="#cb1196-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1196-8"><a href="#cb1196-8" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">long</span> <span class="op">*</span>env_get<span class="op">(</span>Env <span class="op">*</span>E<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1196-9"><a href="#cb1196-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> E<span class="op">-&gt;</span>count<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb1196-10"><a href="#cb1196-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>E<span class="op">-&gt;</span>items<span class="op">[</span>i<span class="op">].</span>name<span class="op">,</span> name<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="op">&amp;</span>E<span class="op">-&gt;</span>items<span class="op">[</span>i<span class="op">].</span>value<span class="op">;</span></span>
<span id="cb1196-11"><a href="#cb1196-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1196-12"><a href="#cb1196-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1196-13"><a href="#cb1196-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1196-14"><a href="#cb1196-14" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">int</span> env_set<span class="op">(</span>Env <span class="op">*</span>E<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">,</span> <span class="dt">long</span> v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1196-15"><a href="#cb1196-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> <span class="op">*</span>p <span class="op">=</span> env_get<span class="op">(</span>E<span class="op">,</span> name<span class="op">);</span></span>
<span id="cb1196-16"><a href="#cb1196-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>p<span class="op">)</span> <span class="op">{</span> <span class="op">*</span>p <span class="op">=</span> v<span class="op">;</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1196-17"><a href="#cb1196-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>E<span class="op">-&gt;</span>count <span class="op">==</span> E<span class="op">-&gt;</span>cap<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1196-18"><a href="#cb1196-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> ncap <span class="op">=</span> E<span class="op">-&gt;</span>cap <span class="op">?</span> E<span class="op">-&gt;</span>cap <span class="op">*</span> <span class="dv">2</span> <span class="op">:</span> <span class="dv">16</span><span class="op">;</span></span>
<span id="cb1196-19"><a href="#cb1196-19" aria-hidden="true" tabindex="-1"></a>        Binding <span class="op">*</span>n <span class="op">=</span> realloc<span class="op">(</span>E<span class="op">-&gt;</span>items<span class="op">,</span> ncap <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(*</span>n<span class="op">));</span></span>
<span id="cb1196-20"><a href="#cb1196-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>n<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1196-21"><a href="#cb1196-21" aria-hidden="true" tabindex="-1"></a>        E<span class="op">-&gt;</span>items <span class="op">=</span> n<span class="op">;</span> E<span class="op">-&gt;</span>cap <span class="op">=</span> ncap<span class="op">;</span></span>
<span id="cb1196-22"><a href="#cb1196-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1196-23"><a href="#cb1196-23" aria-hidden="true" tabindex="-1"></a>    E<span class="op">-&gt;</span>items<span class="op">[</span>E<span class="op">-&gt;</span>count<span class="op">++]</span> <span class="op">=</span> <span class="op">(</span>Binding<span class="op">){</span> strdup<span class="op">(</span>name<span class="op">),</span> v <span class="op">};</span></span>
<span id="cb1196-24"><a href="#cb1196-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1196-25"><a href="#cb1196-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This is not the fastest map, but it is simple and good for a tiny interpreter.</p>
</section>
<section id="step-4.-extend-tokens-for-identifiers-and-equals" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-extend-tokens-for-identifiers-and-equals">Step 4. Extend tokens for identifiers and equals</h4>
<p>Add two kinds:</p>
<ul>
<li><code>TOK_IDENT</code> for variable names</li>
<li><code>TOK_EQ</code> for <code>=</code></li>
</ul>
<p>Identifier rule: start with letter or <code>_</code>, continue with letter, digit, <code>_</code>.</p>
</section>
<section id="step-5.-ast-nodes-for-identifiers-and-assignment" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-ast-nodes-for-identifiers-and-assignment">Step 5. AST nodes for identifiers and assignment</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1197"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1197-1"><a href="#cb1197-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">enum</span> <span class="op">{</span> N_INT<span class="op">,</span> N_ADD<span class="op">,</span> N_SUB<span class="op">,</span> N_MUL<span class="op">,</span> N_DIV<span class="op">,</span> N_IDENT<span class="op">,</span> N_ASSIGN <span class="op">}</span> NodeKind<span class="op">;</span></span>
<span id="cb1197-2"><a href="#cb1197-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1197-3"><a href="#cb1197-3" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span></span>
<span id="cb1197-4"><a href="#cb1197-4" aria-hidden="true" tabindex="-1"></a>    NodeKind kind<span class="op">;</span></span>
<span id="cb1197-5"><a href="#cb1197-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Node <span class="op">*</span>l<span class="op">,</span> <span class="op">*</span>r<span class="op">;</span>  <span class="co">// for binary ops and assignment</span></span>
<span id="cb1197-6"><a href="#cb1197-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> value<span class="op">;</span>          <span class="co">// for integers</span></span>
<span id="cb1197-7"><a href="#cb1197-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span>    <span class="co">// for identifiers</span></span>
<span id="cb1197-8"><a href="#cb1197-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Node<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><code>N_IDENT</code> uses <code>name</code></li>
<li><code>N_ASSIGN</code> uses <code>l</code> as name node and <code>r</code> as expression node</li>
</ul>
</section>
<section id="step-6.-parser-changes" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-parser-changes">Step 6. Parser changes</h4>
<ul>
<li><p>In <code>factor</code>, if token is <code>IDENT</code>, return <code>N_IDENT</code></p></li>
<li><p>Add <code>parse_stmt</code>:</p>
<ul>
<li>If lookahead is <code>IDENT</code> then <code>=</code> then parse <code>expr</code> and build <code>N_ASSIGN</code></li>
<li>Else parse <code>expr</code></li>
</ul></li>
</ul>
</section>
<section id="step-7.-tiny-code-evaluator-minimal-repl" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-tiny-code-evaluator-minimal-repl">Step 7. Tiny Code: evaluator + minimal REPL</h4>
<p>Below is a compact interpreter that builds on the earlier parser. For brevity, the lexer and arena are trimmed to only the new bits you need here.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1198"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1198-1"><a href="#cb1198-1" aria-hidden="true" tabindex="-1"></a><span class="co">// file: tiny_interp.c</span></span>
<span id="cb1198-2"><a href="#cb1198-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define _POSIX_C_SOURCE </span><span class="dv">200809</span><span class="bu">L</span></span>
<span id="cb1198-3"><a href="#cb1198-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1198-4"><a href="#cb1198-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb1198-5"><a href="#cb1198-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;ctype.h&gt;</span></span>
<span id="cb1198-6"><a href="#cb1198-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb1198-7"><a href="#cb1198-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-8"><a href="#cb1198-8" aria-hidden="true" tabindex="-1"></a><span class="co">/* ----- tiny arena ----- */</span></span>
<span id="cb1198-9"><a href="#cb1198-9" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>base<span class="op">;</span> <span class="dt">size_t</span> cap<span class="op">,</span> off<span class="op">;</span> <span class="op">}</span> Arena<span class="op">;</span></span>
<span id="cb1198-10"><a href="#cb1198-10" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Arena <span class="op">*</span>arena_new<span class="op">(</span><span class="dt">size_t</span> cap<span class="op">){</span> Arena<span class="op">*</span>a<span class="op">=</span>malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(*</span>a<span class="op">));</span> <span class="cf">if</span><span class="op">(!</span>a<span class="op">)</span><span class="cf">return</span> NULL<span class="op">;</span> a<span class="op">-&gt;</span>base<span class="op">=</span>malloc<span class="op">(</span>cap<span class="op">);</span> <span class="cf">if</span><span class="op">(!</span>a<span class="op">-&gt;</span>base<span class="op">){</span>free<span class="op">(</span>a<span class="op">);</span><span class="cf">return</span> NULL<span class="op">;}</span> a<span class="op">-&gt;</span>cap<span class="op">=</span>cap<span class="op">;</span> a<span class="op">-&gt;</span>off<span class="op">=</span><span class="dv">0</span><span class="op">;</span> <span class="cf">return</span> a<span class="op">;}</span></span>
<span id="cb1198-11"><a href="#cb1198-11" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> <span class="op">*</span>arena_alloc<span class="op">(</span>Arena<span class="op">*</span>a<span class="op">,</span><span class="dt">size_t</span> n<span class="op">,</span><span class="dt">size_t</span> al<span class="op">){</span> <span class="dt">size_t</span> p<span class="op">=(</span>a<span class="op">-&gt;</span>off<span class="op">+(</span>al<span class="op">-</span><span class="dv">1</span><span class="op">))&amp;~(</span>al<span class="op">-</span><span class="dv">1</span><span class="op">);</span> <span class="cf">if</span><span class="op">(</span>p<span class="op">+</span>n<span class="op">&gt;</span>a<span class="op">-&gt;</span>cap<span class="op">)</span><span class="cf">return</span> NULL<span class="op">;</span> <span class="dt">void</span><span class="op">*</span>ptr<span class="op">=</span>a<span class="op">-&gt;</span>base<span class="op">+</span>p<span class="op">;</span> a<span class="op">-&gt;</span>off<span class="op">=</span>p<span class="op">+</span>n<span class="op">;</span> <span class="cf">return</span> ptr<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1198-12"><a href="#cb1198-12" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> arena_free<span class="op">(</span>Arena<span class="op">*</span>a<span class="op">){</span> <span class="cf">if</span><span class="op">(!</span>a<span class="op">)</span><span class="cf">return</span><span class="op">;</span> free<span class="op">(</span>a<span class="op">-&gt;</span>base<span class="op">);</span> free<span class="op">(</span>a<span class="op">);</span> <span class="op">}</span></span>
<span id="cb1198-13"><a href="#cb1198-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-14"><a href="#cb1198-14" aria-hidden="true" tabindex="-1"></a><span class="co">/* ----- tokens ----- */</span></span>
<span id="cb1198-15"><a href="#cb1198-15" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">enum</span> <span class="op">{</span> TOK_INT<span class="op">,</span> TOK_PLUS<span class="op">,</span> TOK_MINUS<span class="op">,</span> TOK_STAR<span class="op">,</span> TOK_SLASH<span class="op">,</span></span>
<span id="cb1198-16"><a href="#cb1198-16" aria-hidden="true" tabindex="-1"></a>               TOK_LPAREN<span class="op">,</span> TOK_RPAREN<span class="op">,</span> TOK_IDENT<span class="op">,</span> TOK_EQ<span class="op">,</span> TOK_EOF<span class="op">,</span> TOK_ERR <span class="op">}</span> TokKind<span class="op">;</span></span>
<span id="cb1198-17"><a href="#cb1198-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-18"><a href="#cb1198-18" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span> TokKind kind<span class="op">;</span> <span class="dt">long</span> ival<span class="op">;</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>s<span class="op">,*</span>e<span class="op">;</span> <span class="dt">char</span> <span class="op">*</span>lexeme<span class="op">;</span> <span class="op">}</span> Token<span class="op">;</span></span>
<span id="cb1198-19"><a href="#cb1198-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-20"><a href="#cb1198-20" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>src<span class="op">,*</span>cur<span class="op">;</span> Token look<span class="op">;</span> <span class="op">}</span> Lexer<span class="op">;</span></span>
<span id="cb1198-21"><a href="#cb1198-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-22"><a href="#cb1198-22" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> skip_ws<span class="op">(</span>Lexer<span class="op">*</span>L<span class="op">){</span> <span class="cf">while</span><span class="op">(</span>isspace<span class="op">((</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)*</span>L<span class="op">-&gt;</span>cur<span class="op">))</span> L<span class="op">-&gt;</span>cur<span class="op">++;</span> <span class="op">}</span></span>
<span id="cb1198-23"><a href="#cb1198-23" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Token make_tok<span class="op">(</span>TokKind k<span class="op">,</span><span class="dt">const</span> <span class="dt">char</span><span class="op">*</span>s<span class="op">,</span><span class="dt">const</span> <span class="dt">char</span><span class="op">*</span>e<span class="op">,</span><span class="dt">long</span> v<span class="op">,</span><span class="dt">char</span><span class="op">*</span>lex<span class="op">){</span> <span class="cf">return</span> <span class="op">(</span>Token<span class="op">){</span>k<span class="op">,</span>v<span class="op">,</span>s<span class="op">,</span>e<span class="op">,</span>lex<span class="op">};</span> <span class="op">}</span></span>
<span id="cb1198-24"><a href="#cb1198-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-25"><a href="#cb1198-25" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Token next_raw<span class="op">(</span>Lexer<span class="op">*</span>L<span class="op">){</span></span>
<span id="cb1198-26"><a href="#cb1198-26" aria-hidden="true" tabindex="-1"></a>    skip_ws<span class="op">(</span>L<span class="op">);</span> <span class="dt">const</span> <span class="dt">char</span><span class="op">*</span>s<span class="op">=</span>L<span class="op">-&gt;</span>cur<span class="op">;</span> <span class="cf">if</span><span class="op">(*</span>L<span class="op">-&gt;</span>cur<span class="op">==</span><span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> make_tok<span class="op">(</span>TOK_EOF<span class="op">,</span>s<span class="op">,</span>s<span class="op">,</span><span class="dv">0</span><span class="op">,</span>NULL<span class="op">);</span></span>
<span id="cb1198-27"><a href="#cb1198-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> c<span class="op">=*</span>L<span class="op">-&gt;</span>cur<span class="op">++;</span></span>
<span id="cb1198-28"><a href="#cb1198-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>c<span class="op">==</span><span class="ch">'+'</span><span class="op">)</span> <span class="cf">return</span> make_tok<span class="op">(</span>TOK_PLUS<span class="op">,</span> s<span class="op">,</span>L<span class="op">-&gt;</span>cur<span class="op">,</span><span class="dv">0</span><span class="op">,</span>NULL<span class="op">);</span></span>
<span id="cb1198-29"><a href="#cb1198-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>c<span class="op">==</span><span class="ch">'-'</span><span class="op">)</span> <span class="cf">return</span> make_tok<span class="op">(</span>TOK_MINUS<span class="op">,</span>s<span class="op">,</span>L<span class="op">-&gt;</span>cur<span class="op">,</span><span class="dv">0</span><span class="op">,</span>NULL<span class="op">);</span></span>
<span id="cb1198-30"><a href="#cb1198-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>c<span class="op">==</span><span class="ch">'*'</span><span class="op">)</span> <span class="cf">return</span> make_tok<span class="op">(</span>TOK_STAR<span class="op">,</span> s<span class="op">,</span>L<span class="op">-&gt;</span>cur<span class="op">,</span><span class="dv">0</span><span class="op">,</span>NULL<span class="op">);</span></span>
<span id="cb1198-31"><a href="#cb1198-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>c<span class="op">==</span><span class="ch">'/'</span><span class="op">)</span> <span class="cf">return</span> make_tok<span class="op">(</span>TOK_SLASH<span class="op">,</span>s<span class="op">,</span>L<span class="op">-&gt;</span>cur<span class="op">,</span><span class="dv">0</span><span class="op">,</span>NULL<span class="op">);</span></span>
<span id="cb1198-32"><a href="#cb1198-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>c<span class="op">==</span><span class="ch">'('</span><span class="op">)</span> <span class="cf">return</span> make_tok<span class="op">(</span>TOK_LPAREN<span class="op">,</span>s<span class="op">,</span>L<span class="op">-&gt;</span>cur<span class="op">,</span><span class="dv">0</span><span class="op">,</span>NULL<span class="op">);</span></span>
<span id="cb1198-33"><a href="#cb1198-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>c<span class="op">==</span><span class="ch">')'</span><span class="op">)</span> <span class="cf">return</span> make_tok<span class="op">(</span>TOK_RPAREN<span class="op">,</span>s<span class="op">,</span>L<span class="op">-&gt;</span>cur<span class="op">,</span><span class="dv">0</span><span class="op">,</span>NULL<span class="op">);</span></span>
<span id="cb1198-34"><a href="#cb1198-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>c<span class="op">==</span><span class="ch">'='</span><span class="op">)</span> <span class="cf">return</span> make_tok<span class="op">(</span>TOK_EQ<span class="op">,</span>    s<span class="op">,</span>L<span class="op">-&gt;</span>cur<span class="op">,</span><span class="dv">0</span><span class="op">,</span>NULL<span class="op">);</span></span>
<span id="cb1198-35"><a href="#cb1198-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>isdigit<span class="op">((</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)</span>c<span class="op">))</span> <span class="op">{</span></span>
<span id="cb1198-36"><a href="#cb1198-36" aria-hidden="true" tabindex="-1"></a>        <span class="dt">long</span> v <span class="op">=</span> c <span class="op">-</span> <span class="ch">'0'</span><span class="op">;</span> <span class="dt">const</span> <span class="dt">char</span><span class="op">*</span>p<span class="op">=</span>L<span class="op">-&gt;</span>cur<span class="op">;</span></span>
<span id="cb1198-37"><a href="#cb1198-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span>isdigit<span class="op">((</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)*</span>p<span class="op">))</span> <span class="op">{</span> v <span class="op">=</span> v<span class="op">*</span><span class="dv">10</span> <span class="op">+</span> <span class="op">(*</span>p <span class="op">-</span> <span class="ch">'0'</span><span class="op">);</span> p<span class="op">++;</span> <span class="op">}</span></span>
<span id="cb1198-38"><a href="#cb1198-38" aria-hidden="true" tabindex="-1"></a>        L<span class="op">-&gt;</span>cur <span class="op">=</span> p<span class="op">;</span> <span class="cf">return</span> make_tok<span class="op">(</span>TOK_INT<span class="op">,</span> s<span class="op">,</span>p<span class="op">,</span>v<span class="op">,</span>NULL<span class="op">);</span></span>
<span id="cb1198-39"><a href="#cb1198-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1198-40"><a href="#cb1198-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>isalpha<span class="op">((</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)</span>c<span class="op">)</span> <span class="op">||</span> c<span class="op">==</span><span class="ch">'_'</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1198-41"><a href="#cb1198-41" aria-hidden="true" tabindex="-1"></a>        <span class="dt">const</span> <span class="dt">char</span><span class="op">*</span>p<span class="op">=</span>L<span class="op">-&gt;</span>cur<span class="op">;</span> <span class="cf">while</span> <span class="op">(</span>isalnum<span class="op">((</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">)*</span>p<span class="op">)</span> <span class="op">||</span> <span class="op">*</span>p<span class="op">==</span><span class="ch">'_'</span><span class="op">)</span> p<span class="op">++;</span></span>
<span id="cb1198-42"><a href="#cb1198-42" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> n <span class="op">=</span> <span class="op">(</span><span class="dt">size_t</span><span class="op">)(</span>p <span class="op">-</span> <span class="op">(</span>L<span class="op">-&gt;</span>cur<span class="op">-</span><span class="dv">1</span><span class="op">));</span> <span class="co">// include first char</span></span>
<span id="cb1198-43"><a href="#cb1198-43" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> <span class="op">*</span>lex <span class="op">=</span> malloc<span class="op">(</span>n<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb1198-44"><a href="#cb1198-44" aria-hidden="true" tabindex="-1"></a>        memcpy<span class="op">(</span>lex<span class="op">,</span> s<span class="op">,</span> n<span class="op">);</span> lex<span class="op">[</span>n<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1198-45"><a href="#cb1198-45" aria-hidden="true" tabindex="-1"></a>        L<span class="op">-&gt;</span>cur <span class="op">=</span> p<span class="op">;</span> <span class="cf">return</span> make_tok<span class="op">(</span>TOK_IDENT<span class="op">,</span>s<span class="op">,</span>p<span class="op">,</span><span class="dv">0</span><span class="op">,</span>lex<span class="op">);</span></span>
<span id="cb1198-46"><a href="#cb1198-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1198-47"><a href="#cb1198-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> make_tok<span class="op">(</span>TOK_ERR<span class="op">,</span> s<span class="op">,</span>L<span class="op">-&gt;</span>cur<span class="op">,</span><span class="dv">0</span><span class="op">,</span>NULL<span class="op">);</span></span>
<span id="cb1198-48"><a href="#cb1198-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1198-49"><a href="#cb1198-49" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> lex_init<span class="op">(</span>Lexer<span class="op">*</span>L<span class="op">,</span><span class="dt">const</span> <span class="dt">char</span><span class="op">*</span>src<span class="op">){</span> L<span class="op">-&gt;</span>src<span class="op">=</span>src<span class="op">;</span> L<span class="op">-&gt;</span>cur<span class="op">=</span>src<span class="op">;</span> L<span class="op">-&gt;</span>look<span class="op">=</span>next_raw<span class="op">(</span>L<span class="op">);</span> <span class="op">}</span></span>
<span id="cb1198-50"><a href="#cb1198-50" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Token peek<span class="op">(</span>Lexer<span class="op">*</span>L<span class="op">){</span> <span class="cf">return</span> L<span class="op">-&gt;</span>look<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1198-51"><a href="#cb1198-51" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Token take<span class="op">(</span>Lexer<span class="op">*</span>L<span class="op">){</span> Token t<span class="op">=</span>L<span class="op">-&gt;</span>look<span class="op">;</span> L<span class="op">-&gt;</span>look<span class="op">=</span>next_raw<span class="op">(</span>L<span class="op">);</span> <span class="cf">return</span> t<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1198-52"><a href="#cb1198-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-53"><a href="#cb1198-53" aria-hidden="true" tabindex="-1"></a><span class="co">/* ----- AST ----- */</span></span>
<span id="cb1198-54"><a href="#cb1198-54" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">enum</span> <span class="op">{</span> N_INT<span class="op">,</span> N_ADD<span class="op">,</span> N_SUB<span class="op">,</span> N_MUL<span class="op">,</span> N_DIV<span class="op">,</span> N_IDENT<span class="op">,</span> N_ASSIGN <span class="op">}</span> NodeKind<span class="op">;</span></span>
<span id="cb1198-55"><a href="#cb1198-55" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> Node <span class="op">{</span> NodeKind k<span class="op">;</span> <span class="kw">struct</span> Node <span class="op">*</span>l<span class="op">,*</span>r<span class="op">;</span> <span class="dt">long</span> v<span class="op">;</span> <span class="dt">const</span> <span class="dt">char</span><span class="op">*</span>name<span class="op">;</span> <span class="op">}</span> Node<span class="op">;</span></span>
<span id="cb1198-56"><a href="#cb1198-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-57"><a href="#cb1198-57" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Node<span class="op">*</span> new_int<span class="op">(</span>Arena<span class="op">*</span>A<span class="op">,</span><span class="dt">long</span> v<span class="op">){</span> Node<span class="op">*</span>n<span class="op">=</span>arena_alloc<span class="op">(</span>A<span class="op">,</span><span class="kw">sizeof</span><span class="op">(*</span>n<span class="op">),</span><span class="kw">_Alignof</span><span class="op">(</span>Node<span class="op">));</span> <span class="cf">if</span><span class="op">(!</span>n<span class="op">)</span><span class="cf">return</span> NULL<span class="op">;</span> n<span class="op">-&gt;</span>k<span class="op">=</span>N_INT<span class="op">;</span> n<span class="op">-&gt;</span>l<span class="op">=</span>n<span class="op">-&gt;</span>r<span class="op">=</span>NULL<span class="op">;</span> n<span class="op">-&gt;</span>v<span class="op">=</span>v<span class="op">;</span> n<span class="op">-&gt;</span>name<span class="op">=</span>NULL<span class="op">;</span> <span class="cf">return</span> n<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1198-58"><a href="#cb1198-58" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Node<span class="op">*</span> new_ident<span class="op">(</span>Arena<span class="op">*</span>A<span class="op">,</span><span class="dt">const</span> <span class="dt">char</span><span class="op">*</span>name<span class="op">){</span> Node<span class="op">*</span>n<span class="op">=</span>arena_alloc<span class="op">(</span>A<span class="op">,</span><span class="kw">sizeof</span><span class="op">(*</span>n<span class="op">),</span><span class="kw">_Alignof</span><span class="op">(</span>Node<span class="op">));</span> <span class="cf">if</span><span class="op">(!</span>n<span class="op">)</span><span class="cf">return</span> NULL<span class="op">;</span> n<span class="op">-&gt;</span>k<span class="op">=</span>N_IDENT<span class="op">;</span> n<span class="op">-&gt;</span>l<span class="op">=</span>n<span class="op">-&gt;</span>r<span class="op">=</span>NULL<span class="op">;</span> n<span class="op">-&gt;</span>v<span class="op">=</span><span class="dv">0</span><span class="op">;</span> n<span class="op">-&gt;</span>name<span class="op">=</span>name<span class="op">;</span> <span class="cf">return</span> n<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1198-59"><a href="#cb1198-59" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Node<span class="op">*</span> new_bin<span class="op">(</span>Arena<span class="op">*</span>A<span class="op">,</span>NodeKind k<span class="op">,</span>Node<span class="op">*</span>l<span class="op">,</span>Node<span class="op">*</span>r<span class="op">){</span> Node<span class="op">*</span>n<span class="op">=</span>arena_alloc<span class="op">(</span>A<span class="op">,</span><span class="kw">sizeof</span><span class="op">(*</span>n<span class="op">),</span><span class="kw">_Alignof</span><span class="op">(</span>Node<span class="op">));</span> <span class="cf">if</span><span class="op">(!</span>n<span class="op">)</span><span class="cf">return</span> NULL<span class="op">;</span> n<span class="op">-&gt;</span>k<span class="op">=</span>k<span class="op">;</span> n<span class="op">-&gt;</span>l<span class="op">=</span>l<span class="op">;</span> n<span class="op">-&gt;</span>r<span class="op">=</span>r<span class="op">;</span> n<span class="op">-&gt;</span>v<span class="op">=</span><span class="dv">0</span><span class="op">;</span> n<span class="op">-&gt;</span>name<span class="op">=</span>NULL<span class="op">;</span> <span class="cf">return</span> n<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1198-60"><a href="#cb1198-60" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Node<span class="op">*</span> new_assign<span class="op">(</span>Arena<span class="op">*</span>A<span class="op">,</span>Node<span class="op">*</span>name<span class="op">,</span>Node<span class="op">*</span>expr<span class="op">){</span> Node<span class="op">*</span>n<span class="op">=</span>arena_alloc<span class="op">(</span>A<span class="op">,</span><span class="kw">sizeof</span><span class="op">(*</span>n<span class="op">),</span><span class="kw">_Alignof</span><span class="op">(</span>Node<span class="op">));</span> <span class="cf">if</span><span class="op">(!</span>n<span class="op">)</span><span class="cf">return</span> NULL<span class="op">;</span> n<span class="op">-&gt;</span>k<span class="op">=</span>N_ASSIGN<span class="op">;</span> n<span class="op">-&gt;</span>l<span class="op">=</span>name<span class="op">;</span> n<span class="op">-&gt;</span>r<span class="op">=</span>expr<span class="op">;</span> n<span class="op">-&gt;</span>v<span class="op">=</span><span class="dv">0</span><span class="op">;</span> n<span class="op">-&gt;</span>name<span class="op">=</span>NULL<span class="op">;</span> <span class="cf">return</span> n<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1198-61"><a href="#cb1198-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-62"><a href="#cb1198-62" aria-hidden="true" tabindex="-1"></a><span class="co">/* ----- parser ----- */</span></span>
<span id="cb1198-63"><a href="#cb1198-63" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span> Lexer<span class="op">*</span>L<span class="op">;</span> Arena<span class="op">*</span>A<span class="op">;</span> <span class="dt">int</span> ok<span class="op">;</span> <span class="op">}</span> Parser<span class="op">;</span></span>
<span id="cb1198-64"><a href="#cb1198-64" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> fail<span class="op">(</span>Parser<span class="op">*</span>P<span class="op">,</span><span class="dt">const</span> <span class="dt">char</span><span class="op">*</span>msg<span class="op">,</span>Token t<span class="op">){</span> P<span class="op">-&gt;</span>ok<span class="op">=</span><span class="dv">0</span><span class="op">;</span> <span class="dt">size_t</span> pos<span class="op">=(</span><span class="dt">size_t</span><span class="op">)(</span>t<span class="op">.</span>s <span class="op">-</span> P<span class="op">-&gt;</span>L<span class="op">-&gt;</span>src<span class="op">);</span> fprintf<span class="op">(</span>stderr<span class="op">,</span><span class="st">"Parse error at </span><span class="sc">%zu</span><span class="st">: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> pos<span class="op">,</span> msg<span class="op">);</span> <span class="op">}</span></span>
<span id="cb1198-65"><a href="#cb1198-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-66"><a href="#cb1198-66" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Node<span class="op">*</span> parse_expr<span class="op">(</span>Parser<span class="op">*</span>P<span class="op">);</span> <span class="co">// forward</span></span>
<span id="cb1198-67"><a href="#cb1198-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-68"><a href="#cb1198-68" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Node<span class="op">*</span> parse_factor<span class="op">(</span>Parser<span class="op">*</span>P<span class="op">){</span></span>
<span id="cb1198-69"><a href="#cb1198-69" aria-hidden="true" tabindex="-1"></a>    Token t <span class="op">=</span> peek<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">);</span></span>
<span id="cb1198-70"><a href="#cb1198-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>t<span class="op">.</span>kind<span class="op">==</span>TOK_INT<span class="op">){</span> take<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">);</span> <span class="cf">return</span> new_int<span class="op">(</span>P<span class="op">-&gt;</span>A<span class="op">,</span> t<span class="op">.</span>ival<span class="op">);</span> <span class="op">}</span></span>
<span id="cb1198-71"><a href="#cb1198-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>t<span class="op">.</span>kind<span class="op">==</span>TOK_IDENT<span class="op">){</span> take<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">);</span> <span class="cf">return</span> new_ident<span class="op">(</span>P<span class="op">-&gt;</span>A<span class="op">,</span> t<span class="op">.</span>lexeme<span class="op">);</span> <span class="op">}</span></span>
<span id="cb1198-72"><a href="#cb1198-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>t<span class="op">.</span>kind<span class="op">==</span>TOK_LPAREN<span class="op">){</span> take<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">);</span> Node<span class="op">*</span>e<span class="op">=</span>parse_expr<span class="op">(</span>P<span class="op">);</span> <span class="cf">if</span><span class="op">(</span>peek<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">).</span>kind<span class="op">!=</span>TOK_RPAREN<span class="op">){</span> fail<span class="op">(</span>P<span class="op">,</span><span class="st">"expected ')'"</span><span class="op">,</span>peek<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">));</span> <span class="cf">return</span> NULL<span class="op">;}</span> take<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">);</span> <span class="cf">return</span> e<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1198-73"><a href="#cb1198-73" aria-hidden="true" tabindex="-1"></a>    fail<span class="op">(</span>P<span class="op">,</span><span class="st">"expected number, name, or '('"</span><span class="op">,</span> t<span class="op">);</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1198-74"><a href="#cb1198-74" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1198-75"><a href="#cb1198-75" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Node<span class="op">*</span> parse_term<span class="op">(</span>Parser<span class="op">*</span>P<span class="op">){</span></span>
<span id="cb1198-76"><a href="#cb1198-76" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span>n<span class="op">=</span>parse_factor<span class="op">(</span>P<span class="op">);</span></span>
<span id="cb1198-77"><a href="#cb1198-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span><span class="op">(</span>P<span class="op">-&gt;</span>ok<span class="op">){</span></span>
<span id="cb1198-78"><a href="#cb1198-78" aria-hidden="true" tabindex="-1"></a>        TokKind k <span class="op">=</span> peek<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">).</span>kind<span class="op">;</span></span>
<span id="cb1198-79"><a href="#cb1198-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>k<span class="op">!=</span>TOK_STAR <span class="op">&amp;&amp;</span> k<span class="op">!=</span>TOK_SLASH<span class="op">)</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1198-80"><a href="#cb1198-80" aria-hidden="true" tabindex="-1"></a>        take<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">);</span></span>
<span id="cb1198-81"><a href="#cb1198-81" aria-hidden="true" tabindex="-1"></a>        Node<span class="op">*</span>r<span class="op">=</span>parse_factor<span class="op">(</span>P<span class="op">);</span> <span class="cf">if</span><span class="op">(!</span>r<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1198-82"><a href="#cb1198-82" aria-hidden="true" tabindex="-1"></a>        n<span class="op">=</span>new_bin<span class="op">(</span>P<span class="op">-&gt;</span>A<span class="op">,</span> k<span class="op">==</span>TOK_STAR<span class="op">?</span>N_MUL<span class="op">:</span>N_DIV<span class="op">,</span> n<span class="op">,</span> r<span class="op">);</span></span>
<span id="cb1198-83"><a href="#cb1198-83" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1198-84"><a href="#cb1198-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb1198-85"><a href="#cb1198-85" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1198-86"><a href="#cb1198-86" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Node<span class="op">*</span> parse_expr<span class="op">(</span>Parser<span class="op">*</span>P<span class="op">){</span></span>
<span id="cb1198-87"><a href="#cb1198-87" aria-hidden="true" tabindex="-1"></a>    Node<span class="op">*</span>n<span class="op">=</span>parse_term<span class="op">(</span>P<span class="op">);</span></span>
<span id="cb1198-88"><a href="#cb1198-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span><span class="op">(</span>P<span class="op">-&gt;</span>ok<span class="op">){</span></span>
<span id="cb1198-89"><a href="#cb1198-89" aria-hidden="true" tabindex="-1"></a>        TokKind k <span class="op">=</span> peek<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">).</span>kind<span class="op">;</span></span>
<span id="cb1198-90"><a href="#cb1198-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>k<span class="op">!=</span>TOK_PLUS <span class="op">&amp;&amp;</span> k<span class="op">!=</span>TOK_MINUS<span class="op">)</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1198-91"><a href="#cb1198-91" aria-hidden="true" tabindex="-1"></a>        take<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">);</span></span>
<span id="cb1198-92"><a href="#cb1198-92" aria-hidden="true" tabindex="-1"></a>        Node<span class="op">*</span>r<span class="op">=</span>parse_term<span class="op">(</span>P<span class="op">);</span> <span class="cf">if</span><span class="op">(!</span>r<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1198-93"><a href="#cb1198-93" aria-hidden="true" tabindex="-1"></a>        n<span class="op">=</span>new_bin<span class="op">(</span>P<span class="op">-&gt;</span>A<span class="op">,</span> k<span class="op">==</span>TOK_PLUS<span class="op">?</span>N_ADD<span class="op">:</span>N_SUB<span class="op">,</span> n<span class="op">,</span> r<span class="op">);</span></span>
<span id="cb1198-94"><a href="#cb1198-94" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1198-95"><a href="#cb1198-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb1198-96"><a href="#cb1198-96" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1198-97"><a href="#cb1198-97" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> Node<span class="op">*</span> parse_stmt<span class="op">(</span>Parser<span class="op">*</span>P<span class="op">){</span></span>
<span id="cb1198-98"><a href="#cb1198-98" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>peek<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">).</span>kind<span class="op">==</span>TOK_IDENT<span class="op">){</span></span>
<span id="cb1198-99"><a href="#cb1198-99" aria-hidden="true" tabindex="-1"></a>        <span class="co">// look ahead for '='</span></span>
<span id="cb1198-100"><a href="#cb1198-100" aria-hidden="true" tabindex="-1"></a>        Token save <span class="op">=</span> P<span class="op">-&gt;</span>L<span class="op">-&gt;</span>look<span class="op">;</span></span>
<span id="cb1198-101"><a href="#cb1198-101" aria-hidden="true" tabindex="-1"></a>        Token ident <span class="op">=</span> take<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">);</span></span>
<span id="cb1198-102"><a href="#cb1198-102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>peek<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">).</span>kind<span class="op">==</span>TOK_EQ<span class="op">){</span></span>
<span id="cb1198-103"><a href="#cb1198-103" aria-hidden="true" tabindex="-1"></a>            take<span class="op">(</span>P<span class="op">-&gt;</span>L<span class="op">);</span> <span class="co">// consume '='</span></span>
<span id="cb1198-104"><a href="#cb1198-104" aria-hidden="true" tabindex="-1"></a>            Node<span class="op">*</span>rhs <span class="op">=</span> parse_expr<span class="op">(</span>P<span class="op">);</span></span>
<span id="cb1198-105"><a href="#cb1198-105" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>rhs<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb1198-106"><a href="#cb1198-106" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> new_assign<span class="op">(</span>P<span class="op">-&gt;</span>A<span class="op">,</span> new_ident<span class="op">(</span>P<span class="op">-&gt;</span>A<span class="op">,</span> ident<span class="op">.</span>lexeme<span class="op">),</span> rhs<span class="op">);</span></span>
<span id="cb1198-107"><a href="#cb1198-107" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1198-108"><a href="#cb1198-108" aria-hidden="true" tabindex="-1"></a>        <span class="co">// no '=', rewind</span></span>
<span id="cb1198-109"><a href="#cb1198-109" aria-hidden="true" tabindex="-1"></a>        P<span class="op">-&gt;</span>L<span class="op">-&gt;</span>look <span class="op">=</span> save<span class="op">;</span></span>
<span id="cb1198-110"><a href="#cb1198-110" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1198-111"><a href="#cb1198-111" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> parse_expr<span class="op">(</span>P<span class="op">);</span></span>
<span id="cb1198-112"><a href="#cb1198-112" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1198-113"><a href="#cb1198-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-114"><a href="#cb1198-114" aria-hidden="true" tabindex="-1"></a><span class="co">/* ----- environment ----- */</span></span>
<span id="cb1198-115"><a href="#cb1198-115" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span> <span class="dt">const</span> <span class="dt">char</span><span class="op">*</span>name<span class="op">;</span> <span class="dt">long</span> value<span class="op">;</span> <span class="op">}</span> Binding<span class="op">;</span></span>
<span id="cb1198-116"><a href="#cb1198-116" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span> Binding <span class="op">*</span>items<span class="op">;</span> <span class="dt">size_t</span> count<span class="op">,</span> cap<span class="op">;</span> <span class="op">}</span> Env<span class="op">;</span></span>
<span id="cb1198-117"><a href="#cb1198-117" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">long</span><span class="op">*</span> env_get<span class="op">(</span>Env<span class="op">*</span>E<span class="op">,</span><span class="dt">const</span> <span class="dt">char</span><span class="op">*</span>name<span class="op">){</span> <span class="cf">for</span><span class="op">(</span><span class="dt">size_t</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>E<span class="op">-&gt;</span>count<span class="op">;</span>i<span class="op">++)</span> <span class="cf">if</span><span class="op">(</span>strcmp<span class="op">(</span>E<span class="op">-&gt;</span>items<span class="op">[</span>i<span class="op">].</span>name<span class="op">,</span>name<span class="op">)==</span><span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="op">&amp;</span>E<span class="op">-&gt;</span>items<span class="op">[</span>i<span class="op">].</span>value<span class="op">;</span> <span class="cf">return</span> NULL<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1198-118"><a href="#cb1198-118" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">int</span> env_set<span class="op">(</span>Env<span class="op">*</span>E<span class="op">,</span><span class="dt">const</span> <span class="dt">char</span><span class="op">*</span>name<span class="op">,</span><span class="dt">long</span> v<span class="op">){</span></span>
<span id="cb1198-119"><a href="#cb1198-119" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span><span class="op">*</span>p<span class="op">=</span>env_get<span class="op">(</span>E<span class="op">,</span>name<span class="op">);</span> <span class="cf">if</span><span class="op">(</span>p<span class="op">){*</span>p<span class="op">=</span>v<span class="op">;</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;}</span></span>
<span id="cb1198-120"><a href="#cb1198-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>E<span class="op">-&gt;</span>count<span class="op">==</span>E<span class="op">-&gt;</span>cap<span class="op">){</span> <span class="dt">size_t</span> ncap<span class="op">=</span>E<span class="op">-&gt;</span>cap<span class="op">?</span>E<span class="op">-&gt;</span>cap<span class="op">*</span><span class="dv">2</span><span class="op">:</span><span class="dv">16</span><span class="op">;</span> Binding<span class="op">*</span>n<span class="op">=</span>realloc<span class="op">(</span>E<span class="op">-&gt;</span>items<span class="op">,</span>ncap<span class="op">*</span><span class="kw">sizeof</span><span class="op">(*</span>n<span class="op">));</span> <span class="cf">if</span><span class="op">(!</span>n<span class="op">)</span><span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> E<span class="op">-&gt;</span>items<span class="op">=</span>n<span class="op">;</span> E<span class="op">-&gt;</span>cap<span class="op">=</span>ncap<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1198-121"><a href="#cb1198-121" aria-hidden="true" tabindex="-1"></a>    E<span class="op">-&gt;</span>items<span class="op">[</span>E<span class="op">-&gt;</span>count<span class="op">++]</span> <span class="op">=</span> <span class="op">(</span>Binding<span class="op">){</span> strdup<span class="op">(</span>name<span class="op">),</span> v <span class="op">};</span></span>
<span id="cb1198-122"><a href="#cb1198-122" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1198-123"><a href="#cb1198-123" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1198-124"><a href="#cb1198-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-125"><a href="#cb1198-125" aria-hidden="true" tabindex="-1"></a><span class="co">/* ----- evaluator ----- */</span></span>
<span id="cb1198-126"><a href="#cb1198-126" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">int</span> eval<span class="op">(</span>Node<span class="op">*</span>n<span class="op">,</span> Env<span class="op">*</span>E<span class="op">,</span> <span class="dt">long</span> <span class="op">*</span>out<span class="op">){</span></span>
<span id="cb1198-127"><a href="#cb1198-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(!</span>n<span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1198-128"><a href="#cb1198-128" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span><span class="op">(</span>n<span class="op">-&gt;</span>k<span class="op">){</span></span>
<span id="cb1198-129"><a href="#cb1198-129" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> N_INT<span class="op">:</span> <span class="op">*</span>out <span class="op">=</span> n<span class="op">-&gt;</span>v<span class="op">;</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1198-130"><a href="#cb1198-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> N_IDENT<span class="op">:</span> <span class="op">{</span></span>
<span id="cb1198-131"><a href="#cb1198-131" aria-hidden="true" tabindex="-1"></a>            <span class="dt">long</span> <span class="op">*</span>p <span class="op">=</span> env_get<span class="op">(</span>E<span class="op">,</span> n<span class="op">-&gt;</span>name<span class="op">);</span></span>
<span id="cb1198-132"><a href="#cb1198-132" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span><span class="op">(!</span>p<span class="op">){</span> fprintf<span class="op">(</span>stderr<span class="op">,</span><span class="st">"Name not found: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> n<span class="op">-&gt;</span>name<span class="op">);</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1198-133"><a href="#cb1198-133" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>out <span class="op">=</span> <span class="op">*</span>p<span class="op">;</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1198-134"><a href="#cb1198-134" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1198-135"><a href="#cb1198-135" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> N_ADD<span class="op">:</span> <span class="op">{</span> <span class="dt">long</span> a<span class="op">,</span>b<span class="op">;</span> <span class="cf">if</span><span class="op">(!</span>eval<span class="op">(</span>n<span class="op">-&gt;</span>l<span class="op">,</span>E<span class="op">,&amp;</span>a<span class="op">)||!</span>eval<span class="op">(</span>n<span class="op">-&gt;</span>r<span class="op">,</span>E<span class="op">,&amp;</span>b<span class="op">))</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="op">*</span>out<span class="op">=</span>a<span class="op">+</span>b<span class="op">;</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1198-136"><a href="#cb1198-136" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> N_SUB<span class="op">:</span> <span class="op">{</span> <span class="dt">long</span> a<span class="op">,</span>b<span class="op">;</span> <span class="cf">if</span><span class="op">(!</span>eval<span class="op">(</span>n<span class="op">-&gt;</span>l<span class="op">,</span>E<span class="op">,&amp;</span>a<span class="op">)||!</span>eval<span class="op">(</span>n<span class="op">-&gt;</span>r<span class="op">,</span>E<span class="op">,&amp;</span>b<span class="op">))</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="op">*</span>out<span class="op">=</span>a<span class="op">-</span>b<span class="op">;</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1198-137"><a href="#cb1198-137" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> N_MUL<span class="op">:</span> <span class="op">{</span> <span class="dt">long</span> a<span class="op">,</span>b<span class="op">;</span> <span class="cf">if</span><span class="op">(!</span>eval<span class="op">(</span>n<span class="op">-&gt;</span>l<span class="op">,</span>E<span class="op">,&amp;</span>a<span class="op">)||!</span>eval<span class="op">(</span>n<span class="op">-&gt;</span>r<span class="op">,</span>E<span class="op">,&amp;</span>b<span class="op">))</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="op">*</span>out<span class="op">=</span>a<span class="op">*</span>b<span class="op">;</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1198-138"><a href="#cb1198-138" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> N_DIV<span class="op">:</span> <span class="op">{</span></span>
<span id="cb1198-139"><a href="#cb1198-139" aria-hidden="true" tabindex="-1"></a>            <span class="dt">long</span> a<span class="op">,</span>b<span class="op">;</span> <span class="cf">if</span><span class="op">(!</span>eval<span class="op">(</span>n<span class="op">-&gt;</span>l<span class="op">,</span>E<span class="op">,&amp;</span>a<span class="op">)||!</span>eval<span class="op">(</span>n<span class="op">-&gt;</span>r<span class="op">,</span>E<span class="op">,&amp;</span>b<span class="op">))</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1198-140"><a href="#cb1198-140" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span><span class="op">(</span>b<span class="op">==</span><span class="dv">0</span><span class="op">){</span> fprintf<span class="op">(</span>stderr<span class="op">,</span><span class="st">"Divide by zero</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1198-141"><a href="#cb1198-141" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>out<span class="op">=</span>a<span class="op">/</span>b<span class="op">;</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1198-142"><a href="#cb1198-142" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1198-143"><a href="#cb1198-143" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> N_ASSIGN<span class="op">:</span> <span class="op">{</span></span>
<span id="cb1198-144"><a href="#cb1198-144" aria-hidden="true" tabindex="-1"></a>            <span class="dt">long</span> v<span class="op">;</span> <span class="cf">if</span><span class="op">(!</span>eval<span class="op">(</span>n<span class="op">-&gt;</span>r<span class="op">,</span>E<span class="op">,&amp;</span>v<span class="op">))</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1198-145"><a href="#cb1198-145" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span><span class="op">(!</span>n<span class="op">-&gt;</span>l <span class="op">||</span> n<span class="op">-&gt;</span>l<span class="op">-&gt;</span>k <span class="op">!=</span> N_IDENT<span class="op">){</span> fprintf<span class="op">(</span>stderr<span class="op">,</span><span class="st">"Left side of '=' must be a name</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1198-146"><a href="#cb1198-146" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span><span class="op">(!</span>env_set<span class="op">(</span>E<span class="op">,</span> n<span class="op">-&gt;</span>l<span class="op">-&gt;</span>name<span class="op">,</span> v<span class="op">)){</span> fprintf<span class="op">(</span>stderr<span class="op">,</span><span class="st">"Env set failed</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1198-147"><a href="#cb1198-147" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>out <span class="op">=</span> v<span class="op">;</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1198-148"><a href="#cb1198-148" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1198-149"><a href="#cb1198-149" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1198-150"><a href="#cb1198-150" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1198-151"><a href="#cb1198-151" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1198-152"><a href="#cb1198-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-153"><a href="#cb1198-153" aria-hidden="true" tabindex="-1"></a><span class="co">/* ----- simple REPL ----- */</span></span>
<span id="cb1198-154"><a href="#cb1198-154" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">){</span></span>
<span id="cb1198-155"><a href="#cb1198-155" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>line <span class="op">=</span> NULL<span class="op">;</span> <span class="dt">size_t</span> n <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1198-156"><a href="#cb1198-156" aria-hidden="true" tabindex="-1"></a>    Env env <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb1198-157"><a href="#cb1198-157" aria-hidden="true" tabindex="-1"></a>    puts<span class="op">(</span><span class="st">"tiny repl. enter expressions or assignments. Ctrl D to exit."</span><span class="op">);</span></span>
<span id="cb1198-158"><a href="#cb1198-158" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">){</span></span>
<span id="cb1198-159"><a href="#cb1198-159" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"&gt; "</span><span class="op">);</span> fflush<span class="op">(</span>stdout<span class="op">);</span></span>
<span id="cb1198-160"><a href="#cb1198-160" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ssize_t</span> m <span class="op">=</span> getline<span class="op">(&amp;</span>line<span class="op">,</span> <span class="op">&amp;</span>n<span class="op">,</span> stdin<span class="op">);</span></span>
<span id="cb1198-161"><a href="#cb1198-161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>m <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1198-162"><a href="#cb1198-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-163"><a href="#cb1198-163" aria-hidden="true" tabindex="-1"></a>        <span class="co">// strip newline</span></span>
<span id="cb1198-164"><a href="#cb1198-164" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>m<span class="op">&gt;</span><span class="dv">0</span> <span class="op">&amp;&amp;</span> line<span class="op">[</span>m<span class="op">-</span><span class="dv">1</span><span class="op">]==</span><span class="ch">'</span><span class="sc">\n</span><span class="ch">'</span><span class="op">)</span> line<span class="op">[</span>m<span class="op">-</span><span class="dv">1</span><span class="op">]=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb1198-165"><a href="#cb1198-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-166"><a href="#cb1198-166" aria-hidden="true" tabindex="-1"></a>        Arena <span class="op">*</span>A <span class="op">=</span> arena_new<span class="op">(</span><span class="dv">1</span><span class="op">&lt;&lt;</span><span class="dv">16</span><span class="op">);</span></span>
<span id="cb1198-167"><a href="#cb1198-167" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(!</span>A<span class="op">){</span> fprintf<span class="op">(</span>stderr<span class="op">,</span><span class="st">"arena failed</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1198-168"><a href="#cb1198-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-169"><a href="#cb1198-169" aria-hidden="true" tabindex="-1"></a>        Lexer L<span class="op">;</span> lex_init<span class="op">(&amp;</span>L<span class="op">,</span> line<span class="op">);</span></span>
<span id="cb1198-170"><a href="#cb1198-170" aria-hidden="true" tabindex="-1"></a>        Parser P <span class="op">=</span> <span class="op">{</span> <span class="op">.</span>L<span class="op">=&amp;</span>L<span class="op">,</span> <span class="op">.</span>A<span class="op">=</span>A<span class="op">,</span> <span class="op">.</span>ok<span class="op">=</span><span class="dv">1</span> <span class="op">};</span></span>
<span id="cb1198-171"><a href="#cb1198-171" aria-hidden="true" tabindex="-1"></a>        Node<span class="op">*</span> root <span class="op">=</span> parse_stmt<span class="op">(&amp;</span>P<span class="op">);</span></span>
<span id="cb1198-172"><a href="#cb1198-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-173"><a href="#cb1198-173" aria-hidden="true" tabindex="-1"></a>        <span class="dt">long</span> result <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1198-174"><a href="#cb1198-174" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>P<span class="op">.</span>ok <span class="op">&amp;&amp;</span> root <span class="op">&amp;&amp;</span> eval<span class="op">(</span>root<span class="op">,</span> <span class="op">&amp;</span>env<span class="op">,</span> <span class="op">&amp;</span>result<span class="op">))</span></span>
<span id="cb1198-175"><a href="#cb1198-175" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"</span><span class="sc">%ld\n</span><span class="st">"</span><span class="op">,</span> result<span class="op">);</span></span>
<span id="cb1198-176"><a href="#cb1198-176" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb1198-177"><a href="#cb1198-177" aria-hidden="true" tabindex="-1"></a>            fprintf<span class="op">(</span>stderr<span class="op">,</span><span class="st">"Error</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1198-178"><a href="#cb1198-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1198-179"><a href="#cb1198-179" aria-hidden="true" tabindex="-1"></a>        arena_free<span class="op">(</span>A<span class="op">);</span></span>
<span id="cb1198-180"><a href="#cb1198-180" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1198-181"><a href="#cb1198-181" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>line<span class="op">);</span></span>
<span id="cb1198-182"><a href="#cb1198-182" aria-hidden="true" tabindex="-1"></a>    <span class="co">// free env bindings</span></span>
<span id="cb1198-183"><a href="#cb1198-183" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">size_t</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>env<span class="op">.</span>count<span class="op">;</span>i<span class="op">++)</span> free<span class="op">((</span><span class="dt">void</span><span class="op">*)</span>env<span class="op">.</span>items<span class="op">[</span>i<span class="op">].</span>name<span class="op">);</span></span>
<span id="cb1198-184"><a href="#cb1198-184" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>env<span class="op">.</span>items<span class="op">);</span></span>
<span id="cb1198-185"><a href="#cb1198-185" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1198-186"><a href="#cb1198-186" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Build and try:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1199"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1199-1"><a href="#cb1199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-std</span><span class="op">=</span>c23 <span class="at">-O2</span> <span class="at">-Wall</span> <span class="at">-Wextra</span> tiny_interp.c <span class="at">-o</span> tiny_interp</span>
<span id="cb1199-2"><a href="#cb1199-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./tiny_interp</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example session:</p>
<pre><code>&gt; 3 + 4*2 - (1 + 5)
5
&gt; x = 10
10
&gt; x + 7
17
&gt; y = x * 3
30
&gt; y / 5
6</code></pre>
</section>
<section id="step-8.-add-built-in-functions-optional" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-add-built-in-functions-optional">Step 8. Add built in functions (optional)</h4>
<p>You can recognize identifiers like <code>max</code> or <code>min</code> and parse a function call form <code>name '(' args ')'</code>. Then implement small handlers in the evaluator that pop evaluated arguments and return a result.</p>
</section>
<section id="step-9.-better-numbers" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-better-numbers">Step 9. Better numbers</h4>
<p>Switch to <code>double</code> if you want division with fractions:</p>
<ul>
<li>Change value type to <code>double</code></li>
<li>Print with <code>%.6g</code></li>
<li>Update divide by zero checks accordingly</li>
</ul>
</section>
<section id="step-10.-why-this-matters-1" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-why-this-matters-1">Step 10. Why this matters</h4>
<p>You now have a complete loop:</p>
<ul>
<li>Text</li>
<li>Tokens</li>
<li>AST</li>
<li>Evaluation</li>
</ul>
<p>This is the heart of configuration languages, query languages, calculators, and many scripting systems. In the next section you will connect this skill to external data by <strong>interfacing with SQLite or LevelDB</strong> from C and building a tiny query tool.</p>
</section>
</section>
<section id="interfacing-with-sqlite-or-leveldb" class="level3">
<h3 class="anchored" data-anchor-id="interfacing-with-sqlite-or-leveldb">98. Interfacing with SQLite or LevelDB</h3>
<p>Time to connect your C programs to real data. In this section you will talk to two popular embeddable databases:</p>
<ul>
<li><strong>SQLite</strong>: relational, SQL queries, ACID transactions in a single file</li>
<li><strong>LevelDB</strong>: key value store, ordered by key, fast reads and writes</li>
</ul>
<p>You will write tiny programs that insert and query data with both engines.</p>
<section id="step-1.-when-to-choose-which" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-when-to-choose-which">Step 1. When to choose which</h4>
<ul>
<li>Choose <strong>SQLite</strong> when you want tables, indexes, SQL, and transactions</li>
<li>Choose <strong>LevelDB</strong> when you want a simple sorted key value store, no SQL, and you control schema in your app</li>
</ul>
<p>Both are embeddable and require no separate server process.</p>
</section>
<section id="step-2.-install-headers-and-libs" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-install-headers-and-libs">Step 2. Install headers and libs</h4>
<p>On Linux or macOS with Homebrew or apt:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1201"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1201-1"><a href="#cb1201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SQLite</span></span>
<span id="cb1201-2"><a href="#cb1201-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install libsqlite3-dev        <span class="co"># Debian based</span></span>
<span id="cb1201-3"><a href="#cb1201-3" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb1201-4"><a href="#cb1201-4" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> install sqlite                    <span class="co"># macOS</span></span>
<span id="cb1201-5"><a href="#cb1201-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1201-6"><a href="#cb1201-6" aria-hidden="true" tabindex="-1"></a><span class="co"># LevelDB</span></span>
<span id="cb1201-7"><a href="#cb1201-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install libleveldb-dev        <span class="co"># Debian based</span></span>
<span id="cb1201-8"><a href="#cb1201-8" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb1201-9"><a href="#cb1201-9" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> install leveldb                   <span class="co"># macOS</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Windows users can grab prebuilt binaries or build from source and link the .lib files.</p>
</section>
<section id="step-3.-tiny-code-for-sqlite-create-insert-query" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-tiny-code-for-sqlite-create-insert-query">Step 3. Tiny Code for SQLite: create, insert, query</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1202"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1202-1"><a href="#cb1202-1" aria-hidden="true" tabindex="-1"></a><span class="co">// file: sqlite_demo.c</span></span>
<span id="cb1202-2"><a href="#cb1202-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1202-3"><a href="#cb1202-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sqlite3.h&gt;</span></span>
<span id="cb1202-4"><a href="#cb1202-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1202-5"><a href="#cb1202-5" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">int</span> print_row<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>unused<span class="op">,</span> <span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>col<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1202-6"><a href="#cb1202-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> argc<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb1202-7"><a href="#cb1202-7" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st"> = </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> col<span class="op">[</span>i<span class="op">],</span> argv<span class="op">[</span>i<span class="op">]</span> <span class="op">?</span> argv<span class="op">[</span>i<span class="op">]</span> <span class="op">:</span> <span class="st">"NULL"</span><span class="op">);</span></span>
<span id="cb1202-8"><a href="#cb1202-8" aria-hidden="true" tabindex="-1"></a>    puts<span class="op">(</span><span class="st">"---"</span><span class="op">);</span></span>
<span id="cb1202-9"><a href="#cb1202-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1202-10"><a href="#cb1202-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1202-11"><a href="#cb1202-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1202-12"><a href="#cb1202-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1202-13"><a href="#cb1202-13" aria-hidden="true" tabindex="-1"></a>    sqlite3 <span class="op">*</span>db <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb1202-14"><a href="#cb1202-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sqlite3_open<span class="op">(</span><span class="st">"people.db"</span><span class="op">,</span> <span class="op">&amp;</span>db<span class="op">)</span> <span class="op">!=</span> SQLITE_OK<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1202-15"><a href="#cb1202-15" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"open: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> sqlite3_errmsg<span class="op">(</span>db<span class="op">));</span></span>
<span id="cb1202-16"><a href="#cb1202-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1202-17"><a href="#cb1202-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1202-18"><a href="#cb1202-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1202-19"><a href="#cb1202-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>ddl <span class="op">=</span></span>
<span id="cb1202-20"><a href="#cb1202-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CREATE TABLE IF NOT EXISTS people ("</span></span>
<span id="cb1202-21"><a href="#cb1202-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">" id INTEGER PRIMARY KEY AUTOINCREMENT,"</span></span>
<span id="cb1202-22"><a href="#cb1202-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">" name TEXT NOT NULL,"</span></span>
<span id="cb1202-23"><a href="#cb1202-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">" age INTEGER NOT NULL"</span></span>
<span id="cb1202-24"><a href="#cb1202-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">");"</span><span class="op">;</span></span>
<span id="cb1202-25"><a href="#cb1202-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sqlite3_exec<span class="op">(</span>db<span class="op">,</span> ddl<span class="op">,</span> NULL<span class="op">,</span> NULL<span class="op">,</span> NULL<span class="op">)</span> <span class="op">!=</span> SQLITE_OK<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1202-26"><a href="#cb1202-26" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"ddl: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> sqlite3_errmsg<span class="op">(</span>db<span class="op">));</span></span>
<span id="cb1202-27"><a href="#cb1202-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1202-28"><a href="#cb1202-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1202-29"><a href="#cb1202-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1202-30"><a href="#cb1202-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Use prepared statements for safety and speed</span></span>
<span id="cb1202-31"><a href="#cb1202-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>ins <span class="op">=</span> <span class="st">"INSERT INTO people(name, age) VALUES(?, ?);"</span><span class="op">;</span></span>
<span id="cb1202-32"><a href="#cb1202-32" aria-hidden="true" tabindex="-1"></a>    sqlite3_stmt <span class="op">*</span>stmt <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb1202-33"><a href="#cb1202-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sqlite3_prepare_v2<span class="op">(</span>db<span class="op">,</span> ins<span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>stmt<span class="op">,</span> NULL<span class="op">)</span> <span class="op">!=</span> SQLITE_OK<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1202-34"><a href="#cb1202-34" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"prepare: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> sqlite3_errmsg<span class="op">(</span>db<span class="op">));</span></span>
<span id="cb1202-35"><a href="#cb1202-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1202-36"><a href="#cb1202-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1202-37"><a href="#cb1202-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1202-38"><a href="#cb1202-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> <span class="op">{</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span> <span class="dt">int</span> age<span class="op">;</span> <span class="op">}</span> rows<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb1202-39"><a href="#cb1202-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="st">"Ada"</span><span class="op">,</span> <span class="dv">36</span><span class="op">},</span> <span class="op">{</span><span class="st">"Linus"</span><span class="op">,</span> <span class="dv">55</span><span class="op">},</span> <span class="op">{</span><span class="st">"Grace"</span><span class="op">,</span> <span class="dv">61</span><span class="op">}</span></span>
<span id="cb1202-40"><a href="#cb1202-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb1202-41"><a href="#cb1202-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb1202-42"><a href="#cb1202-42" aria-hidden="true" tabindex="-1"></a>        sqlite3_reset<span class="op">(</span>stmt<span class="op">);</span></span>
<span id="cb1202-43"><a href="#cb1202-43" aria-hidden="true" tabindex="-1"></a>        sqlite3_clear_bindings<span class="op">(</span>stmt<span class="op">);</span></span>
<span id="cb1202-44"><a href="#cb1202-44" aria-hidden="true" tabindex="-1"></a>        sqlite3_bind_text<span class="op">(</span>stmt<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> rows<span class="op">[</span>i<span class="op">].</span>name<span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> SQLITE_TRANSIENT<span class="op">);</span></span>
<span id="cb1202-45"><a href="#cb1202-45" aria-hidden="true" tabindex="-1"></a>        sqlite3_bind_int<span class="op">(</span>stmt<span class="op">,</span>  <span class="dv">2</span><span class="op">,</span> rows<span class="op">[</span>i<span class="op">].</span>age<span class="op">);</span></span>
<span id="cb1202-46"><a href="#cb1202-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sqlite3_step<span class="op">(</span>stmt<span class="op">)</span> <span class="op">!=</span> SQLITE_DONE<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1202-47"><a href="#cb1202-47" aria-hidden="true" tabindex="-1"></a>            fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"insert: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> sqlite3_errmsg<span class="op">(</span>db<span class="op">));</span></span>
<span id="cb1202-48"><a href="#cb1202-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1202-49"><a href="#cb1202-49" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1202-50"><a href="#cb1202-50" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1202-51"><a href="#cb1202-51" aria-hidden="true" tabindex="-1"></a>    sqlite3_finalize<span class="op">(</span>stmt<span class="op">);</span></span>
<span id="cb1202-52"><a href="#cb1202-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1202-53"><a href="#cb1202-53" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>q <span class="op">=</span> <span class="st">"SELECT id, name, age FROM people WHERE age &gt;= ? ORDER BY age DESC;"</span><span class="op">;</span></span>
<span id="cb1202-54"><a href="#cb1202-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sqlite3_prepare_v2<span class="op">(</span>db<span class="op">,</span> q<span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>stmt<span class="op">,</span> NULL<span class="op">)</span> <span class="op">!=</span> SQLITE_OK<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1202-55"><a href="#cb1202-55" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"prepare q: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> sqlite3_errmsg<span class="op">(</span>db<span class="op">));</span></span>
<span id="cb1202-56"><a href="#cb1202-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1202-57"><a href="#cb1202-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1202-58"><a href="#cb1202-58" aria-hidden="true" tabindex="-1"></a>    sqlite3_bind_int<span class="op">(</span>stmt<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">40</span><span class="op">);</span></span>
<span id="cb1202-59"><a href="#cb1202-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1202-60"><a href="#cb1202-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>sqlite3_step<span class="op">(</span>stmt<span class="op">)</span> <span class="op">==</span> SQLITE_ROW<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1202-61"><a href="#cb1202-61" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> id <span class="op">=</span> sqlite3_column_int<span class="op">(</span>stmt<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb1202-62"><a href="#cb1202-62" aria-hidden="true" tabindex="-1"></a>        <span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>name <span class="op">=</span> sqlite3_column_text<span class="op">(</span>stmt<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb1202-63"><a href="#cb1202-63" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> age <span class="op">=</span> sqlite3_column_int<span class="op">(</span>stmt<span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb1202-64"><a href="#cb1202-64" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"id=</span><span class="sc">%d</span><span class="st"> name=</span><span class="sc">%s</span><span class="st"> age=</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> id<span class="op">,</span> name<span class="op">,</span> age<span class="op">);</span></span>
<span id="cb1202-65"><a href="#cb1202-65" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1202-66"><a href="#cb1202-66" aria-hidden="true" tabindex="-1"></a>    sqlite3_finalize<span class="op">(</span>stmt<span class="op">);</span></span>
<span id="cb1202-67"><a href="#cb1202-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1202-68"><a href="#cb1202-68" aria-hidden="true" tabindex="-1"></a>    sqlite3_close<span class="op">(</span>db<span class="op">);</span></span>
<span id="cb1202-69"><a href="#cb1202-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1202-70"><a href="#cb1202-70" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Build and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1203"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1203-1"><a href="#cb1203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-std</span><span class="op">=</span>c23 <span class="at">-O2</span> sqlite_demo.c <span class="at">-lsqlite3</span> <span class="at">-o</span> sqlite_demo</span>
<span id="cb1203-2"><a href="#cb1203-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./sqlite_demo</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You should see rows printed for people with age 40 or higher.</p>
</section>
<section id="step-4.-sqlite-best-practices-in-c" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-sqlite-best-practices-in-c">Step 4. SQLite best practices in C</h4>
<ul>
<li>Always use <strong>prepared statements</strong> with <code>?</code> placeholders</li>
<li>Always call <code>sqlite3_finalize</code> on statements</li>
<li>Wrap batches in <code>BEGIN</code> and <code>COMMIT</code> for speed</li>
<li>Check every return code and print <code>sqlite3_errmsg(db)</code> on error</li>
<li>Use <code>sqlite3_last_insert_rowid</code> to fetch new primary keys</li>
</ul>
</section>
<section id="step-5.-tiny-code-for-leveldb-open-put-get-iterate" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-tiny-code-for-leveldb-open-put-get-iterate">Step 5. Tiny Code for LevelDB: open, put, get, iterate</h4>
<p>LevelDB has a C API that mirrors the C++ API.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1204"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1204-1"><a href="#cb1204-1" aria-hidden="true" tabindex="-1"></a><span class="co">// file: leveldb_demo.c</span></span>
<span id="cb1204-2"><a href="#cb1204-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1204-3"><a href="#cb1204-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb1204-4"><a href="#cb1204-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb1204-5"><a href="#cb1204-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;leveldb/c.h&gt;</span></span>
<span id="cb1204-6"><a href="#cb1204-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1204-7"><a href="#cb1204-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1204-8"><a href="#cb1204-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>err <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb1204-9"><a href="#cb1204-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1204-10"><a href="#cb1204-10" aria-hidden="true" tabindex="-1"></a>    leveldb_options_t <span class="op">*</span>opts <span class="op">=</span> leveldb_options_create<span class="op">();</span></span>
<span id="cb1204-11"><a href="#cb1204-11" aria-hidden="true" tabindex="-1"></a>    leveldb_options_set_create_if_missing<span class="op">(</span>opts<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb1204-12"><a href="#cb1204-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1204-13"><a href="#cb1204-13" aria-hidden="true" tabindex="-1"></a>    leveldb_t <span class="op">*</span>db <span class="op">=</span> leveldb_open<span class="op">(</span>opts<span class="op">,</span> <span class="st">"kvdb"</span><span class="op">,</span> <span class="op">&amp;</span>err<span class="op">);</span></span>
<span id="cb1204-14"><a href="#cb1204-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>err<span class="op">)</span> <span class="op">{</span> fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"open: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> err<span class="op">);</span> leveldb_free<span class="op">(</span>err<span class="op">);</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1204-15"><a href="#cb1204-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1204-16"><a href="#cb1204-16" aria-hidden="true" tabindex="-1"></a>    leveldb_writeoptions_t <span class="op">*</span>wopt <span class="op">=</span> leveldb_writeoptions_create<span class="op">();</span></span>
<span id="cb1204-17"><a href="#cb1204-17" aria-hidden="true" tabindex="-1"></a>    leveldb_readoptions_t  <span class="op">*</span>ropt <span class="op">=</span> leveldb_readoptions_create<span class="op">();</span></span>
<span id="cb1204-18"><a href="#cb1204-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1204-19"><a href="#cb1204-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Put some keys</span></span>
<span id="cb1204-20"><a href="#cb1204-20" aria-hidden="true" tabindex="-1"></a>    leveldb_put<span class="op">(</span>db<span class="op">,</span> wopt<span class="op">,</span> <span class="st">"name"</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="st">"Ada"</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="op">&amp;</span>err<span class="op">);</span></span>
<span id="cb1204-21"><a href="#cb1204-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>err<span class="op">)</span> <span class="op">{</span> fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"put: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> err<span class="op">);</span> leveldb_free<span class="op">(</span>err<span class="op">);</span> err <span class="op">=</span> NULL<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1204-22"><a href="#cb1204-22" aria-hidden="true" tabindex="-1"></a>    leveldb_put<span class="op">(</span>db<span class="op">,</span> wopt<span class="op">,</span> <span class="st">"lang"</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="st">"C"</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>err<span class="op">);</span></span>
<span id="cb1204-23"><a href="#cb1204-23" aria-hidden="true" tabindex="-1"></a>    leveldb_put<span class="op">(</span>db<span class="op">,</span> wopt<span class="op">,</span> <span class="st">"year"</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="st">"1972"</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="op">&amp;</span>err<span class="op">);</span></span>
<span id="cb1204-24"><a href="#cb1204-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1204-25"><a href="#cb1204-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get a value</span></span>
<span id="cb1204-26"><a href="#cb1204-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> vlen <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1204-27"><a href="#cb1204-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>val <span class="op">=</span> leveldb_get<span class="op">(</span>db<span class="op">,</span> ropt<span class="op">,</span> <span class="st">"name"</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="op">&amp;</span>vlen<span class="op">,</span> <span class="op">&amp;</span>err<span class="op">);</span></span>
<span id="cb1204-28"><a href="#cb1204-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>err<span class="op">)</span> <span class="op">{</span> fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"get: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> err<span class="op">);</span> leveldb_free<span class="op">(</span>err<span class="op">);</span> err <span class="op">=</span> NULL<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1204-29"><a href="#cb1204-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>val<span class="op">)</span> <span class="op">{</span> printf<span class="op">(</span><span class="st">"name=</span><span class="sc">%.*s\n</span><span class="st">"</span><span class="op">,</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>vlen<span class="op">,</span> val<span class="op">);</span> leveldb_free<span class="op">(</span>val<span class="op">);</span> <span class="op">}</span></span>
<span id="cb1204-30"><a href="#cb1204-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1204-31"><a href="#cb1204-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Iterate in key order</span></span>
<span id="cb1204-32"><a href="#cb1204-32" aria-hidden="true" tabindex="-1"></a>    leveldb_iterator_t <span class="op">*</span>it <span class="op">=</span> leveldb_create_iterator<span class="op">(</span>db<span class="op">,</span> ropt<span class="op">);</span></span>
<span id="cb1204-33"><a href="#cb1204-33" aria-hidden="true" tabindex="-1"></a>    leveldb_iter_seek_to_first<span class="op">(</span>it<span class="op">);</span></span>
<span id="cb1204-34"><a href="#cb1204-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>leveldb_iter_valid<span class="op">(</span>it<span class="op">))</span> <span class="op">{</span></span>
<span id="cb1204-35"><a href="#cb1204-35" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> klen<span class="op">,</span> vlen2<span class="op">;</span></span>
<span id="cb1204-36"><a href="#cb1204-36" aria-hidden="true" tabindex="-1"></a>        <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>k <span class="op">=</span> leveldb_iter_key<span class="op">(</span>it<span class="op">,</span> <span class="op">&amp;</span>klen<span class="op">);</span></span>
<span id="cb1204-37"><a href="#cb1204-37" aria-hidden="true" tabindex="-1"></a>        <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>v <span class="op">=</span> leveldb_iter_value<span class="op">(</span>it<span class="op">,</span> <span class="op">&amp;</span>vlen2<span class="op">);</span></span>
<span id="cb1204-38"><a href="#cb1204-38" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%.*s</span><span class="st">=</span><span class="sc">%.*s\n</span><span class="st">"</span><span class="op">,</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>klen<span class="op">,</span> k<span class="op">,</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>vlen2<span class="op">,</span> v<span class="op">);</span></span>
<span id="cb1204-39"><a href="#cb1204-39" aria-hidden="true" tabindex="-1"></a>        leveldb_iter_next<span class="op">(</span>it<span class="op">);</span></span>
<span id="cb1204-40"><a href="#cb1204-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1204-41"><a href="#cb1204-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">((</span>err <span class="op">=</span> <span class="op">(</span><span class="dt">char</span><span class="op">*)</span>leveldb_iter_get_error<span class="op">(</span>it<span class="op">))</span> <span class="op">&amp;&amp;</span> <span class="op">*</span>err<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1204-42"><a href="#cb1204-42" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"iter: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> err<span class="op">);</span></span>
<span id="cb1204-43"><a href="#cb1204-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1204-44"><a href="#cb1204-44" aria-hidden="true" tabindex="-1"></a>    leveldb_iter_destroy<span class="op">(</span>it<span class="op">);</span></span>
<span id="cb1204-45"><a href="#cb1204-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1204-46"><a href="#cb1204-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Clean up</span></span>
<span id="cb1204-47"><a href="#cb1204-47" aria-hidden="true" tabindex="-1"></a>    leveldb_readoptions_destroy<span class="op">(</span>ropt<span class="op">);</span></span>
<span id="cb1204-48"><a href="#cb1204-48" aria-hidden="true" tabindex="-1"></a>    leveldb_writeoptions_destroy<span class="op">(</span>wopt<span class="op">);</span></span>
<span id="cb1204-49"><a href="#cb1204-49" aria-hidden="true" tabindex="-1"></a>    leveldb_close<span class="op">(</span>db<span class="op">);</span></span>
<span id="cb1204-50"><a href="#cb1204-50" aria-hidden="true" tabindex="-1"></a>    leveldb_options_destroy<span class="op">(</span>opts<span class="op">);</span></span>
<span id="cb1204-51"><a href="#cb1204-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1204-52"><a href="#cb1204-52" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Build and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1205"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1205-1"><a href="#cb1205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-std</span><span class="op">=</span>c23 <span class="at">-O2</span> leveldb_demo.c <span class="at">-lleveldb</span> <span class="at">-o</span> leveldb_demo</span>
<span id="cb1205-2"><a href="#cb1205-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./leveldb_demo</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You should see key value pairs in sorted key order.</p>
</section>
<section id="step-6.-transactions-and-durability" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-transactions-and-durability">Step 6. Transactions and durability</h4>
<ul>
<li><p><strong>SQLite</strong> has full transactions</p>
<ul>
<li>Use <code>BEGIN IMMEDIATE;</code> then your inserts then <code>COMMIT;</code></li>
<li>For crash safety use the default rollback journal or WAL mode</li>
</ul></li>
<li><p><strong>LevelDB</strong> has atomic writes per key and write batches</p>
<ul>
<li>Use <code>leveldb_writebatch_t</code> to group puts and deletes atomically</li>
<li>Sync to disk with <code>leveldb_writeoptions_set_sync(wopt, 1)</code></li>
</ul></li>
</ul>
</section>
<section id="step-7.-parameter-binding-and-type-safety-with-sqlite" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-parameter-binding-and-type-safety-with-sqlite">Step 7. Parameter binding and type safety with SQLite</h4>
<p>Use the correct bind and column functions:</p>
<ul>
<li><code>sqlite3_bind_int</code>, <code>sqlite3_bind_int64</code>, <code>sqlite3_bind_double</code>, <code>sqlite3_bind_text</code></li>
<li><code>sqlite3_column_int</code>, <code>sqlite3_column_int64</code>, <code>sqlite3_column_double</code>, <code>sqlite3_column_text</code></li>
</ul>
<p>Never build SQL by string concatenation with user input. Bindings prevent SQL injection and handle escaping for you.</p>
</section>
<section id="step-8.-working-with-binary-data" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-working-with-binary-data">Step 8. Working with binary data</h4>
<ul>
<li><strong>SQLite</strong>: use <code>sqlite3_bind_blob</code> and <code>sqlite3_column_blob</code> with a separate length</li>
<li><strong>LevelDB</strong>: keys and values are raw byte spans <code>(ptr, length)</code>, so binary is natural</li>
</ul>
<p>You can store serialized structs, protobufs, or JSON. Remember to define your own versioning for compatibility.</p>
</section>
<section id="step-9.-schema-and-indexing-ideas" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-schema-and-indexing-ideas">Step 9. Schema and indexing ideas</h4>
<ul>
<li><p><strong>SQLite</strong></p>
<ul>
<li>Normalize into tables with primary keys and foreign keys</li>
<li>Create indexes for frequent lookups</li>
<li>Use <code>PRAGMA foreign_keys = ON;</code> to enforce constraints</li>
</ul></li>
<li><p><strong>LevelDB</strong></p>
<ul>
<li>Design composite keys to encode access patterns</li>
<li>Example: <code>user:&lt;id&gt;</code> for user row, <code>user_email:&lt;email&gt;</code> points to <code>&lt;id&gt;</code></li>
<li>Range scans are easy: store keys like <code>post:&lt;yyyy-mm&gt;:&lt;id&gt;</code> and iterate by prefix</li>
</ul></li>
</ul>
</section>
<section id="step-10.-why-this-matters-2" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-why-this-matters-2">Step 10. Why this matters</h4>
<p>Embedding a database takes your C program from toy to tool. You now know how to:</p>
<ul>
<li>Execute SQL queries and prepared statements with SQLite</li>
<li>Use a sorted key value engine with LevelDB</li>
<li>Choose the right storage model for each problem</li>
<li>Handle durability, binary data, and iteration from C</li>
</ul>
</section>
<section id="try-it-yourself-89" class="level4">
<h4 class="anchored" data-anchor-id="try-it-yourself-89">Try it yourself</h4>
<ol type="1">
<li>Extend the SQLite demo with a <code>BEGIN</code> and <code>COMMIT</code> around a loop of 10000 inserts and measure time.</li>
<li>Add an index on <code>age</code> and compare query performance.</li>
<li>In the LevelDB demo add a write batch that inserts 1000 sequential keys.</li>
<li>Store binary blobs in both systems and read them back.</li>
<li>Build a tiny CLI that routes <code>sql ...</code> lines to SQLite and <code>kv ...</code> lines to LevelDB.</li>
</ol>
<p>Next up is <strong>99. Packaging, Versioning, and Documentation</strong> where you will learn how to ship your code like a pro with Makefiles, pkg config, semantic versioning, and clean README docs.</p>
</section>
</section>
<section id="packaging-versioning-and-documentation" class="level3">
<h3 class="anchored" data-anchor-id="packaging-versioning-and-documentation">99. Packaging, Versioning, and Documentation</h3>
<p>You’ve written real C programs—now it’s time to <strong>package, version, and document</strong> them like a professional. This is what makes your code usable by others and maintainable by your future self.</p>
<section id="step-1.-the-goal-of-packaging" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-the-goal-of-packaging">Step 1. The goal of packaging</h4>
<p>Packaging is about making your project easy to:</p>
<ul>
<li>build (<code>make</code>, <code>cmake</code>, or <code>meson</code>)</li>
<li>install (<code>make install</code>)</li>
<li>link (<code>pkg-config</code>)</li>
<li>use (<code>#include "yourlib.h"</code>)</li>
</ul>
<p>You’ll create a structure that helps others build and use your code without guessing.</p>
</section>
<section id="step-2.-standard-project-layout" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-standard-project-layout">Step 2. Standard project layout</h4>
<p>A simple, conventional layout for a C project:</p>
<pre><code>myproject/
├── include/
│   └── myproject.h
├── src/
│   ├── main.c
│   └── util.c
├── tests/
│   └── test_basic.c
├── Makefile
├── README.md
└── LICENSE</code></pre>
<ul>
<li><code>include/</code> holds headers that others can include</li>
<li><code>src/</code> holds your implementation files</li>
<li><code>tests/</code> holds unit tests</li>
<li><code>Makefile</code> defines how to build and install</li>
</ul>
</section>
<section id="step-3.-tiny-code-a-simple-reusable-library" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-tiny-code-a-simple-reusable-library">Step 3. Tiny Code: a simple reusable library</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1207"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1207-1"><a href="#cb1207-1" aria-hidden="true" tabindex="-1"></a><span class="co">// include/myproject.h</span></span>
<span id="cb1207-2"><a href="#cb1207-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef MYPROJECT_H</span></span>
<span id="cb1207-3"><a href="#cb1207-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MYPROJECT_H</span></span>
<span id="cb1207-4"><a href="#cb1207-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1207-5"><a href="#cb1207-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">);</span></span>
<span id="cb1207-6"><a href="#cb1207-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sub<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">);</span></span>
<span id="cb1207-7"><a href="#cb1207-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1207-8"><a href="#cb1207-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1208"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1208-1"><a href="#cb1208-1" aria-hidden="true" tabindex="-1"></a><span class="co">// src/myproject.c</span></span>
<span id="cb1208-2"><a href="#cb1208-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"myproject.h"</span></span>
<span id="cb1208-3"><a href="#cb1208-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1208-4"><a href="#cb1208-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1208-5"><a href="#cb1208-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sub<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">-</span> b<span class="op">;</span> <span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-4.-minimal-makefile" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-minimal-makefile">Step 4. Minimal Makefile</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1209"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb1209-1"><a href="#cb1209-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span>      <span class="ch">=</span><span class="st"> gcc</span></span>
<span id="cb1209-2"><a href="#cb1209-2" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span>  <span class="ch">=</span><span class="st"> -std=c23 -O2 -Wall -Iinclude</span></span>
<span id="cb1209-3"><a href="#cb1209-3" aria-hidden="true" tabindex="-1"></a><span class="dt">LDFLAGS</span> <span class="ch">=</span></span>
<span id="cb1209-4"><a href="#cb1209-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1209-5"><a href="#cb1209-5" aria-hidden="true" tabindex="-1"></a><span class="dt">SRC</span> <span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">wildcard</span><span class="st"> src/*.c</span><span class="ch">)</span></span>
<span id="cb1209-6"><a href="#cb1209-6" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJ</span> <span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">SRC</span><span class="kw">:</span><span class="ss">.c</span><span class="kw">=</span><span class="ss">.o</span><span class="ch">)</span></span>
<span id="cb1209-7"><a href="#cb1209-7" aria-hidden="true" tabindex="-1"></a><span class="dt">LIB</span> <span class="ch">=</span><span class="st"> libmyproject.a</span></span>
<span id="cb1209-8"><a href="#cb1209-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1209-9"><a href="#cb1209-9" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY:</span><span class="dt"> all clean install uninstall</span></span>
<span id="cb1209-10"><a href="#cb1209-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1209-11"><a href="#cb1209-11" aria-hidden="true" tabindex="-1"></a><span class="dv">all:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">LIB</span><span class="ch">)</span></span>
<span id="cb1209-12"><a href="#cb1209-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1209-13"><a href="#cb1209-13" aria-hidden="true" tabindex="-1"></a><span class="dv">$(LIB):</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span></span>
<span id="cb1209-14"><a href="#cb1209-14" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>ar rcs <span class="ch">$@</span> <span class="ch">$^</span></span>
<span id="cb1209-15"><a href="#cb1209-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1209-16"><a href="#cb1209-16" aria-hidden="true" tabindex="-1"></a><span class="dv">%.o:</span><span class="dt"> %.c</span></span>
<span id="cb1209-17"><a href="#cb1209-17" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> -c <span class="ch">$&lt;</span> -o <span class="ch">$@</span></span>
<span id="cb1209-18"><a href="#cb1209-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1209-19"><a href="#cb1209-19" aria-hidden="true" tabindex="-1"></a><span class="dv">install:</span></span>
<span id="cb1209-20"><a href="#cb1209-20" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>mkdir -p /usr/local/include/myproject</span>
<span id="cb1209-21"><a href="#cb1209-21" aria-hidden="true" tabindex="-1"></a>    cp include/*.h /usr/local/include/myproject/</span>
<span id="cb1209-22"><a href="#cb1209-22" aria-hidden="true" tabindex="-1"></a>    cp <span class="ch">$(</span><span class="dt">LIB</span><span class="ch">)</span> /usr/local/lib/</span>
<span id="cb1209-23"><a href="#cb1209-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1209-24"><a href="#cb1209-24" aria-hidden="true" tabindex="-1"></a><span class="dv">uninstall:</span></span>
<span id="cb1209-25"><a href="#cb1209-25" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f /usr/local/lib/<span class="ch">$(</span><span class="dt">LIB</span><span class="ch">)</span></span>
<span id="cb1209-26"><a href="#cb1209-26" aria-hidden="true" tabindex="-1"></a>    rm -rf /usr/local/include/myproject</span>
<span id="cb1209-27"><a href="#cb1209-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1209-28"><a href="#cb1209-28" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb1209-29"><a href="#cb1209-29" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f <span class="ch">$(</span><span class="dt">OBJ</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">LIB</span><span class="ch">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Build the library:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1210"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1210-1"><a href="#cb1210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span>
<span id="cb1210-2"><a href="#cb1210-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> make install</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then another project can link against it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1211"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1211-1"><a href="#cb1211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> main.c <span class="at">-lmyproject</span> <span class="at">-L</span>/usr/local/lib <span class="at">-I</span>/usr/local/include/myproject</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-5.-versioning-your-releases" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-versioning-your-releases">Step 5. Versioning your releases</h4>
<p>Follow <strong>semantic versioning</strong>:</p>
<pre><code>vMAJOR.MINOR.PATCH</code></pre>
<p>Examples:</p>
<ul>
<li><code>v1.0.0</code> – stable release</li>
<li><code>v1.1.0</code> – new feature, backward compatible</li>
<li><code>v1.1.1</code> – bug fix, no API change</li>
<li><code>v2.0.0</code> – breaking API change</li>
</ul>
<p>Tag your releases in git:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1213"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1213-1"><a href="#cb1213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> tag <span class="at">-a</span> v1.0.0 <span class="at">-m</span> <span class="st">"First stable release"</span></span>
<span id="cb1213-2"><a href="#cb1213-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push origin v1.0.0</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-6.-create-a-pkg-config-file" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-create-a-pkg-config-file">Step 6. Create a pkg-config file</h4>
<p><code>pkg-config</code> lets others compile your library easily.</p>
<p>Create <code>myproject.pc</code>:</p>
<pre><code>prefix=/usr/local
exec_prefix=${prefix}
libdir=${exec_prefix}/lib
includedir=${prefix}/include/myproject

Name: myproject
Description: Tiny math helper library
Version: 1.0.0
Libs: -L${libdir} -lmyproject
Cflags: -I${includedir}</code></pre>
<p>Install it in <code>/usr/local/lib/pkgconfig/</code> and test:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1215"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1215-1"><a href="#cb1215-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pkg-config</span> <span class="at">--cflags</span> <span class="at">--libs</span> myproject</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-7.-documentation-with-markdown-and-doxygen" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-documentation-with-markdown-and-doxygen">Step 7. Documentation with Markdown and Doxygen</h4>
<p>Keep a clear <strong>README.md</strong> at the root:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1216"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1216-1"><a href="#cb1216-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># myproject</span></span>
<span id="cb1216-2"><a href="#cb1216-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1216-3"><a href="#cb1216-3" aria-hidden="true" tabindex="-1"></a>A tiny example C library for arithmetic functions.</span>
<span id="cb1216-4"><a href="#cb1216-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1216-5"><a href="#cb1216-5" aria-hidden="true" tabindex="-1"></a><span class="fu">## Build</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>make sudo make install</p>
<pre><code>
## Usage
```c
#include &lt;myproject.h&gt;

int main() {
    printf("%d\n", add(3, 4));
}</code></pre>
<pre><code>
For API documentation, use **Doxygen**:

```bash
sudo apt install doxygen
doxygen -g</code></pre>
<p>Edit <code>Doxyfile</code> to include your source paths, then run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1219"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1219-1"><a href="#cb1219-1" aria-hidden="true" tabindex="-1"></a><span class="ex">doxygen</span> Doxyfile</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Docs will appear in <code>html/</code> or <code>latex/</code>.</p>
</section>
<section id="step-8.-licensing" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-licensing">Step 8. Licensing</h4>
<p>Add a <code>LICENSE</code> file so others know how they can use your code. Common ones:</p>
<ul>
<li><strong>MIT License</strong>: simple, permissive</li>
<li><strong>Apache 2.0</strong>: adds patent protection</li>
<li><strong>GPLv3</strong>: ensures derivatives remain open</li>
</ul>
<p>Example MIT License header for your source files:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1220"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1220-1"><a href="#cb1220-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* </span></span>
<span id="cb1220-2"><a href="#cb1220-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * Copyright (c) 2025 Your Name</span></span>
<span id="cb1220-3"><a href="#cb1220-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * Licensed under the MIT License.</span></span>
<span id="cb1220-4"><a href="#cb1220-4" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-9.-continuous-integration-optional" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-continuous-integration-optional">Step 9. Continuous Integration (optional)</h4>
<p>Add GitHub Actions or another CI service:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1221"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb1221-1"><a href="#cb1221-1" aria-hidden="true" tabindex="-1"></a><span class="co"># .github/workflows/build.yml</span></span>
<span id="cb1221-2"><a href="#cb1221-2" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Build and Test</span></span>
<span id="cb1221-3"><a href="#cb1221-3" aria-hidden="true" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">push</span><span class="kw">,</span><span class="at"> pull_request</span><span class="kw">]</span></span>
<span id="cb1221-4"><a href="#cb1221-4" aria-hidden="true" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb1221-5"><a href="#cb1221-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb1221-6"><a href="#cb1221-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb1221-7"><a href="#cb1221-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb1221-8"><a href="#cb1221-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v3</span></span>
<span id="cb1221-9"><a href="#cb1221-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span><span class="at"> make</span></span>
<span id="cb1221-10"><a href="#cb1221-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span><span class="at"> make test || echo "No tests yet"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now every push builds automatically.</p>
</section>
<section id="step-10.-why-this-matters-3" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-why-this-matters-3">Step 10. Why this matters</h4>
<p>Professional packaging is part of being a systems engineer:</p>
<ul>
<li>Your projects build reproducibly.</li>
<li>Others can install, link, and use them easily.</li>
<li>Documentation and version tags create confidence.</li>
<li>Licensing clarifies ownership.</li>
</ul>
<p>You have now moved from <em>C programmer</em> to <em>C maintainer</em>, the person others trust to deliver solid, reusable, and well-documented software.</p>
<p>Next is <strong>100. Practice: Build Your Own Mini Project</strong>, where you will bring everything together, writing, building, debugging, and packaging a complete small system in pure C.</p>
</section>
</section>
<section id="practice-build-your-own-mini-project" class="level3">
<h3 class="anchored" data-anchor-id="practice-build-your-own-mini-project">100. Practice: Build Your Own Mini Project</h3>
<p>You’ve walked through all the essential layers of C, syntax, memory, data structures, file I/O, compilation, debugging, and even packaging. Now you’ll bring it all together by building a complete mini project from scratch.</p>
<p>This final section is a synthesis: plan, design, implement, test, and document a small, useful system in pure C.</p>
<section id="step-1.-choose-your-project-scope" class="level4">
<h4 class="anchored" data-anchor-id="step-1.-choose-your-project-scope">Step 1. Choose your project scope</h4>
<p>Pick something small enough to finish but rich enough to touch multiple topics. Here are three good options:</p>
<p><strong>Option A: A Tiny Note Manager</strong></p>
<ul>
<li>Command line tool to add, list, and delete notes</li>
<li>Stores data in a simple binary file</li>
<li>Indexes notes by ID</li>
</ul>
<p><strong>Option B: A Simple HTTP Server</strong></p>
<ul>
<li>Serves static files from a directory</li>
<li>Uses sockets (<code>socket</code>, <code>bind</code>, <code>listen</code>, <code>accept</code>)</li>
<li>Logs each request to a file</li>
</ul>
<p><strong>Option C: A Tiny Key-Value Store</strong></p>
<ul>
<li>Command line tool with commands <code>put</code>, <code>get</code>, <code>list</code>, <code>delete</code></li>
<li>Uses <code>fopen</code>, <code>fread</code>, and <code>fwrite</code></li>
<li>Optional: add LevelDB or SQLite backend</li>
</ul>
</section>
<section id="step-2.-plan-your-structure" class="level4">
<h4 class="anchored" data-anchor-id="step-2.-plan-your-structure">Step 2. Plan your structure</h4>
<p>Example: for the <strong>Tiny Note Manager</strong></p>
<pre><code>tinynotes/
├── include/
│   └── tinynotes.h
├── src/
│   ├── main.c
│   ├── notes.c
│   └── util.c
├── data/
│   └── notes.bin
├── Makefile
├── README.md
└── LICENSE</code></pre>
</section>
<section id="step-3.-tiny-code-minimal-working-version" class="level4">
<h4 class="anchored" data-anchor-id="step-3.-tiny-code-minimal-working-version">Step 3. Tiny Code: minimal working version</h4>
<p>Below is a working <strong>Tiny Note Manager</strong> in under 150 lines.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1223"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1223-1"><a href="#cb1223-1" aria-hidden="true" tabindex="-1"></a><span class="co">// file: tinynotes.c</span></span>
<span id="cb1223-2"><a href="#cb1223-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1223-3"><a href="#cb1223-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb1223-4"><a href="#cb1223-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb1223-5"><a href="#cb1223-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1223-6"><a href="#cb1223-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAX_NOTE_LEN </span><span class="dv">256</span></span>
<span id="cb1223-7"><a href="#cb1223-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#define DATA_FILE </span><span class="st">"notes.bin"</span></span>
<span id="cb1223-8"><a href="#cb1223-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1223-9"><a href="#cb1223-9" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb1223-10"><a href="#cb1223-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb1223-11"><a href="#cb1223-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> text<span class="op">[</span>MAX_NOTE_LEN<span class="op">];</span></span>
<span id="cb1223-12"><a href="#cb1223-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Note<span class="op">;</span></span>
<span id="cb1223-13"><a href="#cb1223-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1223-14"><a href="#cb1223-14" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> add_note<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>msg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1223-15"><a href="#cb1223-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>f <span class="op">=</span> fopen<span class="op">(</span>DATA_FILE<span class="op">,</span> <span class="st">"ab"</span><span class="op">);</span></span>
<span id="cb1223-16"><a href="#cb1223-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>f<span class="op">)</span> <span class="op">{</span> perror<span class="op">(</span><span class="st">"open"</span><span class="op">);</span> exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span> <span class="op">}</span></span>
<span id="cb1223-17"><a href="#cb1223-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1223-18"><a href="#cb1223-18" aria-hidden="true" tabindex="-1"></a>    Note n <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb1223-19"><a href="#cb1223-19" aria-hidden="true" tabindex="-1"></a>    fseek<span class="op">(</span>f<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> SEEK_END<span class="op">);</span></span>
<span id="cb1223-20"><a href="#cb1223-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> size <span class="op">=</span> ftell<span class="op">(</span>f<span class="op">);</span></span>
<span id="cb1223-21"><a href="#cb1223-21" aria-hidden="true" tabindex="-1"></a>    n<span class="op">.</span>id <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span>size <span class="op">/</span> <span class="kw">sizeof</span><span class="op">(</span>Note<span class="op">))</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1223-22"><a href="#cb1223-22" aria-hidden="true" tabindex="-1"></a>    strncpy<span class="op">(</span>n<span class="op">.</span>text<span class="op">,</span> msg<span class="op">,</span> MAX_NOTE_LEN <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb1223-23"><a href="#cb1223-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1223-24"><a href="#cb1223-24" aria-hidden="true" tabindex="-1"></a>    fwrite<span class="op">(&amp;</span>n<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>n<span class="op">),</span> <span class="dv">1</span><span class="op">,</span> f<span class="op">);</span></span>
<span id="cb1223-25"><a href="#cb1223-25" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>f<span class="op">);</span></span>
<span id="cb1223-26"><a href="#cb1223-26" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Added note </span><span class="sc">%d</span><span class="st">: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> n<span class="op">.</span>id<span class="op">,</span> n<span class="op">.</span>text<span class="op">);</span></span>
<span id="cb1223-27"><a href="#cb1223-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1223-28"><a href="#cb1223-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1223-29"><a href="#cb1223-29" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> list_notes<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1223-30"><a href="#cb1223-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>f <span class="op">=</span> fopen<span class="op">(</span>DATA_FILE<span class="op">,</span> <span class="st">"rb"</span><span class="op">);</span></span>
<span id="cb1223-31"><a href="#cb1223-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>f<span class="op">)</span> <span class="op">{</span> puts<span class="op">(</span><span class="st">"No notes yet."</span><span class="op">);</span> <span class="cf">return</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb1223-32"><a href="#cb1223-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1223-33"><a href="#cb1223-33" aria-hidden="true" tabindex="-1"></a>    Note n<span class="op">;</span></span>
<span id="cb1223-34"><a href="#cb1223-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>fread<span class="op">(&amp;</span>n<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>n<span class="op">),</span> <span class="dv">1</span><span class="op">,</span> f<span class="op">)</span> <span class="op">==</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb1223-35"><a href="#cb1223-35" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> n<span class="op">.</span>id<span class="op">,</span> n<span class="op">.</span>text<span class="op">);</span></span>
<span id="cb1223-36"><a href="#cb1223-36" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>f<span class="op">);</span></span>
<span id="cb1223-37"><a href="#cb1223-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1223-38"><a href="#cb1223-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1223-39"><a href="#cb1223-39" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> delete_all<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1223-40"><a href="#cb1223-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>remove<span class="op">(</span>DATA_FILE<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb1223-41"><a href="#cb1223-41" aria-hidden="true" tabindex="-1"></a>        puts<span class="op">(</span><span class="st">"All notes deleted."</span><span class="op">);</span></span>
<span id="cb1223-42"><a href="#cb1223-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb1223-43"><a href="#cb1223-43" aria-hidden="true" tabindex="-1"></a>        puts<span class="op">(</span><span class="st">"No notes to delete."</span><span class="op">);</span></span>
<span id="cb1223-44"><a href="#cb1223-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1223-45"><a href="#cb1223-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1223-46"><a href="#cb1223-46" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1223-47"><a href="#cb1223-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>argc <span class="op">&lt;</span> <span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1223-48"><a href="#cb1223-48" aria-hidden="true" tabindex="-1"></a>        puts<span class="op">(</span><span class="st">"Usage: tinynotes &lt;add|list|clear&gt; [message]"</span><span class="op">);</span></span>
<span id="cb1223-49"><a href="#cb1223-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1223-50"><a href="#cb1223-50" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1223-51"><a href="#cb1223-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1223-52"><a href="#cb1223-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span> <span class="st">"add"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> argc <span class="op">&gt;=</span> <span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1223-53"><a href="#cb1223-53" aria-hidden="true" tabindex="-1"></a>        add_note<span class="op">(</span>argv<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb1223-54"><a href="#cb1223-54" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span> <span class="st">"list"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1223-55"><a href="#cb1223-55" aria-hidden="true" tabindex="-1"></a>        list_notes<span class="op">();</span></span>
<span id="cb1223-56"><a href="#cb1223-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>strcmp<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span> <span class="st">"clear"</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1223-57"><a href="#cb1223-57" aria-hidden="true" tabindex="-1"></a>        delete_all<span class="op">();</span></span>
<span id="cb1223-58"><a href="#cb1223-58" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb1223-59"><a href="#cb1223-59" aria-hidden="true" tabindex="-1"></a>        puts<span class="op">(</span><span class="st">"Invalid command."</span><span class="op">);</span></span>
<span id="cb1223-60"><a href="#cb1223-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1223-61"><a href="#cb1223-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1223-62"><a href="#cb1223-62" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Build it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1224"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1224-1"><a href="#cb1224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-std</span><span class="op">=</span>c23 <span class="at">-O2</span> tinynotes.c <span class="at">-o</span> tinynotes</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Try it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1225"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1225-1"><a href="#cb1225-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./tinynotes</span> add <span class="st">"Learn C deeply"</span></span>
<span id="cb1225-2"><a href="#cb1225-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./tinynotes</span> add <span class="st">"Write clear code"</span></span>
<span id="cb1225-3"><a href="#cb1225-3" aria-hidden="true" tabindex="-1"></a><span class="ex">./tinynotes</span> list</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output:</p>
<pre><code>Added note 1: Learn C deeply
Added note 2: Write clear code
1: Learn C deeply
2: Write clear code</code></pre>
</section>
<section id="step-4.-extend-it" class="level4">
<h4 class="anchored" data-anchor-id="step-4.-extend-it">Step 4. Extend it</h4>
<p>Add these small improvements:</p>
<ul>
<li><code>tinynotes delete &lt;id&gt;</code> to remove a note by index</li>
<li>Store creation time (<code>time_t</code>)</li>
<li>Save to a user-specific directory (<code>~/.tinynotes/</code>)</li>
<li>Encrypt notes with XOR or AES before writing (optional)</li>
<li>Add JSON export using <code>fprintf</code></li>
</ul>
</section>
<section id="step-5.-package-it" class="level4">
<h4 class="anchored" data-anchor-id="step-5.-package-it">Step 5. Package it</h4>
<p>Add a Makefile:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1227"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb1227-1"><a href="#cb1227-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span><span class="ch">=</span><span class="st">gcc</span></span>
<span id="cb1227-2"><a href="#cb1227-2" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span><span class="ch">=</span><span class="st">-std=c23 -O2 -Wall</span></span>
<span id="cb1227-3"><a href="#cb1227-3" aria-hidden="true" tabindex="-1"></a><span class="dt">TARGET</span><span class="ch">=</span><span class="st">tinynotes</span></span>
<span id="cb1227-4"><a href="#cb1227-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1227-5"><a href="#cb1227-5" aria-hidden="true" tabindex="-1"></a><span class="dv">all:</span></span>
<span id="cb1227-6"><a href="#cb1227-6" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> tinynotes.c -o <span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span>
<span id="cb1227-7"><a href="#cb1227-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1227-8"><a href="#cb1227-8" aria-hidden="true" tabindex="-1"></a><span class="dv">install:</span></span>
<span id="cb1227-9"><a href="#cb1227-9" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>cp <span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span> /usr/local/bin/</span>
<span id="cb1227-10"><a href="#cb1227-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1227-11"><a href="#cb1227-11" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb1227-12"><a href="#cb1227-12" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -f <span class="ch">$(</span><span class="dt">TARGET</span><span class="ch">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Install:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1228"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1228-1"><a href="#cb1228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> make install</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now you can type <code>tinynotes list</code> from anywhere.</p>
</section>
<section id="step-6.-document-it" class="level4">
<h4 class="anchored" data-anchor-id="step-6.-document-it">Step 6. Document it</h4>
<p><strong>README.md</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1229"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1229-1"><a href="#cb1229-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># tinynotes</span></span>
<span id="cb1229-2"><a href="#cb1229-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1229-3"><a href="#cb1229-3" aria-hidden="true" tabindex="-1"></a>A simple command-line note manager written in C.</span>
<span id="cb1229-4"><a href="#cb1229-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1229-5"><a href="#cb1229-5" aria-hidden="true" tabindex="-1"></a><span class="fu">## Build</span></span>
<span id="cb1229-6"><a href="#cb1229-6" aria-hidden="true" tabindex="-1"></a>make</span>
<span id="cb1229-7"><a href="#cb1229-7" aria-hidden="true" tabindex="-1"></a>sudo make install</span>
<span id="cb1229-8"><a href="#cb1229-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1229-9"><a href="#cb1229-9" aria-hidden="true" tabindex="-1"></a><span class="fu">## Usage</span></span>
<span id="cb1229-10"><a href="#cb1229-10" aria-hidden="true" tabindex="-1"></a>tinynotes add "hello world"</span>
<span id="cb1229-11"><a href="#cb1229-11" aria-hidden="true" tabindex="-1"></a>tinynotes list</span>
<span id="cb1229-12"><a href="#cb1229-12" aria-hidden="true" tabindex="-1"></a>tinynotes clear</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-7.-version-and-license" class="level4">
<h4 class="anchored" data-anchor-id="step-7.-version-and-license">Step 7. Version and license</h4>
<p>Tag your release:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1230"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1230-1"><a href="#cb1230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> tag <span class="at">-a</span> v0.1.0 <span class="at">-m</span> <span class="st">"first public release"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Add <code>LICENSE</code> (MIT, Apache, or GPL). Publish it on GitHub if you want others to use or contribute.</p>
</section>
<section id="step-8.-why-this-matters" class="level4">
<h4 class="anchored" data-anchor-id="step-8.-why-this-matters">Step 8. Why this matters</h4>
<p>This is how small programs grow into tools:</p>
<ul>
<li>Real file I/O</li>
<li>Error handling</li>
<li>Build automation</li>
<li>Documentation and versioning</li>
</ul>
<p>C gives you the power to build precise, fast, and minimal software. You now know every layer—from compiler to system call.</p>
</section>
<section id="step-9.-try-it-yourself" class="level4">
<h4 class="anchored" data-anchor-id="step-9.-try-it-yourself">Step 9. Try it yourself</h4>
<ol type="1">
<li>Replace file storage with SQLite or LevelDB</li>
<li>Add <code>search</code> and <code>sort</code></li>
<li>Build a networked version that syncs notes over sockets</li>
<li>Add a unit test suite with assertions</li>
<li>Package your project as a <code>.deb</code> or <code>.tar.gz</code></li>
</ol>
</section>
<section id="step-10.-congratulations" class="level4">
<h4 class="anchored" data-anchor-id="step-10.-congratulations">Step 10. Congratulations</h4>
<p>You’ve reached the end of <strong>The Little Book of C</strong>.</p>
<p>You started from <code>printf("Hello, World");</code> and finished with building, packaging, and documenting full working systems.</p>
<p>You now have the foundation to explore:</p>
<ul>
<li><strong>Operating Systems</strong></li>
<li><strong>Compilers and Interpreters</strong></li>
<li><strong>Embedded Systems</strong></li>
<li><strong>Databases and Networking</strong></li>
</ul>
<p>C is not just a language. It is the foundation of computing. You now speak it fluently, like a systems engineer.</p>
<p>You’ve reached the final page, the quiet epilogue of <em>The Little Book of C.</em></p>
<p>Let’s close this journey the same way C programs begin: with clarity, purpose, and curiosity.</p>
</section>
</section>
<section id="epilogue.-the-spirit-of-c" class="level2">
<h2 class="anchored" data-anchor-id="epilogue.-the-spirit-of-c">Epilogue. The Spirit of C</h2>
<p>C is not just about syntax, pointers, or the compiler. It is a mindset, one that teaches you to think about <strong>how machines actually work</strong>.</p>
<p>When you write in C, you’re speaking the native tongue of computers. You tell the processor what to do, byte by byte, without any illusion between you and the hardware.</p>
<p>You’ve learned that:</p>
<ul>
<li>Every variable has a precise place in memory</li>
<li>Every function call has a cost on the stack</li>
<li>Every pointer is a promise to be careful</li>
<li>Every line you write translates into instructions and data</li>
</ul>
<p>C rewards those who think deeply and punishes those who guess. But when you master it, you gain a kind of freedom that few languages can match.</p>
</section>
<section id="the-path-beyond" class="level2">
<h2 class="anchored" data-anchor-id="the-path-beyond">The Path Beyond</h2>
<p>Now that you can code confidently in C, here are natural next steps:</p>
<p><strong>1. Systems Programming</strong> Explore Linux internals, system calls, and kernel modules. Books like <em>The Linux Programming Interface</em> or your future “Little Book of System Programming with C” are perfect companions.</p>
<p><strong>2. Compilers and Language Tools</strong> Write your own parser or bytecode interpreter. C gives you the precision to build new languages from scratch.</p>
<p><strong>3. Operating Systems and Embedded</strong> Try building a tiny OS (like <em>xv6</em>), or program microcontrollers with bare-metal C. You’ll see how C shapes the firmware world.</p>
<p><strong>4. Libraries and Open Source</strong> Contribute to open-source projects written in C, from SQLite to Redis to Git. You’ll read world-class C and learn design by example.</p>
<p><strong>5. Build Your Own X in C</strong> You can build your own database, HTTP server, shell, or compiler. Each one is a new chance to reapply what you’ve learned here.</p>
</section>
<section id="a-note-from-the-author" class="level2">
<h2 class="anchored" data-anchor-id="a-note-from-the-author">A Note from the Author</h2>
<p>When Dennis Ritchie designed C in the 1970s, he wasn’t just inventing a language. He was inventing a way to think, about <strong>data, control, and abstraction</strong> at the same time.</p>
<p>Fifty years later, the same clarity still matters. C is timeless because it stays close to truth.</p>
<p>Every byte you allocate, every loop you write, every segmentation fault you fix, it all teaches you how computers <em>really</em> work.</p>
<p>So keep experimenting. Break things. Fix them. Rebuild.</p>
<p>That’s how every systems engineer begins.</p>
</section>
<section id="final-exercise" class="level2">
<h2 class="anchored" data-anchor-id="final-exercise">Final Exercise</h2>
<p>Before you leave this book, write one last C program. It doesn’t need to do anything fancy, just something that reminds you why you love building things from first principles.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1231"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1231-1"><a href="#cb1231-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1231-2"><a href="#cb1231-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1231-3"><a href="#cb1231-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1231-4"><a href="#cb1231-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"I learned to think in C.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb1231-5"><a href="#cb1231-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1231-6"><a href="#cb1231-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compile it. Run it. Smile. You now speak the language of the machine.</p>
<p><strong>The Little Book of C</strong> <em>End of Volume</em></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../index.html" class="pagination-link" aria-label="Content">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Content</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>